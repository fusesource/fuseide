<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>HL7 Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="Hipchat-HipchatComponent.html" title="Hipchat Component"><link rel="next" href="HTTP-HTTPComponent.html" title="HTTP Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="HL7-HL7Component"></a>HL7 Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="HL7-HL7Component.html#HL7-HL7MLLPprotocol">HL7 MLLP protocol</a></span></dt><dt><span class="section"><a href="HL7-HL7Component.html#HL7-HL7Modelusingjava.lang.Stringorbyte">HL7 Model using java.lang.String or byte[]</a></span></dt><dt><span class="section"><a href="HL7-HL7Component.html#HL7-HL7v2ModelusingHAPI">HL7v2 Model using HAPI</a></span></dt><dt><span class="section"><a href="HL7-HL7Component.html#HL7-HL7DataFormat">HL7 DataFormat</a></span></dt><dt><span class="section"><a href="HL7-HL7Component.html#HL7-MessageHeaders">Message Headers</a></span></dt><dt><span class="section"><a href="HL7-HL7Component.html#HL7-Options">Options</a></span></dt><dt><span class="section"><a href="HL7-HL7Component.html#HL7-Dependencies">Dependencies</a></span></dt><dt><span class="section"><a href="HL7-HL7Component.html#HL7-Terserlanguage">Terser language</a></span></dt><dt><span class="section"><a href="HL7-HL7Component.html#HL7-HL7Validationpredicate">HL7 Validation predicate</a></span></dt><dt><span class="section"><a href="HL7-HL7Component.html#HL7-HL7ValidationpredicateusingtheHapiContext">HL7 Validation predicate using the HapiContext (Camel 2.14)</a></span></dt><dt><span class="section"><a href="HL7-HL7Component.html#HL7-HL7Acknowledgementexpression">HL7 Acknowledgement expression</a></span></dt><dt><span class="section"><a href="HL7-HL7Component.html#HL7-MoreSamples">More Samples</a></span></dt><dt><span class="section"><a href="HL7-HL7Component.html#HL7-SeeAlso">See Also</a></span></dt></dl></div><p>The <span class="strong"><strong>HL7</strong></span> component is used for working with the HL7 MLLP protocol and
<a class="link" href="http://www.hl7.org/implement/standards/product_brief.cfm?product_id=185" target="_top">HL7
v2 messages</a> using the <a class="link" href="http://hl7api.sourceforge.net" target="_top">HAPI library</a>.</p><p>This component supports the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">HL7 MLLP codec for <a class="link" href="mina2.html" target="_top">Mina</a></li><li class="listitem">HL7 MLLP codec for&nbsp;<a class="link" href="netty4.html" target="_top">Netty4</a> from&nbsp;<span class="strong"><strong>Camel 2.15</strong></span> onwards</li><li class="listitem"><a class="link" href="type-converter.html" target="_top">Type Converter</a> from/to HAPI and String</li><li class="listitem">HL7 DataFormat using the HAPI library</li><li class="listitem">Even more ease-of-use as it&#8217;s integrated well with the
<a class="link" href="mina2.html" target="_top">camel-mina2</a> component.</li></ul></div><p>Maven users will need to add the following dependency to their <code class="literal">pom.xml</code>
for this component:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-hl7<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="HL7-HL7MLLPprotocol"></a>HL7 MLLP protocol</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="HL7-HL7Component.html#HL7-ExposinganHL7listenerusingMina">Exposing an HL7 listener using Mina</a></span></dt><dt><span class="section"><a href="HL7-HL7Component.html#HL7-ExposinganHL7listenerusingNetty">Exposing an HL7 listener using Netty (available from Camel 2.15 onwards)</a></span></dt></dl></div><p>HL7 is often used with the HL7 MLLP protocol, which is a text based TCP
socket based protocol. This component ships with a Mina and Netty4 Codec
that conforms to the MLLP protocol so you can easily expose an HL7
listener accepting HL7 requests over the TCP transport layer. To expose
a HL7 listener service, the <a class="link" href="mina2.html" target="_top">camel-mina2</a>&nbsp;or
<a class="link" href="netty4.html" target="_top">camel-netty4</a> component is used with the
<code class="literal">HL7MLLPCodec</code>&nbsp;(mina2) or <code class="literal">HL7MLLPNettyDecoder/HL7MLLPNettyEncoder</code>
(Netty4).</p><p>HL7 MLLP codec can be configured as follows:</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="10%" class="col_2"><col width="80%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Default Value</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">startByte</code></p></td><td align="left" valign="top"><p><code class="literal">0x0b</code></p></td><td align="left" valign="top"><p>The start byte spanning the HL7 payload.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">endByte1</code></p></td><td align="left" valign="top"><p><code class="literal">0x1c</code></p></td><td align="left" valign="top"><p>The first end byte spanning the HL7 payload.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">endByte2</code></p></td><td align="left" valign="top"><p><code class="literal">0x0d</code></p></td><td align="left" valign="top"><p>The 2nd end byte spanning the HL7 payload.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">charset</code></p></td><td align="left" valign="top"><p>JVM Default</p></td><td align="left" valign="top"><p>The encoding (a
<a class="link" href="http://docs.oracle.com/javase/6/docs/api/java/nio/charset/Charset.html" target="_top">charset
name</a>) to use for the codec. If not provided, Camel will use the
<a class="link" href="http://docs.oracle.com/javase/6/docs/api/java/nio/charset/Charset.html#defaultCharset()" target="_top">JVM
default Charset</a>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">produceString</code></p></td><td align="left" valign="top"><p><code class="literal">true</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>(as of Camel 2.14.1)</strong></span> If true, the codec creates a string using the
defined charset. If false, the codec sends a plain byte array into the
route, so that the HL7 Data Format can determine the actual charset from
the HL7 message content.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">convertLFtoCR</code></p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p>Will convert <code class="literal">\n</code> to <code class="literal">\r</code> (<code class="literal">0x0d</code>, 13 decimal) as HL7 stipulates <code class="literal">\r</code> as
segment terminators. The HAPI library requires the use of <code class="literal">\r</code>.</p></td></tr></tbody></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="HL7-ExposinganHL7listenerusingMina"></a>Exposing an HL7 listener using Mina</h3></div></div></div><p>In the Spring XML file, we configure a mina2 endpoint to listen for HL7
requests using TCP on port <code class="literal">8888</code>:</p><pre class="programlisting">    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;endpoint</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"hl7MinaListener"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"mina2:tcp://localhost:8888?sync=true&amp;amp;codec=#hl7codec"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong></pre><p><span class="strong"><strong>sync=true</strong></span> indicates that this listener is synchronous and therefore
will return a HL7 response to the caller. The HL7 codec is setup with
<span class="strong"><strong>codec=#hl7codec</strong></span>. Note that <code class="literal">hl7codec</code> is just a Spring bean ID, so it
could be named <code class="literal">mygreatcodecforhl7</code> or whatever. The codec is also set
up in the Spring XML file:</p><pre class="programlisting">    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"hl7codec"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.apache.camel.component.hl7.HL7MLLPCodec"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"charset"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"iso-8859-1"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/bean&gt;</strong></pre><p>The endpoint <span class="strong"><strong>hl7MinaLlistener</strong></span> can then be used in a route as a
consumer, as this Java DSL example illustrates:</p><pre class="programlisting">    from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"hl7MinaListener"</em></strong>).beanRef(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"patientLookupService"</em></strong>);</pre><p>This is a very simple route that will listen for HL7 and route it to a
service named <span class="strong"><strong>patientLookupService</strong></span>. This is also Spring bean ID,
configured in the Spring XML as:</p><pre class="programlisting">    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"patientLookupService"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"com.mycompany.healthcare.service.PatientLookupService"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong></pre><p>The business logic can be implemented in POJO classes that do not depend
on Camel, as shown here:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">import</strong> ca.uhn.hl7v2.HL7Exception;
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">import</strong> ca.uhn.hl7v2.model.Message;
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">import</strong> ca.uhn.hl7v2.model.v24.segment.QRD;

<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong> PatientLookupService {
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> Message lookupPatient(Message input) <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">throws</strong> HL7Exception {
        QRD qrd = (QRD)input.get(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"QRD"</em></strong>);
        String patientId = qrd.getWhoSubjectFilter(<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">0</span>).getIDNumber().getValue();

        <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// find patient data based on the patient id and create a HL7 model object with the response</em>
        Message response = ... create and set response data
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">return</strong> response
    }</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="HL7-ExposinganHL7listenerusingNetty"></a>Exposing an HL7 listener using Netty (available from Camel 2.15 onwards)</h3></div></div></div><p>In the Spring XML file, we configure a netty4 endpoint to listen for HL7
requests using TCP on port <code class="literal">8888</code>:</p><pre class="programlisting">    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;endpoint</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"hl7NettyListener"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"netty4:tcp://localhost:8888?sync=true&amp;amp;encoder=#hl7encoder&amp;amp;decoder=#hl7decoder"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong></pre><p><span class="strong"><strong>sync=true</strong></span> indicates that this listener is synchronous and therefore
will return a HL7 response to the caller. The HL7 codec is setup with
<span class="strong"><strong>encoder=#hl7encoder*and*decoder=#hl7decoder</strong></span>. Note that <code class="literal">hl7encoder</code>
and <code class="literal">hl7decoder</code> are just bean IDs, so they could be named differently.
The beans can be set in the Spring XML file:</p><pre class="programlisting">    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"hl7decoder"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.apache.camel.component.hl7.HL7MLLPNettyDecoderFactory"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
&nbsp;   <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"hl7encoder"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.apache.camel.component.hl7.HL7MLLPNettyEncoderFactory"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong></pre><p>The endpoint <span class="strong"><strong>hl7NettyListener</strong></span> can then be used in a route as a
consumer, as this Java DSL example illustrates:</p><pre class="programlisting">    from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"hl7NettyListener"</em></strong>).beanRef(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"patientLookupService"</em></strong>);</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="HL7-HL7Modelusingjava.lang.Stringorbyte"></a>HL7 Model using java.lang.String or byte[]</h2></div></div></div><p>The HL7 MLLP codec uses plain String as its data format. Camel uses its
<a class="link" href="type-converter.html" target="_top">Type Converter</a> to convert to/from strings to
the HAPI HL7 model objects, but you can use the plain String objects if
you prefer, for instance if you wish to parse the data yourself.</p><p>As of Camel 2.14.1 you can also let both the Mina and Netty codecs use a
plain&nbsp;<code class="literal">byte[]</code> as its data format by setting the <code class="literal">produceString</code>
property to false. The Type Converter is also capable of converting
the&nbsp;<code class="literal">byte[]</code> to/from HAPI HL7 model objects.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="HL7-HL7v2ModelusingHAPI"></a>HL7v2 Model using HAPI</h2></div></div></div><p>The HL7v2 model uses Java objects from the HAPI library. Using this
library, you can encode and decode from the EDI format (ER7) that is
mostly used with HL7v2.</p><p>The sample below is a request to lookup a patient with the patient ID
<code class="literal">0101701234</code>.</p><pre class="programlisting">MSH|^~\\&amp;|MYSENDER|MYRECEIVER|MYAPPLICATION||<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">200612211200</span>||QRY^A19|<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">1234</span>|P|<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">2.4</span>
QRD|<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">200612211200</span>|R|I|GetPatient|||<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">1</span>^RD|<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">0101701234</span>|DEM||</pre><p>Using the HL7 model you can work with a <code class="literal">ca.uhn.hl7v2.model.Message</code>
object, e.g. to retrieve a patient ID:</p><pre class="programlisting">Message msg = exchange.getIn().getBody(Message.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>);
QRD qrd = (QRD)msg.get(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"QRD"</em></strong>);
String patientId = qrd.getWhoSubjectFilter(<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">0</span>).getIDNumber().getValue();  <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// 0101701234</em></pre><p>This is powerful when combined with the HL7 listener, because you don&#8217;t
have to work with <code class="literal">byte[]</code>, <code class="literal">String</code> or any other simple object formats.
You can just use the HAPI HL7v2 model objects. If you know the message
type in advance, you can be more type-safe:</p><pre class="programlisting">QRY_A19 msg = exchange.getIn().getBody(QRY_A19.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>);
String patientId = msg.getQRD().getWhoSubjectFilter(<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">0</span>).getIDNumber().getValue();</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="HL7-HL7DataFormat"></a>HL7 DataFormat</h2></div></div></div><p>The <a class="link" href="hl7.html" target="_top">HL7</a> component ships with a HL7 data format that can
be used to marshal or unmarshal HL7 model objects.</p><p>The HL7 dataformat supports 1 options which are listed below.</p><p>{% raw %}</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="11%" class="col_2"><col width="10%" class="col_3"><col width="60%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Default</th><th align="left" valign="top">Java Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>validate</strong></span></p></td><td align="left" valign="top"><p><code class="literal">true</code></p></td><td align="left" valign="top"><p><code class="literal">Boolean</code></p></td><td align="left" valign="top"><p>Whether to validate the HL7 message Is by default true.</p></td></tr></tbody></table></div><p>{% endraw %}</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">marshal</code> = from Message to byte stream (can be used when responding
using the HL7 MLLP codec)</li><li class="listitem"><code class="literal">unmarshal</code> = from byte stream to Message (can be used when receiving
streamed data from the HL7 MLLP</li></ul></div><p>To use the data format, simply instantiate an instance and invoke the
marshal or unmarshal operation in the route builder:</p><pre class="programlisting">  DataFormat hl7 = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> HL7DataFormat();
  ...
  from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:hl7in"</em></strong>).marshal(hl7).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"jms:queue:hl7out"</em></strong>);</pre><p>In the sample above, the HL7 is marshalled from a HAPI Message object to
a byte stream and put on a JMS queue.
 The next example is the opposite:</p><pre class="programlisting">  DataFormat hl7 = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> HL7DataFormat();
  ...
  from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"jms:queue:hl7out"</em></strong>).unmarshal(hl7).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"patientLookupService"</em></strong>);</pre><p>Here we unmarshal the byte stream into a HAPI Message object that is
passed to our patient lookup service.</p><p><span class="strong"><strong>Serializable messages</strong></span></p><p>As of HAPI 2.0 (used by <span class="strong"><strong>Camel 2.11</strong></span>), the HL7v2 model classes are fully
serializable. So you can put HL7v2 messages directly into a JMS queue
(i.e. without calling <code class="literal">marshal()</code> and read them again directly from the
queue (i.e. without calling <code class="literal">unmarshal()</code>.</p><p><span class="strong"><strong>Segment separators</strong></span></p><p>As of <span class="strong"><strong>Camel 2.11</strong></span>, <code class="literal">unmarshal</code> does not automatically fix segment
separators anymore by converting <code class="literal">\n</code> to <code class="literal">\r</code>. If you 
 need this conversion,
<code class="literal">org.apache.camel.component.hl7.HL7#convertLFToCR</code> provides a handy
<code class="literal">Expression</code> for this purpose.</p><p><span class="strong"><strong>Charset</strong></span></p><p>As of <span class="strong"><strong>Camel 2.14.1</strong></span>, both <code class="literal">marshal and unmarshal</code> evaluate the charset
provided in the field&nbsp;<code class="literal">MSH-18</code>. If this field is empty, by default the
charset contained in the corresponding Camel charset property/header is
assumed. You can even change this default behavior by overriding the
<code class="literal">guessCharsetName</code> method when inheriting from the <code class="literal">HL7DataFormat</code>
class.</p><p>&nbsp;</p><p>There is a shorthand syntax in Camel for well-known data formats that
are commonly used. Then you don&#8217;t need to create an instance of the <code class="literal">HL7DataFormat</code>
object:</p><pre class="programlisting">  from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:hl7in"</em></strong>).marshal().hl7().to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"jms:queue:hl7out"</em></strong>);
  from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"jms:queue:hl7out"</em></strong>).unmarshal().hl7().to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"patientLookupService"</em></strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="HL7-MessageHeaders"></a>Message Headers</h2></div></div></div><p>The unmarshal operation adds these fields from the MSH segment as
headers on the Camel message:</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="10%" class="col_2"><col width="80%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Key</th><th align="left" valign="top">MSH field</th><th align="left" valign="top">Example</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">CamelHL7SendingApplication</code></p></td><td align="left" valign="top"><p><code class="literal">MSH-3</code></p></td><td align="left" valign="top"><p><code class="literal">MYSERVER</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelHL7SendingFacility</code></p></td><td align="left" valign="top"><p><code class="literal">MSH-4</code></p></td><td align="left" valign="top"><p><code class="literal">MYSERVERAPP</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelHL7ReceivingApplication</code></p></td><td align="left" valign="top"><p><code class="literal">MSH-5</code></p></td><td align="left" valign="top"><p><code class="literal">MYCLIENT</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelHL7ReceivingFacility</code></p></td><td align="left" valign="top"><p><code class="literal">MSH-6</code></p></td><td align="left" valign="top"><p><code class="literal">MYCLIENTAPP</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelHL7Timestamp</code></p></td><td align="left" valign="top"><p><code class="literal">MSH-7</code></p></td><td align="left" valign="top"><p><code class="literal">20071231235900</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelHL7Security</code></p></td><td align="left" valign="top"><p><code class="literal">MSH-8</code></p></td><td align="left" valign="top"><p><code class="literal">null</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelHL7MessageType</code></p></td><td align="left" valign="top"><p><code class="literal">MSH-9-1</code></p></td><td align="left" valign="top"><p><code class="literal">ADT</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelHL7TriggerEvent</code></p></td><td align="left" valign="top"><p><code class="literal">MSH-9-2</code></p></td><td align="left" valign="top"><p><code class="literal">A01</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelHL7MessageControl</code></p></td><td align="left" valign="top"><p><code class="literal">MSH-10</code></p></td><td align="left" valign="top"><p><code class="literal">1234</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelHL7ProcessingId</code></p></td><td align="left" valign="top"><p><code class="literal">MSH-11</code></p></td><td align="left" valign="top"><p><code class="literal">P</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelHL7VersionId</code></p></td><td align="left" valign="top"><p><code class="literal">MSH-12</code></p></td><td align="left" valign="top"><p><code class="literal">2.4</code></p></td></tr><tr><td align="left" valign="top"><p>`CamelHL7Context</p></td><td align="left" valign="top"><p>``</p></td><td align="left" valign="top"><p>` <span class="strong"><strong>(Camel 2.14)</strong></span> contains the
<a class="link" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/HapiContext.html" target="_top">HapiContext</a>
that was used to parse the message</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelHL7Charset</code></p></td><td align="left" valign="top"><p><code class="literal">MSH-18</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>(Camel 2.14.1)</strong></span> <code class="literal">UNICODE UTF-8</code></p></td></tr></tbody></table></div><p>All headers except&nbsp;<code class="literal">CamelHL7Context `are `String</code> types. If a header
value is missing, its value is <code class="literal">null</code>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="HL7-Options"></a>Options</h2></div></div></div><p>The HL7 Data Format supports the following options:</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="10%" class="col_2"><col width="80%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Option</th><th align="left" valign="top">Default</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">validate</code></p></td><td align="left" valign="top"><p>true</p></td><td align="left" valign="top"><p>Whether the HAPI Parser should validate the message using the default
validation rules. It is recommended to use the <code class="literal">parser</code> or <code class="literal">hapiContext</code>
option and initialize it with the desired HAPI
<a class="link" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/validation/ValidationContext.html" target="_top"><code class="literal">ValidationContext</code></a></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">parser</code></p></td><td align="left" valign="top"><p><code class="literal">ca.uhn.hl7v2.parser.GenericParser</code></p></td><td align="left" valign="top"><p>Custom parser to be used. Must be of type
<a class="link" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/parser/Parser.html" target="_top"><code class="literal">ca.uhn.hl7v2.parser.Parser</code></a>.
Note that
<a class="link" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/parser/GenericParser.html" target="_top"><code class="literal">GenericParser</code></a>
also allows to parse XML-encoded HL7v2 messages</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">hapiContext</code></p></td><td align="left" valign="top"><p><code class="literal">ca.uhn.hl7v2.DefaultHapiContext</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Camel 2.14:</strong></span> Custom HAPI context that can define a custom parser,
custom ValidationContext etc. This gives you full control over the HL7
parsing and rendering process.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="HL7-Dependencies"></a>Dependencies</h2></div></div></div><p>To use HL7 in your Camel routes you&#8217;ll need to add a dependency on
<span class="strong"><strong>camel-hl7</strong></span> listed above, which implements this data format.</p><p>The HAPI library is split into a
<a class="link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-base" target="_top">base library</a> and
several structure libraries, one for each HL7v2 message version:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-structures-v21" target="_top">v2.1
structures library</a></li><li class="listitem"><a class="link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-structures-v22" target="_top">v2.2
structures library</a></li><li class="listitem"><a class="link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-structures-v23" target="_top">v2.3
structures library</a></li><li class="listitem"><a class="link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-structures-v231" target="_top">v2.3.1
structures library</a></li><li class="listitem"><a class="link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-structures-v24" target="_top">v2.4
structures library</a></li><li class="listitem"><a class="link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-structures-v25" target="_top">v2.5
structures library</a></li><li class="listitem"><a class="link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-structures-v251" target="_top">v2.5.1
structures library</a></li><li class="listitem"><a class="link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-structures-v26" target="_top">v2.6
structures library</a></li></ul></div><p>By default <code class="literal">camel-hl7</code> only references the HAPI
<a class="link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-base" target="_top">base library</a>.
Applications are responsible for including structure libraries
themselves. For example, if an application works with HL7v2 message
versions 2.4 and 2.5 then the following dependencies must be added:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>ca.uhn.hapi<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>hapi-structures-v24<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>2.2<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your hapi-base version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>ca.uhn.hapi<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>hapi-structures-v25<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>2.2<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your hapi-base version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><p>Alternatively, an OSGi bundle containing the base library, all
structures libraries and required dependencies (on the bundle classpath)
can be downloaded from the
<a class="link" href="http://repo1.maven.org/maven2/ca/uhn/hapi/hapi-osgi-base" target="_top">central Maven
repository</a>.</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>ca.uhn.hapi<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>hapi-osgi-base<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>2.2<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="HL7-Terserlanguage"></a>Terser language</h2></div></div></div><p><a class="link" href="http://hl7api.sourceforge.net" target="_top">HAPI</a> provides a
<a class="link" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/util/Terser.html" target="_top">Terser</a>
class that provides access to fields using a commonly used terse
location specification syntax. The Terser language allows to use this
syntax to extract values from messages and to use them as expressions
and predicates for filtering, content-based routing etc.</p><p>Sample:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">import</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">static</strong> org.apache.camel.component.hl7.HL7.terser;
...

   <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// extract patient ID from field QRD-8 in the QRY_A19 message above and put into message header</em>
   from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:test1"</em></strong>)
      .setHeader(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"PATIENT_ID"</em></strong>,terser(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"QRD-8(0)-1"</em></strong>))
      .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:test1"</em></strong>);

  &nbsp;<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// continue processing if extracted field equals a message header</em>
   from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:test2"</em></strong>)
      .filter(terser(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"QRD-8(0)-1"</em></strong>).isEqualTo(header(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"PATIENT_ID"</em></strong>))
      .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:test2"</em></strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="HL7-HL7Validationpredicate"></a>HL7 Validation predicate</h2></div></div></div><p>Often it is preferable to first parse a HL7v2 message and in a separate
step validate it against a HAPI
<a class="link" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/validation/ValidationContext.html" target="_top">ValidationContext</a>.</p><p>Sample:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">import</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">static</strong> org.apache.camel.component.hl7.HL7.messageConformsTo;
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">import</strong> ca.uhn.hl7v2.validation.impl.DefaultValidation;
...

   <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// Use standard or define your own validation rules</em>
   ValidationContext defaultContext = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> DefaultValidation();

   <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// Throws PredicateValidationException if message does not validate</em>
   from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:test1"</em></strong>)
      .validate(messageConformsTo(defaultContext))
      .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:test1"</em></strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="HL7-HL7ValidationpredicateusingtheHapiContext"></a>HL7 Validation predicate using the HapiContext (Camel 2.14)</h2></div></div></div><p>The HAPI Context is always configured with a
<a class="link" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/validation/ValidationContext.html" target="_top">ValidationContext</a>
(or a
<a class="link" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/validation/builder/ValidationRuleBuilder.html" target="_top">ValidationRuleBuilder</a>),
so you can access the validation rules indirectly. Furthermore, when
unmarshalling the HL7DataFormat forwards the configured HAPI context in
the <code class="literal">CamelHL7Context</code> header, and the validation rules of this context
can be easily reused:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">import</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">static</strong> org.apache.camel.component.hl7.HL7.messageConformsTo;
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">import</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">static</strong> org.apache.camel.component.hl7.HL7.messageConforms
...

  HapiContext hapiContext = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> DefaultHapiContext();
  hapiContext.getParserConfiguration().setValidating(false); <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// don't validate during parsing</em>

  <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// customize HapiContext some more ... e.g. enforce that PID-8 in ADT_A01 messages of version 2.4 is not empty</em>
  ValidationRuleBuilder builder = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> ValidationRuleBuilder() {
      <em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Override</span></em>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">protected</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> configure() {
         forVersion(Version.V24)
              .message(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"ADT"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"A01"</em></strong>)
              .terser(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"PID-8"</em></strong>, not(empty()));
         }
      };
  hapiContext.setValidationRuleBuilder(builder);

  HL7DataFormat hl7 = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> HL7DataFormat();
  hl7.setHapiContext(hapiContext);

  from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:test1"</em></strong>)
     .unmarshal(hl7)                <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// uses the GenericParser returned from the HapiContext</em>
     .validate(messageConforms())   <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// uses the validation rules returned from the HapiContext</em>
                                    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// equivalent with .validate(messageConformsTo(hapiContext))</em>
     <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// route continues from here</em></pre><p>&nbsp;</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="HL7-HL7Acknowledgementexpression"></a>HL7 Acknowledgement expression</h2></div></div></div><p>A common task in HL7v2 processing is to generate an acknowledgement
message as response to an incoming HL7v2 message, e.g. based on a
validation result. The <code class="literal">ack</code> expression lets us accomplish this very
elegantly:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">import</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">static</strong> org.apache.camel.component.hl7.HL7.messageConformsTo;
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">import</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">static</strong> org.apache.camel.component.hl7.HL7.ack;
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">import</strong> ca.uhn.hl7v2.validation.impl.DefaultValidation;
...

  <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// Use standard or define your own validation rules</em>
   ValidationContext defaultContext = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> DefaultValidation();

   from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:test1"</em></strong>)
      .onException(Exception.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>)
         .handled(true)
         .transform(ack()) <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// auto-generates negative ack because of exception in Exchange</em>
         .end()
      .validate(messageConformsTo(defaultContext))
      <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// do something meaningful here</em>
      ...
      <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// acknowledgement</em>
      .transform(ack())</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="HL7-MoreSamples"></a>More Samples</h2></div></div></div><p>In the following example, a plain <code class="literal">String</code> HL7 request is sent to an HL7
listener that sends back a response:</p><p>In the next sample, HL7 requests from the HL7 listener are routed to the
business logic, which is implemented as plain POJO registered in the
registry as <code class="literal">hl7service</code>.</p><p>Then the Camel routes using the <code class="literal">RouteBuilder</code> may look as follows:</p><p>Note that by using the HL7 DataFormat the Camel message headers are
populated with the fields from the MSH segment. The headers are
particularly useful for filtering or content-based routing as shown in
the example above.</p><p>&nbsp;</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="HL7-SeeAlso"></a>See Also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="configuring-camel.html" target="_top">Configuring Camel</a></li><li class="listitem"><a class="link" href="component.html" target="_top">Component</a></li><li class="listitem"><a class="link" href="endpoint.html" target="_top">Endpoint</a></li><li class="listitem"><a class="link" href="getting-started.html" target="_top">Getting Started</a></li></ul></div></div></div></body></html>