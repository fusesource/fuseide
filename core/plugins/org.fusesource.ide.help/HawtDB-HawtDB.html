<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>HawtDB Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="GuavaEventBus-GuavaEventBusComponent.html" title="Guava EventBus Component"><link rel="next" href="HazelcastComponent-HazelcastComponent.html" title="Hazelcast Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="HawtDB-HawtDB"></a>HawtDB Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="HawtDB-HawtDB.html#HawtDB-UsingHawtDBAggregationRepository">Using HawtDBAggregationRepository</a></span></dt><dt><span class="section"><a href="HawtDB-HawtDB.html#HawtDB-Whatispreservedwhenpersisting">What is preserved when persisting</a></span></dt><dt><span class="section"><a href="HawtDB-HawtDB.html#HawtDB-Recovery">Recovery</a></span></dt><dt><span class="section"><a href="HawtDB-HawtDB.html#HawtDB-Dependencies">Dependencies</a></span></dt><dt><span class="section"><a href="HawtDB-HawtDB.html#HawtDB-SeeAlso">See Also</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel 2.3</strong></span></p><p><a class="link" href="http://hawtdb.fusesource.org/" target="_top">HawtDB</a> is a very lightweight and
embedable key value database. It allows together with Camel to provide
persistent support for various Camel features such as
<a class="link" href="aggregator2.html" target="_top">Aggregator</a>.</p><p><span class="strong"><strong>Deprecated</strong></span></p><p>The <a class="link" href="http://hawtdb.fusesource.org/" target="_top">HawtDB</a> project is being deprecated
and replaced by <a class="link" href="https://code.google.com/p/leveldb/" target="_top">leveldb</a> as the
lightweight and embedable key value database. To make using leveldb easy
there is a <a class="link" href="https://github.com/fusesource/leveldbjni" target="_top">leveldbjni</a> project
for that. The Apache ActiveMQ project is planning on using leveldb as
their primary file based message store in the future, to replace kahadb.</p><p>There os a <a class="link" href="leveldb.html" target="_top">camel-leveldb</a> component we recommend to
use instead of this.</p><p><span class="strong"><strong>Issue with HawtDB 1.4 or older</strong></span></p><p>There is a bug in HawtDB 1.4 or older which means the filestore will not
free unused space. That means the file keeps growing. This has been
fixed in HawtDB 1.5 which is shipped with Camel 2.5 onwards.</p><p>Current features it provides:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">HawtDBAggregationRepository</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="HawtDB-UsingHawtDBAggregationRepository"></a>Using HawtDBAggregationRepository</h2></div></div></div><p><code class="literal">HawtDBAggregationRepository</code> is an <code class="literal">AggregationRepository</code> which on the
fly persists the aggregated messages. This ensures that you will not
loose messages, as the default aggregator will use an in memory only
<code class="literal">AggregationRepository</code>.</p><p>It has the following options:</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="10%" class="col_2"><col width="80%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Option</th><th align="left" valign="top">Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">repositoryName</code></p></td><td align="left" valign="top"><p>String</p></td><td align="left" valign="top"><p>A mandatory repository name. Allows you to use a shared <code class="literal">HawtDBFile</code> for
multiple repositories.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">persistentFileName</code></p></td><td align="left" valign="top"><p>String</p></td><td align="left" valign="top"><p>Filename for the persistent storage. If no file exists on startup a new
file is created.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">bufferSize</code></p></td><td align="left" valign="top"><p>int</p></td><td align="left" valign="top"><p>The size of the memory segment buffer which is mapped to the file store.
By default its 8mb. The value is in bytes.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">sync</code></p></td><td align="left" valign="top"><p>boolean</p></td><td align="left" valign="top"><p>Whether or not the <code class="literal">HawtDBFile</code> should sync on write or not. Default is
<code class="literal">true</code>. By sync on write ensures that its always waiting for all writes
to be spooled to disk and thus will not loose updates. If you disable
this option, then HawtDB will auto sync when it has batched up a number
of writes.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">pageSize</code></p></td><td align="left" valign="top"><p>short</p></td><td align="left" valign="top"><p>The size of memory pages. By default its 512 bytes. The value is in
bytes.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">hawtDBFile</code></p></td><td align="left" valign="top"><p>HawtDBFile</p></td><td align="left" valign="top"><p>Use an existing configured
<code class="literal">org.apache.camel.component.hawtdb.HawtDBFile</code> instance.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">returnOldExchange</code></p></td><td align="left" valign="top"><p>boolean</p></td><td align="left" valign="top"><p>Whether the get operation should return the old existing Exchange if any
existed. By default this option is <code class="literal">false</code> to optimize as we do not need
the old exchange when aggregating.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">useRecovery</code></p></td><td align="left" valign="top"><p>boolean</p></td><td align="left" valign="top"><p>Whether or not recovery is enabled. This option is by default <code class="literal">true</code>.
When enabled the Camel <a class="link" href="aggregator2.html" target="_top">Aggregator</a> automatic
recover failed aggregated exchange and have them resubmitted.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">recoveryInterval</code></p></td><td align="left" valign="top"><p>long</p></td><td align="left" valign="top"><p>If recovery is enabled then a background task is run every x&#8217;th time to
scan for failed exchanges to recover and resubmit. By default this
interval is 5000 millis.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">maximumRedeliveries</code></p></td><td align="left" valign="top"><p>int</p></td><td align="left" valign="top"><p>Allows you to limit the maximum number of redelivery attempts for a
recovered exchange. If enabled then the Exchange will be moved to the
dead letter channel if all redelivery attempts failed. By default this
option is disabled. If this option is used then the <code class="literal">deadLetterUri</code>
option must also be provided.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">deadLetterUri</code></p></td><td align="left" valign="top"><p>String</p></td><td align="left" valign="top"><p>An endpoint uri for a <a class="link" href="dead-letter-channel.html" target="_top">Dead Letter Channel</a>
where exhausted recovered Exchanges will be moved. If this option is
used then the <code class="literal">maximumRedeliveries</code> option must also be provided.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">optimisticLocking</code></p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Camel 2.12:</strong></span> To turn on optimistic locking, which often would be needed
in clustered environments where multiple Camel applications shared the
same HawtDB based aggregation repository.</p></td></tr></tbody></table></div><p>The <code class="literal">repositoryName</code> option must be provided. Then either the
<code class="literal">persistentFileName</code> or the <code class="literal">hawtDBFile</code> must be provided.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="HawtDB-Whatispreservedwhenpersisting"></a>What is preserved when persisting</h2></div></div></div><p><code class="literal">HawtDBAggregationRepository</code> will only preserve any <code class="literal">Serializable</code>
compatible data types. If a data type is not such a type its dropped and
a <code class="literal">WARN</code> is logged. And it only persists the <code class="literal">Message</code> body and the
<code class="literal">Message</code> headers. The <code class="literal">Exchange</code> properties are <span class="strong"><strong>not</strong></span> persisted.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="HawtDB-Recovery"></a>Recovery</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="HawtDB-HawtDB.html#HawtDB-UsingHawtDBAggregationRepositoryinJavaDSL">Using HawtDBAggregationRepository in Java DSL</a></span></dt><dt><span class="section"><a href="HawtDB-HawtDB.html#HawtDB-UsingHawtDBAggregationRepositoryinSpringXML">Using HawtDBAggregationRepository in Spring XML</a></span></dt></dl></div><p>The <code class="literal">HawtDBAggregationRepository</code> will by default recover any failed
<a class="link" href="exchange.html" target="_top">Exchange</a>. It does this by having a background tasks
that scans for failed <a class="link" href="exchange.html" target="_top">Exchange</a>s in the persistent
store. You can use the <code class="literal">checkInterval</code> option to set how often this task
runs. The recovery works as transactional which ensures that Camel will
try to recover and redeliver the failed <a class="link" href="exchange.html" target="_top">Exchange</a>.
Any <a class="link" href="exchange.html" target="_top">Exchange</a> which was found to be recovered will be
restored from the persistent store and resubmitted and send out again.</p><p>The following headers is set when an <a class="link" href="exchange.html" target="_top">Exchange</a> is
being recovered/redelivered:</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="10%" class="col_2"><col width="80%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Header</th><th align="left" valign="top">Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">Exchange.REDELIVERED</code></p></td><td align="left" valign="top"><p>Boolean</p></td><td align="left" valign="top"><p>Is set to true to indicate the <a class="link" href="exchange.html" target="_top">Exchange</a> is being
redelivered.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Exchange.REDELIVERY_COUNTER</code></p></td><td align="left" valign="top"><p>Integer</p></td><td align="left" valign="top"><p>The redelivery attempt, starting from 1.</p></td></tr></tbody></table></div><p>Only when an <a class="link" href="exchange.html" target="_top">Exchange</a> has been successfully
processed it will be marked as complete which happens when the <code class="literal">confirm</code>
method is invoked on the <code class="literal">AggregationRepository</code>. This means if the same
<a class="link" href="exchange.html" target="_top">Exchange</a> fails again it will be kept retried until
it success.</p><p>You can use option <code class="literal">maximumRedeliveries</code> to limit the maximum number of
redelivery attempts for a given recovered <a class="link" href="exchange.html" target="_top">Exchange</a>.
You must also set the <code class="literal">deadLetterUri</code> option so Camel knows where to
send the <a class="link" href="exchange.html" target="_top">Exchange</a> when the <code class="literal">maximumRedeliveries</code> was
hit.</p><p>You can see some examples in the unit tests of camel-hawtdb, for example
<a class="link" href="https://svn.apache.org/repos/asf/camel/trunk/components/camel-hawtdb/src/test/java/org/apache/camel/component/hawtdb/HawtDBAggregateRecoverTest.java" target="_top">this
test</a>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="HawtDB-UsingHawtDBAggregationRepositoryinJavaDSL"></a>Using HawtDBAggregationRepository in Java DSL</h3></div></div></div><p>In this example we want to persist aggregated messages in the
<code class="literal">target/data/hawtdb.dat</code> file.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="HawtDB-UsingHawtDBAggregationRepositoryinSpringXML"></a>Using HawtDBAggregationRepository in Spring XML</h3></div></div></div><p>The same example but using Spring XML instead:</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="HawtDB-Dependencies"></a>Dependencies</h2></div></div></div><p>To use <a class="link" href="hawtdb.html" target="_top">HawtDB</a> in your camel routes you need to add the
a dependency on <span class="strong"><strong>camel-hawtdb</strong></span>.</p><p>If you use maven you could just add the following to your pom.xml,
substituting the version number for the latest &amp; greatest release (see
<a class="link" href="download.html" target="_top">the download page for the latest versions</a>).</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-hawtdb<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>2.3.0<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="HawtDB-SeeAlso"></a>See Also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="configuring-camel.html" target="_top">Configuring Camel</a></li><li class="listitem"><a class="link" href="component.html" target="_top">Component</a></li><li class="listitem"><a class="link" href="endpoint.html" target="_top">Endpoint</a></li><li class="listitem"><a class="link" href="getting-started.html" target="_top">Getting Started</a></li><li class="listitem"><a class="link" href="aggregator2.html" target="_top">Aggregator</a></li><li class="listitem"><a class="link" href="components.html" target="_top">Components</a></li></ul></div></div></div></body></html>