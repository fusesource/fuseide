<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>HTTP</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><meta name="keywords" content="ESB, Apache ServiceMix, Open Source, open source, integration, OSGi, enterprise service bus, Apache ServiceMix documentation, Apache Karaf, Red Hat JBoss Fuse, Red Hat JBoss Fuse documentation"><meta name="keywords" content="ESB, Apache ServiceMix, Open Source, open source, integration, OSGi, enterprise service bus, Apache ServiceMix documentation, Apache Karaf, Red Hat JBoss Fuse, Red Hat JBoss Fuse documentation"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Apache Camel Component Reference"><link rel="prev" href="IDU-HL7.html" title="HL7"><link rel="next" href="IDU-HTTP4.html" title="HTTP4"><link rel="copyright" href="tmdisclaim.html" title="Trademark Disclaimer"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="IDU-HTTP"></a>HTTP</h1></div></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_HTTPComponent"></a>HTTP Component</h2></div></div></div><p>The <span class="bold"><strong>http:</strong></span> component provides HTTP-based <span class="phrase">endpoints</span> for consuming external
            HTTP resources (as a client to call external servers using HTTP).</p><p>Maven users will need to add the following dependency to their <code class="literal">pom.xml</code> for this component:</p><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
    &lt;artifactId&gt;camel-http&lt;/artifactId&gt;
    &lt;version&gt;2.18.1.redhat-000005&lt;/version&gt;
    &lt;!-- use the same version as your Camel core version --&gt;
&lt;/dependency&gt;</pre></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_URIformat"></a>URI format</h2></div></div></div><pre class="programlisting">http:hostname[:port][/resourceUri][?param1=value1][&amp;param2=value2]</pre><p>Will by default use port 80 for HTTP and 443 for HTTPS.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important: camel-http vs camel-jetty"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="imagesdb/important.png"></td><th align="left">camel-http vs camel-jetty</th></tr><tr><td align="left" valign="top"><p>You can only produce to endpoints generated by the HTTP component. Therefore it should
        never be used as input into your camel Routes. To bind/expose an HTTP endpoint via a HTTP
        server as input to a camel route, you can use the <a href="IDU-Jetty.html" class="olink">Jetty
          Component</a> or the <a href="IDU-SERVLET.html" class="olink">Servlet component</a>. </p></td></tr></table></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_Examples"></a>Examples</h2></div></div></div><p>Call the url with the body using POST and return response as out message. If body is null call URL using GET and return response as out message</p><table id="d0e101759"><tr>
        <th>Java DSL</th>
        <th>Spring DSL</th>
      </tr><tr>
        <td>
<pre class="programlisting">from("direct:start")
  .to("http://myhost/mypath");
</pre>
        </td>
        <td>
<pre class="programlisting">&lt;from uri="direct:start"/&gt;
&lt;to uri="http://oldhost"/&gt;
</pre>
        </td>
      </tr></table><p>You can override the HTTP endpoint URI by adding a header. Camel will call the <a class="link" href="http://newhost" target="_top">http://newhost</a>. This is very handy for e.g. REST urls.</p><table id="d0e101787"><tr>
        <th>Java DSL</th>
      </tr><tr>
        <td>
<pre class="programlisting">from("direct:start")
  .setHeader(Exchange.HTTP_URI, simple("http://myserver/orders/${header.orderId}"))
  .to("http://dummyhost");
</pre>
        </td>
      </tr></table><p>URI parameters can either be set directly on the endpoint URI or as a header</p><table id="d0e101803"><tr>
        <th>Java DSL</th>
      </tr><tr>
        <td>
<pre class="programlisting">
from("direct:start")
  .to("http://oldhost?order=123&amp;detail=short");
from("direct:start")
  .setHeader(Exchange.HTTP_QUERY, constant("order=123&amp;detail=short"))
  .to("http://oldhost");
</pre>
        </td>
      </tr></table><p>Set the HTTP request method to POST</p><table id="d0e101819"><tr>
        <th>Java DSL</th>
        <th>Spring DSL</th>
      </tr><tr>
        <td>
<pre class="programlisting">from("direct:start")
  .setHeader(Exchange.HTTP_METHOD, constant("POST"))
  .to("http://www.google.com");
</pre>
        </td>
        <td>
<pre class="programlisting">
&lt;from uri="direct:start"/&gt;
&lt;setHeader headerName="CamelHttpMethod"&gt;
  &lt;constant&gt;POST&lt;/constant&gt;
&lt;/setHeader&gt;
&lt;to uri="http://www.google.com"/&gt;
&lt;to uri="mock:results"/&gt;
</pre>
        </td>
      </tr></table></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_HttpEndpointOptions"></a>HttpEndpoint Options</h2></div></div></div><p>

    </p><table id="d0e101850"><tr>
        <th> Name </th>
        <th> Default Value </th>
        <th> Description </th>
      </tr><tr>
        <td><code class="literal">throwExceptionOnFailure</code>
        </td>
        <td><code class="literal">true</code>
        </td>
        <td> Option to disable throwing the <code class="literal">HttpOperationFailedException</code> in case
          of failed responses from the remote server. This allows you to get all responses
          regardless of the HTTP status code. </td>
      </tr><tr>
        <td><code class="literal">bridgeEndpoint</code>
        </td>
        <td><code class="literal">false</code>
        </td>
        <td>
          <p> If the option is true , HttpProducer will ignore the Exchange.HTTP_URI header, and
            use the endpoint's URI for request. You may also set the <span class="bold"><strong>throwExceptionOnFailure</strong></span> to be false to let the HttpProducer send all the
            fault response back. <span class="bold"><strong>Camel 2.3:</strong></span> If the option is true,
            HttpProducer and CamelServlet will skip the gzip processing if the content-encoding is
            "gzip". </p>
        </td>
      </tr><tr>
        <td><code class="literal">disableStreamCache</code>
        </td>
        <td><code class="literal">false</code>
        </td>
        <td> DefaultHttpBinding will copy the request input stream into a stream cache and put it
                    into message body if this option is false to support read it twice, otherwise
                    DefaultHttpBinding will set the request input stream direct into the message
                    body. <span class="bold"><strong>Camel 2.17:</strong></span> This option is now also
                    supported by the producer to enable using the response stream directly, instead
                    of stream caching by default.</td>
      </tr><tr>
        <td><code class="literal">httpBinding</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> Reference to a <code class="literal">org.apache.camel.component.http.HttpBinding</code> in the Registry. </td>
      </tr><tr>
        <td><code class="literal">httpClientConfigurer</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> Reference to a <code class="literal">org.apache.camel.component.http.HttpClientConfigurer</code> in the Registry. </td>
      </tr><tr>
        <td><code class="literal">httpClient.XXX</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> Setting options on the <a class="link" href="http://hc.apache.org/httpclient-3.x/apidocs/org/apache/commons/httpclient/params/HttpClientParams.html" target="_top">HttpClientParams</a>. For instance <code class="literal">httpClient.soTimeout=5000</code> will set the <code class="literal">SO_TIMEOUT</code> to 5 seconds. </td>
      </tr><tr>
        <td><code class="literal">clientConnectionManager</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> To use a custom <code class="literal">org.apache.http.conn.ClientConnectionManager</code>. </td>
      </tr><tr>
        <td><code class="literal">transferException</code>
        </td>
        <td><code class="literal">false</code>
        </td>
        <td><span class="bold"><strong>Camel 2.6:</strong></span> If enabled and an <a class="link" href="Exchange" target="_top">Exchange</a> failed
          processing on the consumer side, and if the caused <code class="literal">Exception</code> was send
          back serialized in the response as a
            <code class="literal">application/x-java-serialized-object</code> content type (for example using
            <a href="IDU-Jetty.html" class="olink">Jetty</a> or <a href="IDU-SERVLET.html" class="olink">Servlet</a> Camel components). On the producer side the exception will be
          deserialized and thrown as is, instead of the
            <code class="literal">HttpOperationFailedException</code>. The caused exception is required to be
          serialized. </td>
      </tr><tr>
        <td><code class="literal">headerFilterStrategy</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td><span class="bold"><strong>Camel 2.11:</strong></span> Reference to a instance of <code class="literal">org.apache.camel.spi.HeaderFilterStrategy</code> in the Registry. It will be used to apply the custom headerFilterStrategy on the new create HttpEndpoint. </td>
      </tr><tr>
                <td><code class="literal">eagerCheckContentAvailable</code>
                </td>
                <td><code class="literal">false</code>
                </td>
                <td><span class="bold"><strong>Camel 2.15.3/2.16:</strong></span> Consumer only. Whether to
                    eager check whether the HTTP requests has content if the Content-Length header
                    is 0 or not present. This can be turned on in case HTTP clients do not send
                    streamed data. </td>
            </tr><tr>
                <td><code class="literal">copyHeaders</code>
                </td>
                <td><code class="literal">true</code>
                </td>
                <td><span class="bold"><strong>Camel 2.16:</strong></span> If <code class="code">true</code>, IN exchange
                    headers will be copied to OUT exchange headers in accordance with the copy
                    strategy. If <code class="code">false</code>, only the headers from the HTTP response will be
                    included (IN headers will not be copied).</td>
            </tr><tr>
                <td><code class="literal">okStatusCodeRange</code>
                </td>
                <td><code class="literal">200-299</code>
                </td>
                <td><span class="bold"><strong>Camel 2.16:</strong></span> The status codes which are
                    considered a success response. The values are inclusive. The range must be
                    defined using the syntax,
                            <code class="code"><em class="replaceable"><code>from</code></em>-<em class="replaceable"><code>to</code></em></code>.</td>
            </tr><tr>
                <td><code class="literal">ignoreResponseBody</code>
                </td>
                <td><code class="literal">false</code>
                </td>
                <td><span class="bold"><strong>Camel 2.16:</strong></span> If <code class="code">true</code>, the http
                    producer will not read the response body and cache the input stream.</td>
            </tr></table></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_AuthenticationandProxy"></a>Authentication and Proxy</h2></div></div></div><p>The following authentication options can also be set on the HttpEndpoint:</p><p>

    </p><table id="d0e102150"><tr>
        <th> Name </th>
        <th> Default Value </th>
        <th> Description </th>
      </tr><tr>
        <td><code class="literal">authMethod</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> Authentication method, either as <code class="literal">Basic</code>, <code class="literal">Digest</code> or <code class="literal">NTLM</code>. </td>
      </tr><tr>
        <td><code class="literal">authMethodPriority</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> Priority of authentication methods. Is a list separated with comma. For example: <code class="literal">Basic,Digest</code> to exclude <code class="literal">NTLM</code>. </td>
      </tr><tr>
        <td><code class="literal">authUsername</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> Username for authentication </td>
      </tr><tr>
        <td><code class="literal">authPassword</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> Password for authentication </td>
      </tr><tr>
        <td><code class="literal">authDomain</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> Domain for NTML authentication </td>
      </tr><tr>
        <td><code class="literal">authHost</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> Optional host for NTML authentication </td>
      </tr><tr>
        <td><code class="literal">proxyHost</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> The proxy host name </td>
      </tr><tr>
        <td><code class="literal">proxyPort</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> The proxy port number </td>
      </tr><tr>
        <td><code class="literal">proxyAuthMethod</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> Authentication method for proxy, either as <code class="literal">Basic</code>, <code class="literal">Digest</code> or <code class="literal">NTLM</code>. </td>
      </tr><tr>
        <td><code class="literal">proxyAuthUsername</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> Username for proxy authentication </td>
      </tr><tr>
        <td><code class="literal">proxyAuthPassword</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> Password for proxy authentication </td>
      </tr><tr>
        <td><code class="literal">proxyAuthDomain</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> Domain for proxy NTML authentication </td>
      </tr><tr>
        <td><code class="literal">proxyAuthHost</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> Optional host for proxy NTML authentication </td>
      </tr></table><p>When using authentication you <span class="bold"><strong>must</strong></span> provide the choice of method for the <code class="literal">authMethod</code> or <code class="literal">authProxyMethod</code> options.
You can configure the proxy and authentication details on either the <code class="literal">HttpComponent</code> or the <code class="literal">HttpEndoint</code>. Values provided on the <code class="literal">HttpEndpoint</code> will take precedence over <code class="literal">HttpComponent</code>. Its most likely best to configure this on the <code class="literal">HttpComponent</code> which allows you to do this once.</p><p>The <a href="IDU-HTTP.html" class="olink">HTTP</a> component uses convention over configuration
      which means that if you have not explicit set a <code class="literal">authMethodPriority</code> then it
      will fallback and use the select(ed) <code class="literal">authMethod</code> as priority as well. So if
      you use <code class="literal">authMethod.Basic</code> then the <code class="literal">auhtMethodPriority</code>
      will be <code class="literal">Basic</code> only.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The Camel HTTP component is based on HttpClient v3.x and as such has only <a class="link" href="http://hc.apache.org/httpclient-3.x/authentication.html#NTLM" target="_top">limited
                    support</a> for what is known as NTLMv1, the early version of the NTLM
                protocol. It does not support NTLMv2 at all. The <a href="IDU-HTTP4.html" class="olink">Camel
                    HTTP4</a> component has support for NTLMv2.</p></td></tr></table></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_HttpComponentOptions"></a>HttpComponent Options</h2></div></div></div><p>

    </p><table id="d0e102444"><tr>
        <th> Name </th>
        <th> Default Value </th>
        <th> Description </th>
      </tr><tr>
        <td><code class="literal">httpBinding</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> To use a custom <code class="literal">org.apache.camel.component.http.HttpBinding</code>. </td>
      </tr><tr>
        <td><code class="literal">httpClientConfigurer</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> To use a custom <code class="literal">org.apache.camel.component.http.HttpClientConfigurer</code>. </td>
      </tr><tr>
        <td><code class="literal">httpConnectionManager</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> To use a custom <code class="literal">org.apache.commons.httpclient.HttpConnectionManager</code>. </td>
      </tr><tr>
        <td><code class="literal">httpConfiguration</code></td>
        <td><code class="literal">null</code>
        </td>
        <td> To use a custom <code class="literal">org.apache.camel.component.http.HttpConfiguration</code>
        </td>
      </tr><tr>
                <td><code class="literal">allowJavaSerializedObject</code></td>
                <td><code class="literal">false</code>
                </td>
                <td>
                    <p><span class="bold"><strong>Camel 2.16.1/2.15.5:</strong></span> Whether to allow
                        java serialization when a request uses
                            <code class="code">context-type=application/x-java-serialized-object</code>. This
                        option is turned off by default. <span class="bold"><strong>Warning:</strong></span>
                        If you enable this option, then be aware that Java will deserialize the
                        incoming data from the request to Java, and that can be a potential security
                        risk.</p>
                </td>
            </tr></table></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_MessageHeaders"></a>Message Headers</h2></div></div></div><p>

    </p><table id="d0e102560"><tr>
        <th> Name </th>
        <th> Type </th>
        <th> Description </th>
      </tr><tr>
        <td><code class="literal">Exchange.HTTP_URI</code>
        </td>
        <td><code class="literal">String</code>
        </td>
        <td> URI to call. Will override existing URI set directly on the endpoint. This URI is the
                    URI of the HTTP server to call. Its not the same as the Camel endpoint URI,
                    where you can configure endpoint options such as security and so on. This header
                    does not support that, its only the UTI of the HTTP server.</td>
      </tr><tr>
        <td><code class="literal">Exchange.HTTP_METHOD</code>
        </td>
        <td><code class="literal">String</code>
        </td>
        <td> HTTP Method / Verb to use (GET/POST/PUT/DELETE/HEAD/OPTIONS/TRACE) </td>
      </tr><tr>
        <td><code class="literal">Exchange.HTTP_PATH</code>
        </td>
        <td><code class="literal">String</code>
        </td>
        <td> Request URI's path, the header will be used to build the request URI with the HTTP_URI. <span class="bold"><strong>Camel 2.3.0:</strong></span> If the path is start with "/", http producer will try to find the relative path based on the Exchange.HTTP_BASE_URI header or the exchange.getFromEndpoint().getEndpointUri(); </td>
      </tr><tr>
        <td><code class="literal">Exchange.HTTP_QUERY</code>
        </td>
        <td><code class="literal">String</code>
        </td>
        <td> URI parameters. Will override existing URI parameters set directly on the endpoint. </td>
      </tr><tr>
        <td><code class="literal">Exchange.HTTP_RESPONSE_CODE</code>
        </td>
        <td><code class="literal">int</code>
        </td>
        <td> The HTTP response code from the external server. Is 200 for OK. </td>
      </tr><tr>
        <td><code class="literal">Exchange.HTTP_CHARACTER_ENCODING</code>
        </td>
        <td><code class="literal">String</code>
        </td>
        <td> Character encoding. </td>
      </tr><tr>
        <td><code class="literal">Exchange.CONTENT_TYPE</code>
        </td>
        <td><code class="literal">String</code>
        </td>
        <td> The HTTP content type. Is set on both the IN and OUT message to provide a content type, such as <code class="literal">text/html</code>. </td>
      </tr><tr>
        <td><code class="literal">Exchange.CONTENT_ENCODING</code>
        </td>
        <td><code class="literal">String</code>
        </td>
        <td> The HTTP content encoding. Is set on both the IN and OUT message to provide a content encoding, such as <code class="literal">gzip</code>. </td>
      </tr><tr>
        <td><code class="literal">Exchange.HTTP_SERVLET_REQUEST</code>
        </td>
        <td><code class="literal">HttpServletRequest</code>
        </td>
        <td> The <code class="literal">HttpServletRequest</code> object. </td>
      </tr><tr>
        <td><code class="literal">Exchange.HTTP_SERVLET_RESPONSE</code>
        </td>
        <td><code class="literal">HttpServletResponse</code>
        </td>
        <td> The <code class="literal">HttpServletResponse</code> object. </td>
      </tr><tr>
        <td><code class="literal">Exchange.HTTP_PROTOCOL_VERSION</code>
        </td>
        <td><code class="literal">String</code>
        </td>
        <td><span class="bold"><strong>Camel 2.5:</strong></span> You can set the http protocol version with this header, eg. "HTTP/1.0". If you didn't specify the header, HttpProducer will use the default value "HTTP/1.1" </td>
      </tr></table><p>The header name above are constants. For the spring DSL you have to use the value of the constant instead of the name.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_MessageBody"></a>Message Body</h2></div></div></div><p>Camel will store the HTTP response from the external server on the OUT body. All headers from the IN message will be copied to the OUT message, so headers are preserved during routing. Additionally Camel will add the HTTP response headers as well to the OUT message headers.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_Responsecode"></a>Response code</h2></div></div></div><p>Camel will handle according to the HTTP response code:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Response code is in the range 100..299, Camel regards it as a success response.</p></li><li class="listitem"><p>Response code is in the range 300..399, Camel regards it as a redirection response and will throw a <code class="literal">HttpOperationFailedException</code> with the information.</p></li><li class="listitem"><p>Response code is 400+, Camel regards it as an external server failure and will throw a <code class="literal">HttpOperationFailedException</code> with the information.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: throwExceptionOnFailure"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="imagesdb/tip.png"></td><th align="left">throwExceptionOnFailure</th></tr><tr><td align="left" valign="top"><p>The option, <code class="literal">throwExceptionOnFailure</code>, can be set to <code class="literal">false</code> to prevent the <code class="literal">HttpOperationFailedException</code> from being thrown for failed response codes. This allows you to get any response from the remote server.
There is a sample below demonstrating this.</p></td></tr></table></div></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_HttpOperationFailedException"></a>HttpOperationFailedException</h2></div></div></div><p>This exception contains the following information:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The HTTP status code</p></li><li class="listitem"><p>The HTTP status line (text of the status code)</p></li><li class="listitem"><p>Redirect location, if server returned a redirect</p></li><li class="listitem"><p>Response body as a <code class="literal">java.lang.String</code>, if server provided a body as response</p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_CallingusingGETorPOST"></a>Calling using GET or POST</h2></div></div></div><p>The following algorithm is used to determine if either <code class="literal">GET</code> or <code class="literal">POST</code> HTTP method should be used:
1. Use method provided in header.
2. <code class="literal">GET</code> if query string is provided in header.
3. <code class="literal">GET</code> if endpoint is configured with a query string.
4. <code class="literal">POST</code> if there is data to send (body is not null).
5. <code class="literal">GET</code> otherwise.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_HowtogetaccesstoHttpServletRequestandHttpServletResponse"></a>How to get access to HttpServletRequest and HttpServletResponse</h2></div></div></div><p>You can get access to these two using the Camel type converter system using</p><pre class="programlisting">
HttpServletRequest request = exchange.getIn().getBody(HttpServletRequest.class);
HttpServletRequest response = exchange.getIn().getBody(HttpServletResponse.class);
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_UsingclienttimeoutSOTIMEOUT"></a>Using client timeout - SO_TIMEOUT</h2></div></div></div><p>See the unit test in <a class="link" href="http://svn.apache.org/viewvc?view=rev&amp;revision=781775" target="_top">this link</a>
    </p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_ConfiguringaProxy"></a>Configuring a Proxy</h2></div></div></div><table id="d0e102865"><tr>
        <th>Java DSL</th>
      </tr><tr>
        <td>
<pre class="programlisting">from("direct:start")
  .to("http://oldhost?proxyHost=www.myproxy.com&amp;proxyPort=80");
</pre>
        </td>
      </tr></table><p>There is also support for proxy authentication via the <code class="literal">proxyUsername</code> and <code class="literal">proxyPassword</code> options.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_UsingproxysettingsoutsideofURI"></a>Using proxy settings outside of URI</h2></div></div></div><table id="d0e102891"><tr>
        <th>Java DSL</th>
        <th>Spring DSL</th>
      </tr><tr>
        <td>
<pre class="programlisting">
 context.getProperties().put("http.proxyHost", "172.168.18.9");
 context.getProperties().put("http.proxyPort" "8080");
</pre>
        </td>
        <td>
<pre class="programlisting">
   &lt;camelContext&gt;
       &lt;properties&gt;
           &lt;property key="http.proxyHost" value="172.168.18.9"/&gt;
           &lt;property key="http.proxyPort" value="8080"/&gt;
      &lt;/properties&gt;
   &lt;/camelContext&gt;
</pre>
        </td>
      </tr></table><p>Options on Endpoint will override options on the context.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_Configuringcharset"></a>Configuring charset</h2></div></div></div><p>If you are using <code class="literal">POST</code> to send data you can configure the <code class="literal">charset</code>
    </p><pre class="programlisting">
setProperty(Exchange.CHARSET_NAME, "iso-8859-1");
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_Samplewithscheduledpoll"></a>Sample with scheduled poll</h2></div></div></div><p>The sample polls the Google homepage every 10 seconds and write the page to the file <code class="literal">message.html</code>:</p><pre class="programlisting">
from("timer://foo?fixedRate=true&amp;delay=0&amp;period=10000")
    .to("http://www.google.com")
    .setHeader(FileComponent.HEADER_FILE_NAME, "message.html").to("file:target/google");
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_GettingtheResponseCode"></a>Getting the Response Code</h2></div></div></div><p>You can get the HTTP response code from the HTTP component by getting the value from the
            Out message header with <code class="literal">Exchange.HTTP_RESPONSE_CODE</code>.</p><pre class="programlisting">
   Exchange exchange = template.send("http://www.google.com/search", new Processor() {
            public void process(Exchange exchange) throws Exception {
                exchange.getIn().setHeader(Exchange.HTTP_QUERY, constant("hl=en&amp;q=activemq"));
            }
   });
   Message out = exchange.getOut();
   int responseCode = out.getHeader(Exchange.HTTP_RESPONSE_CODE, Integer.class);
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_UsingthrowExceptionOnFailurefalsetogetanyresponseback"></a>Using throwExceptionOnFailure=false to get any response back</h2></div></div></div><p>In the route below we want to route a message that we <span class="phrase">enrich</span> with data returned from a remote HTTP call. As we want any response from the remote server, we set the <code class="literal">throwExceptionOnFailure</code> option to <code class="literal">false</code> so we get any response in the <code class="literal">AggregationStrategy</code>. As the code is based on a unit test that simulates a HTTP status code 404, there is some assertion code etc.</p><pre class="programlisting">// We set throwExceptionOnFailure to false to let Camel return any response from the remove HTTP server without thrown
// HttpOperationFailedException in case of failures.
// This allows us to handle all responses in the aggregation strategy where we can check the HTTP response code
// and decide what to do. As this is based on an unit test we assert the code is 404
from("direct:start").enrich("http://localhost:{{port}}/myserver?throwExceptionOnFailure=false&amp;user=Camel", new AggregationStrategy() {
    public Exchange aggregate(Exchange original, Exchange resource) {
        // get the response code
        Integer code = resource.getIn().getHeader(Exchange.HTTP_RESPONSE_CODE, Integer.class);
        assertEquals(404, code.intValue());
        return resource;
    }
}).to("mock:result");

// this is our jetty server where we simulate the 404
from("jetty://http://localhost:{{port}}/myserver")
        .process(new Processor() {
            public void process(Exchange exchange) throws Exception {
                exchange.getOut().setBody("Page not found");
                exchange.getOut().setHeader(Exchange.HTTP_RESPONSE_CODE, 404);
            }
        });
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_DisablingCookies"></a>Disabling Cookies</h2></div></div></div><p>To disable cookies you can set the HTTP Client to ignore cookies by adding this URI option:
<code class="literal">httpClient.cookiePolicy=ignoreCookies</code>
    </p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_AdvancedUsage"></a>Advanced Usage</h2></div></div></div><p>If you need more control over the HTTP producer you should use the <code class="literal">HttpComponent</code> where you can set various classes to give you custom behavior.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_SettingMaxConnectionsPerHost"></a>Setting MaxConnectionsPerHost</h2></div></div></div><p>The <a href="IDU-HTTP.html" class="olink">HTTP</a> Component has a
        <code class="literal">org.apache.commons.httpclient.HttpConnectionManager</code> where you can
      configure various global configuration for the given component. By global, we mean that any
      endpoint the component creates has the same shared <code class="literal">HttpConnectionManager</code>.
      So, if we want to set a different value for the max connection per host, we need to define it
      on the HTTP component and <span class="bold"><strong>not</strong></span> on the endpoint URI that we
      usually use. So here comes:</p><p>First, we define the <code class="literal">http</code> component in Spring XML. Yes, we use the same scheme name, <code class="literal">http</code>, because otherwise Camel will auto-discover and create the component with default settings. What we need is to overrule this so we can set our options. In the sample below we set the max connection to 5 instead of the default of 2.</p><pre class="programlisting">&lt;bean id="http" class="org.apache.camel.component.http.HttpComponent"&gt;
    &lt;property name="camelContext" ref="camel"/&gt;
    &lt;property name="httpConnectionManager" ref="myHttpConnectionManager"/&gt;
&lt;/bean&gt;

&lt;bean id="myHttpConnectionManager" class="org.apache.commons.httpclient.MultiThreadedHttpConnectionManager"&gt;
    &lt;property name="params" ref="myHttpConnectionManagerParams"/&gt;
&lt;/bean&gt;

&lt;bean id="myHttpConnectionManagerParams" class="org.apache.commons.httpclient.params.HttpConnectionManagerParams"&gt;
    &lt;property name="defaultMaxConnectionsPerHost" value="5"/&gt;
&lt;/bean&gt;

</pre><p>And then we can just use it as we normally do in our routes:</p><pre class="programlisting">&lt;camelContext id="camel" xmlns="http://camel.apache.org/schema/spring" trace="true"&gt;
    &lt;route&gt;
        &lt;from uri="direct:start"/&gt;
        &lt;to uri="http://www.google.com"/&gt;
        &lt;to uri="mock:result"/&gt;
    &lt;/route&gt;
&lt;/camelContext&gt;
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_Usingpreemptiveauthentication"></a>Using preemptive authentication</h2></div></div></div><p>An end user reported that he had problem with authenticating with HTTPS. The problem was eventually resolved when he discovered the HTTPS server did not return a HTTP code 401 Authorization Required. The solution was to set the following URI option: <code class="literal">httpClient.authenticationPreemptive=true</code>
    </p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_Acceptingselfsignedcertificatesfromremoteserver"></a>Accepting self signed certificates from remote server</h2></div></div></div><p>See this <a class="link" href="http://www.nabble.com/Using-HTTPS-in-camel-http-when-remote-side-has-self-signed-cert-td25916878.html" target="_top">link</a> from a mailing list discussion with some code to outline how to do this with the Apache Commons HTTP API.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_UsingtheJSSEConfigurationUtility"></a>Using the JSSE Configuration Utility</h2></div></div></div><p>As of Camel 2.8, the HTTP4 component supports SSL/TLS configuration through the <a class="link" href="http://camel.apache.org/camel-configuration-utilities.html" target="_top">JSSE utility</a>. This utility greatly decreases the amount of component specific code  you need to write and is configurable at the endpoint and component  levels.&nbsp;The following examples demonstrate how to use the utility with  the HTTP4 component.</p><p>The version of the Apache HTTP client used in this component resolves SSL/TLS information from a global "protocol" registry.&nbsp;This component provides an implementation, <code class="literal">org.apache.camel.component.http.SSLContextParametersSecureProtocolSocketFactory</code>, of the HTTP client's protocol socket factory in order to support the use of the Camel JSSE Configuration utility.&nbsp;The following example demonstrates how to configure the protocol registry and use the registered protocol information in a route.</p><pre class="programlisting">
KeyStoreParameters ksp = new KeyStoreParameters();
ksp.setResource("/users/home/server/keystore.jks");
ksp.setPassword("keystorePassword");

KeyManagersParameters kmp = new KeyManagersParameters();
kmp.setKeyStore(ksp);
kmp.setKeyPassword("keyPassword");

SSLContextParameters scp = new SSLContextParameters();
scp.setKeyManagers(kmp);

ProtocolSocketFactory factory =
    new SSLContextParametersSecureProtocolSocketFactory(scp);

Protocol.registerProtocol("https",
        new Protocol(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "https",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; factory,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 443));

from("direct:start")
        .to("https://mail.google.com/mail/").to("mock:results");
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-HTTP_HSH_ConfiguringApacheHTTPClientDirectly"></a>Configuring Apache HTTP Client Directly</h2></div></div></div><p>Basically the HTTP component is built on the top of Apache HTTP client, and you can
            implement a custom
                <code class="literal">org.apache.camel.component.http.HttpClientConfigurer</code> to do some
            configuration on the http client if you need full control of it.</p><p>However if you <span class="emphasis"><em>just</em></span> want to specify the keystore and truststore you can do this with Apache HTTP <code class="literal">HttpClientConfigurer</code>, for example:</p><pre class="programlisting">
Protocol authhttps = new Protocol("https", new AuthSSLProtocolSocketFactory(
  new URL("file:my.keystore"), "mypassword",
  new URL("file:my.truststore"), "mypassword"), 443);

Protocol.registerProtocol("https", authhttps);
</pre><p>And then you need to create a class that implements <code class="literal">HttpClientConfigurer</code>, and registers https protocol providing a keystore or truststore per example above. Then, from your camel route builder class you can hook it up like so:</p><pre class="programlisting">
HttpComponent httpComponent = getContext().getComponent("http", HttpComponent.class);
httpComponent.setHttpClientConfigurer(new MyHttpClientConfigurer());
</pre><p>If you are doing this using the Spring DSL, you can specify your <code class="literal">HttpClientConfigurer</code> using the URI.  For example:</p><pre class="programlisting">
&lt;bean id="myHttpClientConfigurer"
 class="my.https.HttpClientConfigurer"&gt;
&lt;/bean&gt;

&lt;to uri="https://myhostname.com:443/myURL?httpClientConfigurerRef=myHttpClientConfigurer"/&gt;
</pre><p>As long as you implement the HttpClientConfigurer and configure your keystore and truststore as described above, it will work fine.</p><p>

    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a href="IDU-Jetty.html" class="olink">Jetty</a>
        </p></li></ul></div></div></div></body></html>