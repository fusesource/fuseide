<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Adding a Content-Based Router</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling"><link rel="up" href="RiderTT.html" title="Part&nbsp;I.&nbsp;Tooling Tutorials"><link rel="prev" href="RiderTutorialRun.html" title="Running a Route"><link rel="next" href="RiderTutorialAddRoute.html" title="Adding another route to the routing context"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="RiderTutorialCBR"></a>Adding a Content-Based Router</h2></div></div></div><p>This tutorial shows how to add a Content-Based Router (CBR) and logging to a route.</p><p>A CBR routes a message to a destination based on its content. In this tutorial, the CBR that you create routes messages to different folders (valid or invalid) based on the value of each message&#8217;s quantity field (the number of animals in the order). The maximum value of animals for each order is 10. The CBR routes the messages to different folders, depending on whether the quantity is greater than 10. For example, if a zoo orders five zebras and only three zebras are available, the order is copied to the invalid order target folder.</p><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_goals_4"></a>Goals</h2></div></div></div><p>In this tutorial you complete the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Add a Content-Based Router to your route</li><li class="listitem"><p class="simpara">Configure the Content-Based Router:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">Add a log endpoint to each output branch of the content-based router</li><li class="listitem">Add a Set Header EIP after each log endpoint</li><li class="listitem">Add an Otherwise branch to the content-based router</li></ul></div></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_prerequisites_3"></a>Prerequisites</h2></div></div></div><p>To start this tutorial, you need the <span class="strong"><strong>ZooOrderApp</strong></span> project resulting from one of the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p class="simpara">Completing the <a class="xref" href="RiderTutorialRun.html" title="Running a Route"><i>Running a Route</i></a> tutorial.</p><p class="simpara">or</p></li><li class="listitem">Completing the <a class="xref" href="RiderTutorialSetup.html" title="Setting up your environment"><i>Setting up your environment</i></a> tutorial and replacing your project&#8217;s <code class="literal">blueprint.xml</code> file with the provided <code class="literal">blueprintContexts/blueprint1.xml</code> file, as described in <a class="xref" href="RiderTutorialIntro.html#AboutResourceFiles" title="About the resource files">About the resource files</a>.</li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_adding_and_configuring_a_content_based_router"></a>Adding and configuring a Content-Based Router</h2></div></div></div><p>To add and configure a Content-Based Router for your route:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">In <span class="strong"><strong>Project Explorer</strong></span>, double-click <code class="literal">ZooOrderApp/src/main/resources/OSGI-INF/blueprint/blueprint.xml</code> to
open it in the Editor view.</li><li class="listitem">On the <span class="strong"><strong>Design</strong></span>  canvas, select the <code class="literal">To_Received</code> node and then select
the trash can icon to delete it.</li><li class="listitem"><p class="simpara">In the <span class="strong"><strong>Palette</strong></span>, open the <span class="strong"><strong>Routing</strong></span>
drawer, click a <span class="strong"><strong>Choice</strong></span> (
<span class="inlinemediaobject"><img src="images/choice.png" alt="Choice icon"></span>) pattern, and then (in the <span class="strong"><strong>Design</strong></span> canvas) click the
<code class="literal">From_from1</code> node.</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRaddChoice1.png" alt="tutCBRaddChoice1"></div></div><p class="simpara">The <code class="literal">Route_route1</code> container expands to accommodate the
<code class="literal">Choice_choice1</code> node. The error icon indicates that the <code class="literal">Choice_choice1</code> node requires a child node, which you add next.</p></li><li class="listitem"><p class="simpara">From the <span class="strong"><strong>Routing</strong></span> drawer, click the <span class="strong"><strong>When</strong></span> (
<span class="inlinemediaobject"><img src="images/endpointdef.png" alt="When icon"></span>) pattern and then, in the canvas, click the
<code class="literal">Choice_choice1</code> node.</p><p class="simpara">The <code class="literal">Choice_choice1</code> container expands to accommodate the
<code class="literal">When_when1</code> node:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRaddWhen1.png" alt="tutCBRaddWhen1"></div></div><p class="simpara">The <span class="inlinemediaobject"><img src="./images/warning_obj.gif" alt="warning icon"></span> decorating the <code class="literal">When_when1</code> node
indicates that one or more required property values must be set.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The tooling prevents you from adding a pattern to an invalid drop point in a Route
container.</p></td></tr></table></div></li><li class="listitem"><p class="simpara">On the canvas, select the <code class="literal">When_when1</code> node, to open its
properties in the <span class="strong"><strong>Properties</strong></span> view:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRWhen1OpenProps.png" alt="tutCBRWhen1OpenProps"></div></div></li><li class="listitem">Click the
<span class="inlinemediaobject"><img src="./images/popup_menu.gif" alt="drop-down menu icon"></span> button in the <span class="strong"><strong>Expression</strong></span> field to open
the list of available options.</li><li class="listitem"><p class="simpara">Select  <span class="strong"><strong>xpath</strong></span> (for the XML query language) because the test messages are written in XML.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Once you select the <span class="strong"><strong>Expression</strong></span> language, the
<span class="strong"><strong>Properties</strong></span> view displays its properties in an
indented list directly below the <span class="strong"><strong>Expression</strong></span> field. The
<span class="strong"><strong>Id</strong></span> property in this indented list sets the ID of the
expression. The <span class="strong"><strong>Id</strong></span> property following the
<span class="strong"><strong>Description</strong></span> field sets the ID of the
<code class="literal">When</code> node.</p></td></tr></table></div></li><li class="listitem"><p class="simpara">In the indented <span class="strong"><strong>Expression</strong></span> field, type: <code class="literal">/order/orderline/quantity/text() &gt; 10</code></p><p class="simpara">This expression specifies that only messages in which the value of the <span class="strong"><strong>quantity</strong></span> field is greater than 10 travel this path in the route (to the invalidOrders folder).</p></li><li class="listitem"><p class="simpara">Leave each of the remaining properties as they are.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <span class="strong"><strong>Trim</strong></span> option (enabled by default) removes any leading or trailing white spaces and line breaks from the message.</p></td></tr></table></div><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRWhen1Props.png" alt="tutCBRWhen1Props"></div></div></li><li class="listitem"><span class="strong"><strong>Save</strong></span> the routing context file.</li><li class="listitem"><p class="simpara">Click the <span class="strong"><strong>Source</strong></span> tab to view the XML for the route:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRaddedSourceV.png" alt="tutCBRaddedSourceV"></div></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_adding_and_configuring_logging"></a>Adding and configuring logging</h2></div></div></div><p>For the ZooOrder application example, you add a log message so that you can track an XML message as it passes through the route. When you run the route, the log message appears in the <span class="strong"><strong>Console</strong></span> view.</p><p>Follow these steps to add logging to your CBR route:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">In the <span class="strong"><strong>Design</strong></span> tab&#8217;s <span class="strong"><strong>Palette</strong></span>, open the <span class="strong"><strong>Components</strong></span> drawer and click the <span class="strong"><strong>Log</strong></span> component (<span class="inlinemediaobject"><img src="images/log.png" alt="Log icon"></span>).</li><li class="listitem"><p class="simpara">In the canvas, click the <code class="literal">When_when1</code> node.</p><p class="simpara">The <code class="literal">When_when1</code> container expands to accommodate the
<code class="literal">Log_log1</code> node:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRlog1Added.png" alt="tutCBRlog1Added"></div></div></li><li class="listitem">On the canvas, select the <code class="literal">Log_log1</code> node to open its properties in the
<span class="strong"><strong>Properties</strong></span> view.</li><li class="listitem"><p class="simpara">In the <span class="strong"><strong>Message</strong></span> field, type: <span class="strong"><strong><code class="literal">The quantity requested exceeds the maximum allowed - contact customer.</code></strong></span></p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRlog1Properties.png" alt="tutCBRlog1Properties"></div></div></li></ol></div><p>Leave the remaining properties as they are.</p><p>+</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The tooling auto-generates a log node <span class="strong"><strong>id</strong></span> value. In the <span class="strong"><strong>Fuse Integration</strong></span> perspective&#8217;s <span class="strong"><strong>Messages</strong></span>
view, the tooling inserts the contents of the log node&#8217;s
<span class="strong"><strong>Id</strong></span> field in the <span class="strong"><strong>Trace Node Id</strong></span> column
for message instances, when tracing is enabled on the route
(see the <a class="xref" href="RiderTutorialTrace.html" title="Tracing a message through a route"><i>Tracing a message through a route</i></a> tutorial). In the
<span class="strong"><strong>Console</strong></span>, it adds the contents of the log node&#8217;s
<span class="strong"><strong>Message</strong></span> field to the log data whenever the route
runs.</p></td></tr></table></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><span class="strong"><strong>Save</strong></span> the routing context file.</li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_adding_and_configuring_message_headers"></a>Adding and configuring message headers</h2></div></div></div><p>A message header contains information to process a message.</p><p>To add and configure message headers:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">In the <span class="strong"><strong>Palette</strong></span>, open the
<span class="strong"><strong>Transformation</strong></span> drawer and then click the <span class="strong"><strong>Set
Header</strong></span> (
<span class="inlinemediaobject"><img src="images/setHeader.png" alt="Set Header icon"></span>) pattern.</li><li class="listitem"><p class="simpara">In the canvas, click the <code class="literal">Log_log1</code> node.</p><p class="simpara">The <code class="literal">When_when1</code> container expands to accommodate the
<code class="literal">SetHeader_setHeader1</code> node:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutSetHead1Added.png" alt="tutSetHead1Added"></div></div></li><li class="listitem"><p class="simpara">On the canvas, select the <code class="literal">SetHeader_setHeader1</code> node to open its
properties in the <span class="strong"><strong>Properties</strong></span> view:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutSetHeadPropEdNew.png" alt="tutSetHeadPropEdNew"></div></div></li><li class="listitem">Click the
<span class="inlinemediaobject"><img src="./images/popup_menu.gif" alt="drop-down menu icon"></span> button in the <span class="strong"><strong>Expression</strong></span> field to open
the list of available languages, and then select <span class="strong"><strong>constant</strong></span>.</li><li class="listitem">In the indented <span class="strong"><strong>Expression</strong></span> field, type <code class="literal"><span class="strong"><strong>Invalid</strong></span></code>.</li><li class="listitem">In the <span class="strong"><strong>Header Name</strong></span> field, type <code class="literal"><span class="strong"><strong>Destination</strong></span></code>.</li><li class="listitem"><p class="simpara">Leave the remaining properties as they are.</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutSetHead1Properties2.png" alt="tutSetHead1Properties2"></div></div></li><li class="listitem">In the <span class="strong"><strong>Palette</strong></span>, open the <span class="strong"><strong>Components</strong></span> drawer and then click the <span class="strong"><strong>File</strong></span> (<span class="inlinemediaobject"><img src="images/file.png" alt="File icon"></span>) component.</li><li class="listitem"><p class="simpara">In the canvas, click the <code class="literal">SetHeader_setHeader1</code> node.</p><p class="simpara">The <code class="literal">When_when1</code> container expands to accommodate the <code class="literal">To_to1</code> node.</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRWhen1TargetFile.png" alt="tutCBRWhen1TargetFile"></div></div></li><li class="listitem"><p class="simpara">On the canvas, select the <code class="literal">To_to1</code> node to open its properties in the
<span class="strong"><strong>Properties</strong></span> view:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRNewTargetFileProps1.png" alt="tutCBRNewTargetFileProps1"></div></div></li><li class="listitem"><p class="simpara">On the <span class="strong"><strong>Details</strong></span> tab, replace <span class="emphasis"><em>directoryName</em></span> with
<code class="literal"><span class="strong"><strong>target/messages/invalidOrders</strong></span></code> in the
<span class="strong"><strong>Uri</strong></span> field, and type <code class="literal"><span class="strong"><strong>_Invalid</strong></span></code> in
the <span class="strong"><strong>Id</strong></span> field:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRNewTargetFileProps2.png" alt="tutCBRNewTargetFileProps2"></div></div></li><li class="listitem"><span class="strong"><strong>Save</strong></span> the routing context file.</li><li class="listitem"><p class="simpara">Click the <span class="strong"><strong>Source</strong></span> tab to view the XML for the route:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRLogHeaderSourceV.png" alt="tutCBRLogHeaderSourceV"></div></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_adding_and_configuring_a_branch_to_handle_valid_orders"></a>Adding and configuring a branch to handle valid orders</h2></div></div></div><p>So far, the CBR handles messages that contain invalid orders (orders where the quantity value is greater than 10).</p><p>To add and configure an otherwise branch of your route to handle valid orders (that is, any XML messages that do not match the XPath expression set for the <span class="strong"><strong>When_when1</strong></span> node):</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">In the <span class="strong"><strong>Palette</strong></span>, open the <span class="strong"><strong>Routing</strong></span> drawer and click the <span class="strong"><strong>Otherwise</strong></span> (
<span class="inlinemediaobject"><img src="images/endpointdef.png" alt="Otherwise icon"></span>) pattern.</li><li class="listitem"><p class="simpara">In the canvas, click the <code class="literal">Choice_choice1</code> container:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRaddOtherwise.png" alt="tutCBRaddOtherwise"></div></div><p class="simpara">The <code class="literal">Choice_choice1</code> container expands to accommodate the
<code class="literal">Otherwise_otherwise1</code> node.</p></li><li class="listitem">On the canvas, select the <code class="literal">Otherwise_otherwise1</code> node to
open its properties in the <span class="strong"><strong>Properties</strong></span> view.</li><li class="listitem"><p class="simpara">In the <span class="strong"><strong>Id</strong></span> field, change <code class="literal">_otherwise1</code> to <code class="literal"><span class="strong"><strong>_elseValid</strong></span></code>:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBROtherwiseProps.png" alt="tutCBROtherwiseProps"></div></div></li></ol></div><p>To configure logging for the otherwise branch:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">In the <span class="strong"><strong>Palette</strong></span>, open the <span class="strong"><strong>Components</strong></span>
drawer and and then click the <span class="strong"><strong>Log</strong></span> (
<span class="inlinemediaobject"><img src="images/log.png" alt="Log icon"></span>) component.</li><li class="listitem"><p class="simpara">In the canvas, click the <code class="literal">Otherwise_elseValid</code> node:</p><p class="simpara">The <code class="literal">Otherwise-elseValid</code> container expands to accommodate the
<code class="literal">Log_log2</code> node.</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBROtherwiseLogAdd.png" alt="tutCBROtherwiseLogAdd"></div></div></li><li class="listitem">On the canvas, select the <code class="literal">Log_log2</code> node to open its properties in
the <span class="strong"><strong>Properties</strong></span> view.</li><li class="listitem"><p class="simpara">In the <span class="strong"><strong>Message</strong></span> field, type <code class="literal"><span class="strong"><strong>This is a valid order - OK to process.</strong></span></code></p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBROtherwiseLog2.png" alt="tutCBROtherwiseLog2"></div></div><p class="simpara">Leave the remaining properties as they are.</p></li><li class="listitem"><span class="strong"><strong>Save</strong></span> the route.</li></ol></div><p>To configure a message header for the otherwise branch:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">In the <span class="strong"><strong>Palette</strong></span>, open the <span class="strong"><strong>Transformation</strong></span> drawer and then click the <span class="strong"><strong>Set
Header</strong></span> pattern.</li><li class="listitem"><p class="simpara">In the canvas, click the <code class="literal">Log_log2</code> node.</p><p class="simpara">The <code class="literal">Otherwise_elseValid</code> container expands to accommodate
the <code class="literal">SetHeader_setHeader2</code> node.</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRSetHead2Add.png" alt="tutCBRSetHead2Add"></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You can collapse containers to free up space when the diagram becomes congested. To do so,
select the container you want to collapse, and then click its
<span class="inlinemediaobject"><img src="./images/collapse.gif" alt="collapse icon"></span> button:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRcollapseWhen1Container.png" alt="tutCBRcollapseWhen1Container"></div></div><p>To reopen the container, select it and then click its
<span class="inlinemediaobject"><img src="./images/expand.gif" alt="expand icon"></span> button:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRexpandWhen1Container.png" alt="tutCBRexpandWhen1Container"></div></div><p>Collapsing and expanding containers in the <span class="strong"><strong>Design</strong></span>
tab does not affect the routing context file. It remains unchanged.</p></td></tr></table></div></li><li class="listitem">On the canvas, select the <code class="literal">SetHeader_setHeader2</code> node to open its
properties in the <span class="strong"><strong>Properties</strong></span> view.</li><li class="listitem">Click the
<span class="inlinemediaobject"><img src="./images/popup_menu.gif" alt="drop-down menu icon"></span> button in the <span class="strong"><strong>Expression</strong></span> field to open
the list of available languages, and select
<span class="strong"><strong>constant</strong></span>.</li><li class="listitem">In the indented <span class="strong"><strong>Expression</strong></span> field, type <code class="literal"><span class="strong"><strong>ReadyForDispatcher</strong></span></code>.</li><li class="listitem">In the <span class="strong"><strong>Header Name</strong></span> field, type <code class="literal"><span class="strong"><strong>Destination</strong></span></code>.</li><li class="listitem"><p class="simpara">Leave the remaining properties as they are.</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBROtherwiseSetHeadProps2.png" alt="tutCBROtherwiseSetHeadProps2"></div></div></li></ol></div><p>To specify the target folder for the valid messages:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">In the <span class="strong"><strong>Palette</strong></span>, open the <span class="strong"><strong>Components</strong></span>
drawer and then select the <span class="strong"><strong>File</strong></span> (
<span class="inlinemediaobject"><img src="images/file.png" alt="File icon"></span>) component.</li><li class="listitem"><p class="simpara">In the canvas, click the <code class="literal">SetHeader_setHeader2</code> node.</p><p class="simpara">The <code class="literal">Otherwise_elseValid</code> container expands to accommodate the
<code class="literal">To_to1</code> node.</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBROtherwiseFileAdd.png" alt="tutCBROtherwiseFileAdd"></div></div></li><li class="listitem">On the canvas, select the <code class="literal">To_to1</code> node to open its properties in the <span class="strong"><strong>Properties</strong></span> view.</li><li class="listitem"><p class="simpara">In the <span class="strong"><strong>URI</strong></span> field, replace <span class="emphasis"><em>directoryName</em></span> with <code class="literal"><span class="strong"><strong>target/messages/validOrders</strong></span></code>, and in the <span class="strong"><strong>Id</strong></span> field, type <code class="literal"><span class="strong"><strong>_Valid</strong></span></code>.</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBROtherwiseTargFile2.png" alt="tutCBROtherwiseTargFile2"></div></div></li><li class="listitem"><p class="simpara"><span class="strong"><strong>Save</strong></span> the routing context file.</p><p class="simpara">The completed content-based router should look like this:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRfinalDesignV.png" alt="tutCBRfinalDesignV"></div></div></li><li class="listitem"><p class="simpara">Click the <span class="strong"><strong>Source</strong></span> tab at the bottom,
left of the canvas to display the XML for the route.</p><pre class="screen">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.osgi.org/xmlns/blueprint/v1.0.0
    https://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
    http://camel.apache.org/schema/blueprint
    https://camel.apache.org/schema/blueprint/camel-blueprint.xsd"&gt;

&lt;camelContext id="_context1" xmlns="http://camel.apache.org/schema/blueprint"&gt;
        &lt;route id="_route1"&gt;
            &lt;from id="_from1" uri="file:src/data?noop=true"/&gt;
            &lt;choice id="_choice1"&gt;
                &lt;when id="_when1"&gt;
                    &lt;xpath&gt;/order/orderline/quantity/text() &amp;gt; 10&lt;/xpath&gt;
                    &lt;log id="_log1" message="The quantity requested exceeds the maximum allowed - contact customer."/&gt;
                    &lt;setHeader headerName="Destination" id="_setHeader1"&gt;
                        &lt;constant&gt;Invalid&lt;/constant&gt;
                    &lt;/setHeader&gt;
                    &lt;to id="_Invalid" uri="file:target/messages/invalidOrders"/&gt;
                &lt;/when&gt;
                &lt;otherwise id="_elseValid"&gt;
                    &lt;log id="_log2" message="This is a valid order - OK to process."/&gt;
                    &lt;setHeader headerName="Destination" id="_setHeader2"&gt;
                        &lt;constant&gt;ReadyForDispatcher&lt;/constant&gt;
                    &lt;/setHeader&gt;
                    &lt;to id="_Valid" uri="file:target/messages/validOrders"/&gt;
                &lt;/otherwise&gt;
            &lt;/choice&gt;
        &lt;/route&gt;
    &lt;/camelContext&gt;
&lt;/blueprint&gt;</pre></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_verifying_the_cbr"></a>Verifying the CBR</h2></div></div></div><p>You can run the new route as described in the <a class="xref" href="RiderTutorialRun.html#RiderRunRun" title="Running the route">Running the route</a> tutorial and look at the <span class="strong"><strong>Console</strong></span> view to see the log messages.</p><p>After you run it, to verify whether the route executed properly, check the target destination folders in the <span class="strong"><strong>Project Explorer</strong></span>:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Select <code class="literal">ZooOrderApp</code>.</li><li class="listitem">Right-click it to open the context menu, and then select <span class="strong"><strong>Refresh</strong></span>.</li><li class="listitem"><p class="simpara">Under the project root node (<code class="literal">ZooOrderApp</code>), locate the <code class="literal">target/messages/</code> folder and expand it.</p><div class="informalfigure"><div class="mediaobject"><img src="images/tutSimpZooOrderAppVerify.png" alt="message destinations"></div></div></li><li class="listitem"><p class="simpara">Check that the <code class="literal">target/messages/invalidOrders</code> folder contains <code class="literal">message1.xml</code> and <code class="literal">message3.xml</code>.</p><p class="simpara">In these messages, the value of the <code class="literal">quantity</code> element exceeds 10.</p></li><li class="listitem"><p class="simpara">Check that the <code class="literal">target/messages/validOrders</code> folder contains the four
message files that contain valid orders:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">message2.xml</code></li><li class="listitem"><code class="literal">message4.xml</code></li><li class="listitem"><code class="literal">message5.xml</code></li><li class="listitem"><p class="simpara"><code class="literal">message6.xml</code></p><p class="simpara">In these messages, the value of the <code class="literal">quantity</code> element is less than or equal to 10.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>To view message content, double-click each message to open it in the route editor&#8217;s XML editor.</p></td></tr></table></div></li></ul></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_next_steps_4"></a>Next steps</h2></div></div></div><p>In the next tutorial, <a class="xref" href="RiderTutorialAddRoute.html" title="Adding another route to the routing context"><i>Adding another route to the routing context</i></a>, you add a second route that further processes valid order messages.</p></div></div></body></html>