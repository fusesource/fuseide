<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>To Add a Content-Based Router</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><meta name="description" content="This tutorial shows how to add a content-based router with logging to a route."><meta name="keywords" content="ESB, Apache ServiceMix, Open Source, open source, integration, OSGi, enterprise service bus, Apache ServiceMix documentation, Apache Karaf, Red Hat JBoss Fuse, Red Hat JBoss Fuse documentation"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="RiderTutorials.html" title="Tutorials"><link rel="prev" href="RiderTutorialRun.html" title="To Run a Route"><link rel="next" href="RiderTutorialAddRoute.html" title="To Add Another Route to the CBR Routing Context"><link rel="copyright" href="tmdisclaim.html" title="Trademark Disclaimer"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="RiderTutorialCBR"></a>To Add a Content-Based Router</h1></div><div><div class="abstract"><p>This tutorial shows how to add a content-based router with logging to a
                route.</p></div></div></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e20105"></a>Goals</h2></div></div></div><p>In this tutorial you will:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Add a content-based router to your route</p></li><li class="listitem"><p>Configure the content-based router</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Add a log endpoint to each output branch of the content-based router</p></li><li class="listitem"><p>Add a Set Header EIP after each log endpoint</p></li><li class="listitem"><p>Add an Otherwise branch to the content-based router</p></li></ul></div></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e20127"></a>Prerequisites</h2></div></div></div><p>To complete this tutorial you will need the <span class="bold"><strong>CBRroute</strong></span>
            project you created in <a href="RiderTutorialCreate.html" class="olink"><i>To Create a New Route</i></a>.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e20137"></a>Adding and configuring a content-based router</h2></div></div></div><p>To add and configure a content-based router for your route:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>In <span class="guilabel">Project Explorer</span>, double-click <code class="filename">CBRroute/src/main/resources/OSGI-INF/blueprint/blueprint.xml</code> to
                    open your <span class="guilabel">CBRroute</span> project.</p></li><li class="step"><p>On the canvas, select the <span class="guilabel">To_Others</span> node and then select
                    the trash can above and to the right to delete it.</p></li><li class="step"><p>In the <span class="guilabel">Palette</span>, open the <span class="guilabel">Routing</span>
                    drawer and drag a <span class="guilabel">Choice</span> (<span class="inlinemediaobject"><img src="images/choice.png" width="19.200000000000003" alt="Choice icon"></span>) pattern to the canvas and drop it in the
                        <span class="guilabel">Route_route1</span> container.</p><p>The <span class="guilabel">Route_route1</span> container expands to accommodate the
                        <span class="guilabel">Choice_choice1</span> node.</p></li><li class="step"><p>In the <span class="guilabel">Route_route1</span> container, select the
                <span class="guilabel">From_from1</span> node
                    and drag its connector arrow over the <span class="guilabel">Choice_choice1</span> node,
                    then release it:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRaddChoice1.png" width="182.25000000000003"></div></div></li><li class="step"><p>In the <span class="guilabel">Properties</span> editor, <code class="literal">_choice1</code>
                    appears in the <span class="guilabel">Id</span> field:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutRte1ChoicePropEdNew.png" width="465"></div></div><p>Leave the <span class="guilabel">Id</span> field as is.</p></li><li class="step"><p>From the <span class="guilabel">Routing</span> drawer, drag a <span class="guilabel">When</span> (<span class="inlinemediaobject"><img src="images/endpointdef.png" width="19.200000000000003" alt="When icon"></span>) pattern to the canvas and drop it on the
                        <span class="guilabel">Choice_choice1</span> node:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRaddWhen1.png" width="213.75"></div></div><p>The <span class="guilabel">Choice_choice1</span> container expands to accommodate the
                        <span class="guilabel">When_when1</span> node. The <span class="inlinemediaobject"><img src="./images/warning_obj.gif" alt="warning icon"></span> decorating the <span class="guilabel">When_when1</span> node
                    indicates that one or more required property values must be set. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The tooling prevents you from dropping a pattern at an invalid drop point in a Route
                    container.</p></td></tr></table></div></li><li class="step"><p>On the canvas, select the <span class="guilabel">When_when1</span> node, to open its
                    properties in the <span class="guilabel">Properties</span> editor:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRWhen1OpenProps.png" width="404.3"></div></div></li><li class="step"><p>Click the <span class="inlinemediaobject"><img src="./images/popup_menu.gif" width="17.6" alt="drop-down menu icon"></span> button in the <span class="guilabel">Language</span> field to open
                    the list of available languages, and select
                    <span class="guimenuitem">xpath</span>:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRWhen1Props.png" width="436.8"></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Once you select the expression <span class="guilabel">Language</span>, the
                    <span class="guilabel">Properties</span> editor displays its properties in an
                    indented list directly below the <span class="guilabel">Language</span> field. The
                    <span class="guilabel">Id</span> property in this list sets the ID of the
                    expression. The <span class="guilabel">Id</span> property following the
                    <span class="guilabel">Description</span> field sets the ID of the
                    <span class="guilabel">When</span> node.</p></td></tr></table></div></li><li class="step"><p>In the <span class="guilabel">Expression</span> field, enter
                        <strong class="userinput"><code>/order/orderline/quantity/text() &gt;
                        /order/orderline/maxAllowed/text()</code></strong>.</p><p>This expression determines which messages will transit this path in the route. </p></li><li class="step"><p>Leave each of the remaining properties as is.</p><p>Enabling <span class="guilabel">Trim</span> removes any leading or trailing white
                    spaces and line breaks from the message.</p></li><li class="step"><p>On the menu bar, click <span class="guimenu">File</span> &gt; <span class="guimenuitem">Save</span> to save the routing context file.</p></li><li class="step"><p>Click the <span class="guilabel">Source</span> tab to review the routing context in
                <span class="guilabel">Source</span> view:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRaddedSourceV.png" width="467.4"></div></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e20371"></a>Adding and configuring logging</h2></div></div></div><p>To add logging to your route:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>In the <span class="guilabel">Palette</span>, open the <span class="guilabel">Components</span>
                    drawer and select a <span class="guimenuitem">Log</span> (<span class="inlinemediaobject"><img src="images/log.png" width="19.200000000000003" alt="Log icon"></span>) component.</p></li><li class="step"><p>Drag the <span class="guimenuitem">Log</span> component to the canvas and drop it on
                    the <span class="guilabel">When_when1</span> node:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRlog1Added.png" width="172.89999999999998"></div></div><p>The <span class="guilabel">When_when1</span> container expands to accommodate the
                        <span class="guilabel">Log_log1</span> node.</p></li><li class="step"><p>On the canvas, select the <span class="guilabel">Log_log1</span> node to open its properties in the
                        <span class="guilabel">Properties</span> editor.</p></li><li class="step"><p>In the <span class="guilabel">Message</span> field, enter <strong class="userinput"><code>quantity requested
                    exceeds the maximum allowed - contact customer</code></strong>:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRlog1Properties.png" width="481.59999999999997"></div></div></li><li class="step"><p>Leave each of the remaining properties as is.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>In the <span class="guilabel">Fuse Integration</span> perspective's <span class="guilabel">Messages </span>
                        view, the tooling inserts the contents of the log node's
                            <span class="guilabel">Id</span> field in the <code class="code">Trace Node Id</code> column
                        for message instances, when tracing is enabled on the route 
                        (see <a href="RiderTutorialTrace.html" class="olink"><i>To Trace a Message Through a Route</i></a>). In the
                            <span class="guilabel">Console</span>, it adds the contents of the log node's
                            <span class="guilabel">Message</span> field to the log data whenever the route
                        runs.</p></td></tr></table></div></li><li class="step"><p>On the menu bar, click <span class="guimenu">File</span> &gt; <span class="guimenuitem">Save</span> to save the routing context file.</p></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e20474"></a>Adding and configuring message headers</h2></div></div></div><p>To add and configure message headers:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>In the <span class="guilabel">Palette</span>, open the
                        <span class="guilabel">Transformation</span> drawer and select a <span class="guilabel">Set
                        Header</span> (<span class="inlinemediaobject"><img src="images/setHeader.png" width="19.200000000000003" alt="Set Header icon"></span>) pattern.</p></li><li class="step"><p>Drag the <span class="guilabel">Set Header</span> pattern to the canvas and drop it in
                    the <span class="guilabel">When_when1</span> container.</p><p>The <span class="guilabel">When_when1</span> container expands to accommodate the
                        <span class="guilabel">SetHeader_setHeader1</span> node.</p></li><li class="step"><p>On the canvas, select the <span class="guilabel">Log_log1</span> node and drag its connector arrow over
                    the <span class="guilabel">SetHeader_setHeader1</span> node, and then release it:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutSetHead1Added.png" width="183.6"></div></div></li><li class="step"><p>On the canvas, select the <span class="guilabel">SetHeader_setHeader1</span> node to open its
                    properties in the <span class="guilabel">Properties</span> editor:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutSetHeadPropEdNew.png" width="413"></div></div></li><li class="step"><p>Click the <span class="inlinemediaobject"><img src="./images/popup_menu.gif" width="17.6" alt="drop-down menu icon"></span> button in the <span class="guilabel">Language</span> field to open
                    the list of available languages, and select
                    <span class="guimenuitem">constant</span>:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutSetHead1Properties2.png" width="432.25"></div></div></li><li class="step"><p>In the <span class="guilabel">Expression</span> field, enter
                        <strong class="userinput"><code>InvalidOrders</code></strong>.</p></li><li class="step"><p>In the <span class="guilabel">Header Name</span> field, enter
                       <strong class="userinput"><code>Destination</code></strong>.</p></li><li class="step"><p>Leave each of the remaining properties as is. </p></li><li class="step"><p>In the <span class="guilabel">Palette</span>, open the <span class="guilabel">Components</span>
                    drawer and select the <span class="guimenuitem">File</span> (<span class="inlinemediaobject"><img src="images/file.png" width="19.200000000000003" alt="File icon"></span>) component.</p></li><li class="step"><p>Drag the <span class="guimenuitem">File</span> component to the canvas and drop it
                    in the <span class="guilabel">When_when1</span> container.</p><p>The <span class="guilabel">When_when1</span> container expands to accommodate the
                        <span class="guilabel">To_to1</span> node.</p></li><li class="step"><p>On the canvas, select the <span class="guilabel">SetHeader_setHeader1</span> node and drag its
                    connector arrow over the <span class="guilabel">To_to1</span> node, and then release
                    it:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRWhen1TargetFile.png" width="197.6"></div></div></li><li class="step"><p>On the canvas, select the <span class="guilabel">To_to1</span> node to open its properties in the
                        <span class="guilabel">Properties</span> editor:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRNewTargetFileProps1.png" width="409.5"></div></div></li><li class="step"><p>On the <span class="guilabel">Details</span> tab, replace
                        <em class="replaceable"><code>directoryName</code></em> with
                        <strong class="userinput"><code>target/messages/invalidOrders</code></strong> in the
                        <span class="guilabel">Uri</span> field, and enter <strong class="userinput"><code>_Invalid</code></strong> in
                    the <span class="guilabel">Id</span> field:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRNewTargetFileProps2.png" width="464.75"></div></div></li><li class="step"><p>On the menu bar, click <span class="guimenu">File</span> &gt; <span class="guimenuitem">Save</span> to save the routing context file.</p></li><li class="step"><p>Click the <span class="guilabel">Source</span> tab to view the routing context in
                        <span class="guilabel">Source</span> view:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRLogHeaderSourceV.png" width="534.3000000000001"></div></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e20692"></a>Adding and configuring an otherwise branch</h2></div></div></div><p>To add and configure the otherwise branch of your route:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>In the <span class="guilabel">Palette</span>, open the <span class="bold"><strong>Routing</strong></span> drawer and select the
                        <span class="guimenuitem">Otherwise</span> (<span class="inlinemediaobject"><img src="images/endpointdef.png" width="19.200000000000003" alt="Otherwise icon"></span>) pattern.</p></li><li class="step"><p>Drag the <span class="guimenuitem">Otherwise</span> pattern to the canvas and drop
                    it into the <span class="guilabel">Choice_choice1</span> container:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRaddOtherwise.png" width="315.59999999999997"></div></div><p>The <span class="guilabel">Choice_choice1</span> container expands to accommodate the
                        <span class="guimenuitem">Otherwise_otherwise1</span> node.</p></li><li class="step"><p>On the canvas, select the <span class="guilabel">Otherwise_otherwise1</span> node to
                    open its properties in the <span class="guilabel">Properties</span>.</p></li><li class="step"><p>In the <span class="guilabel">Id</span> field, enter <strong class="userinput"><code>_else2</code></strong>:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBROtherwiseProps.png" width="359.4"></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <span class="bold"><strong>else2</strong></span> node will eventually route to the terminal
                            <span class="bold"><strong>file:</strong></span> node
                            (<code class="code">file:target/messages/validOrders</code>) any message that does
                        not match the XPath expression set for the <span class="bold"><strong>When_when1</strong></span> node.</p></td></tr></table></div></li><li class="step"><p>In the <span class="guilabel">Palette</span>, open the <span class="guilabel">Components</span>
                    drawer and select the <span class="guimenuitem">Log</span> (<span class="inlinemediaobject"><img src="images/log.png" width="19.200000000000003" alt="Log icon"></span>) component.</p></li><li class="step"><p>Drag the <span class="guimenuitem">Log</span> component to the canvas and drop it on
                    the <span class="guilabel">Otherwise_else2</span> node:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBROtherwiseLogAdd.png" width="292.8"></div></div><p>The <span class="guilabel">Otherwise-else2</span> container expands to accommodate the
                        <span class="guimenuitem">Log_log2</span> node.</p></li><li class="step"><p>On the canvas, select the <span class="guimenuitem">Log_log2</span> node to open its properties in
                    the <span class="guilabel">Properties</span> editor.</p></li><li class="step"><p>In the <span class="guilabel">Message</span> field, enter <strong class="userinput"><code>valid order -
                        process</code></strong>:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBROtherwiseLog2.png" width="358.8"></div></div><p>Leave each of the remaining properties as is.</p></li><li class="step"><p>In the <span class="guilabel">Palette</span>, open the
                        <span class="guilabel">Transformation</span> drawer and select the <span class="guimenuitem">Set
                        Header</span> pattern.</p></li><li class="step"><p>Drag the <span class="guimenuitem">Set Header</span> pattern to the canvas and drop it into the
                        <span class="guilabel">Otherwise_else2</span> container.</p><p>The <span class="guilabel">Otherwise_else2</span> container expands to accommodate
                    the <span class="guimenuitem">SetHeader_setHeader2</span> node.</p></li><li class="step"><p>On the canvas, select the <span class="guilabel">Log_log2</span> node and drag its
                    connector arrow over the <span class="guilabel">SetHeader_setHeader2</span> node, and
                    then release it:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRSetHead2Add.png" width="326.4"></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You can collapse containers to free up space when the diagram becomes congested. To do so,
                        select the container you want to collapse, and then click its <span class="inlinemediaobject"><img src="./images/collapse.gif" alt="collapse icon"></span> button:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRcollapseWhen1Container.png" width="162.6"></div></div><p>To reopen the container, select it and then click its <span class="inlinemediaobject"><img src="./images/expand.gif" alt="expand icon"></span> button:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRexpandWhen1Container.png" width="149.4"></div></div><p>Collapsing and expanding containers in <span class="guilabel">Design</span> view does not affect the
                          routing context file. It remains unchanged.</p></td></tr></table></div></li><li class="step"><p>On the canvas, select the <span class="guimenuitem">SetHeader_setHeader2</span> node to open its
                    properties in the <span class="guilabel">Properties</span> editor.</p></li><li class="step"><p>Click the <span class="inlinemediaobject"><img src="./images/popup_menu.gif" width="17.6" alt="drop-down menu icon"></span> button in the <span class="guilabel">Language</span> field to open
                    the list of available languages, and select
                    <span class="guimenuitem">constant</span>:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBROtherwiseSetHeadProps2.png" width="455.6499999999999"></div></div></li><li class="step"><p>In the <span class="guilabel">Expression</span> field, enter
                      <strong class="userinput"><code>Dispatcher</code></strong>.</p></li><li class="step"><p>In the <span class="guilabel">Header Name</span> field, enter
                        <strong class="userinput"><code>Destination</code></strong>.</p></li><li class="step"><p>Leave each of the remaining properties as is. </p></li><li class="step"><p>In the <span class="guilabel">Palette</span>, open the <span class="guilabel">Components</span>
                    drawer and select the <span class="guimenuitem">File</span> (<span class="inlinemediaobject"><img src="images/file.png" width="19.200000000000003" alt="File icon"></span>) component.</p></li><li class="step"><p>Drag the <span class="guimenuitem">File</span> component to the canvas and drop it into the
                        <span class="guilabel">Otherwise_else2</span> container.</p><p>The <span class="guilabel">Otherwise_else2</span> container expands to accommodate the
                        <span class="guimenuitem">To_to1</span> node.</p></li><li class="step"><p>On the canvas, select the <span class="guimenuitem">SetHeader_setHeader2</span> node, and drag its
                    connector arrow over the <span class="guimenuitem">To_to1</span> node and then release
                    it:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBROtherwiseFileAdd.png" width="353.6"></div></div></li><li class="step"><p>On the canvas, select the <span class="guimenuitem">To_to1</span> node to open its
                    properties in the <span class="guilabel">Properties</span> editor.</p></li><li class="step"><p>In the <span class="guilabel">URI</span> field, replace <em class="replaceable"><code>directoryName</code></em> with
                        <strong class="userinput"><code>target/messages/validOrders</code></strong>, and in the
                        <span class="guilabel">Id</span> field, enter
                  <strong class="userinput"><code>_Valid</code></strong>:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBROtherwiseTargFile2.png" width="447.2"></div></div></li><li class="step"><p>On the menu bar, click <span class="guimenu">File</span> &gt; <span class="guimenuitem">Save</span> to save the routing context file.</p><p>This is the completed content-based router with logs and message
                      headers:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRfinalDesignV.png" width="355.55"></div></div></li><li class="step"><p>Click the <span class="guilabel">Source</span> tab at the bottom,
                    left of the canvas to display the XML for the route.</p><p>The <code class="sgmltag-element">camelContext</code> element will
                    look like that shown in <a class="xref" href="RiderTutorialCBR.html#CBREx010" title="Example&nbsp;3.&nbsp;XML for content-based router">Example&nbsp;3</a>.</p><div class="example"><a name="CBREx010"></a><p class="title"><b>Example&nbsp;3.&nbsp;XML for content-based router</b></p><div class="example-contents"><pre class="programlisting"><span xmlns="http://www.w3.org/1999/xhtml" class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;blueprint</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://www.osgi.org/xmlns/blueprint/v1.0.0"</span>
    <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns:xsi</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://www.w3.org/2001/XMLSchema-instance"</span> 
    <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://www.osgi.org/xmlns/blueprint/v1.0.0                          
    https://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd                                                     
    http://camel.apache.org/schema/blueprint                          
    http://camel.apache.org/schema/blueprint/camel-blueprint.xsd"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>

  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"_context1"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://camel.apache.org/schema/blueprint"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"_route1"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;from</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"_from1"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"file:src/data?noop=true"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;choice</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"_choice1"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
           <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;when</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"_when1"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
              <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;xpath&gt;</strong>order/orderline/quantity/text() &gt; /order/orderline/maxAllowed/text()<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/xpath&gt;</strong>
              <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;log</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"_log1"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">message</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"quantity requested exceeds the maximum allowed - contact customer"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
              <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;setHeader</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">headerName</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"Destination"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"_setHeader1"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
                  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;constant&gt;</strong>InvalidOrders<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/constant&gt;</strong>
              <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/setHeader&gt;</strong>
              <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"_Invalid"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"file:target/messages/invalidOrders"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
           <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/when&gt;</strong>
           <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;otherwise</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"_else2"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
              <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;log</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"_log2"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">message</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"valid order - process"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
              <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;setHeader</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">headerName</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"Destination"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"_setHeader2"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
                  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;constant&gt;</strong>Dispatcher<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/constant&gt;</strong>
              <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/setHeader&gt;</strong>
              <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"_Valid"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"file:target/messages/validOrders"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
           <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/otherwise&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/choice&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camelContext&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/blueprint&gt;</strong></pre></div></div><br class="example-break"></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e21077"></a>Next steps</h2></div></div></div><p>You can run the new route as described in <a href="RiderTutorialRun.html#RiderRunRun" class="olink">Running the route</a>.</p><p>After you run it, you can easily verify whether the route executed
            properly  by checking the target destinations in <span class="guilabel">Project
                Explorer</span>:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Select <code class="filename">CBRroute</code>.</p></li><li class="step"><p>Right-click it to open the context menu, then select
                    <span class="guimenuitem">Refresh</span>.</p></li><li class="step"><p>Under the project root node
                    (<span class="guilabel">CBRroute</span>), locate the folder
                        <code class="filename">target/messages/</code> and expand it.</p><div class="informalfigure"><div class="mediaobject"><img src="images/tutSimpCBRrouteVerify.png" width="129.6" alt="message destinations"></div></div></li><li class="step"><p>Check that the <code class="filename">target/messages/invalidOrders</code> folder
                                contains <code class="filename">message2.xml</code> and
                                    <code class="filename">message4.xml</code>.</p><p>In these messages, the value of the
                                    <span class="property">quantity</span> element should
                                exceed the value of the
                                    <span class="property">maxAllowed</span>
                                element.</p></li><li class="step"><p>Check that the <code class="filename">target/messages/validOrders</code> folder contains the four
                                message files that contain valid orders:
                                    <code class="filename">message1.xml</code>,
                                    <code class="filename">message3.xml</code> ,
                                    <code class="filename">message5.xml</code> and
                                    <code class="filename">message6.xml</code>.</p><p>In these messages, the value of the
                                    <span class="property">quantity</span> element should
                                be less than or equal to the value of the
                                    <span class="property">maxAllowed</span>
                                element.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>To view message content, double-click each message to open it in the route editor's XML
                        editor.</p></td></tr></table></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e21167"></a>Further reading</h2></div></div></div><p>To learn more about message enrichment see:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="https://access.redhat.com/site/documentation/en-US/Red_Hat_JBoss_Fuse/6.3/html/Apache_Camel_Development_Guide/index.html" target="_top">Red Hat JBoss Fuse: Apache Camel Development Guide</a>
                </p></li><li class="listitem"><p><a class="link" href="https://access.redhat.com/documentation/en/red-hat-jboss-fuse/" target="_top">Red Hat JBoss Fuse 6.3 documentation</a>
                </p></li></ul></div></div></div></body></html>