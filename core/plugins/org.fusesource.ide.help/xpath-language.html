<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>XPath Language</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="xmpp-component.html" title="XMPP Component"><link rel="next" href="xquery-component.html" title="XQuery Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="xpath-language"></a>XPath Language</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="xpath-language.html#_xpath_language_options">XPath Language options</a></span></dt><dt><span class="section"><a href="xpath-language.html#_namespaces">Namespaces</a></span></dt><dt><span class="section"><a href="xpath-language.html#_variables_5">Variables</a></span></dt><dt><span class="section"><a href="xpath-language.html#_functions">Functions</a></span></dt><dt><span class="section"><a href="xpath-language.html#_using_xml_configuration_2">Using XML configuration</a></span></dt><dt><span class="section"><a href="xpath-language.html#_setting_result_type_2">Setting result type</a></span></dt><dt><span class="section"><a href="xpath-language.html#_using_xpath_on_headers">Using XPath on Headers</a></span></dt><dt><span class="section"><a href="xpath-language.html#_examples_38">Examples</a></span></dt><dt><span class="section"><a href="xpath-language.html#_xpath_injection">XPath injection</a></span></dt><dt><span class="section"><a href="xpath-language.html#_using_xpathbuilder_without_an_exchange">Using XPathBuilder without an Exchange</a></span></dt><dt><span class="section"><a href="xpath-language.html#_using_saxon_with_xpathbuilder">Using Saxon with XPathBuilder</a></span></dt><dt><span class="section"><a href="xpath-language.html#_setting_a_custom_xpathfactory_using_system_property">Setting a custom XPathFactory using System Property</a></span></dt><dt><span class="section"><a href="xpath-language.html#_enabling_saxon_from_spring_dsl">Enabling Saxon from Spring DSL</a></span></dt><dt><span class="section"><a href="xpath-language.html#_namespace_auditing_to_aid_debugging">Namespace auditing to aid debugging</a></span></dt><dt><span class="section"><a href="xpath-language.html#_auditing_namespaces">Auditing namespaces</a></span></dt><dt><span class="section"><a href="xpath-language.html#_loading_script_from_external_resource_6">Loading script from external resource</a></span></dt><dt><span class="section"><a href="xpath-language.html#_dependencies_71">Dependencies</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 1.1</strong></span></p><p>Camel supports <a class="link" href="http://www.w3.org/TR/xpath" target="_top">XPath</a> to allow an
Expression or Predicate to be
used in the DSL or <a class="link" href="xml-configuration.html" target="_top">Xml
Configuration</a>. For example you could use XPath to create an
Predicate in a <a class="link" href="message-filter.html" target="_top">Message
Filter</a> or as an Expression for a
Recipient List.</p><p><span class="strong"><strong>Streams</strong></span></p><p>If the message body is stream based, which means the input it receives
is submitted to Camel as a stream. That means you will only be able to
read the content of the stream <span class="strong"><strong>once</strong></span>. So often when you use
<a class="link" href="xpath-language.html" title="XPath Language">XPath</a> as <a class="link" href="xpath-language.html" title="XPath Language">Message Filter</a> or
Content Based Router then you need to
access the data multiple times, and you should use
Stream Caching or convert the message body to
a <code class="literal">String</code> prior which is safe to be re-read multiple times.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"queue:foo"</em></strong>).
  filter().xpath(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"//foo"</em></strong>)).
  to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"queue:bar"</em></strong>)</pre><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"queue:foo"</em></strong>).
  choice().xpath(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"//foo"</em></strong>)).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"queue:bar"</em></strong>).
  otherwise().to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"queue:others"</em></strong>);</pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_xpath_language_options"></a>XPath Language options</h2></div></div></div><p>The XPath language supports 9 options which are listed below.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="11%" class="col_2"><col width="10%" class="col_3"><col width="60%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Default</th><th align="left" valign="top">Java Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>documentType</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>Name of class for document type The default value is org.w3c.dom.Document</p></td></tr><tr><td align="left" valign="top"><p>resultType</p></td><td align="left" valign="top"><p><code class="literal">NODESET</code></p></td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>Sets the class name of the result type (type from output) The default result type is NodeSet</p></td></tr><tr><td align="left" valign="top"><p>saxon</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">Boolean</code></p></td><td align="left" valign="top"><p>Whether to use Saxon.</p></td></tr><tr><td align="left" valign="top"><p>factoryRef</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>References to a custom XPathFactory to lookup in the registry</p></td></tr><tr><td align="left" valign="top"><p>objectModel</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>The XPath object model to use</p></td></tr><tr><td align="left" valign="top"><p>logNamespaces</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">Boolean</code></p></td><td align="left" valign="top"><p>Whether to log namespaces which can assist during trouble shooting</p></td></tr><tr><td align="left" valign="top"><p>headerName</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>Name of header to use as input, instead of the message body</p></td></tr><tr><td align="left" valign="top"><p>threadSafety</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">Boolean</code></p></td><td align="left" valign="top"><p>Whether to enable thread-safety for the returned result of the xpath expression. This applies to when using NODESET as the result type, and the returned set has multiple elements. In this situation there can be thread-safety issues if you process the NODESET concurrently such as from a Camel Splitter EIP in parallel processing mode. This option prevents concurrency issues by doing defensive copies of the nodes. It is recommended to turn this option on if you are using camel-saxon or Saxon in your application. Saxon has thread-safety issues which can be prevented by turning this option on.</p></td></tr><tr><td align="left" valign="top"><p>trim</p></td><td align="left" valign="top"><p><code class="literal">true</code></p></td><td align="left" valign="top"><p><code class="literal">Boolean</code></p></td><td align="left" valign="top"><p>Whether to trim the value to remove leading and trailing whitespaces and line breaks</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_namespaces"></a>Namespaces</h2></div></div></div><p>You can easily use namespaces with XPath expressions using the
Namespaces helper class.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_variables_5"></a>Variables</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="xpath-language.html#_namespace_given">Namespace given</a></span></dt><dt><span class="section"><a href="xpath-language.html#_no_namespace_given">No namespace given</a></span></dt></dl></div><p>Variables in XPath is defined in different namespaces. The default
namespace is <code class="literal"><a class="link" href="http://camel.apache.org/schema/spring" target="_top">http://camel.apache.org/schema/spring</a></code>.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="10%" class="col_2"><col width="10%" class="col_3"><col width="70%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Namespace URI</th><th align="left" valign="top">Local part</th><th align="left" valign="top">Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><a class="link" href="http://camel.apache.org/xml/in/" target="_top">http://camel.apache.org/xml/in/</a></p></td><td align="left" valign="top"><p>in</p></td><td align="left" valign="top"><p>Message</p></td><td align="left" valign="top"><p>the exchange.in message</p></td></tr><tr><td align="left" valign="top"><p><a class="link" href="http://camel.apache.org/xml/out/" target="_top">http://camel.apache.org/xml/out/</a></p></td><td align="left" valign="top"><p>out</p></td><td align="left" valign="top"><p>Message</p></td><td align="left" valign="top"><p>the exchange.out message</p></td></tr><tr><td align="left" valign="top"><p><a class="link" href="http://camel.apache.org/xml/function/" target="_top">http://camel.apache.org/xml/function/</a></p></td><td align="left" valign="top"><p>functions</p></td><td align="left" valign="top"><p>Object</p></td><td align="left" valign="top"><p><span class="strong"><strong>Camel 2.5:</strong></span> Additional functions</p></td></tr><tr><td align="left" valign="top"><p><a class="link" href="http://camel.apache.org/xml/variables/environment-variables" target="_top">http://camel.apache.org/xml/variables/environment-variables</a></p></td><td align="left" valign="top"><p>env</p></td><td align="left" valign="top"><p>Object</p></td><td align="left" valign="top"><p>OS environment variables</p></td></tr><tr><td align="left" valign="top"><p><a class="link" href="http://camel.apache.org/xml/variables/system-properties" target="_top">http://camel.apache.org/xml/variables/system-properties</a></p></td><td align="left" valign="top"><p>system</p></td><td align="left" valign="top"><p>Object</p></td><td align="left" valign="top"><p>Java System properties</p></td></tr><tr><td align="left" valign="top"><p><a class="link" href="http://camel.apache.org/xml/variables/exchange-property" target="_top">http://camel.apache.org/xml/variables/exchange-property</a></p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p>Object</p></td><td align="left" valign="top"><p>the exchange property</p></td></tr></tbody></table></div><p>Camel will resolve variables according to either:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">namespace given</li><li class="listitem">no namespace given</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_namespace_given"></a>Namespace given</h3></div></div></div><p>If the namespace is given then Camel is instructed exactly what to
return. However when resolving either <span class="strong"><strong>in</strong></span> or <span class="strong"><strong>out</strong></span> Camel will try to
resolve a header with the given local part first, and return it. If the
local part has the value <span class="strong"><strong>body</strong></span> then the body is returned instead.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_no_namespace_given"></a>No namespace given</h3></div></div></div><p>If there is no namespace given then Camel resolves only based on the
local part. Camel will try to resolve a variable in the following steps:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">from <code class="literal">variables</code> that has been set using the <code class="literal">variable(name, value)</code>
fluent builder</li><li class="listitem">from message.in.header if there is a header with the given key</li><li class="listitem">from exchange.properties if there is a property with the given key</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_functions"></a>Functions</h2></div></div></div><p>Camel adds the following XPath functions that can be used to access the
exchange:</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="10%" class="col_2"><col width="10%" class="col_3"><col width="70%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Function</th><th align="left" valign="top">Argument</th><th align="left" valign="top">Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>in:body</p></td><td align="left" valign="top"><p>none</p></td><td align="left" valign="top"><p>Object</p></td><td align="left" valign="top"><p>Will return the <span class="strong"><strong>in</strong></span> message body.</p></td></tr><tr><td align="left" valign="top"><p>in:header</p></td><td align="left" valign="top"><p>the header name</p></td><td align="left" valign="top"><p>Object</p></td><td align="left" valign="top"><p>Will return the <span class="strong"><strong>in</strong></span> message header.</p></td></tr><tr><td align="left" valign="top"><p>out:body</p></td><td align="left" valign="top"><p>none</p></td><td align="left" valign="top"><p>Object</p></td><td align="left" valign="top"><p>Will return the <span class="strong"><strong>out</strong></span> message body.</p></td></tr><tr><td align="left" valign="top"><p>out:header</p></td><td align="left" valign="top"><p>the header name</p></td><td align="left" valign="top"><p>Object</p></td><td align="left" valign="top"><p>Will return the <span class="strong"><strong>out</strong></span> message header.</p></td></tr><tr><td align="left" valign="top"><p>function:properties</p></td><td align="left" valign="top"><p>key for property</p></td><td align="left" valign="top"><p>String</p></td><td align="left" valign="top"><p><span class="strong"><strong>Camel 2.5:</strong></span> To lookup a property using the
<a class="link" href="properties-component.html" title="Properties Component">Properties</a> component (property placeholders).</p></td></tr><tr><td align="left" valign="top"><p>function:simple</p></td><td align="left" valign="top"><p>simple expression</p></td><td align="left" valign="top"><p>Object</p></td><td align="left" valign="top"><p><span class="strong"><strong>Camel 2.5:</strong></span> To evaluate a <a class="link" href="simple-language.html" title="Simple Language">Simple</a> expression.</p></td></tr></tbody></table></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="imagesdb/caution.png"></td><th align="left">Caution</th></tr><tr><td align="left" valign="top"><p><code class="literal">function:properties</code> and <code class="literal">function:simple</code> is not supported
when the return type is a <code class="literal">NodeSet</code>, such as when using with a
Splitter EIP.</p></td></tr></table></div><p>Here&#8217;s an example showing some of these functions in use.</p><p>And the new functions introduced in Camel 2.5:</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_xml_configuration_2"></a>Using XML configuration</h2></div></div></div><p>If you prefer to configure your routes in your Spring
XML file then you can use XPath expressions as follows</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;beans</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://www.springframework.org/schema/beans"</span>
       <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns:xsi</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"
       http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>

  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"camel"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://activemq.apache.org/camel/schema/spring"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns:foo</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://example.com/person"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;from</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"activemq:MyQueue"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;filter&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;xpath&gt;</strong>/foo:person[@name='James']<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/xpath&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"mqseries:SomeOtherQueue"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/filter&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camelContext&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/beans&gt;</strong></pre><p>Notice how we can reuse the namespace prefixes, <span class="strong"><strong>foo</strong></span> in this case, in
the XPath expression for easier namespace based XPath expressions!</p><p>See also this
<a class="link" href="http://camel.465427.n5.nabble.com/fail-filter-XPATH-camel-td476424.html" target="_top">discussion
on the mailinglist</a> about using your own namespaces with xpath</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_setting_result_type_2"></a>Setting result type</h2></div></div></div><p>The <a class="link" href="xpath-language.html" title="XPath Language">XPath</a> expression will return a result type using
native XML objects such as <code class="literal">org.w3c.dom.NodeList</code>. But many times you
want a result type to be a String. To do this you have to instruct the
<a class="link" href="xpath-language.html" title="XPath Language">XPath</a> which result type to use.</p><p>In Java DSL:</p><pre class="programlisting">xpath(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"/foo:person/@id"</em></strong>, String.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>)</pre><p>In Spring DSL you use the <span class="strong"><strong>resultType</strong></span> attribute to provide a fully
qualified classname:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;xpath</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">resultType</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"java.lang.String"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>/foo:person/@id<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/xpath&gt;</strong></pre><p>In @XPath:
 <span class="strong"><strong>Available as of Camel 2.1</strong></span></p><pre class="programlisting"><em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@XPath(value = "concat('foo-',//order/name/)", resultType = String.class)</span></em> String name)</pre><p>Where we use the xpath function concat to prefix the order name with
<code class="literal">foo-</code>. In this case we have to specify that we want a String as result
type so the concat function works.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_xpath_on_headers"></a>Using XPath on Headers</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.11</strong></span></p><p>Some users may have XML stored in a header. To apply an XPath to a
header&#8217;s value you can do this by defining the 'headerName' attribute.</p><p>And in Java DSL you specify the headerName as the 2nd parameter as
shown:</p><pre class="programlisting">  xpath(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"/invoice/@orderType = 'premium'"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"invoiceDetails"</em></strong>)</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_examples_38"></a>Examples</h2></div></div></div><p>Here is a simple
<a class="link" href="http://svn.apache.org/repos/asf/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/XPathFilterTest.java" target="_top">example</a>
using an XPath expression as a predicate in a
Message Filter</p><p>If you have a standard set of namespaces you wish to work with and wish
to share them across many different XPath expressions you can use the
NamespaceBuilder as shown
<a class="link" href="http://svn.apache.org/repos/asf/camel/trunk/camel-core/src/test/java/org/apache/camel/processor/XPathWithNamespaceBuilderFilterTest.java" target="_top">in
this example</a></p><p>In this sample we have a choice construct. The first choice evaulates if
the message has a header key <span class="strong"><strong>type</strong></span> that has the value <span class="strong"><strong>Camel</strong></span>.
 The 2nd choice evaluates if the message body has a name tag <span class="strong"><strong>&lt;name&gt;</strong></span>
which values is <span class="strong"><strong>Kong</strong></span>.
 If neither is true the message is routed in the otherwise block:</p><p>And the spring XML equivalent of the route:</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_xpath_injection"></a>XPath injection</h2></div></div></div><p>You can use Bean Integration to invoke a
method on a bean and use various languages such as XPath to extract a
value from the message and bind it to a method parameter.</p><p>The default XPath annotation has SOAP and XML namespaces available. If
you want to use your own namespace URIs in an XPath expression you can
use your own copy of the
<a class="link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/language/XPath.html" target="_top">XPath
annotation</a> to create whatever namespace prefixes you want to use.</p><p>i.e. cut and paste upper code to your own project in a different package
and/or annotation name then add whatever namespace prefix/uris you want
in scope when you use your annotation on a method parameter. Then when
you use your annotation on a method parameter all the namespaces you
want will be available for use in your XPath expression.</p><p>For example</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong> Foo {

    <em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@MessageDriven(uri = "activemq:my.queue")</span></em>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> doSomething(<em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@MyXPath("/ns1:foo/ns2:bar/text()")</span></em> String correlationID, <em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Body</span></em> String body) {
        <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// process the inbound message here</em>
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_xpathbuilder_without_an_exchange"></a>Using XPathBuilder without an Exchange</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.3</strong></span></p><p>You can now use the <code class="literal">org.apache.camel.builder.XPathBuilder</code> without the
need for an Exchange. This comes handy if you want
to use it as a helper to do custom xpath evaluations.</p><p>It requires that you pass in a CamelContext
since a lot of the moving parts inside the XPathBuilder requires access
to the Camel Type Converter and hence why
CamelContext is needed.</p><p>For example you can do something like this:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">boolean</strong> matches = XPathBuilder.xpath(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"/foo/bar/@xyz"</em></strong>).matches(context, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"&lt;foo&gt;&lt;bar xyz='cheese'/&gt;&lt;/foo&gt;"</em></strong>));</pre><p>This will match the given predicate.</p><p>You can also evaluate for example as shown in the following three
examples:</p><pre class="programlisting">String name = XPathBuilder.xpath(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"foo/bar"</em></strong>).evaluate(context, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"&lt;foo&gt;&lt;bar&gt;cheese&lt;/bar&gt;&lt;/foo&gt;"</em></strong>, String.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>);
Integer number = XPathBuilder.xpath(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"foo/bar"</em></strong>).evaluate(context, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"&lt;foo&gt;&lt;bar&gt;123&lt;/bar&gt;&lt;/foo&gt;"</em></strong>, Integer.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>);
Boolean bool = XPathBuilder.xpath(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"foo/bar"</em></strong>).evaluate(context, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"&lt;foo&gt;&lt;bar&gt;true&lt;/bar&gt;&lt;/foo&gt;"</em></strong>, Boolean.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>);</pre><p>Evaluating with a String result is a common requirement and thus you can
do it a bit simpler:</p><pre class="programlisting">String name = XPathBuilder.xpath(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"foo/bar"</em></strong>).evaluate(context, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"&lt;foo&gt;&lt;bar&gt;cheese&lt;/bar&gt;&lt;/foo&gt;"</em></strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_saxon_with_xpathbuilder"></a>Using Saxon with XPathBuilder</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.3</strong></span></p><p>You need to add <span class="strong"><strong>camel-saxon</strong></span> as dependency to your project.</p><p>Its now easier to use <a class="link" href="http://saxon.sourceforge.net/" target="_top">Saxon</a> with the
XPathBuilder which can be done in several ways as shown below.
 Where as the latter ones are the easiest ones.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Using a factory</li><li class="listitem">Using ObjectModel</li></ul></div><p>The easy one</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_setting_a_custom_xpathfactory_using_system_property"></a>Setting a custom XPathFactory using System Property</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.3</strong></span></p><p>Camel now supports reading the
<a class="link" href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/xpath/XPathFactory.html#newInstance(java.lang.String)" target="_top">JVM
system property <code class="literal">javax.xml.xpath.XPathFactory</code></a> that can be used to set
a custom XPathFactory to use.</p><p>This unit test shows how this can be done to use Saxon instead:</p><p>Camel will log at <code class="literal">INFO</code> level if it uses a non default XPathFactory
such as:</p><pre class="screen">XPathBuilder  INFO  Using system property javax.xml.xpath.XPathFactory:http://saxon.sf.net/jaxp/xpath/om with value:
                    net.sf.saxon.xpath.XPathFactoryImpl when creating XPathFactory</pre><p>To use Apache Xerces you can configure the system property</p><pre class="screen">-Djavax.xml.xpath.XPathFactory=org.apache.xpath.jaxp.XPathFactoryImpl</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_enabling_saxon_from_spring_dsl"></a>Enabling Saxon from Spring DSL</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.10</strong></span></p><p>Similarly to Java DSL, to enable Saxon from Spring DSL you have three
options:</p><p>Specifying the factory</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;xpath</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">factoryRef</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"saxonFactory"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">resultType</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"java.lang.String"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>current-dateTime()<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/xpath&gt;</strong></pre><p>Specifying the object model</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;xpath</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">objectModel</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://saxon.sf.net/jaxp/xpath/om"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">resultType</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"java.lang.String"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>current-dateTime()<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/xpath&gt;</strong></pre><p>Shortcut</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;xpath</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">saxon</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"true"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">resultType</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"java.lang.String"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>current-dateTime()<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/xpath&gt;</strong></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_namespace_auditing_to_aid_debugging"></a>Namespace auditing to aid debugging</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.10</strong></span></p><p>A large number of XPath-related issues that users frequently face are
linked to the usage of namespaces. You may have some misalignment
between the namespaces present in your message and those that your XPath
expression is aware of or referencing. XPath predicates or expressions
that are unable to locate the XML elements and attributes due to
namespaces issues may simply look like "they are not working", when in
reality all there is to it is a lack of namespace definition.</p><p>Namespaces in XML are completely necessary, and while we would love to
simplify their usage by implementing some magic or voodoo to wire
namespaces automatically, truth is that any action down this path would
disagree with the standards and would greatly hinder interoperability.</p><p>Therefore, the utmost we can do is assist you in debugging such issues
by adding two new features to the XPath Expression Language and are thus
accesible from both predicates and expressions.</p><p>#=== Logging the Namespace Context of your XPath expression/predicate</p><p>Every time a new XPath expression is created in the internal pool, Camel
will log the namespace context of the expression under the
<code class="literal">org.apache.camel.builder.xml.XPathBuilder</code> logger. Since Camel
represents Namespace Contexts in a hierarchical fashion (parent-child
relationships), the entire tree is output in a recursive manner with the
following format:</p><pre class="screen">[me: {prefix -&gt; namespace}, {prefix -&gt; namespace}], [parent: [me: {prefix -&gt; namespace}, {prefix -&gt; namespace}], [parent: [me: {prefix -&gt; namespace}]]]</pre><p>Any of these options can be used to activate this logging:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Enable TRACE logging on the
<code class="literal">org.apache.camel.builder.xml.XPathBuilder</code> logger, or some parent
logger such as <code class="literal">org.apache.camel</code> or the root logger</li><li class="listitem">Enable the <code class="literal">logNamespaces</code> option as indicated in
<a class="link" href="xpath-language.html" title="XPath Language">Auditing Namespaces</a>, in which case the logging will
occur on the INFO level</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_auditing_namespaces"></a>Auditing namespaces</h2></div></div></div><p>Camel is able to discover and dump all namespaces present on every
incoming message before evaluating an XPath expression, providing all
the richness of information you need to help you analyse and pinpoint
possible namespace issues.</p><p>To achieve this, it in turn internally uses another specially tailored
XPath expression to extract all namespace mappings that appear in the
message, displaying the prefix and the full namespace URI(s) for each
individual mapping.</p><p>Some points to take into account:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">The implicit XML namespace
(xmlns:xml="http://www.w3.org/XML/1998/namespace") is suppressed from
the output because it adds no value</li><li class="listitem">Default namespaces are listed under the DEFAULT keyword in the output</li><li class="listitem">Keep in mind that namespaces can be remapped under different scopes.
Think of a top-level 'a' prefix which in inner elements can be assigned
a different namespace, or the default namespace changing in inner
scopes. For each discovered prefix, all associated URIs are listed.</li></ul></div><p>You can enable this option in Java DSL and Spring DSL.</p><p>Java DSL:</p><pre class="programlisting">XPathBuilder.xpath(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"/foo:person/@id"</em></strong>, String.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>).logNamespaces()</pre><p>Spring DSL:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;xpath</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">logNamespaces</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"true"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">resultType</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"String"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>/foo:person/@id<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/xpath&gt;</strong></pre><p>The result of the auditing will be appear at the INFO level under the
<code class="literal">org.apache.camel.builder.xml.XPathBuilder</code> logger and will look like
the following:</p><pre class="screen">2012-01-16 13:23:45,878 [stSaxonWithFlag] INFO  XPathBuilder  - Namespaces discovered in message:
{xmlns:a=[http://apache.org/camel], DEFAULT=[http://apache.org/default],
xmlns:b=[http://apache.org/camelA, http://apache.org/camelB]}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_loading_script_from_external_resource_6"></a>Loading script from external resource</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.11</strong></span></p><p>You can externalize the script and have Camel load it from a resource
such as <code class="literal">"classpath:"</code>, <code class="literal">"file:"</code>, or <code class="literal">"http:"</code>.
 This is done using the following syntax: <code class="literal">"resource:scheme:location"</code>,
eg to refer to a file on the classpath you can do:</p><pre class="programlisting">.setHeader(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"myHeader"</em></strong>).xpath(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"resource:classpath:myxpath.txt"</em></strong>, String.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>)</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_dependencies_71"></a>Dependencies</h2></div></div></div><p>The XPath language is part of camel-core.</p></div></div></body></html>