<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Cometd Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="CoAP-CoAPComponent.html" title="CoAP Component"><link rel="next" href="Consul-ConsulComponent.html" title="Consul Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="Cometd-CometdComponent"></a>Cometd Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="Cometd-CometdComponent.html#Cometd-URIformat">URI format</a></span></dt><dt><span class="section"><a href="Cometd-CometdComponent.html#Cometd-Examples">Examples</a></span></dt><dt><span class="section"><a href="Cometd-CometdComponent.html#Cometd-Options">Options</a></span></dt><dt><span class="section"><a href="Cometd-CometdComponent.html#Cometd-Authentication">Authentication</a></span></dt><dt><span class="section"><a href="Cometd-CometdComponent.html#Cometd-SettingupSSLforCometdComponent">Setting up SSL for Cometd Component</a></span></dt><dt><span class="section"><a href="Cometd-CometdComponent.html#Cometd-SeeAlso">See Also</a></span></dt></dl></div><p>The <span class="strong"><strong>cometd:</strong></span> component is a transport for working with the
<a class="link" href="http://www.mortbay.org/jetty" target="_top">jetty</a> implementation of the
<a class="link" href="http://docs.codehaus.org/display/JETTY/Cometd+%28aka+Bayeux%29" target="_top">cometd/bayeux
protocol</a>.
 Using this component in combination with the dojo toolkit library it&#8217;s
possible to push Camel messages directly into the browser using an AJAX
based mechanism.</p><p>Maven users will need to add the following dependency to their <code class="literal">pom.xml</code>
for this component:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-cometd<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Cometd-URIformat"></a>URI format</h2></div></div></div><pre class="programlisting">cometd:<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">//host:port/channelName[?options]</em></pre><p>The <span class="strong"><strong>channelName</strong></span> represents a topic that can be subscribed to by the
Camel endpoints.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Cometd-Examples"></a>Examples</h2></div></div></div><pre class="screen">cometd://localhost:8080/service/mychannel
cometds://localhost:8443/service/mychannel</pre><p>where <code class="literal">cometds:</code> represents an SSL configured endpoint.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Cometd-Options"></a>Options</h2></div></div></div><p>The CometD component supports 6 options which are listed below.</p><p>{% raw %}</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="11%" class="col_2"><col width="70%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Java Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>sslKeyPassword</p></td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>The password for the keystore when using SSL.</p></td></tr><tr><td align="left" valign="top"><p>sslPassword</p></td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>The password when using SSL.</p></td></tr><tr><td align="left" valign="top"><p>sslKeystore</p></td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>The path to the keystore.</p></td></tr><tr><td align="left" valign="top"><p>securityPolicy</p></td><td align="left" valign="top"><p><code class="literal">SecurityPolicy</code></p></td><td align="left" valign="top"><p>To use a custom configured SecurityPolicy to control authorization</p></td></tr><tr><td align="left" valign="top"><p>extensions</p></td><td align="left" valign="top"><p><code class="literal">List</code></p></td><td align="left" valign="top"><p>To use a list of custom BayeuxServer.Extension that allows modifying incoming and outgoing requests.</p></td></tr><tr><td align="left" valign="top"><p>sslContextParameters</p></td><td align="left" valign="top"><p><code class="literal">SSLContextParameters</code></p></td><td align="left" valign="top"><p>To configure security using SSLContextParameters</p></td></tr></tbody></table></div><p>{% endraw %}</p><p>The CometD component supports 19 endpoint options which are listed below:</p><p>{% raw %}</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="10%" class="col_2"><col width="11%" class="col_3"><col width="10%" class="col_4"><col width="50%" class="col_5"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Group</th><th align="left" valign="top">Default</th><th align="left" valign="top">Java Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>host</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> Hostname</p></td></tr><tr><td align="left" valign="top"><p>port</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">int</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> Host port number</p></td></tr><tr><td align="left" valign="top"><p>channelName</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> The channelName represents a topic that can be subscribed to by the Camel endpoints.</p></td></tr><tr><td align="left" valign="top"><p>allowedOrigins</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top"><p><code class="literal">*</code></p></td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>The origins domain that support to cross if the crosssOriginFilterOn is true</p></td></tr><tr><td align="left" valign="top"><p>baseResource</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>The root directory for the web resources or classpath. Use the protocol file: or classpath: depending if you want that the component loads the resource from file system or classpath. Classpath is required for OSGI deployment where the resources are packaged in the jar</p></td></tr><tr><td align="left" valign="top"><p>crossOriginFilterOn</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>If true the server will support for cross-domain filtering</p></td></tr><tr><td align="left" valign="top"><p>filterPath</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>The filterPath will be used by the CrossOriginFilter if the crosssOriginFilterOn is true</p></td></tr><tr><td align="left" valign="top"><p>interval</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">int</code></p></td><td align="left" valign="top"><p>The client side poll timeout in milliseconds. How long a client will wait between reconnects</p></td></tr><tr><td align="left" valign="top"><p>jsonCommented</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top"><p><code class="literal">true</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>If true the server will accept JSON wrapped in a comment and will generate JSON wrapped in a comment. This is a defence against Ajax Hijacking.</p></td></tr><tr><td align="left" valign="top"><p>logLevel</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td><td align="left" valign="top"><p><code class="literal">int</code></p></td><td align="left" valign="top"><p>Logging level. 0=none 1=info 2=debug.</p></td></tr><tr><td align="left" valign="top"><p>maxInterval</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top"><p><code class="literal">30000</code></p></td><td align="left" valign="top"><p><code class="literal">int</code></p></td><td align="left" valign="top"><p>The max client side poll timeout in milliseconds. A client will be removed if a connection is not received in this time.</p></td></tr><tr><td align="left" valign="top"><p>multiFrameInterval</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top"><p><code class="literal">1500</code></p></td><td align="left" valign="top"><p><code class="literal">int</code></p></td><td align="left" valign="top"><p>The client side poll timeout if multiple connections are detected from the same browser.</p></td></tr><tr><td align="left" valign="top"><p>timeout</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top"><p><code class="literal">240000</code></p></td><td align="left" valign="top"><p><code class="literal">int</code></p></td><td align="left" valign="top"><p>The server side poll timeout in milliseconds. This is how long the server will hold a reconnect request before responding.</p></td></tr><tr><td align="left" valign="top"><p>bridgeErrorHandler</p></td><td align="left" valign="top"><p>consumer</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Allows for bridging the consumer to the Camel routing Error Handler which mean any exceptions occurred while the consumer is trying to pickup incoming messages or the likes will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions that will be logged at WARN/ERROR level and ignored.</p></td></tr><tr><td align="left" valign="top"><p>sessionHeadersEnabled</p></td><td align="left" valign="top"><p>consumer</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Whether to include the server session headers in the Camel message when creating a Camel Message for incoming requests.</p></td></tr><tr><td align="left" valign="top"><p>exceptionHandler</p></td><td align="left" valign="top"><p>consumer (advanced)</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">ExceptionHandler</code></p></td><td align="left" valign="top"><p>To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this options is not in use. By default the consumer will deal with exceptions that will be logged at WARN/ERROR level and ignored.</p></td></tr><tr><td align="left" valign="top"><p>exchangePattern</p></td><td align="left" valign="top"><p>consumer (advanced)</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">ExchangePattern</code></p></td><td align="left" valign="top"><p>Sets the exchange pattern when the consumer creates an exchange.</p></td></tr><tr><td align="left" valign="top"><p>disconnectLocalSession</p></td><td align="left" valign="top"><p>producer</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Whether to disconnect local sessions after publishing a message to its channel. Disconnecting local session is needed as they are not swept by default by CometD and therefore you can run out of memory.</p></td></tr><tr><td align="left" valign="top"><p>synchronous</p></td><td align="left" valign="top"><p>advanced</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used or Camel is allowed to use asynchronous processing (if supported).</p></td></tr></tbody></table></div><p>{% endraw %}</p><p>You can append query options to the URI in the following format,
<code class="literal">?option=value&amp;option=value&amp;&#8230;&#8203;</code></p><p>Here is some examples on How to pass the parameters</p><p>For file (for webapp resources located in the Web Application directory
-&#8594; cometd://localhost:8080?resourceBase=file./webapp
 For classpath (when by example the web resources are packaged inside
the webapp folder -&#8594;
cometd://localhost:8080?resourceBase=classpath:webapp</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Cometd-Authentication"></a>Authentication</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.8</strong></span></p><p>You can configure custom <code class="literal">SecurityPolicy</code> and <code class="literal">Extension&#8217;s to the
`CometdComponent</code> which allows you to use authentication as
<a class="link" href="http://cometd.org/documentation/howtos/authentication" target="_top">documented here</a></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Cometd-SettingupSSLforCometdComponent"></a>Setting up SSL for Cometd Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="Cometd-CometdComponent.html#Cometd-UsingtheJSSEConfigurationUtility">Using the JSSE Configuration Utility</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Cometd-UsingtheJSSEConfigurationUtility"></a>Using the JSSE Configuration Utility</h3></div></div></div><p>As of Camel 2.9, the Cometd component supports SSL/TLS configuration
through the <a class="link" href="camel-configuration-utilities.html" target="_top">Camel JSSE
Configuration Utility</a>.&nbsp; This utility greatly decreases the amount of
component specific code you need to write and is configurable at the
endpoint and component levels.&nbsp; The following examples demonstrate how
to use the utility with the Cometd component. You need to configure SSL
on the CometdComponent.</p><p><a name="Cometd-Programmaticconfigurationofthecomponent"></a>Programmatic configuration of the component</p><pre class="programlisting">KeyStoreParameters ksp = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> KeyStoreParameters();
ksp.setResource(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"/users/home/server/keystore.jks"</em></strong>);
ksp.setPassword(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"keystorePassword"</em></strong>);

KeyManagersParameters kmp = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> KeyManagersParameters();
kmp.setKeyStore(ksp);
kmp.setKeyPassword(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"keyPassword"</em></strong>);

TrustManagersParameters tmp = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> TrustManagersParameters();
tmp.setKeyStore(ksp);

SSLContextParameters scp = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> SSLContextParameters();
scp.setKeyManagers(kmp);
scp.setTrustManagers(tmp);

CometdComponent commetdComponent = getContext().getComponent(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cometds"</em></strong>, CometdComponent.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>);
commetdComponent.setSslContextParameters(scp);</pre><p><a name="Cometd-SpringDSLbasedconfigurationofendpoint"></a>Spring DSL based configuration of endpoint</p><pre class="programlisting">...
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camel:sslContextParameters</strong>
      <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"sslContextParameters"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camel:keyManagers</strong>
        <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">keyPassword</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"keyPassword"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camel:keyStore</strong>
          <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">resource</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"/users/home/server/keystore.jks"</span>
          <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">password</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"keystorePassword"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camel:keyManagers&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camel:trustManagers&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camel:keyStore</strong>
          <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">resource</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"/users/home/server/keystore.jks"</span>
          <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">password</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"keystorePassword"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camel:keyManagers&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camel:sslContextParameters&gt;</strong>...
&nbsp;
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"cometd"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.apache.camel.component.cometd.CometdComponent"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"sslContextParameters"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">ref</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"sslContextParameters"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/bean&gt;</strong>
...
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"cometds://127.0.0.1:443/service/test?baseResource=file:./target/test-classes/webapp&amp;timeout=240000&amp;interval=0&amp;maxInterval=30000&amp;multiFrameInterval=1500&amp;jsonCommented=true&amp;logLevel=2"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>...</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Cometd-SeeAlso"></a>See Also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="configuring-camel.html" target="_top">Configuring Camel</a></li><li class="listitem"><a class="link" href="component.html" target="_top">Component</a></li><li class="listitem"><a class="link" href="endpoint.html" target="_top">Endpoint</a></li><li class="listitem"><a class="link" href="getting-started.html" target="_top">Getting Started</a></li></ul></div></div></div></body></html>