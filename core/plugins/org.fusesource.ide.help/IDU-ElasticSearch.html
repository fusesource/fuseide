<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>ElasticSearch</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><meta name="keywords" content="ESB, Apache ServiceMix, Open Source, open source, integration, OSGi, enterprise service bus, Apache ServiceMix documentation, Apache Karaf, Red Hat JBoss Fuse, Red Hat JBoss Fuse documentation"><meta name="keywords" content="ESB, Apache ServiceMix, Open Source, open source, integration, OSGi, enterprise service bus, Apache ServiceMix documentation, Apache Karaf, Red Hat JBoss Fuse, Red Hat JBoss Fuse documentation"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Apache Camel Component Reference"><link rel="prev" href="IDU-Etcd.html" title="Etcd"><link rel="next" href="IDU-ElSql.html" title="ElSql"><link rel="copyright" href="tmdisclaim.html" title="Trademark Disclaimer"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="IDU-ElasticSearch"></a>ElasticSearch</h1></div></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-ElasticSearch_HSH_ElasticSearchComponent"></a>ElasticSearch Component</h2></div></div></div><p><span class="bold"><strong>Available as of Camel 2.11</strong></span>
    </p><p>The ElasticSearch component allows you to interface with an <a class="link" href="http://elasticsearch.org" target="_top">ElasticSearch</a> server.</p><p>Maven users will need to add the following dependency to their <code class="literal">pom.xml</code> for this component:</p><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
    &lt;artifactId&gt;camel-elasticsearch&lt;/artifactId&gt;
    &lt;version&gt;x.x.x&lt;/version&gt;
    &lt;!-- use the same version as your Camel core version --&gt;
&lt;/dependency&gt;</pre></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e73667"></a>Camel on EAP deployment</h2></div></div></div><p>This component is supported by the Camel on EAP (Wildfly Camel) framework, which
            offers a simplified deployment model on the Red Hat JBoss Enterprise Application Platform (JBoss EAP) container.
 </p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-ElasticSearch_HSH_URIformat"></a>URI format</h2></div></div></div><p></p><pre class="programlisting">elasticsearch://clusterName?[options]</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="imagesdb/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If you want to run against a local (in JVM/classloader) ElasticSearch server, just set
                the clusterName value in the URI to <code class="code">local</code>. See the <a class="link" href="http://www.elasticsearch.org/guide/reference/java-api/client.html" target="_top">client guide</a> for more details.</p></td></tr></table></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-ElasticSearch_HSH_EndpointOptions"></a>Endpoint Options</h2></div></div></div><p>The following options may be configured on the ElasticSearch endpoint.  All are required to be set as either an endpoint URI parameter or as a header (headers override endpoint properties)</p><table width="837" id="d0e73694"><col width="257pt"><col width="572pt"><tr>
                <th>name </th>
                <th>description</th>
            </tr><tr>
                <td><code class="code">operation</code></td>
                <td>Required, indicates the operation to perform.</td>
            </tr><tr>
                <td><code class="code">indexName</code></td>
                <td>
                    <p>The name of the index to act against.</p>
                </td>
            </tr><tr>
                <td><code class="code">indexType</code></td>
                <td>
                    <p>The type of the index to act against.</p>
                </td>
            </tr><tr>
                <td><code class="code">ip</code></td>
                <td>
                    <p>The TransportClient remote host IP address to use <span class="bold"><strong>Camel 2.12</strong></span>.</p>
                </td>
            </tr><tr>
                <td><code class="code">port</code></td>
                <td>
                    <p>The TransportClient remote port to use (defaults to 9300) <span class="bold"><strong>Camel 2.12</strong></span>. </p>
                </td>
            </tr><tr>
                <td><code class="code">transportAddresses</code></td>
                <td>
                    <p><span class="bold"><strong>Camel 2.16:</strong></span> Comma-separated list with
                                <code class="code"><em class="replaceable"><code>ip</code></em>:<em class="replaceable"><code>port</code></em></code>
                        formatted remote transport addresses to use. Options
                                <code class="code"><em class="replaceable"><code>ip</code></em></code> and
                                <code class="code"><em class="replaceable"><code>port</code></em></code> must be left blank for
                            <code class="code">transportAddresses</code> to be considered instead. </p>
                </td>
            </tr><tr>
                <td><code class="code">consistencyLevel</code></td>
                <td>
                    <p><span class="bold"><strong>Camel 2.16:</strong></span> The write consistency level
                        to use with INDEX and BULK operations (can be any of <code class="code">ONE</code>,
                            <code class="code">QUORUM</code>, <code class="code">ALL</code> or <code class="code">DEFAULT</code>).</p>
                </td>
            </tr><tr>
                <td><code class="code">replicationType</code></td>
                <td>
                    <p><span class="bold"><strong>Camel 2.16:</strong></span> The replication type to use
                        with INDEX and BULK operations (can be any of <code class="code">SYNC</code>,
                            <code class="code">ASYNC</code> or <code class="code">DEFAULT</code>). <span class="bold"><strong>Camel
                            2.17:</strong></span>
                        <code class="code">replicationType</code> option has been removed, since from
                        Elasticsearch 2.0.0 the async replication has been removed..</p>
                </td>
            </tr><tr>
                <td><code class="code">parent</code></td>
                <td>
                    <p><span class="bold"><strong>Camel 2.16.1 / 2.17.0:</strong></span> Optionally used
                        with INDEX operations for Elasticsearch Parent-Child relationships to
                        specify the ID of the parent record. </p>
                </td>
            </tr><tr>
                <td><code class="code">clientTransportSniff</code></td>
                <td>
                    <p><span class="bold"><strong>Camel 2.17:</strong></span> Specifies whether the client
                        is allowed to sniff the rest of the cluster. </p>
                </td>
            </tr></table></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-ElasticSearch_HSH_MessageOperations"></a>Message Operations</h2></div></div></div><p>The following ElasticSearch operations are currently supported. Simply set an endpoint URI
      option or exchange header with a key of <code class="code">operation</code> and a value set to one of the
      following. Some operations also require other parameters or the message body to be set.</p><table id="d0e73892"><tr>
        <th>operation </th>
        <th>message body </th>
        <th>description</th>
      </tr><tr>
        <td><code class="code">INDEX</code></td>
        <td><code class="code">Map</code>, <code class="code">String</code>, <code class="code">byte[]</code> or
            <code class="code">XContentBuilder</code> content to index</td>
        <td> Adds content to an index and returns the content's <code class="code">indexId</code> in the
          body.</td>
      </tr><tr>
        <td><code class="code">GET_BY_ID</code></td>
        <td>Index ID of content to retrieve</td>
        <td> Retrieves the specified index and returns a <code class="code">GetResult</code> object in the
          body.</td>
      </tr><tr>
        <td><code class="code">DELETE</code></td>
        <td>Index ID of content to delete</td>
        <td> Deletes the specified indexId and returns a <code class="code">DeleteResult</code> object in the
          body.</td>
      </tr><tr>
            <td>
                <p><code class="code">BULK_INDEX</code></p>
            </td>
            <td>
                <p>A <span class="strong"><strong>List</strong></span> or <span class="strong"><strong>Collection</strong></span> of any type that is already accepted
                            (<code class="code">XContentBuilder</code>, <code class="code">Map</code>, <code class="code">byte[]</code>, or
                            <code class="code">String</code>)</p>
            </td>
            <td>
                <p><span class="strong"><strong>Camel 2.14, </strong></span> Adds content to an index and
            return a List of the id of the successfully indexed documents in the body.</p>
            </td>
        </tr><tr>
        <td>
          <p><code class="code">BULK</code></p>
        </td>
        <td>
          <p>A <span class="strong"><strong>List</strong></span> or <span class="strong"><strong>Collection</strong></span> of any type that is already accepted
              (<code class="code">XContentBuilder</code>, <code class="code">Map</code>, <code class="code">byte[]</code>, or
              <code class="code">String</code>)</p>
        </td>
        <td>
          <p><span class="strong"><strong>Camel 2.15, </strong></span>  Adds content to an index and
            returns the BulkResponse object in the body.</p>
        </td>
      </tr><tr>
                <td><code class="code">SEARCH</code></td>
                <td><code class="code">Map</code> or <code class="code">SearchRequest</code></td>
                <td>
                    <p><span class="bold"><strong>Camel 2.15:</strong></span> Search the content with the
                        map of query string.</p>
                </td>
            </tr><tr>
                <td><code class="code">MULTIGET</code></td>
                <td>List of <code class="code">MultigetRequest.Item</code></td>
                <td>
                    <p><span class="bold"><strong>Camel 2.17:</strong></span> Retrieves the specified
                        indexes, types etc. in <code class="code">MultigetRequest</code> and returns a
                            <code class="code">MultigetResponse</code> object in the body.</p>
                </td>
            </tr><tr>
                <td><code class="code">MULTISEARCH</code></td>
                <td>List of <code class="code">SearchRequest</code></td>
                <td>
                    <p><span class="bold"><strong>Camel 2.17:</strong></span> Search for parameters
                        specified in <code class="code">MultiSearchRequest</code> and returns a
                            <code class="code">MultiSearchResponse</code> object in the body.</p>
                </td>
            </tr><tr>
                <td><code class="code">EXISTS</code></td>
                <td>
                    <p>Index name as header</p>
                </td>
                <td>
                    <p><span class="bold"><strong>Camel 2.17:</strong></span> Returns a Boolean object in
                        the body.</p>
                </td>
            </tr><tr>
                <td><code class="code">UPDATE</code></td>
                <td><code class="code">Map</code>, <code class="code">String</code>, <code class="code">byte[]</code> or
                        <code class="code">XContentBuilder</code> content to update</td>
                <td>
                    <p><span class="bold"><strong>Camel 2.17:</strong></span> Updates content to an index
                        and returns the content's <code class="code">indexId</code> in the body.</p>
                </td>
            </tr></table></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-ElasticSearch_HSH_IndexExample"></a>Index Example</h2></div></div></div><p>Below is a simple INDEX example</p><pre class="programlisting">from("direct:index")
    .to("elasticsearch://local?operation=INDEX&amp;indexName=twitter&amp;indexType=tweet");</pre><pre class="programlisting">&lt;route&gt;
    &lt;from uri="direct:index" /&gt;
    &lt;to uri="elasticsearch://local?operation=INDEX&amp;indexName=twitter&amp;indexType=tweet"/&gt;
&lt;/route&gt;</pre><p>A client would simply need to pass a body message containing a Map to the route.  The result body contains the indexId created.</p><pre class="programlisting">Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;();
map.put("content", "test");
String indexId = template.requestBody("direct:index", map, String.class);</pre></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e74178"></a>Java Example</h2></div></div></div><p>The following example shows how to use the ElasticSearch component from a Camel route
            defined in Java:  </p><pre class="programlisting">CamelContext camelContext = new DefaultCamelContext();
camelContext.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("direct:index")
          .to("elasticsearch://local?operation=INDEX&amp;indexName=twitter&amp;indexType=tweet");
    }
});

Map&lt;String, String&gt; indexedData = new HashMap&lt;&gt;();
indexedData.put("content", "test");

ProducerTemplate template = camelContext.createProducerTemplate();
template.sendBody("direct:index", indexedData);</pre></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-ElasticSearch_HSH_Formoreinformationseetheseresources"></a>For more information, see these resources</h2></div></div></div><p>
      <a class="link" href="http://elasticsearch.org" target="_top">ElasticSearch Main Site</a>
    </p><p>
      <a class="link" href="http://www.elasticsearch.org/guide/reference/java-api/" target="_top">ElasticSearch Java API</a>
    </p><p>

    </p></div></div></body></html>