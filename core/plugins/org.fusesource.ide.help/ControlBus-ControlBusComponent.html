<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>ControlBus Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="Context-ContextComponent.html" title="Context Component"><link rel="next" href="CouchDB-CamelCouchDBcomponent.html" title="CouchDB Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="ControlBus-ControlBusComponent"></a>ControlBus Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="ControlBus-ControlBusComponent.html#ControlBus-ControlBus">ControlBus EIP</a></span></dt><dt><span class="section"><a href="ControlBus-ControlBusComponent.html#ControlBus-Commands">Commands</a></span></dt><dt><span class="section"><a href="ControlBus-ControlBusComponent.html#ControlBus-Options">Options</a></span></dt><dt><span class="section"><a href="ControlBus-ControlBusComponent.html#ControlBus-Samples">Samples</a></span></dt><dt><span class="section"><a href="ControlBus-ControlBusComponent.html#ControlBus-SeeAlso">See Also</a></span></dt><dt><span class="section"><a href="ControlBus-ControlBusComponent.html#ControlBus-UsingThisPattern">Using This Pattern</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel 2.11</strong></span></p><p>The <span class="strong"><strong>controlbus:</strong></span> component provides easy management of Camel
applications based on the <a class="link" href="controlbus.html" target="_top">Control Bus</a> EIP
pattern.
For example, by sending a message to an <a class="link" href="endpoint.html" target="_top">Endpoint</a>
you can control the lifecycle of routes, or gather performance
statistics.</p><pre class="programlisting">controlbus:command[?options]</pre><p>Where <span class="strong"><strong>command</strong></span> can be any string to identify which type of command to
use.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ControlBus-ControlBus"></a>ControlBus EIP</h2></div></div></div><p>The <a class="link" href="http://www.eaipatterns.com/ControlBus.html" target="_top">Control Bus</a> from the
<a class="link" href="enterprise-integration-patterns.html" target="_top">EIP patterns</a> allows for the
integration system to be monitored and managed from within the
framework.</p><p><span class="inlinemediaobject"><img src="http://www.eaipatterns.com/img/ControlBus.gif" alt="image"></span></p><p>Use a Control Bus to manage an enterprise integration system. The
Control Bus uses the same messaging mechanism used by the application
data, but uses separate channels to transmit data that is relevant to
the management of components involved in the message flow.</p><p>In Camel you can manage and monitor using <a class="link" href="camel-jmx.html" target="_top">JMX</a>, or
by using a Java API from the <code class="literal">CamelContext</code>, or from the
<code class="literal">org.apache.camel.api.management</code> package,
 or use the event notifier which has an example
<a class="link" href="eventnotifier-to-log-details-about-all-sent-exchanges.html" target="_top">here</a>.</p><p>From Camel 2.11 onwards we have introduced a new
<a class="link" href="controlbus-component.html" target="_top">ControlBus Component</a> that allows you to
send messages to a control bus <a class="link" href="endpoint.html" target="_top">Endpoint</a> that reacts
accordingly.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ControlBus-Commands"></a>Commands</h2></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="90%" class="col_2"></colgroup><thead><tr><th align="left" valign="top">Command</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">route</code></p></td><td align="left" valign="top"><p>To control routes using the <code class="literal">routeId</code> and <code class="literal">action</code> parameter.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">language</code></p></td><td align="left" valign="top"><p>Allows you to specify a <a class="link" href="language.html" target="_top">Language</a> to use for
evaluating the message body. If there is any result from the evaluation,
then the result is put in the message body.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ControlBus-Options"></a>Options</h2></div></div></div><p>The Control Bus component has no options.</p><p>The Control Bus component supports 7 endpoint options which are listed below:</p><p>{% raw %}</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="10%" class="col_2"><col width="11%" class="col_3"><col width="10%" class="col_4"><col width="50%" class="col_5"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Group</th><th align="left" valign="top">Default</th><th align="left" valign="top">Java Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>command</p></td><td align="left" valign="top"><p>producer</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> Command can be either route or language</p></td></tr><tr><td align="left" valign="top"><p>language</p></td><td align="left" valign="top"><p>producer</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">Language</code></p></td><td align="left" valign="top"><p>Allows you to specify the name of a Language to use for evaluating the message body. If there is any result from the evaluation then the result is put in the message body.</p></td></tr><tr><td align="left" valign="top"><p>action</p></td><td align="left" valign="top"><p>producer</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>To denote an action that can be either: start stop or status. To either start or stop a route or to get the status of the route as output in the message body. You can use suspend and resume from Camel 2.11.1 onwards to either suspend or resume a route. And from Camel 2.11.1 onwards you can use stats to get performance statics returned in XML format; the routeId option can be used to define which route to get the performance stats for if routeId is not defined then you get statistics for the entire CamelContext.</p></td></tr><tr><td align="left" valign="top"><p>async</p></td><td align="left" valign="top"><p>producer</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Whether to execute the control bus task asynchronously. Important: If this option is enabled then any result from the task is not set on the Exchange. This is only possible if executing tasks synchronously.</p></td></tr><tr><td align="left" valign="top"><p>loggingLevel</p></td><td align="left" valign="top"><p>producer</p></td><td align="left" valign="top"><p><code class="literal">INFO</code></p></td><td align="left" valign="top"><p><code class="literal">LoggingLevel</code></p></td><td align="left" valign="top"><p>Logging level used for logging when task is done or if any exceptions occurred during processing the task.</p></td></tr><tr><td align="left" valign="top"><p>routeId</p></td><td align="left" valign="top"><p>producer</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>To specify a route by its id. The special keyword current indicates the current route.</p></td></tr><tr><td align="left" valign="top"><p>synchronous</p></td><td align="left" valign="top"><p>advanced</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used or Camel is allowed to use asynchronous processing (if supported).</p></td></tr></tbody></table></div><p>{% endraw %}</p><p>You can append query options to the URI in the following format,
<code class="literal">?option=value&amp;option=value&amp;&#8230;&#8203;</code></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ControlBus-Samples"></a>Samples</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="ControlBus-ControlBusComponent.html#ControlBus-Usingroutecommand">Using route command</a></span></dt><dt><span class="section"><a href="ControlBus-ControlBusComponent.html#ControlBus-Usinglanguage">Using Simple language</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="ControlBus-Usingroutecommand"></a>Using route command</h3></div></div></div><p>The route command allows you to do common tasks on a given route very
easily, for example to start a route, you can send an empty message to
this endpoint:</p><pre class="programlisting">template.sendBody(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"controlbus:route?routeId=foo&amp;action=start"</em></strong>, null);</pre><p>To get the status of the route, you can do:</p><pre class="programlisting">String status = template.requestBody(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"controlbus:route?routeId=foo&amp;action=status"</em></strong>, null, String.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>);</pre><p><a name="ControlBus-Gettingperformancestatistics"></a>Getting performance statistics</p><p><span class="strong"><strong>Available as of Camel 2.11.1</strong></span></p><p>This requires JMX to be enabled (is by default) then you can get the
performance statics per route, or for the
<a class="link" href="camelcontext.html" target="_top">CamelContext</a>. For example to get the statics for
a route named foo, we can do:</p><pre class="programlisting">String xml = template.requestBody(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"controlbus:route?routeId=foo&amp;action=stats"</em></strong>, null, String.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>);</pre><p>The returned statics is in XML format. Its the same data you can get
from JMX with the <code class="literal">dumpRouteStatsAsXml</code> operation on the
<code class="literal">ManagedRouteMBean</code>.</p><p>To get statics for the entire <a class="link" href="camelcontext.html" target="_top">CamelContext</a> you
just omit the routeId parameter as shown below:</p><pre class="programlisting">String xml = template.requestBody(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"controlbus:route?action=stats"</em></strong>, null, String.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="ControlBus-Usinglanguage"></a>Using <a class="link" href="simple.html" target="_top">Simple</a> language</h3></div></div></div><p>You can use the <a class="link" href="simple.html" target="_top">Simple</a> language with the control bus,
for example to stop a specific route, you can send a message to the
<code class="literal">"controlbus:language:simple"</code> endpoint containing the following
message:</p><pre class="programlisting">template.sendBody(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"controlbus:language:simple"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"${camelContext.stopRoute('myRoute')}"</em></strong>);</pre><p>As this is a void operation, no result is returned. However, if you want
the route status you can do:</p><pre class="programlisting">String status = template.requestBody(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"controlbus:language:simple"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"${camelContext.getRouteStatus('myRoute')}"</em></strong>, String.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>);</pre><p><span class="strong"><strong>Notice:</strong></span> its easier to use the <code class="literal">route</code> command to control lifecycle of
routes. The <code class="literal">language</code> command allows you to execute a language script
that has stronger powers such as <a class="link" href="groovy.html" target="_top">Groovy</a> or to some
extend the <a class="link" href="simple.html" target="_top">Simple</a> language.</p><p>For example to shutdown Camel itself you can do:</p><pre class="programlisting">template.sendBody(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"controlbus:language:simple?async=true"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"${camelContext.stop()}"</em></strong>);</pre><p>Notice we use <code class="literal">async=true</code> to stop Camel asynchronously as otherwise we
would be trying to stop Camel while it was in-flight processing the
message we sent to the control bus component.</p><p>TIP:You can also use other languages such as <a class="link" href="groovy.html" target="_top">Groovy</a>, etc.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ControlBus-SeeAlso"></a>See Also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="configuring-camel.html" target="_top">Configuring Camel</a></li><li class="listitem"><a class="link" href="component.html" target="_top">Component</a></li><li class="listitem"><a class="link" href="endpoint.html" target="_top">Endpoint</a></li><li class="listitem"><a class="link" href="getting-started.html" target="_top">Getting Started</a></li><li class="listitem"><a class="link" href="controlbus.html" target="_top">ControlBus</a> EIP</li><li class="listitem"><a class="link" href="jmx.html" target="_top">JMX</a> Component</li><li class="listitem">Using <a class="link" href="camel-jmx.html" target="_top">JMX</a> with Camel</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ControlBus-UsingThisPattern"></a>Using This Pattern</h2></div></div></div><p>If you would like to use this EIP Pattern then please read the
<a class="link" href="getting-started.html" target="_top">Getting Started</a>, you may also find the
<a class="link" href="architecture.html" target="_top">Architecture</a> useful particularly the description
of <a class="link" href="endpoint.html" target="_top">Endpoint</a> and <a class="link" href="uris.html" target="_top">URIs</a>. Then you could
try out some of the <a class="link" href="examples.html" target="_top">Examples</a> first before trying
this pattern out.</p></div></div></body></html>