<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Aggregate</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="RiderEIPRef.html" title="Part&nbsp;IV.&nbsp;Enterprise Integration Pattern Reference"><link rel="prev" href="process.html" title="Process"><link rel="next" href="choice.html" title="Choice"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="aggregate"></a>Aggregate</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="aggregate.html#_usage_5">Usage</a></span></dt><dt><span class="section"><a href="aggregate.html#_properties_4">Properties</a></span></dt><dt><span class="section"><a href="aggregate.html#_related_topics_30">Related topics</a></span></dt></dl></div><p>Aggregates many messages into a single message</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_usage_5"></a>Usage</h2></div></div></div><p>The Aggregate pattern uses an expression to determine which messages to aggregate into a
single message. Messages that match the expression are held until they are combined by
the specified aggregation strategy bean.</p><p>The Aggregate pattern can be placed anywhere in the body of a route.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_properties_4"></a>Properties</h2></div></div></div><p><a class="xref" href="aggregate.html#RiderAggregateRefTbl1" title="Table&nbsp;33.&nbsp;Aggregate Properties">Table&nbsp;33, &#8220;Aggregate Properties&#8221;</a> describes the properties you can specify
using the properties editor.</p><div class="table"><a name="RiderAggregateRefTbl1"></a><p class="title"><b>Table&nbsp;33.&nbsp;Aggregate Properties</b></p><div class="table-contents"><table summary="Aggregate Properties" border="1"><colgroup><col width="50%" class="col_1"><col width="50%" class="col_2"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">language</code></p></td><td align="left" valign="top"><p>Specifies the expression language used to process the correlation
              expression.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Aggregate Controller Ref</code></p></td><td align="left" valign="top"><p>Specifies a reference to a org.apache.camel.processor.aggregate.AggregateController to allow external sources to control this aggregator.</p></td></tr><tr><td align="left" valign="top"><p><a name="AggRepo"></a><code class="literal">Aggregation Repository Ref</code></p></td><td align="left" valign="top"><p>Specifies a reference for looking up a custom
                    AggregationRepository in the registry. The
                    AggregationRepository stores the messages while they
                    are being aggregated (held).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Close Correlation Key On Completion</code></p></td><td align="left" valign="top"><p>Specifies the number of closed correlation keys stored in the cache used to
              determine if an exchange should be accepted.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Complete All on Stop</code></p></td><td align="left" valign="top"><p>Indicates to wait to complete all current and partial (pending) aggregate exchanges when the context is stopped. When enabled, the aggregate will wait to complete all exchanges before it is stopped, when the Camel context or the route using it is stopped.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Completion From Batch Consumer</code></p></td><td align="left" valign="top"><p>Specifies whether aggregates can be completed based on information from a batch
                    consumer. The default is <span class="emphasis"><em>Disabled</em></span>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Completion Interval</code></p></td><td align="left" valign="top"><p>Specifies an interval of time, in milliseconds, after which the
                    aggregator completes any in process aggregate messages. This property cannot be
                    used with <code class="literal">Completion Timeout</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">language</code></p></td><td align="left" valign="top"><p>Specifies the expression language used to process the completion size
              expression.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Completion Size</code></p></td><td align="left" valign="top"><p>Specifies an expression used to determine when aggregation is complete based on
              the number of exchanges processed.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Completion Timeout</code></p></td><td align="left" valign="top"><p>Specifies an expression used to determine when aggregation is complete based on
                    the amount of time, in milliseconds, the aggregator has been inactive.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Description</code></p></td><td align="left" valign="top"><p>Specifies a text description for the node.  This description is included in the
              generated XML file, but it is informational only. It is not used by Apache Camel.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Discard On Completion Timeout</code></p></td><td align="left" valign="top"><p>Specifies whether aggregates that are completed due to a timeout, in
                    milliseconds, are discarded. The default is
                    <span class="emphasis"><em>Disabled</em></span>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Eager Check Completion</code></p></td><td align="left" valign="top"><p>Specifies whether the aggregator determines completion by eagerly checking the
data as exchanges are received or by checking the data after it&#8217;s been aggregated into
a single exchange. The default is <span class="emphasis"><em>Disabled</em></span>.</p>
<p>This property works in conjunction with
and influences the behavior of the <code class="literal">Completion Predicate</code>
property.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Executor Service Ref</code></p></td><td align="left" valign="top"><p>Specifies a reference for looking up the
                executorService to use for thread pool management
              when using the <code class="literal">Parallel Processing</code> option or when sending out aggregated
              exchanges.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Force Completion On Stop</code></p></td><td align="left" valign="top"><p>Specifies whether to complete all aggregated exchanges currently in route when
              the routing context is stopped. The default is <span class="emphasis"><em>Disabled</em></span>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Group Exchanges</code></p></td><td align="left" valign="top"><p>Specifies whether the aggregator groups all outgoing exchanges into a single
                    <code class="literal">GroupedExchange</code> object. The default is <span class="emphasis"><em>Disabled</em></span>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Id</code></p></td><td align="left" valign="top"><p>Specifies a unique identifier for the endpoint.</p>
<p>The tooling automatically generates an id for a node when it is
created, but you can remove that id or replace it with your own.
The Camel debugger requires all nodes with a breakpoint set to have
a unique id.</p>
<p>You can use the id to refer to endpoints in your Camel XML
file.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Ignore Invalid Correlation Keys</code></p></td><td align="left" valign="top"><p>Specifies whether the aggregator ignores invalid correlation keys. The default is
              <span class="emphasis"><em>Disabled</em></span>, which causes the aggregator to throw an exception when it encounters an
              invalid correlation key.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Optimistic Lock Retry Policy</code></p></td><td align="left" valign="top"><p>Configures the retry settings when Optimized locking is enabled. See <a class="xref" href="aggregate.html#optLockRetrySettings" title="Table&nbsp;34.&nbsp;Optimistic Lock Retry Configuration Options">Table&nbsp;34, &#8220;Optimistic Lock Retry Configuration Options&#8221;</a> for configuration details.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Optimistic Locking</code></p></td><td align="left" valign="top"><p>Specifies whether to use optimistic locking when aggregating messages. When
                            enabled, the AggregationRepository (see
                                <a class="xref" href="aggregate.html#AggRepo">[AggRepo]</a> must
                            support optimistic locking (which all out-of-the-box, camel-supplied
                            aggregation repositories do). The default is
                                <span class="emphasis"><em>Disabled</em></span>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Parallel Processing</code></p></td><td align="left" valign="top"><p>Specifies whether the aggregator processes multiple messages concurrently. The
                    default is <span class="emphasis"><em>Disabled</em></span>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Strategy Method Allow Null</code></p></td><td align="left" valign="top"><p>Specifies whether the aggregate method is used on the initial aggregation.
                            When disabled, it is not used on the initial aggregation. When enabled,
                            null values are used as the <code class="literal">oldExchange</code> (on the initial aggregation)
                            when POJOs are used as the
                                AggregationStrategy. The default is
                                <span class="emphasis"><em>Disabled</em></span>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Strategy Method Name</code></p></td><td align="left" valign="top"><p>Explicitly specifies the name of the method to use when using POJOs as the
                                AggregationStrategy.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Strategy Ref</code></p></td><td align="left" valign="top"><p>Specifies a reference for looking up the
                    AggregationStrategy in the registry.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Timeout Checker Executor Service Ref</code></p></td><td align="left" valign="top"><p>Specifies a reference for looking up the
                timeoutExecutorService to use for custom thread pool
              management when using one of the options: <code class="literal">Completion Timeout</code>, <code class="literal">Completion Timeout
                Expression</code>, or <code class="literal">Completion Interval</code>.</p></td></tr></tbody></table></div></div><br class="table-break"><p><a class="xref" href="aggregate.html#optLockRetrySettings" title="Table&nbsp;34.&nbsp;Optimistic Lock Retry Configuration Options">Table&nbsp;34, &#8220;Optimistic Lock Retry Configuration Options&#8221;</a> describes the
properties used to configure how a failed optimized lock is tried.</p><div class="table"><a name="optLockRetrySettings"></a><p class="title"><b>Table&nbsp;34.&nbsp;Optimistic Lock Retry Configuration Options</b></p><div class="table-contents"><table summary="Optimistic Lock Retry Configuration Options" border="1"><colgroup><col width="33%" class="col_1"><col width="33%" class="col_2"><col width="34%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Default</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">Exponential Back Off</code></p></td><td align="left" valign="top"><p><span class="emphasis"><em>Enabled</em></span></p></td><td align="left" valign="top"><p>Enables/disables exponential back off mode, which uses an exponential
                            algorithm to calculate successive retry intervals after <code class="literal">Retry
                                Delay</code>, not to exceed <code class="literal">Maximum Retry
                                Delay</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Maximum Retries</code></p></td><td align="left" valign="top"><p><span class="emphasis"><em>0</em></span></p></td><td align="left" valign="top"><p>Specifies the maximum number of retries that will be attempted. When
                            reached, no further attempt will be made.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Maximum Retry Delay</code></p></td><td align="left" valign="top"><p><span class="emphasis"><em>0 ms</em></span></p></td><td align="left" valign="top"><p>Specifies the maximum wait time, in milliseconds, between retries.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Random Back Off</code></p></td><td align="left" valign="top"><p><span class="emphasis"><em>Disabled</em></span></p></td><td align="left" valign="top"><p>Enables/disables random back off mode, which uses  random number
                            generation to calculate successive retry intervals after <code class="literal">Retry
                                Delay</code>, not to exceed <code class="literal">Maximum Retry
                                Delay</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Retry Delay</code></p></td><td align="left" valign="top"><p><span class="emphasis"><em>50 ms</em></span></p></td><td align="left" valign="top"><p>Specifies the initial wait time interval, in milliseconds, between
                            retries.</p></td></tr></tbody></table></div></div><br class="table-break"><p>Combining retry configuration options has these effects:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">When <code class="literal">Random Back Off</code> is enabled, <code class="literal">Retry Delay</code>
is ignored.</li><li class="listitem">When <code class="literal">Random Back Off</code> is enabled, but <code class="literal">Maximum Retry
Delay</code> is not, <code class="literal">Maximum Retry Delay</code> defaults
to <code class="literal">1000</code> ms, and the random back off delay will be between
<code class="literal">0</code> and <code class="literal">1000</code> ms.</li><li class="listitem">When <code class="literal">Exponential Back Off</code> is enabled and <code class="literal">Maximum Retry
Delay</code> set, the <code class="literal">Retry Delay</code> keeps doubling in value
until it reaches or exceeds <code class="literal">Maximum Retry Delay</code>. At that point, the
value of <code class="literal">Maximum Retry Delay</code> is used as the <code class="literal">Retry
Delay</code>.</li><li class="listitem">When both <code class="literal">Exponential Back Off</code> and <code class="literal">Random Back
Off</code> are enabled, <code class="literal">Exponential Back Off</code> takes
precedence.</li><li class="listitem">When both <code class="literal">Exponential Back Off</code> and <code class="literal">Random Back Off</code>
are disabled, the value of <code class="literal">Retry Delay</code> is used and remains
constant throughout all retry attempts.</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_related_topics_30"></a>Related topics</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a href="RiderExLang.html" class="olink">Part&nbsp;III, &#8220;Expression and Predicates Languages&#8221;</a></li><li class="listitem"><a href="RiderEditPrefs.html" class="olink">Configuring the route editor</a></li></ul></div></div></div></body></html>