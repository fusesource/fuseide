<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>XSLT</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><meta name="keywords" content="ESB, Apache ServiceMix, Open Source, open source, integration, OSGi, enterprise service bus, Apache ServiceMix documentation, Apache Karaf, Red Hat JBoss Fuse, Red Hat JBoss Fuse documentation"><meta name="keywords" content="ESB, Apache ServiceMix, Open Source, open source, integration, OSGi, enterprise service bus, Apache ServiceMix documentation, Apache Karaf, Red Hat JBoss Fuse, Red Hat JBoss Fuse documentation"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Apache Camel Component Reference"><link rel="prev" href="IDU-XQueryEndpoint.html" title="XQuery Endpoint"><link rel="next" href="IDU-XStream.html" title="XStream"><link rel="copyright" href="tmdisclaim.html" title="Trademark Disclaimer"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="IDU-XSLT"></a>XSLT</h1></div></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-XSLT_HSH_XSLT"></a>XSLT</h2></div></div></div><p>The <span class="bold"><strong>xslt:</strong></span> component allows you to process a message
            using an <a class="link" href="http://www.w3.org/TR/xslt" target="_top">XSLT</a> template. This can be
            ideal when using <a class="link" href="http://camel.apache.org/templating.html" target="_top">Templating</a> to generate respopnses for
            requests.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-XSLT_HSH_URIformat"></a>URI format</h2></div></div></div><pre class="programlisting">xslt:templateName[?options]</pre><p>Where <span class="bold"><strong>templateName</strong></span> is the classpath-local URI of the
            template to invoke; or the complete URL of the remote template. Refer to the <a class="link" href="http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/core/io/DefaultResourceLoader.html" target="_top">Spring Documentation for more detail of the URI syntax</a>
        </p><p>You can append query options to the URI in the following format,
                <code class="literal">?option=value&amp;option=value&amp;...</code>
        </p><p>Here are some example URIs</p><table id="d0e179341"><tr>
                <th> URI </th>
                <th> Description </th>
            </tr><tr>
                <td>
                    <code class="code">xslt:com/acme/mytransform.xsl</code>
                    
                </td>
                <td> Refers to the file, <code class="code">com/acme/mytransform.xsl</code>, on the classpath.
                </td>
            </tr><tr>
                <td>
                    <code class="code">xslt:file:///foo/bar.xsl</code>
                    
                </td>
                <td> Refers to the file, <code class="code">/foo/bar.xsl</code>.</td>
            </tr><tr>
                <td>
                    <code class="code">xslt:http://acme.com/cheese/foo.xsl</code>
                </td>
                <td> Refers to the remote HTTP resource.</td>
            </tr></table><p>From Camel 2.9 onwards the <a href="IDU-XSLT.html" class="olink">XSLT</a> component is
            provided directly in the camel-core.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-XSLT_HSH_Options"></a>Options</h2></div></div></div><table id="d0e179405"><tr>
                <th> Name </th>
                <th> Default Value </th>
                <th> Description </th>
            </tr><tr>
                <td><code class="literal">converter</code>
                </td>
                <td><code class="literal">null</code>
                </td>
                <td> Option to override default <a class="link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/converter/jaxp/XmlConverter.html" target="_top">XmlConverter</a>. Will lookup for the converter in the Registry. The
                    provided converted must be of type org.apache.camel.converter.jaxp.XmlConverter.
                </td>
            </tr><tr>
                <td><code class="literal">transformerFactory</code>
                </td>
                <td><code class="literal">null</code>
                </td>
                <td>Option to override default <a class="link" href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/TransformerFactory.html" target="_top">TransformerFactory</a>. Will lookup for the transformerFactory in the
                    Registry. The provided transformer factory must be of type
                        <code class="code">javax.xml.transform.TransformerFactory</code>.</td>
            </tr><tr>
                <td><code class="literal">transformerFactoryClass</code>
                </td>
                <td><code class="literal">null</code>
                </td>
                <td>Option to override default <a class="link" href="http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/transform/TransformerFactory.html" target="_top">TransformerFactory</a>. Will create a
                        <code class="code">TransformerFactoryClass</code> instance and set it to the converter.
                </td>
            </tr><tr>
                <td><code class="literal">uriResolverFactory</code></td>
                <td><code class="literal">DefaultXsltUriResolverFactory</code>
                </td>
                <td><span class="bold"><strong>Camel 2.17:</strong></span> Reference to an
                        <code class="code">org.apache.camel.component.xslt.XsltUriResolverFactory</code>, which
                    creates an URI resolver per endpoint.The default implementation returns an
                    instance of
                        <code class="code">org.apache.camel.component.xslt.DefaultXsltUriResolverFactory</code>
                    which creates the default URI resolver
                    org.apache.camel.builder.xml.XsltUriResolver per endpoint. The default URI
                    resolver reads XSLT documents from the classpath and the file system. This
                    option instead of the option <code class="code">uriResolver</code> shall be used when the URI
                    resolver depends on the resource URI of the root XSLT document specified in the
                    endpoint; for example, if you want to extend the default URI resolver. This
                    option is also available on the XSLT component, so that you can set the resource
                    resolver factory only once for all endpoints. </td>
            </tr><tr>
                <td><code class="literal">uriResolver</code></td>
                <td><code class="literal">null</code>
                </td>
                <td><span class="bold"><strong>Camel 2.3</strong></span>: Allows you to use a custom
                        <code class="literal">javax.xml.transformation.URIResolver</code>. Camel will by
                    default use its own implementation
                        <code class="literal">org.apache.camel.builder.xml.XsltUriResolver</code> which is
                    capable of loading from classpath. </td>
            </tr><tr>
                <td><code class="literal">resultHandlerFactory</code>
                </td>
                <td><code class="literal">null</code>
                </td>
                <td><span class="bold"><strong>Camel 2.3:</strong></span> Allows you to use a custom
                        <code class="literal">org.apache.camel.builder.xml.ResultHandlerFactory</code> which
                    is capable of using custom
                        <code class="literal">org.apache.camel.builder.xml.ResultHandler</code> types. </td>
            </tr><tr>
                <td><code class="literal">failOnNullBody</code>
                </td>
                <td><code class="literal">true</code>
                </td>
                <td><span class="bold"><strong>Camel 2.3:</strong></span> Whether or not to throw an exception
                    if the input body is null. </td>
            </tr><tr>
                <td><code class="literal">deleteOutputFile</code>
                </td>
                <td><code class="literal">false</code>
                </td>
                <td><span class="bold"><strong>Camel 2.6:</strong></span> If you have
                        <code class="literal">output=file</code> then this option dictates whether or not the
                    output file should be deleted when the <a class="link" href="Exchange" target="_top">Exchange</a>
                    is done processing. For example suppose the output file is a temporary file,
                    then it can be a good idea to delete it after use. </td>
            </tr><tr>
                <td><code class="literal">output</code>
                </td>
                <td><code class="literal">string</code>
                </td>
                <td><span class="bold"><strong>Camel 2.3:</strong></span> Option to specify which output type
                    to use. Possible values are: <code class="literal">string, bytes, DOM, file</code>. The
                    first three options are all in memory based, where as <code class="literal">file</code> is
                    streamed directly to a <code class="literal">java.io.File</code>. For
                        <code class="literal">file</code> you <span class="bold"><strong>must</strong></span> specify
                    the filename in the IN header with the key
                        <code class="literal">Exchange.XSLT_FILE_NAME</code> which is also
                        <code class="literal">CamelXsltFileName</code>. Also any paths leading to the filename
                    must be created beforehand, otherwise an exception is thrown at runtime. </td>
            </tr><tr>
                <td><code class="literal">contentCache</code>
                </td>
                <td><code class="literal">true</code>
                </td>
                <td><span class="bold"><strong>Camel 2.6:</strong></span> Cache for the resource content (the
                    stylesheet file) when it is loaded. If set to <code class="literal">false</code> Camel
                    will reloader the stylesheet file on each message processing. This is good for
                    development. </td>
            </tr><tr>
                <td><code class="literal">allowStAX</code>
                </td>
                <td><code class="literal">true</code>
                </td>
                <td>
                    <span class="bold"><strong>Camel 2.8.3/2.9:</strong></span> Whether to allow using StAX as
                    the <code class="literal">javax.xml.transform.Source</code>. </td>
            </tr><tr>
                <td><code class="literal">transformerCacheSize</code>
                </td>
                <td><code class="literal">0</code>
                </td>
                <td><span class="bold"><strong>Camel 2.9.3/2.10.1:</strong></span> The number of
                        <code class="literal">javax.xml.transform.Transformer</code> object that are cached
                    for reuse to avoid calls to <code class="literal">Template.newTransformer()</code>. </td>
            </tr><tr>
                <td><code class="literal">saxon</code></td>
                <td><code class="literal">false</code></td>
                <td><span class="bold"><strong>Camel 2.11:</strong></span> Whether to use Saxon as the
                        <code class="literal">transformerFactoryClass</code>. If enabled then the class
                        <code class="literal">net.sf.saxon.TransformerFactoryImpl</code>. You would need to
                    add Saxon to the classpath. </td>
            </tr><tr>
                <td><code class="literal">saxonExtensionFunctions</code></td>
                <td><code class="literal">null</code></td>
                <td><span class="bold"><strong>Camel 2.17:</strong></span> Allows you to configure one or more
                    custom <code class="code">net.sf.saxon.lib.ExtensionFunctionDefinition</code>. You would need
                    to add Saxon to the classpath. By setting this option, the <code class="code">saxon</code>
                    option will be turned on automatically.</td>
            </tr><tr>
                <td><code class="literal">errorListener</code>
                </td>
                <td></td>
                <td>
                    <span class="bold"><strong>Camel 2.14:</strong></span> Allows to configure to use a custom
                        <code class="code">javax.xml.transform.ErrorListener</code>. Beware when doing this then
                    the default error listener which captures any errors or fatal errors and store
                    information on the Exchange as properties is not in use. So only use this option
                    for special use-cases.</td>
            </tr></table></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-XSLT_HSH_UsingXSLTendpoints"></a>Using XSLT endpoints</h2></div></div></div><p>For example you could use something like</p><pre class="programlisting">from("activemq:My.Queue").
  to("xslt:com/acme/mytransform.xsl");</pre><p>To use an XSLT template to forumulate a response for a message for InOut message
            exchanges (where there is a <code class="literal">JMSReplyTo</code> header).</p><p>If you want to use InOnly and consume the message and send it to another destination
            you could use the following route:</p><pre class="programlisting">from("activemq:My.Queue").
  to("xslt:com/acme/mytransform.xsl").
  to("activemq:Another.Queue");</pre></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-XSLT_HSH_GettingParametersintotheXSLTtoworkwith"></a>Getting Parameters into the XSLT to work with</h2></div></div></div><p>By default, all headers are added as parameters which are available in the XSLT. To do
            this you will need to declare the parameter so it is then
            <span class="emphasis"><em>useable</em></span>.</p><pre class="programlisting">&lt;setHeader headerName="myParam"&gt;&lt;constant&gt;42&lt;/constant&gt;&lt;/setHeader&gt;
&lt;to uri="xslt:MyTransform.xsl"/&gt;</pre><p>And the XSLT just needs to declare it at the top level for it to be available:</p><pre class="programlisting">&lt;xsl: ...... &gt;

   &lt;xsl:param name="myParam"/&gt;
  
    &lt;xsl:template ...&gt;</pre></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-XSLT_HSH_SpringXMLversions"></a>Spring XML versions</h2></div></div></div><p>To use the above examples in Spring XML you would use something like</p><pre class="programlisting">  &lt;camelContext xmlns="http://activemq.apache.org/camel/schema/spring"&gt;
    &lt;route&gt;
      &lt;from uri="activemq:My.Queue"/&gt;
      &lt;to uri="xslt:org/apache/camel/spring/processor/example.xsl"/&gt;
      &lt;to uri="activemq:Another.Queue"/&gt;
    &lt;/route&gt;
  &lt;/camelContext&gt;</pre><p>There is a <a class="link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-spring/src/test/java/org/apache/camel/spring/processor/XsltTest.java" target="_top">test case</a> along with <a class="link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-spring/src/test/resources/org/apache/camel/spring/processor/XsltTest-context.xml" target="_top">its Spring XML</a> if you want a concrete example.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-XSLT_HSH_Usingxslinclude"></a>Using xsl:include</h2></div></div></div><p>Camel provides its own implementation of <code class="literal">URIResolver</code> which allows
            Camel to load included files from the classpath and more intelligent than before.</p><p>For example this include:</p><pre class="programlisting">&lt;xsl:include href="staff_template.xsl"/&gt;</pre><p>Will now be located relative from the starting endpoint, which for example could
            be:</p><pre class="programlisting">.to("xslt:org/apache/camel/component/xslt/staff_include_relative.xsl")</pre><p>Which means Camel will locate the file in the <span class="bold"><strong>classpath</strong></span> as
                <code class="literal">org/apache/camel/component/xslt/staff_template.xsl</code>. This allows
            you to use xsl include and have xsl files located in the same folder such as we do in
            the example <code class="literal">org/apache/camel/component/xslt</code>.</p><p>You can use the following two prefixes <code class="literal">classpath:</code> or
                <code class="literal">file:</code> to instruct Camel to look either in classpath or file
            system. If you omit the prefix then Camel uses the prefix from the endpoint
            configuration. If that neither has one, then classpath is assumed.</p><p>You can also refer back in the paths such as</p><pre class="programlisting">&lt;xsl:include href="../staff_other_template.xsl"/&gt;</pre><p>Which then will resolve the xsl file under
                <code class="literal">org/apache/camel/component</code>.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-XSLT_HSH_Usingxslincludeanddefaultprefix"></a>Using xsl:include and default prefix</h2></div></div></div><p>When using xsl:include such as: </p><pre class="programlisting">&lt;xsl:include href="staff_template.xsl"/&gt;</pre><p>Then in Camel 2.10.3 and older, then Camel will use "classpath:" as the default
            prefix, and load the resource from the classpath. This works for most cases, but if you
            configure the starting resource to load from file, </p><pre class="programlisting">.to("xslt:file:etc/xslt/staff_include_relative.xsl")</pre><p>.. then you would have to prefix all your includes with "file:" as well.</p><pre class="programlisting">&lt;xsl:include href="file:staff_template.xsl"/&gt;</pre><p>From Camel 2.10.4 onwards we have made this easier as Camel will use the prefix from
            the endpoint configuration as the default prefix. So from Camel 2.10.4 onwards you can
            do:</p><pre class="programlisting">&lt;xsl:include href="staff_template.xsl"/&gt;</pre><p>Which will load the staff_template.xsl resource from the file system, as the endpoint
            was configured with "file:" as prefix. You can still though explicit configure a prefix,
            and then mix and match. And have both file and classpath loading. But that would be
            unusual, as most people either use file or classpath based resources.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
  XSLT can load the resource file from the Registry by using <em class="parameter"><code>ref:</code></em> as prefix.
  </p></td></tr></table></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e179870"></a>Using Saxon extension functions</h2></div></div></div><p>Since Saxon 9.2, writing extension functions has been supplemented by a new mechanism,
            referred to as integrated extension functions you can now easily use camel:</p><p>Java example:</p><pre class="programlisting">SimpleRegistry registry = new SimpleRegistry();
registry.put("function1", new MyExtensionFunction1());
registry.put("function2", new MyExtensionFunction2());

CamelContext context = new DefaultCamelContext(registry);
context.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("direct:start")
            .to("xslt:org/apache/camel/component/xslt/extensions/extensions.xslt?saxonExtensionFunctions=#function1,#function2");
    }
});</pre><p>Spring XML example:</p><pre class="programlisting">&lt;camelContext xmlns="http://camel.apache.org/schema/spring"&gt;
  &lt;route&gt;
    &lt;from uri="direct:extensions"/&gt;
    &lt;to uri="xslt:org/apache/camel/component/xslt/extensions/extensions.xslt?saxonExtensionFunctions=#function1,#function2"/&gt;
  &lt;/route&gt;
&lt;/camelContext&gt;


&lt;bean id="function1" class="org.apache.camel.component.xslt.extensions.MyExtensionFunction1"/&gt;
&lt;bean id="function2" class="org.apache.camel.component.xslt.extensions.MyExtensionFunction2"/&gt;</pre></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-XSLT_HSH_Dynamicstylesheets"></a>Dynamic stylesheets</h2></div></div></div><p>To provide a dynamic stylesheet at runtime you can define a dynamic URI. For example,
            you can do this using the Recipient List Enterprise Integration Pattern (EIP), which is
            invoked using the <code class="code">.recipientList</code> command in the Java DSL.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scroll-bookmark-2018"></a>Accessing warnings, errors and fatalErrors from XSLT ErrorListener</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.14</strong></span></p><p>From Camel 2.14 onwards, any warning/error or fatalError is stored on the current
            Exchange as a property with the keys <code class="code">Exchange.XSLT_ERROR</code>,
                <code class="code">Exchange.XSLT_FATAL_ERROR</code>, or <code class="code">Exchange.XSLT_WARNING</code> which
            allows end users to get hold of any errors happening during transformation.</p><p>For example in the stylesheet below, we want to terminate if a staff has an empty dob
            field. And to include a custom error message using xsl:message.</p><div class="informalexample"><pre class="programlisting">  &lt;xsl:template match="/"&gt;
    &lt;html&gt;
      &lt;body&gt;
        &lt;xsl:for-each select="staff/programmer"&gt;
          &lt;p&gt;Name: &lt;xsl:value-of select="name"/&gt;&lt;br /&gt;
            &lt;xsl:if test="dob=''"&gt;
              &lt;xsl:message terminate="yes"&gt;Error: DOB is an empty string!&lt;/xsl:message&gt;
            &lt;/xsl:if&gt;
          &lt;/p&gt;
        &lt;/xsl:for-each&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  &lt;/xsl:template&gt;</pre></div><p>This information is not available on the Exchange stored as an Exception that contains
            the message in the <code class="code">getMessage()</code> method on the exception. The exception is
            stored on the Exchange as a warning with the key
            <code class="code">Exchange.XSLT_WARNING.</code></p></div></div></body></html>