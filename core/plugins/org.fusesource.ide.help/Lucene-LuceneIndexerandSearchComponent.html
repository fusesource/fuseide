<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Lucene (Indexer and Search) Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="Log-LogComponent.html" title="Log Component"><link rel="next" href="Lumberjack-LumberjackComponent.html" title="Lumberjack Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="Lucene-LuceneIndexerandSearchComponent"></a>Lucene (Indexer and Search) Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="Lucene-LuceneIndexerandSearchComponent.html#Lucene-URIformat">URI format</a></span></dt><dt><span class="section"><a href="Lucene-LuceneIndexerandSearchComponent.html#Lucene-InsertOptions">Insert Options</a></span></dt><dt><span class="section"><a href="Lucene-LuceneIndexerandSearchComponent.html#Lucene-LuceneUsageSamples">Lucene Usage Samples</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel 2.2</strong></span></p><p>The <span class="strong"><strong>lucene</strong></span> component is based on the Apache Lucene project. Apache
Lucene is a powerful high-performance, full-featured text search engine
library written entirely in Java. For more details about Lucene, please
see the following links</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="http://lucene.apache.org/java/docs/" target="_top">http://lucene.apache.org/java/docs/</a></li><li class="listitem"><a class="link" href="http://lucene.apache.org/java/docs/features.html" target="_top">http://lucene.apache.org/java/docs/features.html</a></li></ul></div><p>The lucene component in camel facilitates integration and utilization of
Lucene endpoints in enterprise integration patterns and scenarios. The
lucene component does the following</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">builds a searchable index of documents when payloads are sent to the
Lucene Endpoint</li><li class="listitem">facilitates performing of indexed searches in Camel</li></ul></div><p>This component only supports producer endpoints.</p><p>Maven users will need to add the following dependency to their <code class="literal">pom.xml</code>
for this component:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-lucene<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Lucene-URIformat"></a>URI format</h2></div></div></div><pre class="programlisting">lucene:searcherName:insert[?options]
lucene:searcherName:query[?options]</pre><p>You can append query options to the URI in the following format,
<code class="literal">?option=value&amp;option=value&amp;&#8230;&#8203;</code></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Lucene-InsertOptions"></a>Insert Options</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="Lucene-LuceneIndexerandSearchComponent.html#Lucene-MessageHeaders">Message Headers</a></span></dt><dt><span class="section"><a href="Lucene-LuceneIndexerandSearchComponent.html#Lucene-LuceneProducers">Lucene Producers</a></span></dt><dt><span class="section"><a href="Lucene-LuceneIndexerandSearchComponent.html#Lucene-LuceneProcessor">Lucene Processor</a></span></dt></dl></div><p>The Lucene component supports 1 options which are listed below.</p><p>{% raw %}</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="11%" class="col_2"><col width="70%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Java Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>config</p></td><td align="left" valign="top"><p><code class="literal">LuceneConfiguration</code></p></td><td align="left" valign="top"><p>To use a shared lucene configuration</p></td></tr></tbody></table></div><p>{% endraw %}</p><p>The Lucene component supports 7 endpoint options which are listed below:</p><p>{% raw %}</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="10%" class="col_2"><col width="11%" class="col_3"><col width="10%" class="col_4"><col width="50%" class="col_5"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Group</th><th align="left" valign="top">Default</th><th align="left" valign="top">Java Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>host</p></td><td align="left" valign="top"><p>producer</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> The URL to the lucene server</p></td></tr><tr><td align="left" valign="top"><p>operation</p></td><td align="left" valign="top"><p>producer</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">LuceneOperation</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> Operation to do such as insert or query.</p></td></tr><tr><td align="left" valign="top"><p>analyzer</p></td><td align="left" valign="top"><p>producer</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">Analyzer</code></p></td><td align="left" valign="top"><p>An Analyzer builds TokenStreams which analyze text. It thus represents a policy for extracting index terms from text. The value for analyzer can be any class that extends the abstract class org.apache.lucene.analysis.Analyzer. Lucene also offers a rich set of analyzers out of the box</p></td></tr><tr><td align="left" valign="top"><p>indexDir</p></td><td align="left" valign="top"><p>producer</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">File</code></p></td><td align="left" valign="top"><p>A file system directory in which index files are created upon analysis of the document by the specified analyzer</p></td></tr><tr><td align="left" valign="top"><p>maxHits</p></td><td align="left" valign="top"><p>producer</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">int</code></p></td><td align="left" valign="top"><p>An integer value that limits the result set of the search operation</p></td></tr><tr><td align="left" valign="top"><p>srcDir</p></td><td align="left" valign="top"><p>producer</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">File</code></p></td><td align="left" valign="top"><p>An optional directory containing files to be used to be analyzed and added to the index at producer startup.</p></td></tr><tr><td align="left" valign="top"><p>synchronous</p></td><td align="left" valign="top"><p>advanced</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used or Camel is allowed to use asynchronous processing (if supported).</p></td></tr></tbody></table></div><p>{% endraw %}</p><p>[[Lucene-Sending/ReceivingMessagestoFromthecache]]
Sending/Receiving Messages to/from the cache
<sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup>^^</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Lucene-MessageHeaders"></a>Message Headers</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="90%" class="col_2"></colgroup><thead><tr><th align="left" valign="top">Header</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">QUERY</code></p></td><td align="left" valign="top"><p>The Lucene Query to performed on the index. The query may include
wildcards and phrases</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">RETURN_LUCENE_DOCS</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Camel 2.15:</strong></span> Set this header to true to include the actual Lucene
documentation when returning hit information.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Lucene-LuceneProducers"></a>Lucene Producers</h3></div></div></div><p>This component supports 2 producer endpoints.</p><p><span class="strong"><strong>insert</strong></span> - The insert producer builds a searchable index by analyzing
the body in incoming exchanges and associating it with a token
("content").
<span class="strong"><strong>query</strong></span> - The query producer performs searches on a pre-created index.
The query uses the searchable index to perform score &amp; relevance based
searches. Queries are sent via the incoming exchange contains a header
property name called 'QUERY'. The value of the header property 'QUERY'
is a Lucene Query. For more details on how to create Lucene Queries
check out <a class="link" href="http://lucene.apache.org/java/3_0_0/queryparsersyntax.html" target="_top">http://lucene.apache.org/java/3_0_0/queryparsersyntax.html</a></p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Lucene-LuceneProcessor"></a>Lucene Processor</h3></div></div></div><p>There is a processor called LuceneQueryProcessor available to perform
queries against lucene without the need to create a producer.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Lucene-LuceneUsageSamples"></a>Lucene Usage Samples</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="Lucene-LuceneIndexerandSearchComponent.html#Lucene-Example1-CreatingaLuceneindex">Example 1: Creating a Lucene index</a></span></dt><dt><span class="section"><a href="Lucene-LuceneIndexerandSearchComponent.html#Lucene-Example2-LoadingpropertiesintotheJNDIregistryintheCamelContext">Example 2: Loading properties into the JNDI registry in the Camel Context</a></span></dt><dt><span class="section"><a href="Lucene-LuceneIndexerandSearchComponent.html#Lucene-Example2-PerformingsearchesusingaQueryProducer">Example 2: Performing searches using a Query Producer</a></span></dt><dt><span class="section"><a href="Lucene-LuceneIndexerandSearchComponent.html#Lucene-Example3-PerformingsearchesusingaQueryProcessor">Example 3: Performing searches using a Query Processor</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Lucene-Example1-CreatingaLuceneindex"></a>Example 1: Creating a Lucene index</h3></div></div></div><pre class="programlisting">RouteBuilder builder = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> RouteBuilder() {
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> configure() {
       from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>).
           to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"lucene:whitespaceQuotesIndex:insert?
</em></strong>               analyzer=#whitespaceAnalyzer&amp;indexDir=#whitespace&amp;srcDir=#load_dir<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">").
</em></strong>           to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:result"</em></strong>);
    }
};</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Lucene-Example2-LoadingpropertiesintotheJNDIregistryintheCamelContext"></a>Example 2: Loading properties into the JNDI registry in the Camel Context</h3></div></div></div><pre class="programlisting"><em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Override</span></em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">protected</strong> JndiRegistry createRegistry() <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">throws</strong> Exception {
  JndiRegistry registry =
         <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> JndiRegistry(createJndiContext());
  registry.bind(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"whitespace"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> File(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"./whitespaceIndexDir"</em></strong>));
  registry.bind(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"load_dir"</em></strong>,
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> File(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"src/test/resources/sources"</em></strong>));
  registry.bind(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"whitespaceAnalyzer"</em></strong>,
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> WhitespaceAnalyzer());
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">return</strong> registry;
}
...
CamelContext context = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> DefaultCamelContext(createRegistry());</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Lucene-Example2-PerformingsearchesusingaQueryProducer"></a>Example 2: Performing searches using a Query Producer</h3></div></div></div><pre class="programlisting">RouteBuilder builder = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> RouteBuilder() {
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> configure() {
       from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>).
          setHeader(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"QUERY"</em></strong>, constant(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Seinfeld"</em></strong>)).
          to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"lucene:searchIndex:query?
</em></strong>             analyzer=#whitespaceAnalyzer&amp;indexDir=#whitespace&amp;maxHits=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">20</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">").
</em></strong>          to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:next"</em></strong>);

       from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:next"</em></strong>).process(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> Processor() {
          <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> process(Exchange exchange) <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">throws</strong> Exception {
             Hits hits = exchange.getIn().getBody(Hits.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>);
             printResults(hits);
          }

          <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">private</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> printResults(Hits hits) {
              LOG.debug(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Number of hits: "</em></strong> + hits.getNumberOfHits());
              <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">for</strong> (<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">int</strong> i = <span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">0</span>; i &lt; hits.getNumberOfHits(); i++) {
                 LOG.debug(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Hit "</em></strong> + i + <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">" Index Location:"</em></strong> + hits.getHit().get(i).getHitLocation());
                 LOG.debug(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Hit "</em></strong> + i + <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">" Score:"</em></strong> + hits.getHit().get(i).getScore());
                 LOG.debug(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Hit "</em></strong> + i + <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">" Data:"</em></strong> + hits.getHit().get(i).getData());
              }
           }
       }).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:searchResult"</em></strong>);
   }
};</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Lucene-Example3-PerformingsearchesusingaQueryProcessor"></a>Example 3: Performing searches using a Query Processor</h3></div></div></div><pre class="programlisting">RouteBuilder builder = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> RouteBuilder() {
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> configure() {
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">try</strong> {
            from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>).
                setHeader(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"QUERY"</em></strong>, constant(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Rodney Dangerfield"</em></strong>)).
                process(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> LuceneQueryProcessor(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"target/stdindexDir"</em></strong>, analyzer, null, <span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">20</span>)).
                to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:next"</em></strong>);
        } <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">catch</strong> (Exception e) {
            e.printStackTrace();
        }

        from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:next"</em></strong>).process(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> Processor() {
            <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> process(Exchange exchange) <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">throws</strong> Exception {
                Hits hits = exchange.getIn().getBody(Hits.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>);
                printResults(hits);
            }

            <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">private</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> printResults(Hits hits) {
                LOG.debug(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Number of hits: "</em></strong> + hits.getNumberOfHits());
                <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">for</strong> (<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">int</strong> i = <span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">0</span>; i &lt; hits.getNumberOfHits(); i++) {
                    LOG.debug(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Hit "</em></strong> + i + <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">" Index Location:"</em></strong> + hits.getHit().get(i).getHitLocation());
                    LOG.debug(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Hit "</em></strong> + i + <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">" Score:"</em></strong> + hits.getHit().get(i).getScore());
                    LOG.debug(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Hit "</em></strong> + i + <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">" Data:"</em></strong> + hits.getHit().get(i).getData());
                }
            }
       }).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:searchResult"</em></strong>);
   }
};</pre></div></div></div></body></html>