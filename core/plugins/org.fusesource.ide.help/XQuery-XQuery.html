<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>XQuery Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="XMPP-XMPPComponent.html" title="XMPP Component"><link rel="next" href="XSLT-XSLT.html" title="XSLT Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="XQuery-XQuery"></a>XQuery Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="XQuery-XQuery.html#XQuery-Options">Options</a></span></dt><dt><span class="section"><a href="XQuery-XQuery.html#XQuery-Examples">Examples</a></span></dt><dt><span class="section"><a href="XQuery-XQuery.html#XQuery-Variables">Variables</a></span></dt><dt><span class="section"><a href="XQuery-XQuery.html#XQuery-UsingXMLconfiguration">Using XML configuration</a></span></dt><dt><span class="section"><a href="XQuery-XQuery.html#XQuery-UsingXQueryastransformation">Using XQuery as transformation</a></span></dt><dt><span class="section"><a href="XQuery-XQuery.html#XQuery-UsingXQueryasanendpoint">Using XQuery as an endpoint</a></span></dt><dt><span class="section"><a href="XQuery-XQuery.html#XQuery-Examples.1">Examples</a></span></dt><dt><span class="section"><a href="XQuery-XQuery.html#XQuery-LearningXQuery">Learning XQuery</a></span></dt><dt><span class="section"><a href="XQuery-XQuery.html#XQuery-Loadingscriptfromexternalresource">Loading script from external resource</a></span></dt><dt><span class="section"><a href="XQuery-XQuery.html#XQuery-Dependencies">Dependencies</a></span></dt></dl></div><p>Camel supports <a class="link" href="http://www.w3.org/TR/xquery/" target="_top">XQuery</a> to allow an
<a class="link" href="expression.html" target="_top">Expression</a> or <a class="link" href="predicate.html" target="_top">Predicate</a> to be
used in the <a class="link" href="dsl.html" target="_top">DSL</a> or <a class="link" href="xml-configuration.html" target="_top">Xml
Configuration</a>. For example you could use XQuery to create an
<a class="link" href="predicate.html" target="_top">Predicate</a> in a <a class="link" href="message-filter.html" target="_top">Message
Filter</a> or as an <a class="link" href="expression.html" target="_top">Expression</a> for a
<a class="link" href="recipient-list.html" target="_top">Recipient List</a>.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="XQuery-Options"></a>Options</h2></div></div></div><p>The XQuery component supports 1 options which are listed below.</p><p>{% raw %}</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="11%" class="col_2"><col width="70%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Java Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>moduleURIResolver</p></td><td align="left" valign="top"><p><code class="literal">ModuleURIResolver</code></p></td><td align="left" valign="top"><p>To use the custom ModuleURIResolver</p></td></tr></tbody></table></div><p>{% endraw %}</p><p>The XQuery component supports 31 endpoint options which are listed below:</p><p>{% raw %}</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="10%" class="col_2"><col width="11%" class="col_3"><col width="10%" class="col_4"><col width="50%" class="col_5"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Group</th><th align="left" valign="top">Default</th><th align="left" valign="top">Java Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>resourceUri</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> The name of the template to load from classpath or file system</p></td></tr><tr><td align="left" valign="top"><p>allowStAX</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Whether to allow using StAX mode</p></td></tr><tr><td align="left" valign="top"><p>configuration</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">Configuration</code></p></td><td align="left" valign="top"><p>To use a custom Saxon configuration</p></td></tr><tr><td align="left" valign="top"><p>headerName</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>To use a Camel Message header as the input source instead of Message body.</p></td></tr><tr><td align="left" valign="top"><p>moduleURIResolver</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">ModuleURIResolver</code></p></td><td align="left" valign="top"><p>To use the custom ModuleURIResolver</p></td></tr><tr><td align="left" valign="top"><p>namespacePrefixes</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">Map</code></p></td><td align="left" valign="top"><p>Allows to control which namespace prefixes to use for a set of namespace mappings</p></td></tr><tr><td align="left" valign="top"><p>parameters</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">Map</code></p></td><td align="left" valign="top"><p>Additional parameters</p></td></tr><tr><td align="left" valign="top"><p>properties</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">Properties</code></p></td><td align="left" valign="top"><p>Properties to configure the serialization parameters</p></td></tr><tr><td align="left" valign="top"><p>resultsFormat</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top"><p><code class="literal">DOM</code></p></td><td align="left" valign="top"><p><code class="literal">ResultFormat</code></p></td><td align="left" valign="top"><p>What output result to use</p></td></tr><tr><td align="left" valign="top"><p>resultType</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">Class&lt;?&gt;</code></p></td><td align="left" valign="top"><p>What output result to use defined as a class</p></td></tr><tr><td align="left" valign="top"><p>staticQueryContext</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">StaticQueryContext</code></p></td><td align="left" valign="top"><p>To use a custom Saxon StaticQueryContext</p></td></tr><tr><td align="left" valign="top"><p>stripsAllWhiteSpace</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top"><p><code class="literal">true</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Whether to strip all whitespaces</p></td></tr><tr><td align="left" valign="top"><p>bridgeErrorHandler</p></td><td align="left" valign="top"><p>consumer</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Allows for bridging the consumer to the Camel routing Error Handler which mean any exceptions occurred while the consumer is trying to pickup incoming messages or the likes will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions that will be logged at WARN/ERROR level and ignored.</p></td></tr><tr><td align="left" valign="top"><p>sendEmptyMessageWhenIdle</p></td><td align="left" valign="top"><p>consumer</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>If the polling consumer did not poll any files you can enable this option to send an empty message (no body) instead.</p></td></tr><tr><td align="left" valign="top"><p>exceptionHandler</p></td><td align="left" valign="top"><p>consumer (advanced)</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">ExceptionHandler</code></p></td><td align="left" valign="top"><p>To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this options is not in use. By default the consumer will deal with exceptions that will be logged at WARN/ERROR level and ignored.</p></td></tr><tr><td align="left" valign="top"><p>exchangePattern</p></td><td align="left" valign="top"><p>consumer (advanced)</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">ExchangePattern</code></p></td><td align="left" valign="top"><p>Sets the exchange pattern when the consumer creates an exchange.</p></td></tr><tr><td align="left" valign="top"><p>pollStrategy</p></td><td align="left" valign="top"><p>consumer (advanced)</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">PollingConsumerPollStrategy</code></p></td><td align="left" valign="top"><p>A pluggable org.apache.camel.PollingConsumerPollingStrategy allowing you to provide your custom implementation to control error handling usually occurred during the poll operation before an Exchange have been created and being routed in Camel.</p></td></tr><tr><td align="left" valign="top"><p>synchronous</p></td><td align="left" valign="top"><p>advanced</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used or Camel is allowed to use asynchronous processing (if supported).</p></td></tr><tr><td align="left" valign="top"><p>backoffErrorThreshold</p></td><td align="left" valign="top"><p>scheduler</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">int</code></p></td><td align="left" valign="top"><p>The number of subsequent error polls (failed due some error) that should happen before the backoffMultipler should kick-in.</p></td></tr><tr><td align="left" valign="top"><p>backoffIdleThreshold</p></td><td align="left" valign="top"><p>scheduler</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">int</code></p></td><td align="left" valign="top"><p>The number of subsequent idle polls that should happen before the backoffMultipler should kick-in.</p></td></tr><tr><td align="left" valign="top"><p>backoffMultiplier</p></td><td align="left" valign="top"><p>scheduler</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">int</code></p></td><td align="left" valign="top"><p>To let the scheduled polling consumer backoff if there has been a number of subsequent idles/errors in a row. The multiplier is then the number of polls that will be skipped before the next actual attempt is happening again. When this option is in use then backoffIdleThreshold and/or backoffErrorThreshold must also be configured.</p></td></tr><tr><td align="left" valign="top"><p>delay</p></td><td align="left" valign="top"><p>scheduler</p></td><td align="left" valign="top"><p><code class="literal">500</code></p></td><td align="left" valign="top"><p><code class="literal">long</code></p></td><td align="left" valign="top"><p>Milliseconds before the next poll. You can also specify time values using units such as 60s (60 seconds) 5m30s (5 minutes and 30 seconds) and 1h (1 hour).</p></td></tr><tr><td align="left" valign="top"><p>greedy</p></td><td align="left" valign="top"><p>scheduler</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>If greedy is enabled then the ScheduledPollConsumer will run immediately again if the previous run polled 1 or more messages.</p></td></tr><tr><td align="left" valign="top"><p>initialDelay</p></td><td align="left" valign="top"><p>scheduler</p></td><td align="left" valign="top"><p><code class="literal">1000</code></p></td><td align="left" valign="top"><p><code class="literal">long</code></p></td><td align="left" valign="top"><p>Milliseconds before the first poll starts. You can also specify time values using units such as 60s (60 seconds) 5m30s (5 minutes and 30 seconds) and 1h (1 hour).</p></td></tr><tr><td align="left" valign="top"><p>runLoggingLevel</p></td><td align="left" valign="top"><p>scheduler</p></td><td align="left" valign="top"><p><code class="literal">TRACE</code></p></td><td align="left" valign="top"><p><code class="literal">LoggingLevel</code></p></td><td align="left" valign="top"><p>The consumer logs a start/complete log line when it polls. This option allows you to configure the logging level for that.</p></td></tr><tr><td align="left" valign="top"><p>scheduledExecutorService</p></td><td align="left" valign="top"><p>scheduler</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">ScheduledExecutorService</code></p></td><td align="left" valign="top"><p>Allows for configuring a custom/shared thread pool to use for the consumer. By default each consumer has its own single threaded thread pool.</p></td></tr><tr><td align="left" valign="top"><p>scheduler</p></td><td align="left" valign="top"><p>scheduler</p></td><td align="left" valign="top"><p><code class="literal">none</code></p></td><td align="left" valign="top"><p><code class="literal">ScheduledPollConsumerScheduler</code></p></td><td align="left" valign="top"><p>To use a cron scheduler from either camel-spring or camel-quartz2 component</p></td></tr><tr><td align="left" valign="top"><p>schedulerProperties</p></td><td align="left" valign="top"><p>scheduler</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">Map</code></p></td><td align="left" valign="top"><p>To configure additional properties when using a custom scheduler or any of the Quartz2 Spring based scheduler.</p></td></tr><tr><td align="left" valign="top"><p>startScheduler</p></td><td align="left" valign="top"><p>scheduler</p></td><td align="left" valign="top"><p><code class="literal">true</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Whether the scheduler should be auto started.</p></td></tr><tr><td align="left" valign="top"><p>timeUnit</p></td><td align="left" valign="top"><p>scheduler</p></td><td align="left" valign="top"><p><code class="literal">MILLISECONDS</code></p></td><td align="left" valign="top"><p><code class="literal">TimeUnit</code></p></td><td align="left" valign="top"><p>Time unit for initialDelay and delay options.</p></td></tr><tr><td align="left" valign="top"><p>useFixedDelay</p></td><td align="left" valign="top"><p>scheduler</p></td><td align="left" valign="top"><p><code class="literal">true</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Controls if fixed delay or fixed rate is used. See ScheduledExecutorService in JDK for details.</p></td></tr></tbody></table></div><p>{% endraw %}</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="XQuery-Examples"></a>Examples</h2></div></div></div><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"queue:foo"</em></strong>).filter().
  xquery(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"//foo"</em></strong>).
  to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"queue:bar"</em></strong>)</pre><p>You can also use functions inside your query, in which case you need an
explicit type conversion (or you will get a org.w3c.dom.DOMException:
HIERARCHY_REQUEST_ERR) by passing the Class as a second argument to the
<span class="strong"><strong>xquery()</strong></span> method.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>).
  recipientList().xquery(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"concat('mock:foo.', /person/@city)"</em></strong>, String.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="XQuery-Variables"></a>Variables</h2></div></div></div><p>The IN message body will be set as the <code class="literal">contextItem</code>. Besides this these
Variables is also added as parameters:</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="10%" class="col_2"><col width="80%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Variable</th><th align="left" valign="top">Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>exchange</p></td><td align="left" valign="top"><p>Exchange</p></td><td align="left" valign="top"><p>The current Exchange</p></td></tr><tr><td align="left" valign="top"><p>in.body</p></td><td align="left" valign="top"><p>Object</p></td><td align="left" valign="top"><p>The In message&#8217;s body</p></td></tr><tr><td align="left" valign="top"><p>out.body</p></td><td align="left" valign="top"><p>Object</p></td><td align="left" valign="top"><p>The OUT message&#8217;s body (if any)</p></td></tr><tr><td align="left" valign="top"><p>in.headers.*</p></td><td align="left" valign="top"><p>Object</p></td><td align="left" valign="top"><p>You can access the value of exchange.in.headers with key <span class="strong"><strong>foo</strong></span> by using
the variable which name is in.headers.foo</p></td></tr><tr><td align="left" valign="top"><p>out.headers.*</p></td><td align="left" valign="top"><p>Object</p></td><td align="left" valign="top"><p>You can access the value of exchange.out.headers with key <span class="strong"><strong>foo</strong></span> by using
the variable which name is out.headers.foo variable</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>key name</strong></span></p></td><td align="left" valign="top"><p>Object</p></td><td align="left" valign="top"><p>Any exchange.properties and exchange.in.headers and any additional
parameters set using <code class="literal">setParameters(Map)</code>. These parameters is added
with they own key name, for instance if there is an IN header with the
key name <span class="strong"><strong>foo</strong></span> then its added as <span class="strong"><strong>foo</strong></span>.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="XQuery-UsingXMLconfiguration"></a>Using XML configuration</h2></div></div></div><p>If you prefer to configure your routes in your <a class="link" href="spring.html" target="_top">Spring</a>
XML file then you can use XPath expressions as follows</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;beans</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://www.springframework.org/schema/beans"</span>
       <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns:xsi</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns:foo</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://example.com/person"</span>
       <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>

  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"camel"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://activemq.apache.org/camel/schema/spring"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;from</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"activemq:MyQueue"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;filter&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;xquery&gt;</strong>/foo:person[@name='James']<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/xquery&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"mqseries:SomeOtherQueue"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/filter&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camelContext&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/beans&gt;</strong></pre><p>Notice how we can reuse the namespace prefixes, <span class="strong"><strong>foo</strong></span> in this case, in
the XPath expression for easier namespace based XQuery expressions!</p><p>When you use functions in your XQuery expression you need an explicit
type conversion which is done in the xml configuration via the <span class="strong"><strong>@type</strong></span>
attribute:</p><pre class="programlisting">    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;xquery</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">type</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"java.lang.String"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>concat('mock:foo.', /person/@city)<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/xquery&gt;</strong></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="XQuery-UsingXQueryastransformation"></a>Using XQuery as transformation</h2></div></div></div><p>We can do a message translation using transform or setBody in the route,
as shown below:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>).
   transform().xquery(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"/people/person"</em></strong>);</pre><p>Notice that xquery will use DOMResult by default, so if we want to grab
the value of the person node, using text() we need to tell xquery to use
String as result type, as shown:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>).
   transform().xquery(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"/people/person/text()"</em></strong>, String.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>);</pre><p>&nbsp;</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="XQuery-UsingXQueryasanendpoint"></a>Using XQuery as an endpoint</h2></div></div></div><p>Sometimes an XQuery expression can be quite large; it can essentally be
used for <a class="link" href="templating.html" target="_top">Templating</a>. So you may want to use an
<a class="link" href="xquery-endpoint.html" target="_top">XQuery Endpoint</a> so you can route using XQuery
templates.</p><p>The following example shows how to take a message of an ActiveMQ queue
(MyQueue) and transform it using XQuery and send it to MQSeries.</p><pre class="programlisting">  &lt;camelContext id=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"camel"</em></strong> xmlns=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"http://camel.apache.org/schema/spring"</em></strong>&gt;
    &lt;route&gt;
      &lt;from uri=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"activemq:MyQueue"</em></strong>/&gt;
      &lt;to uri=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"xquery:com/acme/someTransform.xquery"</em></strong>/&gt;
      &lt;to uri=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mqseries:SomeOtherQueue"</em></strong>/&gt;
    &lt;/route&gt;
  &lt;/camelContext&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="XQuery-Examples.1"></a>Examples</h2></div></div></div><p>Here is a simple
<a class="link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-saxon/src/test/java/org/apache/camel/builder/saxon/XQueryFilterTest.java" target="_top">example</a>
using an XQuery expression as a predicate in a
<a class="link" href="message-filter.html" target="_top">Message Filter</a></p><p>This
<a class="link" href="http://svn.apache.org/repos/asf/camel/trunk/components/camel-saxon/src/test/java/org/apache/camel/builder/saxon/XQueryWithNamespacesFilterTest.java" target="_top">example</a>
uses XQuery with namespaces as a predicate in a
<a class="link" href="message-filter.html" target="_top">Message Filter</a></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="XQuery-LearningXQuery"></a>Learning XQuery</h2></div></div></div><p>XQuery is a very powerful language for querying, searching, sorting and
returning XML. For help learning XQuery try these tutorials</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Mike Kay&#8217;s <a class="link" href="http://www.stylusstudio.com/xquery_primer.html" target="_top">XQuery
Primer</a></li><li class="listitem">the W3Schools <a class="link" href="http://www.w3schools.com/xquery/default.asp" target="_top">XQuery
Tutorial</a></li></ul></div><p>You might also find the <a class="link" href="http://www.w3.org/TR/xpath-functions/" target="_top">XQuery
function reference</a> useful</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="XQuery-Loadingscriptfromexternalresource"></a>Loading script from external resource</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.11</strong></span></p><p>You can externalize the script and have Camel load it from a resource
such as <code class="literal">"classpath:"</code>, <code class="literal">"file:"</code>, or <code class="literal">"http:"</code>.
 This is done using the following syntax: <code class="literal">"resource:scheme:location"</code>,
eg to refer to a file on the classpath you can do:</p><pre class="programlisting">.setHeader(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"myHeader"</em></strong>).xquery(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"resource:classpath:myxquery.txt"</em></strong>, String.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>)</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="XQuery-Dependencies"></a>Dependencies</h2></div></div></div><p>To use XQuery in your camel routes you need to add the a dependency on
<span class="strong"><strong>camel-saxon</strong></span> which implements the XQuery language.</p><p>If you use maven you could just add the following to your pom.xml,
substituting the version number for the latest &amp; greatest release (see
<a class="link" href="download.html" target="_top">the download page for the latest versions</a>).</p><pre class="programlisting">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-saxon&lt;/artifactId&gt;
  &lt;version&gt;x.x.x&lt;/version&gt;
&lt;/dependency&gt;</pre></div></div></body></html>