<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>To Trace a Message Through a Route</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><meta name="description" content="This tutorial shows you how to trace a message through a route."><meta name="keywords" content="ESB, Apache ServiceMix, Open Source, open source, integration, OSGi, enterprise service bus, Apache ServiceMix documentation, Apache Karaf, Red Hat JBoss Fuse, Red Hat JBoss Fuse documentation"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="RiderTutorials.html" title="Tutorials"><link rel="prev" href="RiderTutorialDebug.html" title="To Debug a Routing Context"><link rel="next" href="RiderTutorialJUnit.html" title="To Test a Route with JUnit"><link rel="copyright" href="tmdisclaim.html" title="Trademark Disclaimer"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="RiderTutorialTrace"></a>To Trace a Message Through a Route</h1></div><div><div class="abstract"><p>This tutorial shows you how to trace a message through a route.</p></div></div></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e24210"></a>Goals</h2></div></div></div><p>In this tutorial you will:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Run the <span class="guimenuitem">CBRroute</span> in the <span class="guilabel">Fuse Integration</span>
                    perspective</p></li><li class="listitem"><p>Enable tracing on the <span class="guimenuitem">CBRroute</span></p></li><li class="listitem"><p>Drop messages onto the <span class="guimenuitem">CBRroute</span> and track them through all route nodes</p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e24236"></a>Prerequisites</h2></div></div></div><p>To complete this tutorial you will need the <span class="guimenuitem">CBRroute</span> project you
            updated in <a href="RiderTutorialAddRoute.html" class="olink"><i>To Add Another Route to the CBR Routing Context</i></a>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you skipped any tutorial after <a href="RiderTutorialCreate.html" class="olink"><i>To Create a New Route</i></a>, you can use the
                prefabricated <code class="filename">blueprint6.xml</code> file to work through this tutorial
                (for details, see <a href="RiderTutorialResources.html" class="olink"><i>Using the Fuse Tooling Resource Files</i></a>).</p></td></tr></table></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e24256"></a>Accessing Fuse Integration perspective</h2></div></div></div><p>If you are not already working in <span class="guilabel">Fuse Integration</span>
            perspective:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Click the <span class="inlinemediaobject"><img src="./images/new_persp2.png" width="20.4" alt="Open Perspective icon"></span> button on the right side of the tool bar, and then select
                        <span class="guimenuitem">Fuse Integration</span> from the list:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutPerspListFIPselected.png" width="153.45000000000002"></div></div><p><span class="guilabel">Fuse Integration</span> perspective opens in the default
                    layout:</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="495"><tr><td><img src="./images/TutFIP_63.png" width="495"></td></tr></table></div></div></li><li class="step"><p>Drag the <span class="guilabel">JMX Navigator</span> tab to the far right of the
                        <span class="guilabel">Terminal</span> tab and drop it there:</p><div class="informalfigure"><a name="RiderTutorialFIPrearranged"></a><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="495"><tr><td><img src="./images/ftTutFIPrearrange.png" width="495"></td></tr></table></div></div><p>This arrangement provides more space for <span class="guilabel">Diagram View</span> to
                    display the routing context's nodes graphically, which makes it easier for you
                    to visually trace the path that messages take in traversing the routing
                    context.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>To make it easy to access a routing context <code class="literal">.xml</code> file, especially when a
                    project consists of multiple contexts, the tooling lists them under the
                    <code class="filename">Camel Contexts</code> folder in <span class="guilabel">Project
                        Explorer</span>.</p><p>Additionally, all routes in a routing context are displayed as icons
                        directly under their context file entry. To display a single route in the
                        routing context on the canvas, double-click its icon in <span class="guilabel">Project
                            Explorer</span>. To display all routes in the routing context,
                        double-click the context file entry. 
                        </p><div class="informalfigure"><div class="mediaobject"><img src="./images/TutCamelContextsFolderPE.png" width="166.95"></div></div></td></tr></table></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e24329"></a>Starting message tracing</h2></div></div></div><p>To start message tracing on the <span class="guilabel">CBRroute</span> project:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>In <span class="guilabel">Project Explorer</span>, expand the
                        <code class="filename">CBRroute</code> project to expose 
                        <code class="filename">src/main/resources/OSGI-INF/blueprint/blueprint.xml</code>.
                   </p></li><li class="step"><p>Right-click 
                            <code class="filename">src/main/resources/OSGI-INF/blueprint/blueprint.xml</code>
                           to open the context menu.</p></li><li class="step"><p>Select <span class="guimenu">Run As</span> &gt; <span class="guimenuitem">Local Camel Context (without tests)</span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you select <span class="guimenuitem">Local Camel Context</span>, the tooling reverts to running
                        without tests because you have not yet created a JUnit test for the
                            <span class="guilabel">CBRroute</span> project. You will do that later in <a href="RiderTutorialJUnit.html" class="olink"><i>To Test a Route with JUnit</i></a>.</p></td></tr></table></div></li><li class="step"><p>In <span class="guilabel">JMX Navigator</span>, expand <span class="guilabel">Local
                        Processes</span>.</p><p>When you first expand <span class="guilabel">Local Processes</span>, you see the node
                            <code class="filename">maven[<em class="replaceable"><code>Id</code></em>][Disconnected]</code>:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutMsgTrJMXLocalProcessess.png" width="184.25000000000003"></div></div><p>When you click this node, it changes to <code class="filename">Local Camel
                            Context[<em class="replaceable"><code>Id</code></em>][Disconnected]</code>
                    (retaining the same <em class="replaceable"><code>Id</code></em> as its predecessor): </p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutMsgTrJMXLocalCamCntxt.png" width="184.8"></div></div></li><li class="step"><p>Double click <code class="filename">Local Camel
                        Context[<em class="replaceable"><code>Id</code></em>][Disconnected]</code> to connect
                    to it, and then expand the elements of your route:</p><div class="informalfigure"><a name="RiderTutMavenExpand"></a><div class="mediaobject"><img src="./images/tutMsgTrJMXLCCexpanded.png" width="176.8"></div></div></li><li class="step"><p>Right-click the <span class="guimenuitem">_context1</span> node to open the context
                    menu, and select <span class="guimenuitem">Start Tracing</span>:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutTraceStart.png" width="263.25"></div></div><p>The tooling displays a graphical representation of your routing context in
                        <span class="guilabel">Diagram View</span>:</p><div class="informalfigure"><a name="RiderTutDiagrmaNodes"></a><div class="mediaobject"><img src="images/tutDiagramNodes.png" width="452"></div></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e24450"></a>Dropping messages on the running CBRroute project</h2></div></div></div><p>To drop messages on the running CBRroute project:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>In <span class="guilabel">Project Explorer</span>, expand
                        <code class="code">CBRroute/src/data</code>, so you can access the message files
                        (<code class="code">message1.xml</code> through <code class="code">message6.xml</code>):</p><div class="informalfigure"><a name="RiderTutDataExpand"></a><div class="mediaobject"><img src="images/tutMsgFiles.png"></div></div></li><li class="step"><a name="msg1drag"></a><p>Drag <code class="code">message1.xml</code> and drop it on the
                        <code class="code">_context1&gt;Endpoints&gt;file&gt;src/data?noop=true</code> node in
                        <span class="guilabel">JMX Navigator</span>:</p><div class="informalfigure"><a name="tutblueprntExpand"></a><div class="mediaobject"><img src="./images/tutJMXLocalCntxtExpanded.png" width="201.5"></div></div><p>As the message traverses the route, the tooling traces and records its passage
                    at each step. To update <span class="guilabel">Diagram View</span> with the new message
                    count, you need to click the <code class="code">_context1</code> node in <span class="guilabel">JMX
                        Navigator</span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <code class="filename">Local Camel Context[xxx]</code> tree collapses to the
                            <code class="filename">_context1</code> node after you drop the next message on
                        the input <code class="filename">src/data?noop=true</code> node. You need not
                        re-expand it. When dragging the other messages, hover over each node in the
                        tree to expose the next node, until you reach the
                            <code class="filename">src/data?noop=true</code> node. Then drop the message on
                        it. This method prevents the tooling from redrawing the graphical
                        representation in <span class="guilabel">Diagram View</span>.</p></td></tr></table></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e24520"></a>Initializing and configuring Messages View</h2></div></div></div><p>You need to initialize <span class="guilabel">Messages View</span> before it will display
            message traces. You also need to configure the columns in <span class="guilabel">Messages
                View</span> if you want them to persist across all message traces.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Switch from <span class="guilabel">Console</span> to <span class="guilabel">Messages View</span>.</p></li><li class="step"><p>Click the <code class="filename">_context1</code> node in <span class="guilabel">JMX
                        Navigator</span> to initialize <span class="guilabel">Messages View</span> with
                        <code class="filename">message1.xml</code>'s details.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You can control columnar layout in all of the tooling's tables. Use the
                        drag method to temporarily rearrange tabular format. For example, drag a
                        column's border rule to expand or contract its width. To hide a column,
                        totally contract its borders. Drag the column header to relocate a column
                        within the table. For your arrangement to persist, you must use the <span class="guimenu">View Menu</span> &gt; <span class="guisubmenu">Configure Columns...</span> method instead. </p></td></tr></table></div></li><li class="step"><p>In <span class="guilabel">Messages View</span>, click the <span class="inlinemediaobject"><img src="images/ViewMnuIcon.png" alt="View Menu icon"></span> icon on the panel's menu bar, and select
                        <span class="guisubmenu">Configure Columns...</span> to open the
                        <span class="guisubmenu">Configure Columns</span> wizard:</p><div class="informalfigure"><a name="CnfigColsDefault"></a><div class="mediaobject"><img src="./images/TutConfigColsDefaults.png" width="161.09999999999997"></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Notice that the message header, <code class="filename">Destination</code>, which you
                    set for the messages in your routing context, appears in the list.</p></td></tr></table></div><p>You can include or exclude items from <span class="guilabel">Messages View</span> by
                    selecting or deselecting them. You can rearrange the columnar order in which
                    items appear in <span class="guilabel">Messages View</span> by highlighting individual,
                    selected items and moving them up or down in the list.</p></li><li class="step"><p>In the <span class="guilabel">Configure Columns</span> wizard, select and order the
                    columns this way:</p><div class="informalfigure"><a name="CnfigColsSet"></a><div class="mediaobject"><img src="./images/tutMsgVCnfgColsMnu.png" width="161.55"></div></div><p>These columns and their order will persist in <span class="guilabel">Messages View</span>
                    until you change them again.</p></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e24617"></a>Arranging Diagram View</h2></div></div></div><p>To see all message flow paths clearly, you'll probably need to rearrange the nodes
            by dragging them to fit neatly in <span class="guilabel">Diagram View</span>. You may also need
            to adjust the size of the other views and tabs in Red Hat JBoss Developer Studio to
            allow <span class="guilabel">Diagram View</span> to expand.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e24628"></a>Stepping through message traces</h2></div></div></div><p>To step through the message traces:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>In <span class="guilabel">Messages View</span>, click the <span class="inlinemediaobject"><img src="./images/refresh.png"></span> (Refresh button) on top, right of the panel's menu bar to
                    populate the view with <code class="filename">message1.xml</code>'s message
                    traces.</p><p>Each time you drop a message on the input <code class="filename">src</code> node in <span class="guilabel">JMX
                    Navigator</span>, you need to refresh <span class="guilabel">Messages View</span>
                    to populate it with the message traces.</p></li><li class="step"><a name="msgView"></a><p>Click one of the message traces to see more details about it in
                <span class="guilabel">Properties</span> view:</p><div class="informalfigure"><a name="msgTraceselected"></a><div class="mediaobject"><img src="./images/tutTraceDetails2.png" width="523.5"></div></div><p>The tooling displays the details about a message trace (including message
                    headers when they are set) in the top half of the
                        <span class="guilabel">Properties</span> panel and the contents of the message
                    instance in the bottom half of the <span class="guilabel">Properties</span> panel. So, if
                    your application sets headers at any step within a route, you can check the
                        <span class="guilabel">Message Details</span> to see whether they were set as
                    expected.</p><p>You can step through the message instances by highlighting each one to see how
                    a particular message traversed the route and whether it was processed as
                    expected at each step in the route.</p><p>In <span class="guilabel">Diagram View</span>, the associated step in the route is
                    highlighted:</p><div class="informalfigure"><a name="msgTraceNode"></a><div class="mediaobject"><img src="./images/TutMsgTraceDiagNode.png" width="404"></div></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e24690"></a>Finishing up</h2></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Drag <code class="code">message2.xml</code> and drop it on
                        the<code class="code">_context1&gt;Endpoints&gt;file&gt;src/data?noop=true</code> node in
                        <span class="guilabel">JMX Navigator</span>.</p><p>Hover over each node in the tree until you expose the
                        <code class="filename">src/data?noop=true</code> node, then drop
                        <code class="code">message2.xml</code> on it.</p></li><li class="step"><p>Switch from <span class="guilabel">Console</span> to <span class="guilabel">Messages
                    View</span>.</p></li><li class="step"><p>In <span class="guilabel">Messages View</span>, click the <span class="inlinemediaobject"><img src="./images/refresh.png"></span> (Refresh button) on top, right of the panel's menu bar to
                    populate the view with <code class="filename">message2.xml</code>'s message
                    traces.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You can repeat <a class="xref" href="RiderTutorialTrace.html#msg1drag" title="Step 2">Step 2</a>
                        through <a class="xref" href="RiderTutorialTrace.html#msgView" title="Step 2">Step 2</a> for the
                        remaining messages in <code class="filename">CBRroute/src/data/</code> at any time,
                        as long as tracing remains enabled.</p><p>On each subsequent drop, remember to click the <span class="inlinemediaobject"><img src="./images/refresh.png"></span> (Refresh button) on the panel's menu bar to populate
                            <span class="guilabel">Messages View</span> with the new message traces.</p></td></tr></table></div><p>The tooling draws the route in <span class="guilabel">Diagram View</span>, tagging
                    paths exiting a processing step with timing and performance metrics (in
                    milliseconds). Only the metric <span class="guilabel">Total exchanges</span> is displayed
                    in the diagram:</p><div class="informalfigure"><a name="TutMessageTrace"></a><div class="mediaobject"><img src="images/tutTraceFIP_63.png" width="647.5"></div></div><p>Hovering over the displayed metrics reveals additional metrics about message
                    flow:</p><div class="informalfigure"><a name="tutMsgMetrics"></a><div class="mediaobject"><img src="images/tutDVnodeMetrics.png" width="283.2"></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Mean time the step took to process a message</p></li><li class="listitem"><p>Maximum time the step took to process a message</p></li><li class="listitem"><p>Minimum time the step took to process a message</p></li></ul></div></li><li class="step"><p>When done:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>In <span class="guilabel">JMX Navigator</span>, right-click
                                    <span class="guimenuitem">_context1</span> and select
                                    <span class="guimenuitem">Stop Tracing Context</span> from the context
                                menu.</p></li><li class="listitem"><p>Open the <span class="guilabel">Console</span> and click the <span class="inlinemediaobject"><img src="images/ConsoleStopButton.jpg" alt="Stop icon"></span> button in the upper right of the panel to stop
                                the Console. Then click the <span class="inlinemediaobject"><img src="images/clear_co.png" alt="Clear icon"></span> button to clear console output.</p></li></ul></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e24819"></a>Next steps</h2></div></div></div><p>After you create a JUnit test case for your project, you can run your project as a
                <span class="guimenuitem">Local Camel Context</span>, instead of <span class="guimenuitem">Local Camel
                Context (without tests)</span>. (See <a href="RiderTutorialJUnit.html" class="olink"><i>To Test a Route with JUnit</i></a>
            for details.</p></div></div></body></html>