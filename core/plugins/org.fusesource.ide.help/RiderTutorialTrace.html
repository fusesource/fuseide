<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>To Trace a Message Through a Route</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="RiderEclipseHelp.html" title="Part&nbsp;I.&nbsp;Tooling Tutorials"><link rel="prev" href="RiderTutorialDebug.html" title="To Debug a Routing Context"><link rel="next" href="RiderTutorialJUnit.html" title="To Test a Route with JUnit"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="RiderTutorialTrace"></a>To Trace a Message Through a Route</h2></div></div></div><p>This tutorial shows you how to trace a message through a route.</p><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_goals_6"></a>Goals</h2></div></div></div><p>In this tutorial you will:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Run the <code class="literal">CBRroute</code> in the <code class="literal">Fuse Integration</code>
perspective</li><li class="listitem">Enable tracing on the <code class="literal">CBRroute</code></li><li class="listitem">Drop messages onto the <code class="literal">CBRroute</code> and track them through all route nodes</li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_prerequisites_7"></a>Prerequisites</h2></div></div></div><p>To complete this tutorial you will need the <code class="literal">CBRroute</code> project you
updated in <a class="xref" href="RiderTutorialAddRoute.html" title="To Add Another Route to the CBR Routing Context"><i>To Add Another Route to the CBR Routing Context</i></a>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you skipped any tutorial after <a class="xref" href="RiderTutorialCreate.html" title="To Create a New Route"><i>To Create a New Route</i></a>, you can use the
prefabricated <code class="literal">blueprint6.xml</code> file to work through this tutorial
(for details, see <a class="xref" href="RiderTutorialResources.html" title="Using the Fuse Tooling Resource Files"><i>Using the Fuse Tooling Resource Files</i></a>).</p></td></tr></table></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_accessing_fuse_integration_perspective"></a>Accessing Fuse Integration perspective</h2></div></div></div><p>If you are not already working in <code class="literal">Fuse Integration</code>
perspective:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">Click the
<span class="inlinemediaobject"><img src="./images/new_persp2.png" alt="Open Perspective icon"></span> button on the right side of the tool bar, and then select
<code class="literal">Fuse Integration</code> from the list:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutPerspListFIPselected.png" alt="tutPerspListFIPselected"></div></div><p class="simpara"><code class="literal">Fuse Integration</code> perspective opens in the default
layout:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/TutFIP_63.png" alt="TutFIP 63"></div></div></li><li class="listitem"><p class="simpara">Drag the <code class="literal">JMX Navigator</code> tab to the far right of the
<code class="literal">Terminal</code> tab and drop it there:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/ftTutFIPrearrange.png" alt="ftTutFIPrearrange"></div></div><p class="simpara">This arrangement provides more space for <code class="literal">Diagram View</code> to
display the routing context&#8217;s nodes graphically, which makes it easier for you
to visually trace the path that messages take in traversing the routing
context.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>To make it easy to access a routing context <code class="literal">.xml</code> file, especially when a
project consists of multiple contexts, the tooling lists them under the
<code class="literal">Camel Contexts</code> folder in <code class="literal">Project
Explorer</code>.</p><p>Additionally, all routes in a routing context are displayed as icons
directly under their context file entry. To display a single route in the
routing context on the canvas, double-click its icon in <code class="literal">Project
Explorer</code>. To display all routes in the routing context,
double-click the context file entry.</p><div class="informalfigure"><div class="mediaobject"><img src="./images/TutCamelContextsFolderPE.png" alt="TutCamelContextsFolderPE"></div></div></td></tr></table></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_starting_message_tracing"></a>Starting message tracing</h2></div></div></div><p>To start message tracing on the <code class="literal">CBRroute</code> project:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">In <code class="literal">Project Explorer</code>, expand the
<code class="literal">CBRroute</code> project to expose
<code class="literal">src/main/resources/OSGI-INF/blueprint/blueprint.xml</code>.</li><li class="listitem">Right-click
<code class="literal">src/main/resources/OSGI-INF/blueprint/blueprint.xml</code>
to open the context menu.</li><li class="listitem"><p class="simpara">Select <span class="guimenu">Run As</span> &gt; <span class="guisubmenu"></span> &gt; <span class="guisubmenu"></span> &gt; <span class="guisubmenu"><code class="literal">Local Camel Context (without tests)</code></span> &gt; <span class="guimenuitem"></span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you select <code class="literal">Local Camel Context</code>, the tooling reverts to running
without tests because you have not yet created a JUnit test for the
<code class="literal">CBRroute</code> project. You will do that later in <a class="xref" href="RiderTutorialJUnit.html" title="To Test a Route with JUnit"><i>To Test a Route with JUnit</i></a>.</p></td></tr></table></div></li><li class="listitem"><p class="simpara">In <code class="literal">JMX Navigator</code>, expand <code class="literal">Local
Processes</code>.</p><p class="simpara">When you first expand <code class="literal">Local Processes</code>, you see the node <code class="literal">maven[Id][Disconnected]</code>:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutMsgTrJMXLocalProcessess.png" alt="tutMsgTrJMXLocalProcessess"></div></div><p class="simpara">When you click this node, it changes to <code class="literal">Local Camel
Context[Id][Disconnected]</code>
(retaining the same <span class="emphasis"><em>Id</em></span> as its predecessor):</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutMsgTrJMXLocalCamCntxt.png" alt="tutMsgTrJMXLocalCamCntxt"></div></div></li><li class="listitem"><p class="simpara">Double click <code class="literal">Local Camel
Context[Id][Disconnected]</code> to connect
to it, and then expand the elements of your route:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutMsgTrJMXLCCexpanded.png" alt="tutMsgTrJMXLCCexpanded"></div></div></li><li class="listitem"><p class="simpara">Right-click the <code class="literal">_context1</code> node to open the context
menu, and select <code class="literal">Start Tracing</code>:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutTraceStart.png" alt="tutTraceStart"></div></div><p class="simpara">The tooling displays a graphical representation of your routing context in
<code class="literal">Diagram View</code>:</p><div class="informalfigure"><div class="mediaobject"><img src="images/tutDiagramNodes.png" alt="tutDiagramNodes"></div></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_dropping_messages_on_the_running_cbrroute_project"></a>Dropping messages on the running CBRroute project</h2></div></div></div><p>To drop messages on the running CBRroute project:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">In <code class="literal">Project Explorer</code>, expand
<code class="literal">CBRroute/src/data</code>, so you can access the message files
(<code class="literal">message1.xml</code> through <code class="literal">message6.xml</code>):</p><div class="informalfigure"><div class="mediaobject"><img src="images/tutMsgFiles.png" alt="tutMsgFiles"></div></div></li><li class="listitem"><p class="simpara"><a name="msg1drag"></a> Drag <code class="literal">message1.xml</code> and drop it on the
<code class="literal">_context1&gt;Endpoints&gt;file&gt;src/data?noop=true</code> node in
<code class="literal">JMX Navigator</code>:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutJMXLocalCntxtExpanded.png" alt="tutJMXLocalCntxtExpanded"></div></div><p class="simpara">As the message traverses the route, the tooling traces and records its passage
at each step. To update <code class="literal">Diagram View</code> with the new message
count, you need to click the <code class="literal">_context1</code> node in <code class="literal">JMX
Navigator</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <code class="literal">Local Camel Context[xxx]</code> tree collapses to the
<code class="literal">_context1</code> node after you drop the next message on
the input <code class="literal">src/data?noop=true</code> node. You need not
re-expand it. When dragging the other messages, hover over each node in the
tree to expose the next node, until you reach the
<code class="literal">src/data?noop=true</code> node. Then drop the message on
it. This method prevents the tooling from redrawing the graphical
representation in <code class="literal">Diagram View</code>.</p></td></tr></table></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_initializing_and_configuring_messages_view"></a>Initializing and configuring Messages View</h2></div></div></div><p>You need to initialize <code class="literal">Messages View</code> before it will display
message traces. You also need to configure the columns in <code class="literal">Messages
View</code> if you want them to persist across all message traces.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Switch from <code class="literal">Console</code> to <code class="literal">Messages View</code>.</li><li class="listitem"><p class="simpara">Click the <code class="literal">_context1</code> node in <code class="literal">JMX
Navigator</code> to initialize <code class="literal">Messages View</code> with
<code class="literal">message1.xml</code>'s details.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You can control columnar layout in all of the tooling&#8217;s tables. Use the
drag method to temporarily rearrange tabular format. For example, drag a
column&#8217;s border rule to expand or contract its width. To hide a column,
totally contract its borders. Drag the column header to relocate a column
within the table. For your arrangement to persist, you must use the <span class="guimenu">View Menu</span> &gt; <span class="guisubmenu"></span> &gt; <span class="guisubmenu"></span> &gt; <span class="guisubmenu">Configure Columns&#8230;&#8203;</span> &gt; <span class="guimenuitem"></span> method instead.</p></td></tr></table></div></li><li class="listitem"><p class="simpara">In <code class="literal">Messages View</code>, click the
<span class="inlinemediaobject"><img src="images/ViewMnuIcon.png" alt="View Menu icon"></span> icon on the panel&#8217;s menu bar, and select
Configure Columns&#8230;&#8203; to open the
Configure Columns wizard:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/TutConfigColsDefaults.png" alt="TutConfigColsDefaults"></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Notice that the message header, <code class="literal">Destination</code>, which you
set for the messages in your routing context, appears in the list.</p></td></tr></table></div><p class="simpara">You can include or exclude items from <code class="literal">Messages View</code> by
selecting or deselecting them. You can rearrange the columnar order in which
items appear in <code class="literal">Messages View</code> by highlighting individual,
selected items and moving them up or down in the list.</p></li><li class="listitem"><p class="simpara">In the <code class="literal">Configure Columns</code> wizard, select and order the
columns this way:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutMsgVCnfgColsMnu.png" alt="tutMsgVCnfgColsMnu"></div></div><p class="simpara">These columns and their order will persist in <code class="literal">Messages View</code>
until you change them again.</p></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_arranging_diagram_view"></a>Arranging Diagram View</h2></div></div></div><p>To see all message flow paths clearly, you&#8217;ll probably need to rearrange the nodes
by dragging them to fit neatly in <code class="literal">Diagram View</code>. You may also need
to adjust the size of the other views and tabs in Red Hat JBoss Developer Studio to
allow <code class="literal">Diagram View</code> to expand.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_stepping_through_message_traces"></a>Stepping through message traces</h2></div></div></div><p>To step through the message traces:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">In <code class="literal">Messages View</code>, click the
<span class="inlinemediaobject"><img src="./images/refresh.png" alt="refresh"></span> (Refresh button) on top, right of the panel&#8217;s menu bar to
populate the view with <code class="literal">message1.xml</code>'s message
traces.</p><p class="simpara">Each time you drop a message on the input <code class="literal">src</code> node in <code class="literal">JMX
Navigator</code>, you need to refresh <code class="literal">Messages View</code>
to populate it with the message traces.</p></li><li class="listitem"><p class="simpara"><a name="msgView"></a> Click one of the message traces to see more details about it in
<code class="literal">Properties</code> view:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutTraceDetails2.png" alt="tutTraceDetails2"></div></div><p class="simpara">The tooling displays the details about a message trace (including message
headers when they are set) in the top half of the
<code class="literal">Properties</code> panel and the contents of the message
instance in the bottom half of the <code class="literal">Properties</code> panel. So, if
your application sets headers at any step within a route, you can check the
<code class="literal">Message Details</code> to see whether they were set as
expected.</p><p class="simpara">You can step through the message instances by highlighting each one to see how
a particular message traversed the route and whether it was processed as
expected at each step in the route.</p><p class="simpara">In <code class="literal">Diagram View</code>, the associated step in the route is
highlighted:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/TutMsgTraceDiagNode.png" alt="TutMsgTraceDiagNode"></div></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_finishing_up_2"></a>Finishing up</h2></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">Drag <code class="literal">message2.xml</code> and drop it on
the<code class="literal">_context1&gt;Endpoints&gt;file&gt;src/data?noop=true</code> node in
<code class="literal">JMX Navigator</code>.</p><p class="simpara">Hover over each node in the tree until you expose the
<code class="literal">src/data?noop=true</code> node, then drop
<code class="literal">message2.xml</code> on it.</p></li><li class="listitem">Switch from <code class="literal">Console</code> to <code class="literal">Messages
View</code>.</li><li class="listitem"><p class="simpara">In <code class="literal">Messages View</code>, click the
<span class="inlinemediaobject"><img src="./images/refresh.png" alt="refresh"></span> (Refresh button) on top, right of the panel&#8217;s menu bar to
populate the view with <code class="literal">message2.xml</code>'s message
traces.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You can repeat <a class="xref" href="RiderTutorialTrace.html#msg1drag">[msg1drag]</a>
through <a class="xref" href="RiderTutorialTrace.html#msgView">[msgView]</a> for the
remaining messages in <code class="literal">CBRroute/src/data/</code> at any time,
as long as tracing remains enabled.</p><p>On each subsequent drop, remember to click the
<span class="inlinemediaobject"><img src="./images/refresh.png" alt="refresh"></span> (Refresh button) on the panel&#8217;s menu bar to populate
<code class="literal">Messages View</code> with the new message traces.</p></td></tr></table></div><p class="simpara">The tooling draws the route in <code class="literal">Diagram View</code>, tagging
paths exiting a processing step with timing and performance metrics (in
milliseconds). Only the metric <code class="literal">Total exchanges</code> is displayed
in the diagram:</p><div class="informalfigure"><div class="mediaobject"><img src="images/tutTraceFIP_63.png" alt="tutTraceFIP 63"></div></div><p class="simpara">Hovering over the displayed metrics reveals additional metrics about message
flow:</p><div class="informalfigure"><div class="mediaobject"><img src="images/tutDVnodeMetrics.png" alt="tutDVnodeMetrics"></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Mean time the step took to process a message</li><li class="listitem">Maximum time the step took to process a message</li><li class="listitem">Minimum time the step took to process a message</li></ul></div></li><li class="listitem"><p class="simpara">When done:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">In <code class="literal">JMX Navigator</code>, right-click
<code class="literal">_context1</code> and select
<code class="literal">Stop Tracing Context</code> from the context
menu.</li><li class="listitem">Open the <code class="literal">Console</code> and click the
<span class="inlinemediaobject"><img src="images/ConsoleStopButton.jpg" alt="Stop icon"></span> button in the upper right of the panel to stop
the Console. Then click the
<span class="inlinemediaobject"><img src="images/clear_co.png" alt="Clear icon"></span> button to clear console output.</li></ul></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_next_steps_5"></a>Next steps</h2></div></div></div><p>After you create a JUnit test case for your project, you can run your project as a
<code class="literal">Local Camel Context</code>, instead of <code class="literal">Local Camel
Context (without tests)</code>. (See <a class="xref" href="RiderTutorialJUnit.html" title="To Test a Route with JUnit"><i>To Test a Route with JUnit</i></a>
for details.</p></div></div></body></html>