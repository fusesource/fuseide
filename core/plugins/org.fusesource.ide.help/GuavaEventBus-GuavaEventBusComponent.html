<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Guava EventBus Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="MongoDBGridFS-CamelMongoDBGridFScomponent.html" title="MongoDB GridFS Component"><link rel="next" href="HawtDB-HawtDB.html" title="HawtDB Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="GuavaEventBus-GuavaEventBusComponent"></a>Guava EventBus Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="GuavaEventBus-GuavaEventBusComponent.html#GuavaEventBus-URIformat">URI format</a></span></dt><dt><span class="section"><a href="GuavaEventBus-GuavaEventBusComponent.html#GuavaEventBus-Options">Options</a></span></dt><dt><span class="section"><a href="GuavaEventBus-GuavaEventBusComponent.html#GuavaEventBus-Usage">Usage</a></span></dt><dt><span class="section"><a href="GuavaEventBus-GuavaEventBusComponent.html#GuavaEventBus-DeadEventconsiderations">DeadEvent considerations</a></span></dt><dt><span class="section"><a href="GuavaEventBus-GuavaEventBusComponent.html#GuavaEventBus-Consumingmultipletypeofevents">Consuming multiple type of events</a></span></dt></dl></div><p><span class="strong"><strong>Available since Camel 2.10.0</strong></span></p><p>The
<a class="link" href="http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/eventbus/package-summary.html" target="_top">Google
Guava EventBus</a> allows publish-subscribe-style communication between
components without requiring the components to explicitly register with
one another (and thus be aware of each other). The <span class="strong"><strong>guava-eventbus:</strong></span>
component provides integration bridge between Camel and
<a class="link" href="http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/eventbus/package-summary.html" target="_top">Google
Guava EventBus</a> infrastructure. With the latter component, messages
exchanged with the Guava <code class="literal">EventBus</code> can be transparently forwarded to
the Camel routes. EventBus component allows also to route body of Camel
exchanges to the Guava <code class="literal">EventBus</code>.</p><p>Maven users will need to add the following dependency to their <code class="literal">pom.xml</code>
for this component:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-guava-eventbus<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="GuavaEventBus-URIformat"></a>URI format</h2></div></div></div><pre class="programlisting">guava-eventbus:busName[?options]</pre><p>Where <span class="strong"><strong>busName</strong></span> represents the name of the
<code class="literal">com.google.common.eventbus.EventBus</code> instance located in the Camel
registry.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="GuavaEventBus-Options"></a>Options</h2></div></div></div><p>The Guava EventBus component supports 2 options which are listed below.</p><p>{% raw %}</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="11%" class="col_2"><col width="70%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Java Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>eventBus</p></td><td align="left" valign="top"><p><code class="literal">EventBus</code></p></td><td align="left" valign="top"><p>To use the given Guava EventBus instance</p></td></tr><tr><td align="left" valign="top"><p>listenerInterface</p></td><td align="left" valign="top"><p><code class="literal">Class&lt;?&gt;</code></p></td><td align="left" valign="top"><p>The interface with method(s) marked with the Subscribe annotation. Dynamic proxy will be created over the interface so it could be registered as the EventBus listener. Particularly useful when creating multi-event listeners and for handling DeadEvent properly. This option cannot be used together with eventClass option.</p></td></tr></tbody></table></div><p>{% endraw %}</p><p>The Guava EventBus component supports 7 endpoint options which are listed below:</p><p>{% raw %}</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="10%" class="col_2"><col width="11%" class="col_3"><col width="10%" class="col_4"><col width="50%" class="col_5"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Group</th><th align="left" valign="top">Default</th><th align="left" valign="top">Java Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>eventBusRef</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>To lookup the Guava EventBus from the registry with the given name</p></td></tr><tr><td align="left" valign="top"><p>eventClass</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">Class&lt;?&gt;</code></p></td><td align="left" valign="top"><p>If used on the consumer side of the route will filter events received from the EventBus to the instances of the class and superclasses of eventClass. Null value of this option is equal to setting it to the java.lang.Object i.e. the consumer will capture all messages incoming to the event bus. This option cannot be used together with listenerInterface option.</p></td></tr><tr><td align="left" valign="top"><p>listenerInterface</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">Class&lt;?&gt;</code></p></td><td align="left" valign="top"><p>The interface with method(s) marked with the Subscribe annotation. Dynamic proxy will be created over the interface so it could be registered as the EventBus listener. Particularly useful when creating multi-event listeners and for handling DeadEvent properly. This option cannot be used together with eventClass option.</p></td></tr><tr><td align="left" valign="top"><p>bridgeErrorHandler</p></td><td align="left" valign="top"><p>consumer</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Allows for bridging the consumer to the Camel routing Error Handler which mean any exceptions occurred while the consumer is trying to pickup incoming messages or the likes will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions that will be logged at WARN/ERROR level and ignored.</p></td></tr><tr><td align="left" valign="top"><p>exceptionHandler</p></td><td align="left" valign="top"><p>consumer (advanced)</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">ExceptionHandler</code></p></td><td align="left" valign="top"><p>To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this options is not in use. By default the consumer will deal with exceptions that will be logged at WARN/ERROR level and ignored.</p></td></tr><tr><td align="left" valign="top"><p>exchangePattern</p></td><td align="left" valign="top"><p>consumer (advanced)</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">ExchangePattern</code></p></td><td align="left" valign="top"><p>Sets the exchange pattern when the consumer creates an exchange.</p></td></tr><tr><td align="left" valign="top"><p>synchronous</p></td><td align="left" valign="top"><p>advanced</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used or Camel is allowed to use asynchronous processing (if supported).</p></td></tr></tbody></table></div><p>{% endraw %}</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="GuavaEventBus-Usage"></a>Usage</h2></div></div></div><p>Using <code class="literal">guava-eventbus</code> component on the consumer side of the route will
capture messages sent to the Guava <code class="literal">EventBus</code> and forward them to the
Camel route. Guava EventBus consumer processes incoming messages
<a class="link" href="http://camel.apache.org/asynchronous-routing-engine.html" target="_top">asynchronously</a>.</p><pre class="programlisting">SimpleRegistry registry = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> SimpleRegistry();
EventBus eventBus = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> EventBus();
registry.put(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"busName"</em></strong>, eventBus);
CamelContext camel = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> DefaultCamelContext(registry);

from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"guava-eventbus:busName"</em></strong>).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"seda:queue"</em></strong>);

eventBus.post(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Send me to the SEDA queue."</em></strong>);</pre><p>Using <code class="literal">guava-eventbus</code> component on the producer side of the route will
forward body of the Camel exchanges to the Guava <code class="literal">EventBus</code> instance.</p><pre class="programlisting">SimpleRegistry registry = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> SimpleRegistry();
EventBus eventBus = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> EventBus();
registry.put(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"busName"</em></strong>, eventBus);
CamelContext camel = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> DefaultCamelContext(registry);

from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"guava-eventbus:busName"</em></strong>);

ProducerTemplate producerTemplate = camel.createProducerTemplate();
producer.sendBody(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Send me to the Guava EventBus."</em></strong>);

eventBus.register(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> Object(){
  <em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Subscribe</span></em>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> messageHander(String message) {
    System.out.println(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Message received from the Camel: "</em></strong> + message);
  }
});</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="GuavaEventBus-DeadEventconsiderations"></a>DeadEvent considerations</h2></div></div></div><p>Keep in mind that due to the limitations caused by the design of the
Guava EventBus, you cannot specify event class to be received by the
listener without creating class annotated with <code class="literal">@Subscribe</code> method. This
limitation implies that endpoint with <code class="literal">eventClass</code> option specified
actually listens to all possible events (<code class="literal">java.lang.Object</code>) and filter
appropriate messages programmatically at runtime. The snipped below
demonstrates an appropriate excerpt from the Camel code base.</p><pre class="programlisting"><em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Subscribe</span></em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> eventReceived(Object event) {
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">if</strong> (eventClass == null || eventClass.isAssignableFrom(event.getClass())) {
    doEventReceived(event);
...</pre><p>This drawback of this approach is that <code class="literal">EventBus</code> instance used by Camel
will never generate <code class="literal">com.google.common.eventbus.DeadEvent</code>
notifications. If you want Camel to listen only to the precisely
specified event (and therefore enable <code class="literal">DeadEvent</code> support), use
<code class="literal">listenerInterface</code> endpoint option. Camel will create dynamic proxy
over the interface you specify with the latter option and listen only to
messages specified by the interface handler methods. The example of the
listener interface with single method handling only <code class="literal">SpecificEvent</code>
instances is demonstrated below.</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">package</strong> com.example;

<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">interface</strong> CustomListener {

  <em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Subscribe</span></em>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> eventReceived(SpecificEvent event);

}</pre><p>The listener presented above could be used in the endpoint definition as
follows.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"guava-eventbus:busName?listenerInterface=com.example.CustomListener"</em></strong>).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"seda:queue"</em></strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="GuavaEventBus-Consumingmultipletypeofevents"></a>Consuming multiple type of events</h2></div></div></div><p>In order to define multiple type of events to be consumed by Guava
EventBus consumer use <code class="literal">listenerInterface</code> endpoint option, as listener
interface could provide multiple methods marked with the <code class="literal">@Subscribe</code>
annotation.</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">package</strong> com.example;

<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">interface</strong> MultipleEventsListener {

  <em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Subscribe</span></em>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> someEventReceived(SomeEvent event);

  <em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Subscribe</span></em>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> anotherEventReceived(AnotherEvent event);

}</pre><p>The listener presented above could be used in the endpoint definition as
follows.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"guava-eventbus:busName?listenerInterface=com.example.MultipleEventsListener"</em></strong>).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"seda:queue"</em></strong>);</pre></div></div></body></html>