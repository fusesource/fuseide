<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Websocket</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><meta name="keywords" content="ESB, Apache ServiceMix, Open Source, open source, integration, OSGi, enterprise service bus, Apache ServiceMix documentation, Apache Karaf, Red Hat JBoss Fuse, Red Hat JBoss Fuse documentation"><meta name="keywords" content="ESB, Apache ServiceMix, Open Source, open source, integration, OSGi, enterprise service bus, Apache ServiceMix documentation, Apache Karaf, Red Hat JBoss Fuse, Red Hat JBoss Fuse documentation"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Apache Camel Component Reference"><link rel="prev" href="IDU-Weather.html" title="Weather"><link rel="next" href="IDU-XmlRpc.html" title="XmlRpc"><link rel="copyright" href="tmdisclaim.html" title="Trademark Disclaimer"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="IDU-Websocket"></a>Websocket</h1></div></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-Websocket_HSH_WebsocketComponent"></a>Websocket Component</h2></div></div></div><p><span class="bold"><strong>Available as of Camel 2.10</strong></span>
    </p><p>The <span class="bold"><strong>websocket</strong></span> component provides websocket <span class="phrase">endpoints</span> for communicating with clients using websocket. The component uses Eclipse Jetty Server which implements the <a class="link" href="http://tools.ietf.org/html/rfc6455" target="_top">IETF</a> specification (drafts and RFC 6455). It supports the protocols ws:// and wss://. To use wss:// protocol, the SSLContextParameters must be defined.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-Websocket_HSH_URIformat"></a>URI format</h2></div></div></div><p></p><pre class="programlisting">websocket://hostname[:port][/resourceUri][?options]</pre><p>You can append query options to the URI in the following format, <code class="literal">?option=value&amp;option=value&amp;...</code>
    </p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-Websocket_HSH_ComponentOptions"></a>Component Options</h2></div></div></div><p>The <code class="literal">WebsocketComponent</code> can be configured prior to use, to setup host, to act as a websocket server. </p><p>

    </p><table id="d0e175474"><tr>
        <th> Option </th>
        <th> Default </th>
        <th> Description </th>
      </tr><tr>
        <td>
                    <code class="code">host</code>
                </td>
        <td> 0.0.0.0 </td>
        <td> The hostname. </td>
      </tr><tr>
        <td>
                    <code class="code">port</code>
                </td>
        <td> 9292 </td>
        <td> The port number. </td>
      </tr><tr>
        <td>
                    <code class="code">staticResources</code>
                </td>
        <td><code class="literal">null</code>
        </td>
        <td> Path for static resources such as index.html files etc. If this option has been configured, then a server is started on the given hostname and port, to service the static resources, eg such as an index.html file. If this option has not been configured, then no server is started. </td>
      </tr><tr>
        <td>
                    <code class="code">sslContextParameters</code>
                </td>
        <td></td>
          <td> Reference to a <code class="literal">org.apache.camel.util.jsse.SSLContextParameters</code> in
              the <a class="link" href="http://camel.apache.org/registry.html" target="_top">Registry</a>.&nbsp;This
              reference overrides any configured SSLContextParameters at the component
              level. See <a class="link" href="http://camel.apache.org/camel-configuration-utilities.html" target="_top">Using the
                  JSSE Configuration Utility</a>. </td>
      </tr><tr>
        <td><code class="literal">enableJmx</code>
        </td>
        <td><code class="literal">false</code>
        </td>
        <td> If this option is true, Jetty JMX support will be enabled for this endpoint. </td>
      </tr><tr>
        <td><code class="literal">sslKeyPassword</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> <span class="bold"><strong>Consumer only</strong></span>: The password for the keystore when using SSL. </td>
      </tr><tr>
        <td><code class="literal">sslPassword</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> <span class="bold"><strong>Consumer only</strong></span>: The password when using SSL. </td>
      </tr><tr>
        <td><code class="literal">sslKeystore</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td> <span class="bold"><strong>Consumer only</strong></span>: The path to the keystore. </td>
      </tr><tr>
        <td><code class="literal">minThreads</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td>
                    <span class="bold"><strong>Consumer only</strong></span>: To set a value for minimum
                    number of threads in server thread pool.
                        <code class="code">minThreads</code>/<code class="code">maxThreads</code> or <code class="code">threadPool</code>
                    fields are required due to switch to Jetty 9. </td>
      </tr><tr>
        <td><code class="literal">maxThreads</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td>
                    <span class="bold"><strong>Consumer only</strong></span>: To set a value for maximum
                    number of threads in server thread
                        pool.<code class="code">minThreads</code>/<code class="code">maxThreads</code> or
                        <code class="code">threadPool</code> fields are required due to switch to Jetty 9. </td>
      </tr><tr>
        <td><code class="literal">threadPool</code>
        </td>
        <td><code class="literal">null</code>
        </td>
        <td>
                    <span class="bold"><strong>Consumer only</strong></span>: To use a custom thread pool for
                    the server. <code class="code">minThreads</code>/<code class="code">maxThreads</code> or
                        <code class="code">threadPool</code> fields are required due to switch to Jetty 9. </td>
      </tr></table></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-Websocket_HSH_EndpointOptions"></a>Endpoint Options</h2></div></div></div><p>The <code class="literal">WebsocketEndpoint</code> can be configured prior to use</p><table id="d0e175711"><tr>
        <th> Option </th>
        <th> Default </th>
        <th> Description </th>
      </tr><tr>
        <td>
                    <code class="code">sslContextParametersRef</code>
                </td>
        <td></td>
          <td><span class="bold"><strong>Deprecated and will be removed in Camel 3.0:</strong></span> Reference to a <code class="literal">org.apache.camel.util.jsse.SSLContextParameters</code> in the <a class="link" href="http://camel.apache.org/registry.html" target="_top">Registry</a>.&nbsp;This reference overrides any configured SSLContextParameters at the component level. See <a class="link" href="http://camel.apache.org/camel-configuration-utilities.html" target="_top">Using the
              JSSE Configuration Utility</a>. Use the <code class="literal">sslContextParameters</code> option instead </td>
      </tr><tr>
        <td>
                    <code class="code">sslContextParameters</code>
                </td>
        <td></td>
          <td><span class="bold"><strong>Camel 2.11.1:</strong></span> Reference to a
              <code class="literal">org.apache.camel.util.jsse.SSLContextParameters</code> in the <a class="link" href="http://camel.apache.org/registry.html" target="_top">Registry</a>. This reference overrides any configured SSLContextParameters at the component level. 
              See <a href="IDU-Websocket.html#IDU-Websocket_HSH_UsingtheJSSEConfigurationUtility" class="olink">Using the JSSE Configuration Utility</a>. </td>
      </tr><tr>
        <td>
                    <code class="code">sendToAll</code>
                </td>
        <td><code class="literal">null</code>
        </td>
        <td> <span class="bold"><strong>Producer only:</strong></span> To send to all websocket subscribers. Can be used to configure on endpoint level, instead of having to use the <code class="literal">WebsocketConstants.SEND_TO_ALL</code> header on the message. </td>
      </tr><tr>
        <td>
                    <code class="code">staticResources</code>
                </td>
        <td><code class="literal">null</code>
        </td>
        <td> The root directory for the web resources or classpath. Use the protocol file: or classpath: depending if you want that the component loads the resource from file system or classpath. </td>
      </tr><tr>
                <td align="left" valign="top">
                    <p><code class="code">bufferSize</code></p>
                </td>
                <td align="left" valign="top">
                    <p><code class="literal">8192</code></p>
                </td>
                <td align="left" valign="top">
                    <p>Set the buffer size of the websocketServlet which is also the max frame
                        byte size (default 8192)</p>
                </td>
            </tr><tr>
                <td align="left" valign="top">
                    <p><code class="code">maxIdleTime</code></p>
                </td>
                <td align="left" valign="top">
                    <p><code class="literal">300000</code></p>
                </td>
                <td align="left" valign="top">
                    <p>Set the time in ms that the websocket created by the websocketServlet
                        may be idle before closing. (default is 300000)</p>
                </td>
            </tr><tr>
                <td align="left" valign="top">
                    <p><code class="code">maxTextMessageSize</code></p>
                </td>
                <td align="left" valign="top"></td>
                <td align="left" valign="top">
                    <p>Can be used to set the size in characters that the websocket created by
                        the websocketServlet may be accept before closing.</p>
                </td>
            </tr><tr>
                <td align="left" valign="top">
                    <p><code class="code">maxBinaryMessageSize</code></p>
                </td>
                <td align="left" valign="top">
                    <p><code class="literal">-1</code></p>
                </td>
                <td align="left" valign="top">
                    <p>Can be used to set the size in bytes that the websocket created by the
                        websocketServlet may be accept before closing. (Default is -1 - or
                        unlimited)</p>
                </td>
            </tr><tr>
                <td align="left" valign="top">
                    <p><code class="code">minVersion</code></p>
                </td>
                <td align="left" valign="top">
                    <p><code class="literal">13</code></p>
                </td>
                <td align="left" valign="top">
                    <p>Can be used to set the minimum protocol version accepted for the
                        websocketServlet. (Default 13 - the RFC6455 version)</p>
                </td>
            </tr><tr>
                <td align="left" valign="top">
                    <p><code class="code">sendTimeout</code></p>
                </td>
                <td align="left" valign="top">
                    <p><code class="literal">30000</code></p>
                </td>
                <td align="left" valign="top">
                    <p><span class="bold"><strong>Camel 2.18:</strong></span> Timeout in millis when
                        sending to a websocket channel. The default timeout is 30000 (30
                        seconds).</p>
                </td>
            </tr></table></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-Websocket_HSH_MessageHeaders"></a>Message Headers</h2></div></div></div><p>The websocket component uses 2 headers to indicate to either send messages back to a single/current client, or to all clients.</p><p>

    </p><table id="d0e175951"><tr>
        <th> Key</th>
        <th> Description </th>
      </tr><tr>
        <td><code class="literal">WebsocketConstants.SEND_TO_ALL</code>
        </td>
        <td> Sends the message to all clients which are currently connected. You can use the <code class="literal">sendToAll</code> option on the endpoint instead of using this header. </td>
      </tr><tr>
        <td><code class="literal">WebsocketConstants.CONNECTION_KEY</code>
        </td>
        <td> Sends the message to the client with the given connection key. </td>
      </tr></table></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-Websocket_HSH_Usage"></a>Usage</h2></div></div></div><p>In this example we let Camel exposes a websocket server which clients can communicate with. The websocket server uses the default host and port, which would be <code class="literal">0.0.0.0:9292</code>.
The example will send back an echo of the input. To send back a message, we need to send the transformed message to the same endpoint <code class="literal">"websocket://echo"</code>. This is needed
because by default the messaging is InOnly. </p><pre class="programlisting">// expose a echo websocket client, that sends back an echo
from("websocket://echo")
    .log("&gt;&gt;&gt; Message received from WebSocket Client : ${body}")
    .transform().simple("${body}${body}")
    // send back to the client, by sending the message to the same endpoint
    // this is needed as by default messages is InOnly
    // and we will by default send back to the current client using the provided connection key
    .to("websocket://echo");
</pre><p>This example is part of an unit test, which you can find <a class="link" href="https://svn.apache.org/repos/asf/camel/trunk/components/camel-websocket/src/test/java/org/apache/camel/component/websocket/WebsocketRouteExampleTest.java" target="_top">here</a>. As a client we use the <a href="IDU-AHC.html" class="olink">AHC</a> library which offers support for web socket as well. </p><p>Here is another example where webapp resources location have been defined to allow the Jetty Application Server to not only register the WebSocket servlet but also to expose web resources for the browser. Resources should be defined under the webapp directory.</p><pre class="programlisting">from("activemq:topic:newsTopic")
   .routeId("fromJMStoWebSocket")
   .to("websocket://localhost:8443/newsTopic?sendToAll=true&amp;staticResources=classpath:webapp");</pre></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-Websocket_HSH_SettingupSSLforWebSocketComponent"></a>Setting up SSL for WebSocket Component</h2></div></div></div><p></p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-Websocket_HSH_UsingtheJSSEConfigurationUtility"></a>Using the JSSE Configuration Utility</h2></div></div></div><p>As of Camel 2.10, the WebSocket component supports SSL/TLS configuration through 
        the <a class="link" href="http://camel.apache.org/camel-configuration-utilities.html" target="_top">Using the
            JSSE Configuration Utility</a>. This utility greatly decreases the amount of component specific code you need to write and is configurable at the endpoint and component levels.&nbsp;The following examples demonstrate how to use the utility with the Cometd component.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-Websocket_HSH_Programmaticconfigurationofthecomponent"></a>Programmatic configuration of the component</h2></div></div></div><p></p><pre class="programlisting">KeyStoreParameters ksp = new KeyStoreParameters();
ksp.setResource("/users/home/server/keystore.jks");
ksp.setPassword("keystorePassword");

KeyManagersParameters kmp = new KeyManagersParameters();
kmp.setKeyStore(ksp);
kmp.setKeyPassword("keyPassword");

TrustManagersParameters tmp = new TrustManagersParameters();
tmp.setKeyStore(ksp);

SSLContextParameters scp = new SSLContextParameters();
scp.setKeyManagers(kmp);
scp.setTrustManagers(tmp);

CometdComponent commetdComponent = getContext().getComponent("cometds", CometdComponent.class);
commetdComponent.setSslContextParameters(scp);</pre></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-Websocket_HSH_SpringDSLbasedconfigurationofendpoint"></a>Spring DSL based configuration of endpoint</h2></div></div></div><p></p><pre class="programlisting">...
  &lt;camel:sslContextParameters
      id="sslContextParameters"&gt;
    &lt;camel:keyManagers
        keyPassword="keyPassword"&gt;
      &lt;camel:keyStore
          resource="/users/home/server/keystore.jks"
          password="keystorePassword"/&gt;
    &lt;/camel:keyManagers&gt;
    &lt;camel:trustManagers&gt;
      &lt;camel:keyStore
          resource="/users/home/server/keystore.jks"
          password="keystorePassword"/&gt;
    &lt;/camel:trustManagers&gt;
  &lt;/camel:sslContextParameters&gt;...
...
  &lt;to uri="websocket://127.0.0.1:8443/test?sslContextParameters=#sslContextParameters"/&gt;...</pre></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-Websocket_HSH_JavaDSLbasedconfigurationofendpoint"></a>Java DSL based configuration of endpoint</h2></div></div></div><p></p><pre class="programlisting">...
    protected RouteBuilder createRouteBuilder() throws Exception {
        return new RouteBuilder() {
            public void configure() {

                String uri = "websocket://127.0.0.1:8443/test?sslContextParameters=#sslContextParameters";

                from(uri)
                     .log("&gt;&gt;&gt; Message received from WebSocket Client : ${body}")
                     .to("mock:client")
                     .loop(10)
                         .setBody().constant("&gt;&gt; Welcome on board!")
                         .to(uri);
...</pre><p>

    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a href="IDU-AHC.html" class="olink">AHC</a>
        </p></li><li class="listitem"><p>
          <a href="IDU-Jetty.html" class="olink">Jetty</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="http://camel.apache.org/twitter-websocket-example.html" target="_top">Twitter Websocket Example</a> demonstrates how to poll a constant feed of twitter searches and publish results in real time using web socket to a web page.</p></li></ul></div></div></div></body></html>