<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>XML Security component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><meta name="keywords" content="ESB, Apache ServiceMix, Open Source, open source, integration, OSGi, enterprise service bus, Apache ServiceMix documentation, Apache Karaf, Red Hat JBoss Fuse, Red Hat JBoss Fuse documentation"><meta name="keywords" content="ESB, Apache ServiceMix, Open Source, open source, integration, OSGi, enterprise service bus, Apache ServiceMix documentation, Apache Karaf, Red Hat JBoss Fuse, Red Hat JBoss Fuse documentation"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Apache Camel Component Reference"><link rel="prev" href="IDU-XmlRpc.html" title="XmlRpc"><link rel="next" href="IDU-XMPP.html" title="XMPP"><link rel="copyright" href="tmdisclaim.html" title="Trademark Disclaimer"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="IDU-XMLSecuritycomponent"></a>XML Security component</h1></div></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-XMLSecuritycomponent_HSH_XMLSecuritycomponent"></a>XML Security component</h2></div></div></div><p><span class="bold"><strong>Available as of Camel 2.12.0</strong></span>
        </p><p>With this Apache Camel component, you can generate and validate XML signatures as
            described in the W3C standard <a class="link" href="http://www.w3.org/TR/xmldsig-core/" target="_top">XML
                Signature Syntax and Processing</a> or as described in the successor <a class="link" href="http://www.w3.org/TR/xmldsig-core1/" target="_top">version 1.1</a>. For XML Encryption
            support, please refer to the XML Security <a class="link" href="http://camel.apache.org/data-format.html" target="_top">Data
            Format</a>.</p><p>You can find an introduction to XML signature <a class="link" href="http://www.oracle.com/technetwork/articles/javase/dig-signatures-141823.html" target="_top">here</a>. The implementation of the component is based on <a class="link" href="http://docs.oracle.com/javase/6/docs/technotes/guides/security/xmldsig/overview.html" target="_top">JSR 105</a>, the Java API corresponding to the W3C standard and supports the
            Apache Santuario and the JDK provider for JSR 105. The implementation will first try to
            use the Apache Santuario provider; if it does not find the Santuario provider, it will
            use the JDK provider. Further, the implementation is DOM based.</p><p>Since Camel 2.15.0 we also provide support for XAdES-BES/EPES for the signer endpoint;
            see <a class="xref" href="IDU-XMLSecuritycomponent.html#IDU-XMLSecuritycomponent-XAdES" title="XAdES-BES/EPES for the Signer Endpoint">XAdES-BES/EPES for the Signer Endpoint</a>.</p><p>Maven users will need to add the following dependency to their
                <code class="literal">pom.xml</code> for this component:</p><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
    &lt;artifactId&gt;camel-xmlsecurity&lt;/artifactId&gt;
    &lt;version&gt;x.x.x&lt;/version&gt;
    &lt;!-- use the same version as your Camel core version --&gt;
&lt;/dependency&gt;</pre></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-XMLSecuritycomponent_HSH_XMLSignaturewrappingmodes"></a>XML Signature wrapping modes</h2></div></div></div><p>XML Signature differs between enveloped, enveloping, and detached XML signature. In
            the enveloped XML signature case, the XML Signature is wrapped by the signed XML
            Document; which means that the XML signature element is a child element of a parent
            element, which belongs to the signed XML Document. In the enveloping XML signature case,
            the XML Signature contains the signed content. All other cases are called detached XML
            signatures. A certain form of detached XML signature is supported since <span class="bold"><strong>Camel 2.14.0</strong></span>.</p><p>In the enveloped XML signature case, the supported generated XML signature has the
            following structure (Variables are surrounded by []).</p><pre class="programlisting">    &lt;[parent element]&gt;
       ... &lt;!-- Signature element is added as last child of the parent element--&gt;
       &lt;Signature Id="generated_unique_signature_id"&gt;
           &lt;SignedInfo&gt;
                 &lt;Reference URI=""&gt; 
                       &lt;Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/&gt;
                       (&lt;Transform&gt;)* &lt;!-- By default "http://www.w3.org/2006/12/xml-c14n11" is added to the transforms --&gt;
                       &lt;DigestMethod&gt;
                       &lt;DigestValue&gt;
                 &lt;/Reference&gt;
                 (&lt;Reference URI="#[keyinfo_Id]"&gt;
                       &lt;Transform Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/&gt;
                       &lt;DigestMethod&gt;
                       &lt;DigestValue&gt;
                 &lt;/Reference&gt;)?
                 &lt;!-- further references possible, see option 'properties' below --&gt;
          &lt;/SignedInfo&gt;
          &lt;SignatureValue&gt;
          (&lt;KeyInfo Id="[keyinfo_id]"&gt;)?
          &lt;!-- Object elements possible, see option 'properties' below --&gt;
      &lt;/Signature&gt;
    &lt;/[parent element]&gt;</pre><p>In the enveloping XML signature case, the supported generated XML signature has the
            structure:</p><pre class="programlisting">    &lt;Signature Id="generated_unique_signature_id"&gt;
      &lt;SignedInfo&gt;
             &lt;Reference URI="#generated_unique_object_id" type="[optional_type_value]"&gt;
                   (&lt;Transform&gt;)* &lt;!-- By default "http://www.w3.org/2006/12/xml-c14n11" is added to the transforms --&gt;
                   &lt;DigestMethod&gt;
                   &lt;DigestValue&gt;
             &lt;/Reference&gt;
             (&lt;Reference URI="#[keyinfo_id]"&gt;
                   &lt;Transform Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/&gt;
                   &lt;DigestMethod&gt;
                   &lt;DigestValue&gt;
             &lt;/Reference&gt;)?
              &lt;!-- further references possible, see option 'properties' below  --&gt;
      &lt;/SignedInfo&gt;
      &lt;SignatureValue&gt;
      (&lt;KeyInfo Id="[keyinfo_id]"&gt;)?
      &lt;Object Id="generated_unique_object_id"/&gt; &lt;!-- The Object element contains the in-message body --&gt;
      &lt;!-- The object ID can either be generated or set by the option parameter "contentObjectId" --&gt;
      &lt;!-- Further Object elements possible, see option 'properties' below --&gt;
    &lt;/Signature&gt;  </pre><p>As of <span class="bold"><strong>Camel 2.14.0</strong></span> detached XML signatures with the
            following structure are supported (see also <a class="xref" href="IDU-XMLSecuritycomponent.html#scroll-bookmark-2001" title="Detached XML Signatures as Siblings of the Signed Elements">Detached XML Signatures as Siblings of the Signed Elements</a>):</p><div class="informalexample"><pre class="programlisting">(&lt;[signed element] Id="[id_value]"&gt;
&lt;!-- signed element must have an attribute of type ID --&gt;
      ...
 
&lt;/[signed element]&gt; 
&lt;other sibling/&gt;* 
&lt;!-- between the signed element and the corresponding signature element, there can be other siblings.
 Signature element is added as last sibling. --&gt;
&lt;Signature Id="generated_unique_ID"&gt;
           &lt;SignedInfo&gt;
                &lt;CanonicalizationMethod&gt;
                &lt;SignatureMethod&gt;
                &lt;Reference URI="#[id_value]" type="[optional_type_value]"&gt;
                &lt;!-- reference URI contains the ID attribute value of the signed element --&gt;
                      (&lt;Transform&gt;)* &lt;!-- By default "http://www.w3.org/2006/12/xml-c14n11" is added to the transforms --&gt;
                      &lt;DigestMethod&gt;
                      &lt;DigestValue&gt;
                &lt;/Reference&gt;
                (&lt;Reference URI="#[generated_keyinfo_Id]"&gt;
                      &lt;Transform Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/&gt;
                      &lt;DigestMethod&gt;
                      &lt;DigestValue&gt;
                &lt;/Reference&gt;)?
         &lt;/SignedInfo&gt;
         &lt;SignatureValue&gt;
         (&lt;KeyInfo Id="[generated_keyinfo_id]"&gt;)?
&lt;/Signature&gt;)+</pre></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-XMLSecuritycomponent_HSH_URIformat"></a>URI format</h2></div></div></div><p>The camel component consists of two endpoints which have the following URI
            format.</p><pre class="programlisting">    xmlsecurity:sign:name[?options]
    xmlsecurity:verify:name[?options]</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>With the signer endpoint, you can generate a XML signature for the body of the
                    in-message which can be either a XML document or a plain text. The enveloped
                    enveloping, or detached (as of <span class="bold"><strong>Camel 12.14</strong></span>) XML
                    signature(s) will be set to the body of the out-message. </p></li><li class="listitem"><p>With the verifier endpoint, you can validate an enveloped or enveloping XML
                    signature or even several detached (as of <span class="bold"><strong>Camel
                        2.14.0</strong></span>) XML signatures contained in the body of the in-message;
                    if the validation is successful, then the original content is extracted from the
                    XML signature and set to the body of the out-message.</p></li><li class="listitem"><p>The <code class="literal">name</code> part in the URI can be chosen by the user to
                    distinguish between different signer/verifier endpoints within the camel
                    context.</p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-XMLSecuritycomponent_HSH_BasicExample"></a>Basic Example</h2></div></div></div><p>The following example shows the basic usage of the component.</p><pre class="programlisting">    from("direct:enveloping").to("xmlsecurity:sign://enveloping?keyAccessor=#accessor",
                                 "xmlsecurity:verify://enveloping?keySelector=#selector","mock:result")</pre><p>In Spring XML:</p><pre class="programlisting">    &lt;from uri="direct:enveloping" /&gt;
      &lt;to uri="xmlsecurity:sign://enveloping?keyAccessor=#accessor" /&gt;
      &lt;to uri="xmlsecurity:verify://enveloping?keySelector=#selector" /&gt;
    &lt;to uri="mock:result" /&gt;</pre><p>For the signing process, a private key is necessary. You specify a key accessor bean
            which provides this private key. For the validation, the corresponding public key is
            necessary; you specify a key selector bean which provides this public key.</p><p>The key accessor bean must implement the <a class="link" href="https://github.com/apache/camel/blob/master/components/camel-xmlsecurity/src/main/java/org/apache/camel/component/xmlsecurity/api/KeyAccessor.java" target="_top">KeyAccessor</a> interface. The package
                <code class="literal">org.apache.camel.component.xmlsecurity.api</code> contains the default
            implementation class <a class="link" href="https://github.com/apache/camel/blob/master/components/camel-xmlsecurity/src/main/java/org/apache/camel/component/xmlsecurity/api/DefaultKeyAccessor.java" target="_top">DefaultKeyAccessor</a> which reads the private key from a Java keystore.</p><p>The key selector bean must implement the <a class="link" href="http://docs.oracle.com/javase/6/docs/api/javax/xml/crypto/KeySelector.html" target="_top">javax.xml.crypto.KeySelector</a> interface. The package
                <code class="literal">org.apache.camel.component.xmlsecurity.api</code> contains the default
            implementation class <a class="link" href="https://github.com/apache/camel/blob/master/components/camel-xmlsecurity/src/main/java/org/apache/camel/component/xmlsecurity/api/DefaultKeySelector.java" target="_top">DefaultKeySelector</a> which reads the public key from a keystore.</p><p>In the example, the default signature algorithm
                <code class="literal">http://www.w3.org/2000/09/xmldsig#rsa-sha1</code> is used. You can set
            the signature algorithm of your choice by the option
                <code class="literal">signatureAlgorithm</code> (see below). The signer endpoint creates an
                <span class="bold"><strong>enveloping</strong></span> XML signature. If you want to create an
                <span class="bold"><strong>enveloped</strong></span> XML signature then you must specify the
            parent element of the Signature element; see option <code class="literal">parentLocalName</code>
            for more details. </p><p>For creating detached XML signatures, see <a class="xref" href="IDU-XMLSecuritycomponent.html#scroll-bookmark-2001" title="Detached XML Signatures as Siblings of the Signed Elements">Detached XML Signatures as Siblings of the Signed Elements</a>.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-XMLSecuritycomponent_HSH_CommonSigningandVerifyingOptions"></a>Common Signing and Verifying Options</h2></div></div></div><p>There are options which can be used for both endpoints, signer and verifier.</p><p>
            
        </p><table width="1046" id="d0e176046"><col width="161pt"><col width="228pt"><col width="115pt"><col width="534pt"><tr>
                <th> Name </th>
                <th> Type </th>
                <th> Default </th>
                <th> Description </th>
            </tr><tr>
                <td>
                    <code class="code">uriDereferencer</code>
                </td>
                <td>
                    <a class="link" href="http://docs.oracle.com/javase/7/docs/api/javax/xml/crypto/URIDereferencer.html" target="_top">javax.xml.crypto.URIDereferencer</a>
                </td>
                <td>
                    <code class="code">null</code>
                </td>
                <td> URI dereferencer. You can specify here your own URI dereferencer, if you want
                    to restrict the dereferencing or have special requirements for dereferencing.
                </td>
            </tr><tr>
                <td>
                    <code class="code">baseUri</code>
                </td>
                <td>
                    <code class="code">String</code>
                </td>
                <td>
                    <code class="code">null</code>
                </td>
                <td> Base URI used in the URI dereferencer. Relative URIs are concatenated with the
                    base URI. </td>
            </tr><tr>
                <td>
                    <code class="code">cryptoContextProperties</code>
                </td>
                <td>
                    <code class="code">Map&lt;String, ? extends Object&gt;</code>
                </td>
                <td>
                    <code class="code">null</code>
                </td>
                <td> Crypto context properties. See
                        <code class="literal">javax.xml.crypto.XMLCryptoContext.setProperty(String,
                        Object)</code>. The properties can depend on the provider. For example,
                    the JDK provider <code class="code">XMLDSig</code> has the property
                        <code class="code">org.jcp.xml.dsig.validateManifests</code> for enabling manifest
                    validation. The following properties are set by default to the value
                        <code class="code">Boolean.TRUE</code> for the XML verifier:
                        <code class="code">org.jcp.xml.dsig.validateManifests</code>,
                        <code class="code">javax.xml.crypto.dsig.cacheReference</code>. If the
                        <code class="code">secureValidation</code> option is <code class="code">true</code>, additionally the
                    properties <code class="code">org.apache.jcp.xml.dsig.secureValidation</code> and
                        <code class="code">org.jcp.xml.dsig.secureValidation</code> are set to
                        <code class="code">Boolean.TRUE</code> for the XML verifier. If you want to switch these
                    features off you must set the property values to
                    <code class="code">Boolean.FALSE</code>.</td>
            </tr><tr>
                <td>
                    <code class="code">disallowDoctypeDecl</code>
                </td>
                <td>
                    <code class="code">Boolean</code>
                </td>
                <td><code class="code">Boolean.TRUE</code></td>
                <td> Indicator whether DTD DOCTYPE declarations shall be disallowed in the incoming
                    XML message. </td>
            </tr><tr>
                <td>
                    <code class="code">omitXmlDeclaration</code>
                </td>
                <td>
                    <code class="code">Boolean</code>
                </td>
                <td><code class="code">Boolean.FALSE</code></td>
                <td> Indicator whether the XML declaration header shall be omitted in the output XML
                    message. </td>
            </tr><tr>
                <td>
                    <code class="code">clearHeaders</code>
                </td>
                <td>
                    <code class="code">Boolean</code>
                </td>
                <td><code class="code">Boolean.TRUE</code></td>
                <td> Indicator whether the XML signature message headers defined in <a class="link" href="https://github.com/apache/camel/blob/master/components/camel-xmlsecurity/src/main/java/org/apache/camel/component/xmlsecurity/api/XmlSignatureConstants.java" target="_top">XmlSignatureConstants</a> shall be deleted at the end of the signer or
                    verifier processing. </td>
            </tr><tr>
                <td>
                    <code class="code">schemaResourceUri</code>
                </td>
                <td>
                    <code class="code">String</code>
                </td>
                <td>
                    <code class="code">null</code>
                </td>
                <td> Since <span class="bold"><strong>Camel 2.14.0</strong></span>. Classpath to the XML
                    Schema file. If set, the XML document is validated against the XML schema. Must
                    be set in the case of detached signatures in order to determine the attributes
                    of type ID. This value can be overwritten by the header
                        <code class="code">CamelXmlSignatureSchemaResourceUri</code>. For further information,
                    see <a class="xref" href="IDU-XMLSecuritycomponent.html#scroll-bookmark-2001" title="Detached XML Signatures as Siblings of the Signed Elements">Detached XML Signatures as Siblings of the Signed Elements</a>. The schema is also necessary in the
                    case of enveloped signature with a reference URI to an ID attribute (see Signing
                    Option <code class="code">contentReferenceUri</code>).</td>
            </tr><tr>
                <td>
                    <code class="code">outputXmlEncoding</code>
                </td>
                <td>
                    <code class="code">String</code>
                </td>
                <td>
                    <code class="code">null</code>
                </td>
                <td> Since <span class="bold"><strong>Camel 2.15.0</strong></span>. Character encoding of the
                    output XML document. If null then UTF-8 is used. </td>
            </tr></table></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-XMLSecuritycomponent_HSH_SigningOptions"></a>Signing Options</h2></div></div></div><p>The signer endpoint has the following options.</p><table id="d0e176302"><tr>
                <th> Name </th>
                <th> Type </th>
                <th> Default </th>
                <th> Description </th>
            </tr><tr>
                <td>
                    <code class="code">keyAccessor</code>
                </td>
                <td>
                    <a class="link" href="https://github.com/apache/camel/blob/master/components/camel-xmlsecurity/src/main/java/org/apache/camel/component/xmlsecurity/api/KeyAccessor.java" target="_top">KeyAccessor</a>
                </td>
                <td><code class="code">null</code></td>
                <td> Provides the signing key and the KeyInfo instance. There is an example
                    implementation which uses a keystore, see <a class="link" href="https://github.com/apache/camel/blob/master/components/camel-xmlsecurity/src/main/java/org/apache/camel/component/xmlsecurity/api/DefaultKeyAccessor.java" target="_top">DefaultKeyAccessor</a>
                </td>
            </tr><tr>
                <td>
                    <code class="code">addKeyInfoReference</code>
                </td>
                <td><code class="code">Boolean</code></td>
                <td><code class="code">Boolean.TRUE</code></td>
                <td> Indicates whether a <code class="code">Reference</code> element referring to the
                        <code class="code">KeyInfo</code> element provided by the key accessor should be added to
                    the XML signature. </td>
            </tr><tr>
                <td>
                    <code class="code">signatureAlgorithm</code>
                </td>
                <td><code class="code">String</code></td>
                <td>
                    <code class="code">http://www.w3.org/2000/09/xmldsig#rsa-sha1</code>
                </td>
                <td> signature algorithm consisting of a digest and encryption algorithm. The digest
                    algorithm is used to calculate the digest of the SignedInfo element and the
                    encryption algorithm is used to sign this digest. Possible values:
                        <code class="code">http://www.w3.org/2000/09/xmldsig#dsa-sha1</code>,
                        <code class="code">http://www.w3.org/2000/09/xmldsig#rsa-sha1</code>,
                        <code class="code">http://www.w3.org/2001/04/xmldsig-more#rsa-sha256</code>,
                        <code class="code">http://www.w3.org/2001/04/xmldsig-more#rsa-sha384</code>,
                        <code class="code">http://www.w3.org/2001/04/xmldsig-more#rsa-sha512</code></td>
            </tr><tr>
                <td>
                    <code class="code">digestAlgorithm</code>
                </td>
                <td><code class="code">String</code></td>
                <td> see description </td>
                <td> Digest algorithm for calculating the digest of the in-message body. If not
                    specified then the digest algorithm of the signature algorithm is used. Possible
                    values: <code class="code">http://www.w3.org/2000/09/xmldsig#sha1</code>,
                        <code class="code">http://www.w3.org/2001/04/xmlenc#sha256</code>,
                        <code class="code">http://www.w3.org/2001/04/xmldsig-more#sha384</code>,
                        <code class="code">http://www.w3.org/2001/04/xmlenc#sha512</code>. </td>
            </tr><tr>
                <td>
                    <code class="code">parentLocalName</code>
                </td>
                <td><code class="code">String</code></td>
                <td> null </td>
                <td> Local name of the parent of the <code class="code">Signature</code> element. The
                        <code class="code">Signature</code> element will be added at the end of the children of
                    the parent. Necessary for enveloped XML signature. If this option and the
                        <code class="code">parentXpath</code> option are <code class="code">null</code>, an enveloping XML
                    signature is created. See also option <code class="code">parentNamespace</code>.
                    Alternatively you can specify the parent via the option
                    <code class="code">parentXpath</code>. </td>
            </tr><tr>
                <td>
                    <code class="code">parentNamespace</code>
                </td>
                <td><code class="code">String</code></td>
                <td> null </td>
                <td> Namespace of the parent of the Signature element. See option
                        <code class="literal">parentLocalName</code>
                </td>
            </tr><tr>
                <td>
                    <code class="code">parentXpath</code>
                </td>
                <td><code class="code">XPathFilterParameterSpec</code></td>
                <td> null </td>
                <td> Since <span class="bold"><strong>Camel 2.15.0</strong></span>. XPath to the parent of the
                        <code class="code">Signature</code> element. The <code class="code">Signature</code> element will be
                    added at the end of the children of the parent. Necessary for enveloped XML
                    signature. If this option and the <code class="code">parentLocalName</code> option are
                        <code class="code">null</code>, an enveloping XML signature is created. Alternatively,
                    you can specify the parent via the option <code class="code">parentLocalName</code>. Example:
                        <code class="code">/p1:root/SecurityItem[last()]</code>. This example will select the
                    last sibling with the name <code class="code">SecurityItem</code>. Such kind of selection is
                    not possible with the option <code class="code">parentLocalName</code>.</td>
            </tr><tr>
                <td>
                    <code class="code">canonicalizationMethod</code></td>
                <td>
                    <a class="link" href="http://docs.oracle.com/javase/7/docs/api/javax/xml/crypto/AlgorithmMethod.html" target="_top">javax.xml.crypto.AlgorithmMethod</a>
                </td>
                <td> C14n </td>
                <td> Canonicalization method used to canonicalize the SignedInfo element before the
                    digest is calculated. You can use the helper methods <a class="link" href="https://github.com/apache/camel/blob/master/components/camel-xmlsecurity/src/main/java/org/apache/camel/component/xmlsecurity/api/XmlSignatureHelper.java" target="_top">XmlSignatureHelper</a>.getCanonicalizationMethod(String algorithm) or
                    getCanonicalizationMethod(String algorithm, List&lt;String&gt;
                    inclusiveNamespacePrefixes) to create a canonicalization method. </td>
            </tr><tr>
                <td>
                    <code class="code">transformMethods</code></td>
                <td><code class="code">List&lt;javax.xml.crypto.AlgorithmMethod&gt;</code></td>
                <td> see description </td>
                <td>
                    <p> Transforms which are executed on the message body before the digest is
                        calculated. By default, C14n is added and in the case of enveloped signature
                        (see option <code class="literal">parentLocalName</code>) also <a class="link" href="http://www.w3.org/2000/09/xmldsig#enveloped-signature" target="_top">http://www.w3.org/2000/09/xmldsig#enveloped-signature</a> is added
                        at position 0 of the list. Use methods in <a class="link" href="https://github.com/apache/camel/blob/master/components/camel-xmlsecurity/src/main/java/org/apache/camel/component/xmlsecurity/api/XmlSignatureHelper.java" target="_top">XmlSignatureHelper</a> to create the transform methods.</p>
                    <p>The Camel header, <code class="code">CamelXmlSignatureTransformMethods</code>,
                        overwrites this option (since <span class="bold"><strong>Camel
                        2.17.0</strong></span>). The header value must be of <code class="code">String</code> type;
                        you specify the transform algorithms in a comma separated list&#8212; for
                        example,
                            <code class="code">http://www.w3.org/2000/09/xmldsig#enveloped-signature,http://www.w3.org/TR/2001/REC-xml-c14n-20010315</code>.
                        In the header you cannot specify transform algorithms which need parameters,
                        like <code class="code">http://www.w3.org/TR/1999/REC-xslt-19991116</code>,
                            <code class="code">http://www.w3.org/2002/06/xmldsig-filter2</code>, or
                            <code class="code">http://www.w3.org/TR/1999/REC-xpath-19991116</code>.</p>
                </td>
            </tr><tr>
                <td>
                    <code class="code">prefixForXmlSignatureNamespace</code>
                </td>
                <td><code class="code">String</code></td>
                <td><code class="literal">ds</code>
                </td>
                <td> Prefix for the XML signature namespace. If <code class="literal">null</code> is specified
                    or an empty string then no prefix is used for the signature namespace. </td>
            </tr><tr>
                <td>
                    <code class="code">contentReferenceUri</code>
                </td>
                <td><code class="code">String</code></td>
                <td> See description </td>
                <td> The URI of the reference to the signed content (in-message body). If
                        <code class="literal">null</code> and we are in the enveloped XML signature case then
                    the URI is set to an empty string. If <code class="literal">null</code> and we are in the
                    enveloping XML signature case then the URI is set to
                        <code class="code">generated_object_id</code>, which means that the reference points to
                    the <code class="code">Object</code> element containing the in-message body. You can use this
                    option to reference a specific part in your in-message body if you do not want
                    to sign the complete in-message body. This value can be overwritten by the
                    header <code class="code">CamelXmlSignatureContentReferenceUri</code>. Please be aware, if
                    you want to use a value of an XML ID attribute (example:
                    <code class="code">#ID_value</code>), you must provide the information about the ID attribute
                    either via a <code class="code">doctype</code> definition contained in the input XML document
                    or via a XML schema document which you can specify in the option
                        <code class="code">schemaResourceUri</code>. The defining of the ID attributes via XML
                    schema with the <code class="code">schemaResourceURi</code> option works only in the
                    enveloped signature case. This option is ignored in the case of detached
                    signature, when the option <code class="code">xpathsToIdAttributes</code> is set.</td>
            </tr><tr>
                <td>
                    <code class="code">contentReferenceType</code>
                </td>
                <td><code class="code">String</code></td>
                <td> null </td>
                <td> Value of the type attribute of the content reference. This value can be
                    overwritten by the header "CamelXmlSignatureContentReferenceType" </td>
            </tr><tr>
                <td>
                    <code class="code">plainText</code>
                </td>
                <td><code class="code">Boolean</code></td>
                <td> Boolean.FALSE </td>
                <td> Indicates whether the in-message body contains plain text. Normally, the
                    signature generator treats the incoming message body as XML. If the message body
                    is plain text, then you must set this option to <code class="literal">true</code>. The
                    value can be overwritten by the header
                        <code class="code">CamelXmlSignatureMessageIsPlainText</code>. </td>
            </tr><tr>
                <td>
                    <code class="code">plainTextEncoding</code>
                </td>
                <td><code class="code">String</code></td>
                <td> null </td>
                <td> Only used when the option <code class="literal">plainText</code> is set to
                        <code class="literal">true</code>. Then you can specify the encoding of the plain
                    text. If <code class="literal">null</code> then UTF-8 is used. The value can be
                    overwritten by the header "CamelXmlSignatureMessageIsPlainTextEncoding". </td>
            </tr><tr>
                <td>
                    <code class="code">properties</code>
                </td>
                <td>
                    <a class="link" href="https://github.com/apache/camel/blob/master/components/camel-xmlsecurity/src/main/java/org/apache/camel/component/xmlsecurity/api/XmlSignatureProperties.java" target="_top">XmlSignatureProperties</a>
                </td>
                <td> null </td>
                <td> For adding additional References and Objects to the XML signature which contain
                    additional properties, you can provide a bean which implements the <a class="link" href="https://github.com/apache/camel/blob/master/components/camel-xmlsecurity/src/main/java/org/apache/camel/component/xmlsecurity/api/XmlSignatureProperties.java" target="_top">XmlSignatureProperties</a> interface. </td>
            </tr><tr>
                <td>
                    <code class="code">contentObjectId</code>
                </td>
                <td><code class="code">String</code>
                </td>
                <td> null </td>
                <td> Value of the <code class="code">Id</code> attribute of the <code class="code">Object</code> element. Only
                    used in the enveloping XML signature case. If <code class="code">null</code>, a unique value
                    is generated. Available as of 2.12.2</td>
            </tr><tr>
                <td>
                    <p><code class="code">xpathsToIdAttributes</code></p>
                </td>
                <td>
                    <p><code class="code">List&lt;XPathFilterParameterSpec&gt;</code></p>
                </td>
                <td>
                    <p>empty list</p>
                </td>
                <td>
                    <p><span class="strong"><strong>Since 2.14.0</strong></span>. List of XPATH
                        expressions to ID attributes of elements to be signed. Used for the
                        detached XML Signatures. Can only be used in combination with the
                        option <code class="code">schemaResourceUri</code><span class="italics">.
                        </span>The value can be overwritten by the header
                        "<code class="code">CamelXmlSignatureXpathsToIdAttributes</code>". If the
                        option <code class="code">parentLocalNam</code><span class="italics">e</span> is set at the same time then an exception is
                        thrown. The class <code class="code">XPathFilterParameterSpec </code>has the
                        package <code class="code">javax.xml.crypto.dsig.spec</code>. For further
                        information, see sub-chapter "Detached XML Signatures as Siblings of
                        the Signed Elements".</p>
                </td>
            </tr><tr>
                <td>
                    <p><code class="code">signatureId</code></p>
                </td>
                <td>
                    <p><code class="code">String</code></p>
                </td>
                <td>
                    <p>null</p>
                </td>
                <td>
                    <p><span class="strong"><strong>Since 2.14.0</strong></span>. Value of the Id
                        attribute of the Signature element. If <code class="code">null</code> then a
                        unique Id is generated. If the value is the empty string ("") then
                        no Id attribute is added to the Signature element.</p>
                </td>
            </tr></table></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-XMLSecuritycomponent_HSH_VerifyingOptions"></a>Verifying Options</h2></div></div></div><p>The verifier endpoint has the following options.</p><p>
            
        </p><table id="d0e176891"><tr>
                <th> Name </th>
                <th> Type </th>
                <th> Default </th>
                <th> Description </th>
            </tr><tr>
                <td>
                    <code class="code">keySelector</code>
                </td>
                <td>
                    <a class="link" href="http://docs.oracle.com/javase/7/docs/api/javax/xml/crypto/KeySelector.html" target="_top">javax.xml.crypto.KeySelector</a>
                </td>
                <td>
                    <code class="code">null</code>
                </td>
                <td> Provides the key for validating the XML signature. There is an example
                    implementation which uses a keystore, see <a class="link" href="https://github.com/apache/camel/blob/master/components/camel-xmlsecurity/src/main/java/org/apache/camel/component/xmlsecurity/api/DefaultKeySelector.java" target="_top">DefaultKeySelector</a>. </td>
            </tr><tr>
                <td>
                    <code class="code">xmlSignatureChecker</code>
                </td>
                <td>
                    <a class="link" href="https://github.com/apache/camel/blob/master/components/camel-xmlsecurity/src/main/java/org/apache/camel/component/xmlsecurity/api/XmlSignatureChecker.java" target="_top">XmlSignatureChecker</a>
                </td>
                <td>
                    <code class="code">null</code>
                </td>
                <td> This interface allows the application to check the XML signature before the
                    validation is executed. This step is recommended in <a class="link" href="http://www.w3.org/TR/xmldsig-bestpractices/#check-what-is-signed" target="_top">http://www.w3.org/TR/xmldsig-bestpractices/#check-what-is-signed</a>
                </td>
            </tr><tr>
                <td>
                    <code class="code">validationFailedHandler</code>
                </td>
                <td>
                    <a class="link" href="https://github.com/apache/camel/blob/master/components/camel-xmlsecurity/src/main/java/org/apache/camel/component/xmlsecurity/api/ValidationFailedHandler.java" target="_top">ValidationFailedHandler</a>
                </td>
                <td>
                    <a class="link" href="https://github.com/apache/camel/blob/master/components/camel-xmlsecurity/src/main/java/org/apache/camel/component/xmlsecurity/api/DefaultValidationFailedHandler.java" target="_top">DefaultValidationFailedHandler</a>
                </td>
                <td> Handles the different validation failed situations. The default implementation
                    throws specific exceptions for the different situations (All exceptions have the
                    package name <code class="literal">org.apache.camel.component.xmlsecurity.api</code> and
                    are a sub-class of <code class="literal">XmlSignatureInvalidException</code>. If the
                    signature value validation fails, a
                        <code class="literal">XmlSignatureInvalidValueException</code> is thrown. If a
                    reference validation fails, a
                        <code class="literal">XmlSignatureInvalidContentHashException</code> is thrown. For
                    more detailed information, see the JavaDoc. </td>
            </tr><tr>
                <td>
                    <code class="code">xmlSignature2Message</code>
                </td>
                <td>
                    <a class="link" href="https://github.com/apache/camel/blob/master/components/camel-xmlsecurity/src/main/java/org/apache/camel/component/xmlsecurity/api/XmlSignature2Message.java" target="_top">XmlSignature2Message</a>
                </td>
                <td>
                    <a class="link" href="https://github.com/apache/camel/blob/master/components/camel-xmlsecurity/src/main/java/org/apache/camel/component/xmlsecurity/api/DefaultXmlSignature2Message.java" target="_top">DefaultXmlSignature2Message</a>
                </td>
                <td> Bean which maps the XML signature to the ouput-message after the validation.
                    How this mapping should be done can be configured by the options
                        <code class="literal">outputNodeSearchType</code>,
                    <code class="literal">outputNodeSearch</code>, and
                        <code class="literal">removeSignatureElements</code>. The default implementation
                    offers three possibilities which are related to the three output node search
                    types "Default", "ElementName", and "XPath". The default implementation
                    determines a node which is then serialized and set to the body of the ouput
                    message. If the search type is "ElementName" then the ouput node (which must be
                    in this case an element) is determined by the local name and namespace defined
                    in the search value (see option <code class="literal">outputNodeSearch</code>). If the
                    search type is "XPath" then the output node is determined by the XPath specified
                    in the search value (in this case the ouput node can be of type "Element",
                    "TextNode" or "Document"). If the output node search type is "Default" then the
                    following rules apply: In the enveloped XML signature case (there is a reference
                    with URI="" and transform
                    "http://www.w3.org/2000/09/xmldsig#enveloped-signature"), the incoming XML
                    document without the Signature element is set to the output message body. In the
                    non-enveloped XML signature case, the message body is determined from a
                    referenced Object; this is explained in more detail in chapter "Output Node
                    Determination in Enveloping XML Signature Case". </td>
            </tr><tr>
                <td>
                    <code class="code">outputNodeSearchType</code>
                </td>
                <td>
                    <code class="code">String</code>
                </td>
                <td><code class="code">Default</code></td>
                <td> Determines the type of the search of the output node. See option
                        <code class="literal">xmlSignature2Message</code>. The default implementation
                        <code class="literal">DefaultXmlSignature2Message</code> supports the three search
                    types "Default", "ElementName", and "XPath". </td>
            </tr><tr>
                <td>
                    <code class="code">outputNodeSearch</code>
                </td>
                <td>
                    <code class="code">Object</code>
                </td>
                <td><code class="code">null</code></td>
                <td> Search value of the output node search. The type depends on the search type.
                    For the default search implementation
                        <code class="literal">DefaultXmlSignature2Message</code> the following values can be
                    supplied. If the search type is "Default", then the search value is not used. If
                    the search type is "ElementName", then the search value contains the namespace
                    and local name of the output element. The namespace must be embraced in
                    brackets. If the search type is "XPath", the search value contains an instance
                    of <code class="literal">javax.xml.crypto.dsig.spec.XPathFilterParameterSpec</code> which
                    represents an XPath. You can create such an instance via the method <code class="literal">
                        <a class="link" href="https://github.com/apache/camel/blob/master/components/camel-xmlsecurity/src/main/java/org/apache/camel/component/xmlsecurity/api/XmlSignatureHelper.java" target="_top">XmlSignatureHelper</a>.getXpathFilter(String xpath, Map&lt;String,
                        String&gt; namespaceMap)</code>. The XPath determines the output node which
                    can be of type Element, TextNode, or Document. </td>
            </tr><tr>
                <td>
                    <code class="code">removeSignatureElements</code>
                </td>
                <td>
                    <code class="code">Boolean</code>
                </td>
                <td><code class="code">Boolean.FALSE</code></td>
                <td> Indicator for removing Signature elements in the output message in the
                    enveloped XML signature case. Used in the
                        <code class="literal">XmlSignature2Message</code> instance. The default implementation
                    does use this indicator for the two search types "ElementName" and "XPath".
                </td>
            </tr><tr>
                <td>
                    <code class="code">secureValidation</code>
                </td>
                <td>
                    <code class="code">Boolean</code>
                </td>
                <td><code class="code">Boolean.TRUE</code></td>
                <td> Enables secure validation. If true then secure validation is enabled - see
                        <a class="link" href="http://santuario.apache.org/java150releasenotes.html" target="_top">here</a> for more information. </td>
            </tr></table></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-XMLSecuritycomponent_HSH_OutputNodeDeterminationinEnvelopingXMLSignatureCase"></a>Output Node Determination in Enveloping XML Signature Case</h2></div></div></div><p>After the validation the node is extracted from the XML signature document which is
            finally returned to the output-message body. In the enveloping XML signature case, the
            default implementation <a class="link" href="https://github.com/apache/camel/blob/master/components/camel-xmlsecurity/src/main/java/org/apache/camel/component/xmlsecurity/api/DefaultXmlSignature2Message.java" target="_top">DefaultXmlSignature2Message</a> of <a class="link" href="https://github.com/apache/camel/blob/master/components/camel-xmlsecurity/src/main/java/org/apache/camel/component/xmlsecurity/api/XmlSignature2Message.java" target="_top">XmlSignature2Message</a> does this for the node search type "Default" in the
            following way (see option <code class="literal">xmlSignature2Message</code>):</p><p>First an Object reference is determined:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Only same document references are taken into account (URI must start with
                    '#')</p></li><li class="listitem"><p>Also indirect same document references to an object via manifest are taken
                    into account.</p></li><li class="listitem"><p>The resulting number of Object references must be 1.</p></li></ul></div><p>Then, the Object is dereferenced and the Object must only contain one XML element.
            This element is returned as output node.</p><p>This does mean that the enveloping XML signature must have either the structure</p><pre class="programlisting">    &lt;Signature&gt;
          &lt;SignedInfo&gt;
             &lt;Reference URI="#object"/&gt;       
             &lt;!-- further references possible but they must not point to an Object or Manifest containing an object reference --&gt;
             ...
          &lt;/SignedInfo&gt;
      
          &lt;Object Id="object"&gt;
               &lt;!-- contains one XML element which is extracted to the message body --&gt;
          &lt;Object&gt;
          &lt;!-- further object elements possible which are not referenced--&gt;
          ...
          (&lt;KeyInfo&gt;)?
    &lt;/Signature&gt;</pre><p>or the structure</p><pre class="programlisting">    &lt;Signature&gt;
          &lt;SignedInfo&gt;
             &lt;Reference URI="#manifest"/&gt;       
             &lt;!-- further references  are possible but they must not point to an Object or other manifest containing an object reference --&gt;
             ...
          &lt;/SignedInfo&gt;
      
          &lt;Object &gt;
             &lt;Manifest Id="manifest"&gt;
                &lt;Reference URI=#object/&gt;
             &lt;/Manifest&gt;
          &lt;/Objet&gt;
          &lt;Object Id="object"&gt;
              &lt;!-- contains the DOM node which is extracted to the message body --&gt;
          &lt;/Object&gt;
           &lt;!-- further object elements possible which are not referenced --&gt;
          ...
          (&lt;KeyInfo&gt;)?
    &lt;/Signature&gt;</pre></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scroll-bookmark-2001"></a>Detached XML Signatures as Siblings of the Signed Elements</h2></div></div></div><p><span class="strong"><strong>Since 2.14.0</strong></span>.</p><p>You can create detached signatures where the signature is a sibling of the signed
            element. The following example contains two detached signatures. The first signature
            is for the element "C" and the second signature is for element "A". The signatures
            are <span class="strong"><strong>nested</strong></span>; the second signature is for the
            element A which also contains the first signature.</p><div class="example"><a name="d0e177185"></a><p class="title"><b>Example&nbsp;13.&nbsp;Example Detached XML Signatures</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;root&gt;
    &lt;A ID="IDforA"&gt;
        &lt;B&gt;
            &lt;C ID="IDforC"&gt;
                &lt;D&gt;dvalue&lt;/D&gt;
            &lt;/C&gt;
            &lt;ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#"
                Id="_6bf13099-0568-4d76-8649-faf5dcb313c0"&gt;
                &lt;ds:SignedInfo&gt;
                    &lt;ds:CanonicalizationMethod
                        Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315" /&gt;
                    &lt;ds:SignatureMethod
                        Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1" /&gt;
                    &lt;ds:Reference URI="#IDforC"&gt;
                        ...
                    &lt;/ds:Reference&gt;
                &lt;/ds:SignedInfo&gt;
                &lt;ds:SignatureValue&gt;aUDFmiG71&lt;/ds:SignatureValue&gt;
            &lt;/ds:Signature&gt;
        &lt;/B&gt;
    &lt;/A&gt;
    &lt;ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#"Id="_6b02fb8a-30df-42c6-ba25-76eba02c8214"&gt;
        &lt;ds:SignedInfo&gt;
            &lt;ds:CanonicalizationMethod
                Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315" /&gt;
            &lt;ds:SignatureMethod
                Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1" /&gt;
            &lt;ds:Reference URI="#IDforA"&gt;
                ...
            &lt;/ds:Reference&gt;         
        &lt;/ds:SignedInfo&gt;
        &lt;ds:SignatureValue&gt;q3tvRoGgc8cMUqUSzP6C21zb7tt04riPnDuk=&lt;/ds:SignatureValue&gt;
    &lt;/ds:Signature&gt;
&lt;root&gt;</pre></div></div><br class="example-break"><p>The example shows that you can sign several elements and that for each element a
            signature is created as sibling. The elements to be signed must have an attribute of
            type ID. The ID type of the attribute must be defined in the XML schema (see option
            <span class="italics">schemaResourceUri</span>). You specify a list of
            XPATH expressions pointing to attributes of type ID (see option <span class="italics">xpathsToIdAttributes</span>). These attributes determine the
            elements to be signed. The elements are signed by the same key given by the
            <span class="italics">keyAccessor</span> bean. Ements with higher
            (=deeper) hierarachy level are signed first. In the example, the element "C" is
            signed before the element "A".</p><div class="example"><a name="d0e177201"></a><p class="title"><b>Example&nbsp;14.&nbsp;Java DSL Example</b></p><div class="example-contents"><pre class="programlisting">from("direct:detached")
  .to("xmlsecurity:sign://detached?keyAccessor=#keyAccessorBeant&amp;xpathsToIdAttributes=#xpathsToIdAttributesBean&amp;schemaResourceUri=Test.xsd")
  .to("xmlsecurity:verify://detached?keySelector=#keySelectorBean&amp;schemaResourceUri=org/apache/camel/component/xmlsecurity/Test.xsd")
  .to("mock:result");</pre></div></div><br class="example-break"><div class="example"><a name="d0e177206"></a><p class="title"><b>Example&nbsp;15.&nbsp;Spring Example</b></p><div class="example-contents"><pre class="programlisting">   
  &lt;bean id="xpathsToIdAttributesBean" class="java.util.ArrayList"&gt;
        &lt;constructor-arg type="java.util.Collection"&gt;
            &lt;list&gt;
                &lt;bean
                    class="org.apache.camel.component.xmlsecurity.api.XmlSignatureHelper"
                    factory-method="getXpathFilter"&gt;
                    &lt;constructor-arg type="java.lang.String"
                        value="/ns:root/a/@ID" /&gt;
                    &lt;constructor-arg&gt;
                        &lt;map key-type="java.lang.String" value-type="java.lang.String"&gt;
                            &lt;entry key="ns" value="http://test" /&gt;
                        &lt;/map&gt;
                    &lt;/constructor-arg&gt;
                &lt;/bean&gt;
            &lt;/list&gt;
        &lt;/constructor-arg&gt;
    &lt;/bean&gt;
...
       &lt;from uri="direct:detached" /&gt;
            &lt;to
                uri="xmlsecurity:sign://detached?keyAccessor=#keyAccessorBean&amp;amp;xpathsToIdAttributes=#xpathsToIdAttributesBean&amp;amp;schemaResourceUri=Test.xsd" /&gt;
            &lt;to
                uri="xmlsecurity:verify://detached?keySelector=#keySelectorBean&amp;amp;schemaResourceUri=Test.xsd" /&gt;
            &lt;to uri="mock:result" /&gt;</pre></div></div><br class="example-break"></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-XMLSecuritycomponent-XAdES"></a>XAdES-BES/EPES for the Signer Endpoint</h2></div></div></div><p><span class="bold"><strong>Available as of Camel 2.15.0</strong></span>
            <a class="link" href="http://www.etsi.org/deliver/etsi_ts/101900_101999/101903/01.04.02_60/ts_101903v010402p.pdf" target="_top">&#159;XML Advanced Electronic Signatures (XAdES)</a> defines extensions to XML
            Signature. This standard was defined by the <a class="link" href="http://www.etsi.org/" target="_top">European Telecomunication Standards Institute</a> and allows you to create
            signatures which are compliant to the <a class="link" href="http://eur-lex.europa.eu/LexUriServ/LexUriServ.do?uri=OJ:L:2000:013:0012:0020:EN:PDF" target="_top">European Union Directive (1999/93/EC) on a Community framework for electronic
                signatures</a>. XAdES defines different sets of signature properties which are
            called signature forms. We support the signature forms <span class="emphasis"><em>Basic Electronic
                Signature</em></span> (XAdES-BES) and <span class="emphasis"><em>Explicit Policy Based Electronic
                Signature (XAdES-EPES) for the Signer Endpoint. The forms Electronic Signature with
                Validation Data</em></span> XAdES-T and XAdES-C are not supported. We support the
            following properties of the XAdES-EPES form ("?" denotes zero or one
            occurrence):</p><table id="d0e177233"><tr>
                <td>
                    <pre class="programlisting">        &lt;QualifyingProperties Target&gt;
            &lt;SignedProperties&gt;
                &lt;SignedSignatureProperties&gt;
                    (SigningTime)?
                    (SigningCertificate)?
                    (SignaturePolicyIdentifier)
                    (SignatureProductionPlace)?
                    (SignerRole)?
                &lt;/SignedSignatureProperties&gt;
                &lt;SignedDataObjectProperties&gt;
                    (DataObjectFormat)?
                    (CommitmentTypeIndication)?
                &lt;/SignedDataObjectProperties&gt;
            &lt;/SignedProperties&gt;
        &lt;/QualifyingProperties&gt;</pre>
                </td>
            </tr></table><p>The properties of the XAdES-BES form are the same except that the
                <code class="code">SignaturePolicyIdentifier</code> property is not part of XAdES-BES. </p><p> You can configure the XAdES-BES/EPES properties via the bean
                <code class="code">org.apache.camel.component.xmlsecurity.api.XAdESSignatureProperties</code> or
                <code class="code">org.apache.camel.component.xmlsecurity.api.DefaultXAdESSignatureProperties.
                XAdESSignatureProperties</code> does support all properties mentioned above except
            the <code class="code">SigningCertificate </code> property. To get the <code class="code">SigningCertificate
            </code>property, you must overwrite either the method
                <code class="code">XAdESSignatureProperties.getSigningCertificate() </code>or<code class="code">
                XAdESSignatureProperties.getSigningCertificateChain(). </code>The class
                <code class="code">DefaultXAdESSignatureProperties</code> overwrites the method
                <code class="code">getSigningCertificate()</code> and allows you to specify the signing
            certificate via a keystore and alias. The following example shows all parameters you can
            specify. If you do not need certain parameters you can just omit them.</p><table id="d0e177273"><tr>
                <td>
                    <pre class="programlisting">        Keystore keystore = ... // load a keystore
        DefaultKeyAccessor accessor = new DefaultKeyAccessor();
        accessor.setKeyStore(keystore);
        accessor.setPassword("password");
        accessor.setAlias("cert_alias"); // signer key alias
 
        DefaultXAdESSignatureProperties props = new DefaultXAdESSignatureProperties();
        props.setNamespace("http://uri.etsi.org/01903/v1.3.2#"); // sets the namespace for the XAdES elements; the namspace is related to the XAdES version, default value is "http://uri.etsi.org/01903/v1.3.2#", other possible values are "http://uri.etsi.org/01903/v1.1.1#" and "http://uri.etsi.org/01903/v1.2.2#"
        props.setPrefix("etsi"); // sets the prefix for the XAdES elements, default value is "etsi"
        
        // signing certificate
        props.setKeystore(keystore));
        props.setAlias("cert_alias"); // specify the alias of the signing certificate in the keystore = signer key alias
        props.setDigestAlgorithmForSigningCertificate(DigestMethod.SHA256); // possible values for the algorithm are "http://www.w3.org/2000/09/xmldsig#sha1", "http://www.w3.org/2001/04/xmlenc#sha256", "http://www.w3.org/2001/04/xmldsig-more#sha384", "http://www.w3.org/2001/04/xmlenc#sha512", default value is "http://www.w3.org/2001/04/xmlenc#sha256"
        props.setSigningCertificateURIs(Collections.singletonList("http://certuri"));
 
        // signing time
        props.setAddSigningTime(true);
 
        // policy
        props.setSignaturePolicy(XAdESSignatureProperties.SIG_POLICY_EXPLICIT_ID);
        // also the values XAdESSignatureProperties.SIG_POLICY_NONE ("None"), and XAdESSignatureProperties.SIG_POLICY_IMPLIED ("Implied")are possible, default value is XAdESSignatureProperties.SIG_POLICY_EXPLICIT_ID ("ExplicitId")
        // For "None" and "Implied" you must not specify any further policy parameters
        props.setSigPolicyId("urn:oid:1.2.840.113549.1.9.16.6.1");
        props.setSigPolicyIdQualifier("OIDAsURN"); //allowed values are empty string, "OIDAsURI", "OIDAsURN"; default value is empty string
        props.setSigPolicyIdDescription("invoice version 3.1");
        props.setSignaturePolicyDigestAlgorithm(DigestMethod.SHA256);// possible values for the algorithm are "http://www.w3.org/2000/09/xmldsig#sha1", http://www.w3.org/2001/04/xmlenc#sha256", "http://www.w3.org/2001/04/xmldsig-more#sha384", "http://www.w3.org/2001/04/xmlenc#sha512", default value is http://www.w3.org/2001/04/xmlenc#sha256"
        props.setSignaturePolicyDigestValue("Ohixl6upD6av8N7pEvDABhEL6hM=");
        // you can add  qualifiers for the signature policy either by specifying text or an XML fragment with the root element "SigPolicyQualifier" 
        props.setSigPolicyQualifiers(Arrays
            .asList(new String[] {
                "&lt;SigPolicyQualifier xmlns=\"http://uri.etsi.org/01903/v1.3.2#\"&gt;&lt;SPURI&gt;http://test.com/sig.policy.pdf&lt;/SPURI&gt;&lt;SPUserNotice&gt;&lt;ExplicitText&gt;display text&lt;/ExplicitText&gt;"
                    + "&lt;/SPUserNotice&gt;&lt;/SigPolicyQualifier&gt;", "category B" }));
        props.setSigPolicyIdDocumentationReferences(Arrays.asList(new String[] {"http://test.com/policy.doc.ref1.txt",
            "http://test.com/policy.doc.ref2.txt" }));
 
        // production place
        props.setSignatureProductionPlaceCity("Munich");
        props.setSignatureProductionPlaceCountryName("Germany");
        props.setSignatureProductionPlacePostalCode("80331");
        props.setSignatureProductionPlaceStateOrProvince("Bavaria");
 
        //role
        // you can add claimed roles either by specifying text or an XML fragment with the root element "ClaimedRole" 
        props.setSignerClaimedRoles(Arrays.asList(new String[] {"test",
            "&lt;a:ClaimedRole xmlns:a=\"http://uri.etsi.org/01903/v1.3.2#\"&gt;&lt;TestRole&gt;TestRole&lt;/TestRole&gt;&lt;/a:ClaimedRole&gt;" }));
        props.setSignerCertifiedRoles(Collections.singletonList(new XAdESEncapsulatedPKIData("Ahixl6upD6av8N7pEvDABhEL6hM=",
            "http://uri.etsi.org/01903/v1.2.2#DER", "IdCertifiedRole")));
 
        // data object format
        props.setDataObjectFormatDescription("invoice");
        props.setDataObjectFormatMimeType("text/xml");
        props.setDataObjectFormatIdentifier("urn:oid:1.2.840.113549.1.9.16.6.2");
        props.setDataObjectFormatIdentifierQualifier("OIDAsURN"); //allowed values are empty string, "OIDAsURI", "OIDAsURN"; default value is empty string
        props.setDataObjectFormatIdentifierDescription("identifier desc");
        props.setDataObjectFormatIdentifierDocumentationReferences(Arrays.asList(new String[] {
            "http://test.com/dataobject.format.doc.ref1.txt", "http://test.com/dataobject.format.doc.ref2.txt" }));
 
        //commitment
        props.setCommitmentTypeId("urn:oid:1.2.840.113549.1.9.16.6.4");
        props.setCommitmentTypeIdQualifier("OIDAsURN"); //allowed values are empty string, "OIDAsURI", "OIDAsURN"; default value is empty string
        props.setCommitmentTypeIdDescription("description for commitment type ID");
        props.setCommitmentTypeIdDocumentationReferences(Arrays.asList(new String[] {"http://test.com/commitment.ref1.txt",
            "http://test.com/commitment.ref2.txt" }));
        // you can specify a commitment type qualifier either by simple text or an XML fragment with root element "CommitmentTypeQualifier"
        props.setCommitmentTypeQualifiers(Arrays.asList(new String[] {"commitment qualifier",
            "&lt;c:CommitmentTypeQualifier xmlns:c=\"http://uri.etsi.org/01903/v1.3.2#\"&gt;&lt;C&gt;c&lt;/C&gt;&lt;/c:CommitmentTypeQualifier&gt;" }));
 
 beanRegistry.bind("xmlSignatureProperties",props);
 beanRegistry.bind("keyAccessorDefault",keyAccessor);
 
 // you must reference the properties bean in the "xmlsecurity" URI
 from("direct:xades").to("xmlsecurity:sign://xades?keyAccessor=#keyAccessorDefault&amp;properties=#xmlSignatureProperties")
                     .to("mock:result");

</pre>
                </td>
            </tr></table><table id="d0e177282"><tr>
                <td>
                    <pre class="programlisting">   ...
   &lt;from uri="direct:xades" /&gt;
            &lt;to
                uri="xmlsecurity:sign://xades?keyAccessor=#accessorRsa&amp;amp;properties=#xadesProperties" /&gt;
            &lt;to uri="mock:result" /&gt;
   ...
   &lt;bean id="xadesProperties"
        class="org.apache.camel.component.xmlsecurity.api.XAdESSignatureProperties"&gt;
        &lt;!-- For more properties see the the previous Java DSL example. 
             If you want to have a signing certificate then use the bean class DefaultXAdESSignatureProperties (see the previous Java DSL example). --&gt;
        &lt;property name="signaturePolicy" value="ExplicitId" /&gt;
        &lt;property name="sigPolicyId" value="http://www.test.com/policy.pdf" /&gt;
        &lt;property name="sigPolicyIdDescription" value="factura" /&gt;
        &lt;property name="signaturePolicyDigestAlgorithm" value="http://www.w3.org/2000/09/xmldsig#sha1" /&gt;
        &lt;property name="signaturePolicyDigestValue" value="Ohixl6upD6av8N7pEvDABhEL1hM=" /&gt;
        &lt;property name="signerClaimedRoles" ref="signerClaimedRoles_XMLSigner" /&gt;
        &lt;property name="dataObjectFormatDescription" value="Factura electr&oacute;nica" /&gt;
        &lt;property name="dataObjectFormatMimeType" value="text/xml" /&gt;
    &lt;/bean&gt;
    &lt;bean class="java.util.ArrayList" id="signerClaimedRoles_XMLSigner"&gt;
        &lt;constructor-arg&gt;
            &lt;list&gt;
                &lt;value&gt;Emisor&lt;/value&gt;
                &lt;value&gt;&amp;lt;ClaimedRole
                    xmlns=&amp;quot;http://uri.etsi.org/01903/v1.3.2#&amp;quot;&amp;gt;&amp;lt;test
                    xmlns=&amp;quot;http://test.com/&amp;quot;&amp;gt;test&amp;lt;/test&amp;gt;&amp;lt;/ClaimedRole&amp;gt;&lt;/value&gt;
            &lt;/list&gt;
        &lt;/constructor-arg&gt;
    &lt;/bean&gt;</pre>
                </td>
            </tr></table></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e177291"></a>Headers</h2></div></div></div><table id="d0e177294"><tbody><tr>
                    <th>Header</th>
                    <th>Type</th>
                    <th>Description</th>
                </tr><tr>
                    <td><p><code class="code">CamelXmlSignatureXAdESQualifyingPropertiesId</code></p></td>
                    <td>String</td>
                    <td>for the 'Id' attribute value of
                        <code class="code">QualifyingProperties</code> element</td>
                </tr><tr>
                    <td><p><code class="code">CamelXmlSignatureXAdESSignedDataObjectPropertiesId</code></p></td>
                    <td>String</td>
                    <td>for the 'Id' attribute value of
                        <code class="code">SignedDataObjectProperties</code> element</td>
                </tr><tr>
                    <td><p><code class="code">CamelXmlSignatureXAdESSignedSignaturePropertiesId</code></p></td>
                    <td>String</td>
                    <td>for the 'Id' attribute value of
                        <code class="code">SignedSignatureProperties</code> element</td>
                </tr><tr>
                    <td><p><code class="code">CamelXmlSignatureXAdESDataObjectFormatEncoding</code></p></td>
                    <td>String</td>
                    <td>for the value of the
                        <code class="code">Encoding</code> element of the
                        <code class="code">DataObjectFormat</code> element</td>
                </tr><tr>
                    <td><code class="code">CamelXmlSignatureXAdESNamespace</code></td>
                    <td>String</td>
                    <td> overwrites the XAdES namespace
                        parameter value</td>
                </tr><tr>
                    <td><p><code class="code">CamelXmlSignatureXAdESPrefix</code></p></td>
                    <td>String</td>
                    <td>overwrites the XAdES prefix parameter
                        value</td>
                </tr></tbody></table></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e177399"></a>Limitations with regard to XAdES version 1.4.2</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>No support for signature form XAdES-T and XAdES-C</p></li><li class="listitem"><p>Only signer part implemented. Verifier part currently not available.</p></li><li class="listitem"><p>No support for the '<code class="code">QualifyingPropertiesReference</code>' element (see
                section 6.3.2 of spec).</p></li><li class="listitem"><p>No support for the <code class="code">Transforms</code> element contained in the
                <code class="code">SignaturePolicyId</code> element contained in the
                <code class="code">SignaturePolicyIdentifier element</code></p></li><li class="listitem"><p>No support of the <code class="code">CounterSignature</code> element --&gt; no support for
                the <code class="code">UnsignedProperties</code> element</p></li><li class="listitem"><p>At most one <code class="code">DataObjectFormat</code> element. More than one
                <code class="code">DataObjectFormat </code>element makes no sense because we have only
                one data object which is signed (this is the incoming message body to the XML
                signer endpoint).</p></li><li class="listitem"><p>At most one <code class="code">CommitmentTypeIndication</code> element. More than one
                <code class="code">CommitmentTypeIndication</code>element makes no sense because we have
                only one data object which is signed (this is the incoming message body to the
                XML signer endpoint).</p></li><li class="listitem"><p>A <code class="code">CommitmentTypeIndication</code> element contains always the
                <code class="code">AllSignedDataObjects</code> element. The
                <code class="code">ObjectReference</code> element within
                <code class="code">CommitmentTypeIndication</code> element is not supported.</p></li><li class="listitem"><p>The<code class="code"> AllDataObjectsTimeStamp</code> element is not supported</p></li><li class="listitem"><p>The<code class="code"> IndividualDataObjectsTimeStamp</code> element is not supported</p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e177480"></a>See Also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://www.w3.org/TR/xmldsig-bestpractices/" target="_top">Best Practices</a></p></li></ul></div></div></div></body></html>