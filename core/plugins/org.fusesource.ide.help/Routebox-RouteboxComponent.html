<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Routebox Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="RMI-RMIComponent.html" title="RMI Component"><link rel="next" href="RSS-RSSComponent.html" title="RSS Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="Routebox-RouteboxComponent"></a>Routebox Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="Routebox-RouteboxComponent.html#Routebox-TheneedforaCamelRouteboxendpoint">The need for a Camel Routebox endpoint</a></span></dt><dt><span class="section"><a href="Routebox-RouteboxComponent.html#Routebox-URIformat">URI format</a></span></dt><dt><span class="section"><a href="Routebox-RouteboxComponent.html#Routebox-Options">Options</a></span></dt><dt><span class="section"><a href="Routebox-RouteboxComponent.html#Routebox-SendingReceivingMessagestofromtheroutebox">Sending/Receiving Messages to/from the routebox</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel 2.6</strong></span></p><p><span class="strong"><strong>Routebox subject for change</strong></span></p><p>The Routebox component will be revisited in upcoming releases to see if
it can be further simplified, be more intuitive and user friendly. The
related <a class="link" href="context.html" target="_top">Context</a> component may be regardes as the
simpler component. This component may be @deprecated in favor of
<a class="link" href="context.html" target="_top">Context</a>.</p><p>The <span class="strong"><strong>routebox</strong></span> component enables the creation of specialized endpoints
that offer encapsulation and a strategy based indirection service to a
collection of camel routes hosted in an automatically created or user
injected camel context.</p><p>Routebox endpoints are camel endpoints that may be invoked directly on
camel routes. The routebox endpoint performs the following key functions</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">encapsulation - acts as a blackbox, hosting a collection of camel
routes stored in an inner camel context. The inner context is fully
under the control of the routebox component and is <span class="strong"><strong>JVM bound</strong></span>.</li><li class="listitem">strategy based indirection - direct payloads sent to the routebox
endpoint along a camel route to specific inner routes based on a user
defined internal routing strategy or a dispatch map.</li><li class="listitem">exchange propagation - forward exchanges modified by the routebox
endpoint to the next segment of the camel route.</li></ul></div><p>The routebox component supports both consumer and producer endpoints.</p><p>Producer endpoints are of two flavors</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Producers that send or dispatch incoming requests to a external
routebox consumer endpoint</li><li class="listitem">Producers that directly invoke routes in an internal embedded camel
context thereby not sending requests to an external consumer.</li></ul></div><p>Maven users will need to add the following dependency to their <code class="literal">pom.xml</code>
for this component:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-routebox<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Routebox-TheneedforaCamelRouteboxendpoint"></a>The need for a Camel Routebox endpoint</h2></div></div></div><p>The routebox component is designed to ease integration in complex
environments needing</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">a large collection of routes and</li><li class="listitem">involving a wide set of endpoint technologies needing integration in
different ways</li></ul></div><p>In such environments, it is often necessary to craft an integration
solution by creating a sense of layering among camel routes effectively
organizing them into</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Coarse grained or higher level routes - aggregated collection of inner
or lower level routes exposed as Routebox endpoints that represent an
integration focus area. For example</li></ul></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="50%" class="col_1"><col width="50%" class="col_2"></colgroup><thead><tr><th align="left" valign="top">Focus Area</th><th align="left" valign="top">Coarse grained Route Examples</th></tr></thead><tbody><tr><td align="left" valign="top"><p>Department Focus</p></td><td align="left" valign="top"><p>HR routes, Sales routes etc</p></td></tr><tr><td align="left" valign="top"><p>Supply chain &amp; B2B Focus</p></td><td align="left" valign="top"><p>Shipping routes, Fulfillment routes, 3rd party services etc</p></td></tr><tr><td align="left" valign="top"><p>Technology Focus</p></td><td align="left" valign="top"><p>Database routes, JMS routes, Scheduled batch routes etc</p></td></tr></tbody></table></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Fine grained routes - routes that execute a singular and specific
business and/or integration pattern.</li></ul></div><p>Requests sent to Routebox endpoints on coarse grained routes can then
delegate requests to inner fine grained routes to achieve a specific
integration objective, collect the final inner result, and continue to
progress to the next step along the coarse-grained route.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Routebox-URIformat"></a>URI format</h2></div></div></div><pre class="programlisting">routebox:routeboxname[?options]</pre><p>You can append query options to the URI in the following format,
<code class="literal">?option=value&amp;option=value&amp;&#8230;&#8203;</code></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Routebox-Options"></a>Options</h2></div></div></div><p>The RouteBox component has no options.</p><p>The RouteBox component supports 18 endpoint options which are listed below:</p><p>{% raw %}</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="10%" class="col_2"><col width="11%" class="col_3"><col width="10%" class="col_4"><col width="50%" class="col_5"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Group</th><th align="left" valign="top">Default</th><th align="left" valign="top">Java Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>routeboxName</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> Logical name for the routebox (eg like a queue name)</p></td></tr><tr><td align="left" valign="top"><p>dispatchMap</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">Map</code></p></td><td align="left" valign="top"><p>A string representing a key in the Camel Registry matching an object value of the type HashMap. The HashMap key should contain strings that can be matched against the value set for the exchange header ROUTE_DISPATCH_KEY. The HashMap value should contain inner route consumer URI&#8217;s to which requests should be directed.</p></td></tr><tr><td align="left" valign="top"><p>dispatchStrategy</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">RouteboxDispatchStrategy</code></p></td><td align="left" valign="top"><p>To use a custom RouteboxDispatchStrategy which allows to use custom dispatching instead of the default.</p></td></tr><tr><td align="left" valign="top"><p>forkContext</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top"><p><code class="literal">true</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Whether to fork and create a new inner CamelContext instead of reusing the same CamelContext.</p></td></tr><tr><td align="left" valign="top"><p>innerProtocol</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top"><p><code class="literal">direct</code></p></td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>The Protocol used internally by the Routebox component. Can be Direct or SEDA. The Routebox component currently offers protocols that are JVM bound.</p></td></tr><tr><td align="left" valign="top"><p>queueSize</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">int</code></p></td><td align="left" valign="top"><p>Create a fixed size queue to receive requests.</p></td></tr><tr><td align="left" valign="top"><p>bridgeErrorHandler</p></td><td align="left" valign="top"><p>consumer</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Allows for bridging the consumer to the Camel routing Error Handler which mean any exceptions occurred while the consumer is trying to pickup incoming messages or the likes will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions that will be logged at WARN/ERROR level and ignored.</p></td></tr><tr><td align="left" valign="top"><p>pollInterval</p></td><td align="left" valign="top"><p>consumer</p></td><td align="left" valign="top"><p><code class="literal">1000</code></p></td><td align="left" valign="top"><p><code class="literal">long</code></p></td><td align="left" valign="top"><p>The timeout used when polling from seda. When a timeout occurs the consumer can check whether it is allowed to continue running. Setting a lower value allows the consumer to react more quickly upon shutdown.</p></td></tr><tr><td align="left" valign="top"><p>threads</p></td><td align="left" valign="top"><p>consumer</p></td><td align="left" valign="top"><p><code class="literal">20</code></p></td><td align="left" valign="top"><p><code class="literal">int</code></p></td><td align="left" valign="top"><p>Number of threads to be used by the routebox to receive requests.</p></td></tr><tr><td align="left" valign="top"><p>exceptionHandler</p></td><td align="left" valign="top"><p>consumer (advanced)</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">ExceptionHandler</code></p></td><td align="left" valign="top"><p>To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this options is not in use. By default the consumer will deal with exceptions that will be logged at WARN/ERROR level and ignored.</p></td></tr><tr><td align="left" valign="top"><p>exchangePattern</p></td><td align="left" valign="top"><p>consumer (advanced)</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">ExchangePattern</code></p></td><td align="left" valign="top"><p>Sets the exchange pattern when the consumer creates an exchange.</p></td></tr><tr><td align="left" valign="top"><p>connectionTimeout</p></td><td align="left" valign="top"><p>producer</p></td><td align="left" valign="top"><p><code class="literal">20000</code></p></td><td align="left" valign="top"><p><code class="literal">long</code></p></td><td align="left" valign="top"><p>Timeout in millis used by the producer when sending a message.</p></td></tr><tr><td align="left" valign="top"><p>sendToConsumer</p></td><td align="left" valign="top"><p>producer</p></td><td align="left" valign="top"><p><code class="literal">true</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Dictates whether a Producer endpoint sends a request to an external routebox consumer. If the setting is false the Producer creates an embedded inner context and processes requests internally.</p></td></tr><tr><td align="left" valign="top"><p>innerContext</p></td><td align="left" valign="top"><p>advanced</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">CamelContext</code></p></td><td align="left" valign="top"><p>A string representing a key in the Camel Registry matching an object value of the type org.apache.camel.CamelContext. If a CamelContext is not provided by the user a CamelContext is automatically created for deployment of inner routes.</p></td></tr><tr><td align="left" valign="top"><p>innerProducerTemplate</p></td><td align="left" valign="top"><p>advanced</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">ProducerTemplate</code></p></td><td align="left" valign="top"><p>The ProducerTemplate to use by the internal embeded CamelContext</p></td></tr><tr><td align="left" valign="top"><p>innerRegistry</p></td><td align="left" valign="top"><p>advanced</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">Registry</code></p></td><td align="left" valign="top"><p>To use a custom registry for the internal embedded CamelContext.</p></td></tr><tr><td align="left" valign="top"><p>routeBuilders</p></td><td align="left" valign="top"><p>advanced</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>A string representing a key in the Camel Registry matching an object value of the type List. If the user does not supply an innerContext pre-primed with inner routes the routeBuilders option must be provided as a non-empty list of RouteBuilders containing inner routes</p></td></tr><tr><td align="left" valign="top"><p>synchronous</p></td><td align="left" valign="top"><p>advanced</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used or Camel is allowed to use asynchronous processing (if supported).</p></td></tr></tbody></table></div><p>{% endraw %}</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Routebox-SendingReceivingMessagestofromtheroutebox"></a>Sending/Receiving Messages to/from the routebox</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="Routebox-RouteboxComponent.html#Routebox-Step1-LoadinginnerroutedetailsintotheRegistry">Step 1: Loading inner route details into the Registry</a></span></dt><dt><span class="section"><a href="Routebox-RouteboxComponent.html#Routebox-Step2-OptionalyusingaDispatchStrategyinsteadofaDispatchMap">Step 2: Optionaly using a Dispatch Strategy instead of a Dispatch Map</a></span></dt><dt><span class="section"><a href="Routebox-RouteboxComponent.html#Routebox-Step2-Launchingarouteboxconsumer">Step 2: Launching a routebox consumer</a></span></dt><dt><span class="section"><a href="Routebox-RouteboxComponent.html#Routebox-Step3-Usingarouteboxproducer">Step 3: Using a routebox producer</a></span></dt></dl></div><p>Before sending requests it is necessary to properly configure the
routebox by loading the required URI parameters into the Registry as
shown below. In the case of Spring, if the necessary beans are declared
correctly, the registry is automatically populated by Camel.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Routebox-Step1-LoadinginnerroutedetailsintotheRegistry"></a>Step 1: Loading inner route details into the Registry</h3></div></div></div><pre class="programlisting"><em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Override</span></em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">protected</strong> JndiRegistry createRegistry() <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">throws</strong> Exception {
    JndiRegistry registry = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> JndiRegistry(createJndiContext());

    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// Wire the routeDefinitions &amp; dispatchStrategy to the outer camelContext where the routebox is declared</em>
    List&lt;RouteBuilder&gt; routes = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> ArrayList&lt;RouteBuilder&gt;();
    routes.add(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> SimpleRouteBuilder());
    registry.bind(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"registry"</em></strong>, createInnerRegistry());
    registry.bind(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"routes"</em></strong>, routes);

    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// Wire a dispatch map to registry</em>
    HashMap&lt;String, String&gt; map = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> HashMap&lt;String, String&gt;();
    map.put(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"addToCatalog"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"seda:addToCatalog"</em></strong>);
    map.put(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"findBook"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"seda:findBook"</em></strong>);
    registry.bind(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"map"</em></strong>, map);

    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// Alternatively wiring a dispatch strategy to the registry</em>
    registry.bind(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"strategy"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> SimpleRouteDispatchStrategy());

    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">return</strong> registry;
}

<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">private</strong> JndiRegistry createInnerRegistry() <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">throws</strong> Exception {
    JndiRegistry innerRegistry = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> JndiRegistry(createJndiContext());
    BookCatalog catalogBean = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> BookCatalog();
    innerRegistry.bind(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"library"</em></strong>, catalogBean);

    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">return</strong> innerRegistry;
}
...
CamelContext context = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> DefaultCamelContext(createRegistry());</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Routebox-Step2-OptionalyusingaDispatchStrategyinsteadofaDispatchMap"></a>Step 2: Optionaly using a Dispatch Strategy instead of a Dispatch Map</h3></div></div></div><p>Using a dispatch Strategy involves implementing the interface
<span class="emphasis"><em>org.apache.camel.component.routebox.strategy.RouteboxDispatchStrategy</em></span>
as shown in the example below.</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong> SimpleRouteDispatchStrategy <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">implements</strong> RouteboxDispatchStrategy {

    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">/* (non-Javadoc)
     * @see org.apache.camel.component.routebox.strategy.RouteboxDispatchStrategy#selectDestinationUri(java.util.List, org.apache.camel.Exchange)
     */</em>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> URI selectDestinationUri(List&lt;URI&gt; activeDestinations,
            Exchange exchange) {
        URI dispatchDestination = null;

        String operation = exchange.getIn().getHeader(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"ROUTE_DISPATCH_KEY"</em></strong>, String.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>);
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">for</strong> (URI destination : activeDestinations) {
            <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">if</strong> (destination.toASCIIString().equalsIgnoreCase(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"seda:"</em></strong> + operation)) {
                dispatchDestination = destination;
                <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">break</strong>;
            }
        }

        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">return</strong> dispatchDestination;
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Routebox-Step2-Launchingarouteboxconsumer"></a>Step 2: Launching a routebox consumer</h3></div></div></div><p>When creating a route consumer, note that the # entries in the
routeboxUri are matched to the created inner registry, routebuilder list
and dispatchStrategy/dispatchMap in the CamelContext Registry. Note that
all routebuilders and associated routes are launched in the routebox
created inner context</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">private</strong> String routeboxUri = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"routebox:multipleRoutes?innerRegistry=#registry&amp;routeBuilders=#routes&amp;dispatchMap=#map"</em></strong>;

<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> testRouteboxRequests() <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">throws</strong> Exception {
    CamelContext context = createCamelContext();
    template = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> DefaultProducerTemplate(context);
    template.start();

    context.addRoutes(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> RouteBuilder() {
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> configure() {
            from(routeboxUri)
                .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"log:Routes operation performed?showAll=true"</em></strong>);
        }
    });
    context.start();

    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// Now use the ProducerTemplate to send the request to the routebox</em>
    template.requestBodyAndHeader(routeboxUri, book, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"ROUTE_DISPATCH_KEY"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"addToCatalog"</em></strong>);
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Routebox-Step3-Usingarouteboxproducer"></a>Step 3: Using a routebox producer</h3></div></div></div><p>When sending requests to the routebox, it is not necessary for producers
do not need to know the inner route endpoint URI and they can simply
invoke the Routebox URI endpoint with a dispatch strategy or dispatchMap
as shown below</p><p>It is necessary to set a special exchange Header called
<span class="strong"><strong>ROUTE_DISPATCH_KEY</strong></span> (optional for Dispatch Strategy) with a key that
matches a key in the dispatch map so that the request can be sent to the
correct inner route</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:sendToStrategyBasedRoutebox"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"routebox:multipleRoutes?innerRegistry=#registry&amp;routeBuilders=#routes&amp;dispatchStrategy=#strategy"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"log:Routes operation performed?showAll=true"</em></strong>);

from (<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:sendToMapBasedRoutebox"</em></strong>)
    .setHeader(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"ROUTE_DISPATCH_KEY"</em></strong>, constant(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"addToCatalog"</em></strong>))
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"routebox:multipleRoutes?innerRegistry=#registry&amp;routeBuilders=#routes&amp;dispatchMap=#map"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"log:Routes operation performed?showAll=true"</em></strong>);</pre></div></div></div></body></html>