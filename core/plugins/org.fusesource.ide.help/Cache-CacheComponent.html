<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Cache Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="Browse-BrowseComponent.html" title="Browse Component"><link rel="next" href="CDI-CamelCDI.html" title="Camel CDI"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="Cache-CacheComponent"></a>Cache Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="Cache-CacheComponent.html#Cache-URIformat">URI format</a></span></dt><dt><span class="section"><a href="Cache-CacheComponent.html#Cache-Options">Options</a></span></dt><dt><span class="section"><a href="Cache-CacheComponent.html#Cache-SendingReceivingMessagestofromthecache">Sending/Receiving Messages to/from the cache</a></span></dt><dt><span class="section"><a href="Cache-CacheComponent.html#Cache-CacheUsageSamples">Cache Usage Samples</a></span></dt><dt><span class="section"><a href="Cache-CacheComponent.html#Cache-ManagementofEHCache">Management of EHCache</a></span></dt><dt><span class="section"><a href="Cache-CacheComponent.html#Cache-CachereplicationCamel2.8">Cache replication Camel 2.8</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel 2.1</strong></span></p><p>The <span class="strong"><strong>cache</strong></span> component enables you to perform caching operations using
EHCache as the Cache Implementation. The cache itself is created on
demand or if a cache of that name already exists then it is simply
utilized with its original settings.</p><p>This component supports producer and event based consumer endpoints.</p><p>The Cache consumer is an event based consumer and can be used to listen
and respond to specific cache activities. If you need to perform
selections from a pre-existing cache, use the processors defined for the
cache component.</p><p>Maven users will need to add the following dependency to their <code class="literal">pom.xml</code>
for this component:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-cache<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Cache-URIformat"></a>URI format</h2></div></div></div><pre class="programlisting">cache:<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">//cacheName[?options]</em></pre><p>You can append query options to the URI in the following format,
<code class="literal">?option=value&amp;option=#beanRef&amp;&#8230;&#8203;</code></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Cache-Options"></a>Options</h2></div></div></div><p>The EHCache component supports 3 options which are listed below.</p><p>{% raw %}</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="11%" class="col_2"><col width="70%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Java Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>cacheManagerFactory</p></td><td align="left" valign="top"><p><code class="literal">CacheManagerFactory</code></p></td><td align="left" valign="top"><p>To use the given CacheManagerFactory for creating the CacheManager. By default the DefaultCacheManagerFactory is used.</p></td></tr><tr><td align="left" valign="top"><p>configuration</p></td><td align="left" valign="top"><p><code class="literal">CacheConfiguration</code></p></td><td align="left" valign="top"><p>Sets the Cache configuration</p></td></tr><tr><td align="left" valign="top"><p>configurationFile</p></td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>Sets the location of the ehcache.xml file to load from classpath or file system. By default the file is loaded from classpath:ehcache.xml</p></td></tr></tbody></table></div><p>{% endraw %}</p><p>The EHCache component supports 20 endpoint options which are listed below:</p><p>{% raw %}</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="10%" class="col_2"><col width="11%" class="col_3"><col width="10%" class="col_4"><col width="50%" class="col_5"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Group</th><th align="left" valign="top">Default</th><th align="left" valign="top">Java Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>cacheName</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> Name of the cache</p></td></tr><tr><td align="left" valign="top"><p>diskExpiryThreadIntervalSeconds</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">long</code></p></td><td align="left" valign="top"><p>The number of seconds between runs of the disk expiry thread.</p></td></tr><tr><td align="left" valign="top"><p>diskPersistent</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Whether the disk store persists between restarts of the application.</p></td></tr><tr><td align="left" valign="top"><p>diskStorePath</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>This parameter is ignored. CacheManager sets it using setter injection.</p></td></tr><tr><td align="left" valign="top"><p>eternal</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Sets whether elements are eternal. If eternal timeouts are ignored and the element never expires.</p></td></tr><tr><td align="left" valign="top"><p>key</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>The default key to use. If a key is provided in the message header then the key from the header takes precedence.</p></td></tr><tr><td align="left" valign="top"><p>maxElementsInMemory</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top"><p><code class="literal">1000</code></p></td><td align="left" valign="top"><p><code class="literal">int</code></p></td><td align="left" valign="top"><p>The number of elements that may be stored in the defined cache in memory.</p></td></tr><tr><td align="left" valign="top"><p>memoryStoreEvictionPolicy</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top"><p><code class="literal">LFU</code></p></td><td align="left" valign="top"><p><code class="literal">MemoryStoreEvictionPolicy</code></p></td><td align="left" valign="top"><p>Which eviction strategy to use when maximum number of elements in memory is reached. The strategy defines which elements to be removed. LRU - Lest Recently Used LFU - Lest Frequently Used FIFO - First In First Out</p></td></tr><tr><td align="left" valign="top"><p>objectCache</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Whether to turn on allowing to store non serializable objects in the cache. If this option is enabled then overflow to disk cannot be enabled as well.</p></td></tr><tr><td align="left" valign="top"><p>operation</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>The default cache operation to use. If an operation in the message header then the operation from the header takes precedence.</p></td></tr><tr><td align="left" valign="top"><p>overflowToDisk</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top"><p><code class="literal">true</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Specifies whether cache may overflow to disk</p></td></tr><tr><td align="left" valign="top"><p>timeToIdleSeconds</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top"><p><code class="literal">300</code></p></td><td align="left" valign="top"><p><code class="literal">long</code></p></td><td align="left" valign="top"><p>The maximum amount of time between accesses before an element expires</p></td></tr><tr><td align="left" valign="top"><p>timeToLiveSeconds</p></td><td align="left" valign="top"><p>common</p></td><td align="left" valign="top"><p><code class="literal">300</code></p></td><td align="left" valign="top"><p><code class="literal">long</code></p></td><td align="left" valign="top"><p>The maximum time between creation time and when an element expires. Is used only if the element is not eternal</p></td></tr><tr><td align="left" valign="top"><p>bridgeErrorHandler</p></td><td align="left" valign="top"><p>consumer</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Allows for bridging the consumer to the Camel routing Error Handler which mean any exceptions occurred while the consumer is trying to pickup incoming messages or the likes will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions that will be logged at WARN/ERROR level and ignored.</p></td></tr><tr><td align="left" valign="top"><p>exceptionHandler</p></td><td align="left" valign="top"><p>consumer (advanced)</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">ExceptionHandler</code></p></td><td align="left" valign="top"><p>To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this options is not in use. By default the consumer will deal with exceptions that will be logged at WARN/ERROR level and ignored.</p></td></tr><tr><td align="left" valign="top"><p>exchangePattern</p></td><td align="left" valign="top"><p>consumer (advanced)</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">ExchangePattern</code></p></td><td align="left" valign="top"><p>Sets the exchange pattern when the consumer creates an exchange.</p></td></tr><tr><td align="left" valign="top"><p>cacheLoaderRegistry</p></td><td align="left" valign="top"><p>advanced</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">CacheLoaderRegistry</code></p></td><td align="left" valign="top"><p>To configure cache loader using the CacheLoaderRegistry</p></td></tr><tr><td align="left" valign="top"><p>cacheManagerFactory</p></td><td align="left" valign="top"><p>advanced</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">CacheManagerFactory</code></p></td><td align="left" valign="top"><p>To use a custom CacheManagerFactory for creating the CacheManager to be used by this endpoint. By default the CacheManagerFactory configured on the component is used.</p></td></tr><tr><td align="left" valign="top"><p>eventListenerRegistry</p></td><td align="left" valign="top"><p>advanced</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">CacheEventListenerRegistry</code></p></td><td align="left" valign="top"><p>To configure event listeners using the CacheEventListenerRegistry</p></td></tr><tr><td align="left" valign="top"><p>synchronous</p></td><td align="left" valign="top"><p>advanced</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">boolean</code></p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used or Camel is allowed to use asynchronous processing (if supported).</p></td></tr></tbody></table></div><p>{% endraw %}</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Cache-SendingReceivingMessagestofromthecache"></a>Sending/Receiving Messages to/from the cache</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="Cache-CacheComponent.html#Cache-MessageHeadersuptoCamel2.7">Message Headers up to Camel 2.7</a></span></dt><dt><span class="section"><a href="Cache-CacheComponent.html#Cache-MessageHeadersCamel2.8">Message Headers Camel 2.8+</a></span></dt><dt><span class="section"><a href="Cache-CacheComponent.html#Cache-CacheProducer">Cache Producer</a></span></dt><dt><span class="section"><a href="Cache-CacheComponent.html#Cache-CacheConsumer">Cache Consumer</a></span></dt><dt><span class="section"><a href="Cache-CacheComponent.html#Cache-CacheProcessors">Cache Processors</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Cache-MessageHeadersuptoCamel2.7"></a>Message Headers up to Camel 2.7</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="20%" class="col_1"><col width="80%" class="col_2"></colgroup><thead><tr><th align="left" valign="top">Header</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">CACHE_OPERATION</code></p></td><td align="left" valign="top"><p>The operation to be performed on the cache. Valid options are</p><p>* GET
* CHECK
* ADD
* UPDATE
* DELETE
* DELETEALL
 <code class="literal">GET</code> and <code class="literal">CHECK</code> requires <span class="strong"><strong>Camel 2.3</strong></span> onwards.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CACHE_KEY</code></p></td><td align="left" valign="top"><p>The cache key used to store the Message in the cache. The cache key is
optional if the CACHE_OPERATION is DELETEALL</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Cache-MessageHeadersCamel2.8"></a>Message Headers Camel 2.8+</h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Header changes in Camel 2.8</p><p>The header names and supported values have changed to be prefixed with
'CamelCache' and use mixed case. This makes them easier to identify and
keep separate from other headers. The CacheConstants variable names
remain unchanged, just their values have been changed. Also, these
headers are now removed from the exchange after the cache operation is
performed.</p></td></tr></table></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="20%" class="col_1"><col width="80%" class="col_2"></colgroup><thead><tr><th align="left" valign="top">Header</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">CamelCacheOperation</code></p></td><td align="left" valign="top"><p>The operation to be performed on the cache. The valid options are</p><p>* CamelCacheGet
* CamelCacheCheck
* CamelCacheAdd
* CamelCacheUpdate
* CamelCacheDelete
* CamelCacheDeleteAll</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelCacheKey</code></p></td><td align="left" valign="top"><p>The cache key used to store the Message in the cache. The cache key is
optional if the CamelCacheOperation is CamelCacheDeleteAll</p></td></tr></tbody></table></div><p>The <code class="literal">CamelCacheAdd</code> and <code class="literal">CamelCacheUpdate</code> operations support additional
headers:</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="10%" class="col_2"><col width="80%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Header</th><th align="left" valign="top">Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">CamelCacheTimeToLive</code></p></td><td align="left" valign="top"><p><code class="literal">Integer</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Camel 2.11:</strong></span> Time to live in seconds.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelCacheTimeToIdle</code></p></td><td align="left" valign="top"><p><code class="literal">Integer</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Camel 2.11:</strong></span> Time to idle in seconds.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelCacheEternal</code></p></td><td align="left" valign="top"><p><code class="literal">Boolean</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Camel 2.11:</strong></span> Whether the content is eternal.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Cache-CacheProducer"></a>Cache Producer</h3></div></div></div><p>Sending data to the cache involves the ability to direct payloads in
exchanges to be stored in a pre-existing or created-on-demand cache. The
mechanics of doing this involve</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">setting the Message Exchange Headers shown above.</li><li class="listitem">ensuring that the Message Exchange Body contains the message directed
to the cache</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Cache-CacheConsumer"></a>Cache Consumer</h3></div></div></div><p>Receiving data from the cache involves the ability of the CacheConsumer
to listen on a pre-existing or created-on-demand Cache using an event
Listener and receive automatic notifications when any cache activity
take place (i.e
CamelCacheGet/CamelCacheUpdate/CamelCacheDelete/CamelCacheDeleteAll).
Upon such an activity taking place</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">an exchange containing Message Exchange Headers and a Message Exchange
Body containing the just added/updated payload is placed and sent.</li><li class="listitem">in case of a CamelCacheDeleteAll operation, the Message Exchange
Header CamelCacheKey and the Message Exchange Body are not populated.</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Cache-CacheProcessors"></a>Cache Processors</h3></div></div></div><p>There are a set of nice processors with the ability to perform cache
lookups and selectively replace payload content at the</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">body</li><li class="listitem">token</li><li class="listitem">xpath level</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Cache-CacheUsageSamples"></a>Cache Usage Samples</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="Cache-CacheComponent.html#Cache-Example1-Configuringthecache">Example 1: Configuring the cache</a></span></dt><dt><span class="section"><a href="Cache-CacheComponent.html#Cache-Example2-Addingkeystothecache">Example 2: Adding keys to the cache</a></span></dt><dt><span class="section"><a href="Cache-CacheComponent.html#Cache-Example2-Updatingexistingkeysinacache">Example 2: Updating existing keys in a cache</a></span></dt><dt><span class="section"><a href="Cache-CacheComponent.html#Cache-Example3-Deletingexistingkeysinacache">Example 3: Deleting existing keys in a cache</a></span></dt><dt><span class="section"><a href="Cache-CacheComponent.html#Cache-Example4-Deletingallexistingkeysinacache">Example 4: Deleting all existing keys in a cache</a></span></dt><dt><span class="section"><a href="Cache-CacheComponent.html#Cache-Example5-NotifyinganychangesregisteringinaCachetoProcessorsandotherProducers">Example 5: Notifying any changes registering in a Cache to Processors and other Producers</a></span></dt><dt><span class="section"><a href="Cache-CacheComponent.html#Cache-Example6-UsingProcessorstoselectivelyreplacepayloadwithcachevalues">Example 6: Using Processors to selectively replace payload with cache values</a></span></dt><dt><span class="section"><a href="Cache-CacheComponent.html#Cache-Example7-GettinganentryfromtheCache">Example 7: Getting an entry from the Cache</a></span></dt><dt><span class="section"><a href="Cache-CacheComponent.html#Cache-Example8-CheckingforanentryintheCache">Example 8: Checking for an entry in the Cache</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Cache-Example1-Configuringthecache"></a>Example 1: Configuring the cache</h3></div></div></div><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cache://MyApplicationCache"</em></strong> +
          <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"?maxElementsInMemory=1000"</em></strong> +
          <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"&amp;memoryStoreEvictionPolicy="</em></strong> +
              <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"MemoryStoreEvictionPolicy.LFU"</em></strong> +
          <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"&amp;overflowToDisk=true"</em></strong> +
          <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"&amp;eternal=true"</em></strong> +
          <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"&amp;timeToLiveSeconds=300"</em></strong> +
          <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"&amp;timeToIdleSeconds=true"</em></strong> +
          <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"&amp;diskPersistent=true"</em></strong> +
          <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"&amp;diskExpiryThreadIntervalSeconds=300"</em></strong>)</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Cache-Example2-Addingkeystothecache"></a>Example 2: Adding keys to the cache</h3></div></div></div><pre class="programlisting">RouteBuilder builder = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> RouteBuilder() {
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> configure() {
     from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>)
     .setHeader(CacheConstants.CACHE_OPERATION, constant(CacheConstants.CACHE_OPERATION_ADD))
     .setHeader(CacheConstants.CACHE_KEY, constant(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Ralph_Waldo_Emerson"</em></strong>))
     .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cache://TestCache1"</em></strong>)
   }
};</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Cache-Example2-Updatingexistingkeysinacache"></a>Example 2: Updating existing keys in a cache</h3></div></div></div><pre class="programlisting">RouteBuilder builder = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> RouteBuilder() {
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> configure() {
     from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>)
     .setHeader(CacheConstants.CACHE_OPERATION, constant(CacheConstants.CACHE_OPERATION_UPDATE))
     .setHeader(CacheConstants.CACHE_KEY, constant(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Ralph_Waldo_Emerson"</em></strong>))
     .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cache://TestCache1"</em></strong>)
   }
};</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Cache-Example3-Deletingexistingkeysinacache"></a>Example 3: Deleting existing keys in a cache</h3></div></div></div><pre class="programlisting">RouteBuilder builder = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> RouteBuilder() {
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> configure() {
     from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>)
     .setHeader(CacheConstants.CACHE_OPERATION, constant(CacheConstants.CACHE_DELETE))
     .setHeader(CacheConstants.CACHE_KEY<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">", constant("</em></strong>Ralph_Waldo_Emerson<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"))
</em></strong>     .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cache://TestCache1"</em></strong>)
   }
};</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Cache-Example4-Deletingallexistingkeysinacache"></a>Example 4: Deleting all existing keys in a cache</h3></div></div></div><pre class="programlisting">RouteBuilder builder = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> RouteBuilder() {
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> configure() {
     from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>)
     .setHeader(CacheConstants.CACHE_OPERATION, constant(CacheConstants.CACHE_DELETEALL))
     .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cache://TestCache1"</em></strong>);
    }
};</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Cache-Example5-NotifyinganychangesregisteringinaCachetoProcessorsandotherProducers"></a>Example 5: Notifying any changes registering in a Cache to Processors and other Producers</h3></div></div></div><pre class="programlisting">RouteBuilder builder = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> RouteBuilder() {
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> configure() {
     from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cache://TestCache1"</em></strong>)
     .process(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> Processor() {
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> process(Exchange exchange)
               <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">throws</strong> Exception {
           String operation = (String) exchange.getIn().getHeader(CacheConstants.CACHE_OPERATION);
           String key = (String) exchange.getIn().getHeader(CacheConstants.CACHE_KEY);
           Object body = exchange.getIn().getBody();
           <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// Do something</em>
        }
     })
   }
};</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Cache-Example6-UsingProcessorstoselectivelyreplacepayloadwithcachevalues"></a>Example 6: Using Processors to selectively replace payload with cache values</h3></div></div></div><pre class="programlisting">RouteBuilder builder = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> RouteBuilder() {
   <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> configure() {
     <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">//Message Body Replacer</em>
     from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cache://TestCache1"</em></strong>)
     .filter(header(CacheConstants.CACHE_KEY).isEqualTo(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"greeting"</em></strong>))
     .process(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> CacheBasedMessageBodyReplacer(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cache://TestCache1"</em></strong>,<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"farewell"</em></strong>))
     .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:next"</em></strong>);

    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">//Message Token replacer</em>
    from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cache://TestCache1"</em></strong>)
    .filter(header(CacheConstants.CACHE_KEY).isEqualTo(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"quote"</em></strong>))
    .process(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> CacheBasedTokenReplacer(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cache://TestCache1"</em></strong>,<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"novel"</em></strong>,<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"#novel#"</em></strong>))
    .process(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> CacheBasedTokenReplacer(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cache://TestCache1"</em></strong>,<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"author"</em></strong>,<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"#author#"</em></strong>))
    .process(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> CacheBasedTokenReplacer(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cache://TestCache1"</em></strong>,<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"number"</em></strong>,<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"#number#"</em></strong>))
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:next"</em></strong>);

    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">//Message XPath replacer</em>
    from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cache://TestCache1"</em></strong>).
    .filter(header(CacheConstants.CACHE_KEY).isEqualTo(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"XML_FRAGMENT"</em></strong>))
    .process(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> CacheBasedXPathReplacer(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cache://TestCache1"</em></strong>,<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"book1"</em></strong>,<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"/books/book1"</em></strong>))
    .process (<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> CacheBasedXPathReplacer(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cache://TestCache1"</em></strong>,<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"book2"</em></strong>,<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"/books/book2"</em></strong>))
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:next"</em></strong>);
   }
};</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Cache-Example7-GettinganentryfromtheCache"></a>Example 7: Getting an entry from the Cache</h3></div></div></div><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>)
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// Prepare headers</em>
    .setHeader(CacheConstants.CACHE_OPERATION, constant(CacheConstants.CACHE_OPERATION_GET))
    .setHeader(CacheConstants.CACHE_KEY, constant(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Ralph_Waldo_Emerson"</em></strong>)).
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cache://TestCache1"</em></strong>).
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// Check if entry was not found</em>
    .choice().when(header(CacheConstants.CACHE_ELEMENT_WAS_FOUND).isNull()).
        <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// If not found, get the payload and put it to cache</em>
        .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cxf:bean:someHeavyweightOperation"</em></strong>).
        .setHeader(CacheConstants.CACHE_OPERATION, constant(CacheConstants.CACHE_OPERATION_ADD))
        .setHeader(CacheConstants.CACHE_KEY, constant(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Ralph_Waldo_Emerson"</em></strong>))
        .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cache://TestCache1"</em></strong>)
    .end()
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:nextPhase"</em></strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Cache-Example8-CheckingforanentryintheCache"></a>Example 8: Checking for an entry in the Cache</h3></div></div></div><p>Note: The CHECK command tests existence of an entry in the cache but
doesn&#8217;t place a message in the body.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>)
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// Prepare headers</em>
    .setHeader(CacheConstants.CACHE_OPERATION, constant(CacheConstants.CACHE_OPERATION_CHECK))
    .setHeader(CacheConstants.CACHE_KEY, constant(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Ralph_Waldo_Emerson"</em></strong>)).
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cache://TestCache1"</em></strong>).
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// Check if entry was not found</em>
    .choice().when(header(CacheConstants.CACHE_ELEMENT_WAS_FOUND).isNull()).
        <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// If not found, get the payload and put it to cache</em>
        .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cxf:bean:someHeavyweightOperation"</em></strong>).
        .setHeader(CacheConstants.CACHE_OPERATION, constant(CacheConstants.CACHE_OPERATION_ADD))
        .setHeader(CacheConstants.CACHE_KEY, constant(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Ralph_Waldo_Emerson"</em></strong>))
        .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cache://TestCache1"</em></strong>)
    .end();</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Cache-ManagementofEHCache"></a>Management of EHCache</h2></div></div></div><p><a class="link" href="http://ehcache.org/" target="_top">EHCache</a> has its own statistics and management from
<a class="link" href="camel-jmx.html" target="_top">JMX</a>.</p><p>Here&#8217;s a snippet on how to expose them via JMX in a Spring application
context:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"ehCacheManagementService"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"net.sf.ehcache.management.ManagementService"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">init-method</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"init"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">lazy-init</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"false"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;constructor-arg&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"net.sf.ehcache.CacheManager"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">factory-method</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"getInstance"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/constructor-arg&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;constructor-arg&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.springframework.jmx.support.JmxUtils"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">factory-method</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"locateMBeanServer"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/constructor-arg&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;constructor-arg</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"true"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;constructor-arg</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"true"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;constructor-arg</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"true"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;constructor-arg</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"true"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/bean&gt;</strong></pre><p>Of course you can do the same thing in straight Java:</p><pre class="programlisting">ManagementService.registerMBeans(CacheManager.getInstance(), mbeanServer, true, true, true, true);</pre><p>You can get cache hits, misses, in-memory hits, disk hits, size stats
this way. You can also change CacheConfiguration parameters on the fly.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Cache-CachereplicationCamel2.8"></a>Cache replication Camel 2.8</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="Cache-CacheComponent.html#Cache-Example-JMScachereplication">Example: JMS cache replication</a></span></dt></dl></div><p>The Camel Cache component is able to distribute a cache across server
nodes using several different replication mechanisms including: RMI,
JGroups, JMS and Cache Server.</p><p>There are two different ways to make it work:</p><p><span class="strong"><strong>1.</strong></span> You can configure <code class="literal">ehcache.xml</code> manually</p><p>OR</p><p><span class="strong"><strong>2.</strong></span> You can configure these three options:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">cacheManagerFactory</li><li class="listitem">eventListenerRegistry</li><li class="listitem">cacheLoaderRegistry</li></ul></div><p>Configuring Camel Cache replication using the first option is a bit of
hard work as you have to configure all caches separately. So in a
situation when the all names of caches are not known, using
<code class="literal">ehcache.xml</code> is not a good idea.</p><p>The second option is much better when you want to use many different
caches as you do not need to define options per cache. This is because
replication options are set per <code class="literal">CacheManager</code> and per <code class="literal">CacheEndpoint</code>.
Also it is the only way when cache names are not know at the development
phase.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>It might be useful to read the <a class="link" href="http://ehcache.org/documentation" target="_top">EHCache
manual</a> to get a better understanding of the Camel Cache replication
mechanism.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Cache-Example-JMScachereplication"></a>Example: JMS cache replication</h3></div></div></div><p>JMS replication is the most powerful and secured replication method.
Used together with Camel Cache replication makes it also rather
simple. An example is available on <a class="link" href="cachereplicationjmsexample.html" target="_top">a
separate page</a>.</p></div></div></div></body></html>