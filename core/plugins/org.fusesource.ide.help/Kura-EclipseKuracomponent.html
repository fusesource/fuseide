<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Kura Eclipse Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="Kubernetes-KubernetesComponent.html" title="Kubernetes Component"><link rel="next" href="Language-Language.html" title="Language Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="Kura-EclipseKuracomponent"></a>Kura Eclipse Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="Kura-EclipseKuracomponent.html#Kura-KuraRouteractivator">KuraRouter activator</a></span></dt><dt><span class="section"><a href="Kura-EclipseKuracomponent.html#Kura-DeployingKuraRouter">Deploying KuraRouter</a></span></dt><dt><span class="section"><a href="Kura-EclipseKuracomponent.html#Kura-KuraRouterutilities">KuraRouter utilities&nbsp;</a></span></dt><dt><span class="section"><a href="Kura-EclipseKuracomponent.html#Kura-KuraRouteractivatorcallbacks">KuraRouter activator callbacks</a></span></dt><dt><span class="section"><a href="Kura-EclipseKuracomponent.html#Kura-LoadingXMLroutesfromConfigurationAdmin">Loading XML routes from ConfigurationAdmin</a></span></dt><dt><span class="section"><a href="Kura-EclipseKuracomponent.html#Kura-DeployingKurarouterasadeclarativeOSGiservice">Deploying Kura router as a declarative OSGi service</a></span></dt><dt><span class="section"><a href="Kura-EclipseKuracomponent.html#Kura-SeeAlso">See Also</a></span></dt></dl></div><p>INFO: Kura component is available starting from Camel <span class="strong"><strong>2.15</strong></span>.</p><p>This documentation page covers the integration options of Camel with the
<a class="link" href="https://eclipse.org/kura/" target="_top">Eclipse Kura</a> M2M gateway. The common reason
to deploy Camel routes into the Eclipse Kura is to provide enterprise
integration patterns and Camel components to the messaging M2M gateway.
For example you might want to install Kura on Raspberry PI, then&nbsp;read
temperature from the sensor attached to that Raspberry PI using Kura
services and finally forward the current temperature value to your data
center service using Camel EIP and components.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Kura-KuraRouteractivator"></a>KuraRouter activator</h2></div></div></div><p>Bundles deployed to the Eclipse&nbsp;Kura&nbsp;are usually
<a class="link" href="http://eclipse.github.io/kura/doc/hello-example.html#create-java-class" target="_top">developed
as bundle activators</a>. So the easiest way to deploy Apache Camel routes
into the Kura is to create an OSGi bundle containing the class extending
<code class="literal">org.apache.camel.kura.KuraRouter</code> class:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong> MyKuraRouter <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">extends</strong> KuraRouter {

  <em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Override</span></em>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> configure() <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">throws</strong> Exception {
    from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"timer:trigger"</em></strong>).
      to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"netty-http:http://app.mydatacenter.com/api"</em></strong>);
  }

}</pre><p>Keep in mind that <code class="literal">KuraRouter</code> implements
the&nbsp;<code class="literal">org.osgi.framework.BundleActivator</code>&nbsp;interface, so you need to
register its&nbsp;<code class="literal">start</code>&nbsp;and&nbsp;<code class="literal">stop</code>&nbsp;lifecycle methods
while&nbsp;<a class="link" href="http://eclipse.github.io/kura/doc/hello-example.html#create-component-class" target="_top">creating
Kura bundle component class</a>.</p><p>Kura router starts its own OSGi-aware <code class="literal">CamelContext</code>. It means that for
every class extending <code class="literal">KuraRouter</code>, there will be a dedicated
<code class="literal">CamelContext</code> instance. Ideally we recommend to deploy one <code class="literal">KuraRouter</code>
per OSGi bundle.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Kura-DeployingKuraRouter"></a>Deploying KuraRouter</h2></div></div></div><p>Bundle containing your Kura router class should import the following
packages in the OSGi manifest:</p><pre class="programlisting">Import-Package: org.osgi.framework;version="1.3.0",
  org.slf4j;version="1.6.4",
  org.apache.camel,org.apache.camel.impl,org.apache.camel.core.osgi,org.apache.camel.builder,org.apache.camel.model,
  org.apache.camel.component.kura</pre><p>Keep in mind that you don&#8217;t have to import every Camel component bundle
you plan to use in your routes, as Camel components are resolved as the
services on the runtime level.</p><p>Before you deploy your router bundle, be sure that you have deployed
(and started) the following Camel core bundles (using Kura GoGo
shell)&#8230;&#8203;</p><pre class="programlisting">install file:///home/user/.m2/repository/org/apache/camel/camel-core/2.15.0/camel-core-2.15.0.jar
start <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camel-core-bundle-id&gt;</strong>
install file:///home/user/.m2/repository/org/apache/camel/camel-core-osgi/2.15.0/camel-core-osgi-2.15.0.jar
start <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camel-core-osgi-bundle-id&gt;</strong>
install file:///home/user/.m2/repository/org/apache/camel/camel-kura/2.15.0/camel-kura-2.15.0.jar
start <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camel-kura-bundle-id&gt;</strong></pre><p>&#8230;&#8203;and all the components you plan to use in your routes:</p><pre class="programlisting">install file:///home/user/.m2/repository/org/apache/camel/camel-stream/2.15.0/camel-stream-2.15.0.jar
start <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camel-stream-bundle-id&gt;</strong></pre><p>Then finally deploy your router bundle:</p><pre class="programlisting">install file:///home/user/.m2/repository/com/example/myrouter/1.0/myrouter-1.0.jar
start <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;your-bundle-id&gt;</strong></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Kura-KuraRouterutilities"></a>KuraRouter utilities&nbsp;</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="Kura-EclipseKuracomponent.html#Kura-SLF4Jlogger">SLF4J logger</a></span></dt><dt><span class="section"><a href="Kura-EclipseKuracomponent.html#Kura-BundleContext">BundleContext</a></span></dt><dt><span class="section"><a href="Kura-EclipseKuracomponent.html#Kura-CamelContext">CamelContext</a></span></dt><dt><span class="section"><a href="Kura-EclipseKuracomponent.html#Kura-ProducerTemplate">ProducerTemplate</a></span></dt><dt><span class="section"><a href="Kura-EclipseKuracomponent.html#Kura-ConsumerTemplate">ConsumerTemplate</a></span></dt><dt><span class="section"><a href="Kura-EclipseKuracomponent.html#Kura-OSGiserviceresolver">OSGi service resolver</a></span></dt></dl></div><p>&nbsp;Kura router base class provides many useful utilities. This section
explores each of them.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Kura-SLF4Jlogger"></a>SLF4J logger</h3></div></div></div><p>Kura uses SLF4J facade for logging purposes. Protected member <code class="literal">log</code>
returns SLF4J logger instance associated with the given Kura router.</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong> MyKuraRouter <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">extends</strong> KuraRouter {

    <em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Override</span></em>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> configure() <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">throws</strong> Exception {
        log.info(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Configuring Camel routes!"</em></strong>);
        ...
    }

}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Kura-BundleContext"></a>BundleContext</h3></div></div></div><p>Protected member <code class="literal">bundleContext</code> returns bundle context associated with
the given Kura router.</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong> MyKuraRouter <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">extends</strong> KuraRouter {

    <em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Override</span></em>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> configure() <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">throws</strong> Exception {
        ServiceReference&lt;MyService&gt; serviceRef = bundleContext.getServiceReference(LogService.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>.getName());
        MyService myService = bundleContext.getService(serviceRef);
        ...
    }

}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Kura-CamelContext"></a>CamelContext</h3></div></div></div><p>Protected member <code class="literal">camelContext</code> is the <code class="literal">CamelContext</code> associated with
the given Kura router.</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong> MyKuraRouter <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">extends</strong> KuraRouter {

    <em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Override</span></em>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> configure() <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">throws</strong> Exception {
        camelContext.getStatus();
        ...
    }

}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Kura-ProducerTemplate"></a>ProducerTemplate</h3></div></div></div><p>Protected member&nbsp;<code class="literal">producerTemplate</code>&nbsp;is the&nbsp;<code class="literal">ProducerTemplate</code>&nbsp;instance
associated with the given Camel context.</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong> MyKuraRouter <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">extends</strong> KuraRouter {

    <em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Override</span></em>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> configure() <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">throws</strong> Exception {
        producerTemplate.sendBody(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"jms:temperature"</em></strong>, <span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">22.0</span>);
        ...
    }

}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Kura-ConsumerTemplate"></a>ConsumerTemplate</h3></div></div></div><p>Protected member&nbsp;<code class="literal">consumerTemplate</code>&nbsp;is the&nbsp;<code class="literal">ConsumerTemplate</code>&nbsp;instance
associated with the given Camel context.</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong> MyKuraRouter <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">extends</strong> KuraRouter {

    <em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Override</span></em>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> configure() <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">throws</strong> Exception {
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">double</strong> currentTemperature = producerTemplate.receiveBody(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"jms:temperature"</em></strong>, Double.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>);
        ...
    }

}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Kura-OSGiserviceresolver"></a>OSGi service resolver</h3></div></div></div><p>OSGi service resolver (<code class="literal">service(Class&lt;T&gt; serviceType)</code>) can be used to
easily retrieve service by type from the OSGi bundle context.</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong> MyKuraRouter <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">extends</strong> KuraRouter {

    <em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Override</span></em>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> configure() <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">throws</strong> Exception {
        MyService myService = service(MyService.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>);
        ...
    }

}</pre><p>If service is not found, a <code class="literal">null</code> value is returned. If you want your
application to fail if the service is not available, use
<code class="literal">requiredService(Class)</code> method instead. The <code class="literal">requiredService</code>&nbsp;throws
<code class="literal">IllegalStateException</code> if a service cannot be found.</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong> MyKuraRouter <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">extends</strong> KuraRouter {

    <em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Override</span></em>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> configure() <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">throws</strong> Exception {
        MyService myService = requiredService(MyService.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>);
        ...
    }

}</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Kura-KuraRouteractivatorcallbacks"></a>KuraRouter activator callbacks</h2></div></div></div><p>Kura router comes with the lifecycle callbacks that can be used to
customize the way the Camel router works. For example to configure the
<code class="literal">CamelContext</code> instance associated with the router just before the
former is started, override <code class="literal">beforeStart</code> method of the <code class="literal">KuraRouter</code>
class:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong> MyKuraRouter <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">extends</strong> KuraRouter {
&nbsp;
  ...

  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">protected</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> beforeStart(CamelContext camelContext) {
    OsgiDefaultCamelContext osgiContext = (OsgiCamelContext) camelContext;
    osgiContext.setName(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"NameOfTheRouter"</em></strong>);
  }

}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Kura-LoadingXMLroutesfromConfigurationAdmin"></a>Loading XML routes from ConfigurationAdmin</h2></div></div></div><p>Sometimes it is desired to read the XML definition of the routes from
the server configuration. This a common scenario for IoT gateways where
over-the-air redeployment cost may be significant. To address this
requirement each <code class="literal">KuraRouter</code> looks for the
<code class="literal">kura.camel.BUNDLE-SYMBOLIC-NAME.route</code> property from the <code class="literal">kura.camel</code>
PID using the OSGi ConfigurationAdmin. This approach allows you to
define Camel XML routes file per deployed <code class="literal">KuraRouter</code>. In order to
update a route, just edit an appropriate configuration property and
restart a bundle associated with it. The content of
the&nbsp;<code class="literal">kura.camel.BUNDLE-SYMBOLIC-NAME.route</code>&nbsp;property is expected to be
Camel XML route file, for example:</p><pre class="programlisting">&lt;routes xmlns=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"http://camel.apache.org/schema/spring"</em></strong>&gt;
    &lt;route id=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"loaded"</em></strong>&gt;
        &lt;from uri=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:bar"</em></strong>/&gt;
        &lt;to uri=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:bar"</em></strong>/&gt;
    &lt;/route&gt;
&lt;/routes&gt;</pre><p>&nbsp;</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Kura-DeployingKurarouterasadeclarativeOSGiservice"></a>Deploying Kura router as a declarative OSGi service</h2></div></div></div><p>If you would like to deploy your Kura router as a declarative OSGi
service, you can use <code class="literal">activate</code> and <code class="literal">deactivate</code> methods provided by
<code class="literal">KuraRouter</code>.</p><pre class="programlisting">&lt;scr:component name=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"org.eclipse.kura.example.camel.MyKuraRouter"</em></strong> activate=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"activate"</em></strong> deactivate=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"deactivate"</em></strong> enabled=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"true"</em></strong> immediate=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"true"</em></strong>&gt;
  &lt;implementation <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"org.eclipse.kura.example.camel.MyKuraRouter"</em></strong>/&gt;
&lt;/scr:component&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Kura-SeeAlso"></a>See Also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="configuring-camel.html" target="_top">Configuring Camel</a></li><li class="listitem"><a class="link" href="component.html" target="_top">Component</a></li><li class="listitem"><a class="link" href="endpoint.html" target="_top">Endpoint</a></li><li class="listitem"><a class="link" href="getting-started.html" target="_top">Getting Started</a></li></ul></div></div></div></body></html>