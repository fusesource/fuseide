<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>To Add Another Route to the CBR Routing Context</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="RiderEclipseHelp.html" title="Part&nbsp;I.&nbsp;Tooling Tutorials"><link rel="prev" href="RiderTutorialCBR.html" title="To Add a Content-Based Router"><link rel="next" href="RiderTutorialDebug.html" title="To Debug a Routing Context"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="RiderTutorialAddRoute"></a>To Add Another Route to the CBR Routing Context</h2></div></div></div><p>This tutorial shows you how to add a second route to the
<code class="literal">blueprint.xml</code> file in the <code class="literal">CBRroute</code>
project. The second route:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Takes messages directly from the terminal end of the first route&#8217;s
<span class="strong"><strong>otherwise</strong></span> branch</li><li class="listitem">Sorts the messages according to customers' country</li><li class="listitem">Sends each message to the corresponding <span class="strong"><strong>country</strong></span>
folder in the <code class="literal">CBRroute/target/messages</code>
folder.</li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_goals_4"></a>Goals</h2></div></div></div><p>In this tutorial you will:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Reconfigure the existing route for direct connection to a second route</li><li class="listitem">Add a second route to your <code class="literal">&lt;camelContext&gt;</code></li><li class="listitem">Configure the new route to take messages directly from the otherwise branch of
the first route</li><li class="listitem">Add a content-based router to the new route</li><li class="listitem">Add and configure a message header, logging, and target destination to each
output branch of the new route&#8217;s content-based router</li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_prerequisites_5"></a>Prerequisites</h2></div></div></div><p>To complete this tutorial you will need the <span class="strong"><strong>CBRroute</strong></span> project you modified in <a class="xref" href="RiderTutorialCBR.html" title="To Add a Content-Based Router"><i>To Add a Content-Based Router</i></a>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you skipped any tutorial after <a class="xref" href="RiderTutorialCreate.html" title="To Create a New Route"><i>To Create a New Route</i></a>, you can use the
prefabricated <code class="literal">blueprint5.xml</code> file to work through this tutorial
(for details, see <a class="xref" href="RiderTutorialResources.html" title="Using the Fuse Tooling Resource Files"><i>Using the Fuse Tooling Resource Files</i></a>).</p></td></tr></table></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_reconfiguring_the_existing_route_for_direct_connection"></a>Reconfiguring the existing route for direct connection</h2></div></div></div><p>To configure the existing route for direct connection with the new
route:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Open your <code class="literal">CBRroute/src/main/resources/OSGI-INF/blueprint/blueprint.xml</code> in
the route editor.</li><li class="listitem">On the canvas, select the <code class="literal">Route_route1</code> container to open its properties
in the <code class="literal">Properties</code> view.</li><li class="listitem">Scroll down to the <code class="literal">Shutdown Route</code> property and enter
<code class="literal">Default</code>.</li><li class="listitem">On the canvas, select the terminal file node <code class="literal">To_Valid</code> to
display its properties in the <code class="literal">Properties</code> view.</li><li class="listitem">In the <code class="literal">Uri</code> field, delete the existing
text, and then enter
<code class="literal">direct:OrderFulfillment</code>.</li><li class="listitem">In the <code class="literal">Id</code> field, enter
<code class="literal">_Fulfill</code>.</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Instead of repurposing the existing <code class="literal">To_Valid</code> terminal file node, you
could have replaced it with a <span class="guimenu">Components</span> &gt; <span class="guisubmenu"></span> &gt; <span class="guisubmenu"></span> &gt; <span class="guisubmenu"><code class="literal">Direct</code></span> &gt; <span class="guimenuitem"></span> component, configuring it with the same property values as the
repurposed <code class="literal">To_Valid</code> node.</p></td></tr></table></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_adding_the_second_route"></a>Adding the second route</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The route editor displays each route in a multiroute routing context in its own
<code class="literal">Route_</code> container.</p></td></tr></table></div><p>To add a route to the routing context:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">In the <code class="literal">Palette</code>, open the <code class="literal">Routing</code>
drawer and select the <code class="literal">Route</code> (
<span class="inlinemediaobject"><img src="images/route.png" alt="Route icon"></span>) pattern.</li><li class="listitem"><p class="simpara">Drag the <code class="literal">Route</code> pattern to the canvas and drop it next to the
<code class="literal">Route_route1</code> container:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutRte2DropOnCanvas.png" alt="tutRte2DropOnCanvas"></div></div><p class="simpara">The <code class="literal">Route</code> pattern becomes the
<code class="literal">Route_route2</code> container node on the canvas.</p></li><li class="listitem">Click the <code class="literal">Route_route2</code> container node to display its
properties in the <code class="literal">Properties</code> view.</li><li class="listitem">Leave each of the properties as is.</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>As your multiroute routing context grows in complexity, you may want to focus the route editor
on an individual route while you work on it. To do so, in <code class="literal">Project
Explorer</code>, double-click the route you want the route editor to display
on the canvas; for example <code class="literal">Route_route2</code>:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutProjExSwitchRtesOnCanvas.png" alt="tutProjExSwitchRtesOnCanvas"></div></div><p>To display all routes in the routing context on the canvas, double-click the
project&#8217;s <code class="literal">.xml</code> context file entry
(<code class="literal">src/main/resources/OSGI-INF/&#8230;&#8203;</code>) at
the top of the <code class="literal">Camel Contexts</code> folder.</p></td></tr></table></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_building_and_configuring_the_usa_branch_of_the_second_route"></a>Building and configuring the USA branch of the second route</h2></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">In the <code class="literal">Palette</code>, open the <code class="literal">Components</code>
drawer and drag a <code class="literal">Direct</code> component (
<span class="inlinemediaobject"><img src="images/endpoint.png" alt="Direct icon"></span>) to the canvas and drop it in the
<code class="literal">Route_route2</code> container:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2From2Add.png" alt="tutCBRrte2From2Add"></div></div><p class="simpara">The <code class="literal">Route_route2</code> container expands to accommodate the
<code class="literal">From_from2</code> node.</p></li><li class="listitem"><p class="simpara">On the canvas, select the <code class="literal">From_from2</code> node to open its properties in the
<code class="literal">Properties</code> view:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2From2Props.png" alt="tutCBRrte2From2Props"></div></div></li><li class="listitem">In the <code class="literal">Uri</code> field, replace <span class="emphasis"><em>name</em></span>
(following <code class="literal">direct:</code>) with <code class="literal">OrderFulfillment</code>, and in the
<code class="literal">Id</code> field, enter
<code class="literal">_direct:OrderFulfillment</code>.</li><li class="listitem"><p class="simpara">In the <code class="literal">Palette</code>, open the <code class="literal">Routing</code>
drawer and drag a <code class="literal">Choice</code> (
<span class="inlinemediaobject"><img src="images/choice.png" alt="Choice icon"></span>) pattern to the canvas and drop it in the
<code class="literal">Route_route2</code> container.</p><p class="simpara">The <code class="literal">Route_route2</code> container expands to accommodate the
<code class="literal">Choice_choice2</code> node.</p></li><li class="listitem"><p class="simpara">In the <code class="literal">Route_route2</code> container, select the
<code class="literal">direct:OrderFulfillment</code> node and drag its connector arrow over
the <code class="literal">Choice_choice2</code> node, then release it:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2Choice2Added.png" alt="tutCBRrte2Choice2Added"></div></div></li><li class="listitem">In the <code class="literal">Properties</code> view, leave each of the
<code class="literal">Choice_choice2</code> node&#8217;s properties as is.</li><li class="listitem"><p class="simpara">In the Palette, open the <code class="literal">Routing</code> drawer and drag a
<code class="literal">When</code> (
<span class="inlinemediaobject"><img src="images/endpointdef.png" alt="When icon"></span>) pattern to the canvas and drop it in the
<code class="literal">Choice_choice2</code> container:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2When2Added.png" alt="tutCBRrte2When2Added"></div></div><p class="simpara">The <code class="literal">Choice_choice2</code> container expands to accommodate the
<code class="literal">When_when2</code> node.</p></li><li class="listitem"><p class="simpara">On the canvas, select the <code class="literal">When_when2</code> node to open its properties in the
<code class="literal">Properties</code> view:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2When2usaProps.png" alt="tutCBRrte2When2usaProps"></div></div></li><li class="listitem"><p class="simpara">Set the node&#8217;s properties this way:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2WhenUSAprops.png" alt="tutCBRrte2WhenUSAprops"></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Select <code class="literal">xpath</code> from
the <code class="literal">Language</code> drop-down
menu.</li><li class="listitem">Enter <code class="literal">/order/customer/country = 'USA'</code> in the
<code class="literal">Expression</code>
field.</li><li class="listitem">Leave <code class="literal">Trim</code> enabled.</li><li class="listitem"><p class="simpara">Enter <code class="literal">_when/usa</code> in the <code class="literal">Id</code> field.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Once you select the expression <code class="literal">Language</code>, the
<code class="literal">Properties</code> view displays its properties in an
indented list directly below the <code class="literal">Language</code> field. The
<code class="literal">Id</code> property in this list sets the ID of the
expression. The <code class="literal">Id</code> property following the
<code class="literal">Description</code> field sets the ID of the
<code class="literal">When</code> node.</p></td></tr></table></div></li></ul></div></li><li class="listitem"><p class="simpara">In the <code class="literal">Palette</code>, open the
<code class="literal">Transformation</code> drawer and drag the <code class="literal">Set
Header</code> pattern to the canvas and drop on the
<code class="literal">When_when/usa</code> node:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2SetHeadUSAadd.png" alt="tutCBRrte2SetHeadUSAadd"></div></div><p class="simpara">The <code class="literal">When_when/usa</code> container expands to accommodate the
<code class="literal">SetHeader_setHeader3</code> node.</p></li><li class="listitem"><p class="simpara">On the canvas, select the <code class="literal">SetHeader_setHeader3</code> node to open its
properties in the <code class="literal">Properties</code> view:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCRErte2SetHead3Props.png" alt="tutCRErte2SetHead3Props"></div></div></li><li class="listitem"><p class="simpara">Set the node&#8217;s properties this way:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCRErte2SetHeadusaProps.png" alt="tutCRErte2SetHeadusaProps"></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Select <code class="literal">constant</code> from the
Language drop-down menu.</li><li class="listitem">Enter <code class="literal">USA</code> in the
<code class="literal">Expression</code> field.</li><li class="listitem">Leave <code class="literal">Trim</code> enabled.</li><li class="listitem">Enter <code class="literal">Destination</code> in the
<code class="literal">Header Name</code> field.</li><li class="listitem">Enter <code class="literal">_setHead_usa</code> in the
<code class="literal">Id</code> field.</li></ul></div></li><li class="listitem"><p class="simpara">In the <code class="literal">Palette</code>, open the <code class="literal">Components</code>
drawer and drag a <code class="literal">Log</code> component (
<span class="inlinemediaobject"><img src="images/log.png" alt="Log icon"></span>) to the canvas and drop it in the
<code class="literal">When_when/usa</code> container.</p><p class="simpara">The <code class="literal">When_when/usa</code> container expands to accommodate the
<code class="literal">Log_log3</code> node.</p></li><li class="listitem"><p class="simpara">On the canvas, select the <code class="literal">SetHeader_setHead_usa</code> node and drag its
connector arrow over the <code class="literal">Log_log3</code> node, then release
it:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2Log3Added.png" alt="tutCBRrte2Log3Added"></div></div></li><li class="listitem"><p class="simpara">On the canvas, select the <code class="literal">Log_log3</code> node to open its properties in the
<code class="literal">Properties</code> view:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrteLog3Props.png" alt="tutCBRrteLog3Props"></div></div></li><li class="listitem"><p class="simpara">In the <code class="literal">Properties</code> view:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2Log3usaAdded.png" alt="tutCBRrte2Log3usaAdded"></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Enter <code class="literal">Valid order - ship animals to USA
customer</code> in the <code class="literal">Message</code>
field.</li><li class="listitem">Enter <code class="literal">_usa</code> in the <code class="literal">Id</code>
field.</li><li class="listitem">Leave <code class="literal">Logging Level</code>
as is.</li></ul></div></li><li class="listitem"><p class="simpara">In the <code class="literal">Palette</code>, open the <code class="literal">Components</code>
drawer and drag a <code class="literal">File</code> component (
<span class="inlinemediaobject"><img src="images/file.png" alt="File icon"></span>) to the canvas and drop it in the
<code class="literal">When_when/usa</code> container.</p><p class="simpara">The <code class="literal">When_when/usa</code> container expands to accommodate the
<code class="literal">To_to1</code> node.</p></li><li class="listitem"><p class="simpara">On the canvas, select the <code class="literal">Log_usa</code> node and drag its connector arrow over
the <code class="literal">To_to1</code> node, then release it:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2USAtermFile.png" alt="tutCBRrte2USAtermFile"></div></div></li><li class="listitem"><p class="simpara">In the <code class="literal">Properties</code> view:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutRte2EndptUSA.png" alt="tutRte2EndptUSA"></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Replace <span class="emphasis"><em>directoryName</em></span> with
<code class="literal">target/messages/USA</code> in
the <code class="literal">Uri</code> field.</li><li class="listitem">Enter <code class="literal">_US</code> in the <code class="literal">Id</code>
field.</li></ul></div></li><li class="listitem"><p class="simpara">On the menu bar, click <span class="guimenu">File</span> &gt; <span class="guisubmenu"></span> &gt; <span class="guisubmenu"></span> &gt; <span class="guisubmenu"><code class="literal">Save</code></span> &gt; <span class="guimenuitem"></span> to save the routing context file.</p><p class="simpara">The USA branch of <code class="literal">Route_route2</code> should look like
this:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutUSAbranchRte2.png" alt="tutUSAbranchRte2"></div></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_building_and_configuring_the_great_britain_branch_of_the_second_route"></a>Building and configuring the Great Britain branch of the second route</h2></div></div></div><p>With <code class="literal">Route_route2</code> displayed on the canvas:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">In the <code class="literal">Palette</code>, open the <code class="literal">Routing</code>
drawer and drag a <code class="literal">When</code> pattern (
<span class="inlinemediaobject"><img src="images/endpointdef.png" alt="When icon"></span>) to the canvas and drop it in the
<code class="literal">Choice_choice2</code> container:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2WhenGBAdd.png" alt="tutCBRrte2WhenGBAdd"></div></div><p class="simpara">The <code class="literal">Choice_choice2</code> container expands to accommodate the
<code class="literal">When_when2</code> node.</p></li><li class="listitem">On the canvas, select the <code class="literal">When_when2</code> node to open its properties in the
<code class="literal">Properties</code> view.</li><li class="listitem"><p class="simpara">In the <code class="literal">Properties</code> view:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Select <code class="literal">xpath</code> from the
<code class="literal">Language</code> drop-down menu.</li><li class="listitem">Enter <code class="literal">/order/customer/country = 'Great
Britain'</code> in the <code class="literal">Expression</code>
field.</li><li class="listitem">Leave <code class="literal">Trim</code> enabled.</li><li class="listitem">Enter <code class="literal">_when/gb</code> in the
<code class="literal">Id</code> field.</li></ul></div></li><li class="listitem"><p class="simpara">In the <code class="literal">Palette</code>, open the
<code class="literal">Transformation</code> drawer and drag a <code class="literal">Set
Header</code> pattern (
<span class="inlinemediaobject"><img src="images/setHeader.png" alt="Set Header icon"></span>) to the canvas and drop it on the
<code class="literal">When_when/gb</code> node:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2SetHeadUKAdd.png" alt="tutCBRrte2SetHeadUKAdd"></div></div><p class="simpara">The <code class="literal">When_when/gb</code> container expands to accommodate the
<code class="literal">SetHeader_setHeader3</code> node.</p></li><li class="listitem">On the canvas, select the <code class="literal">SetHeader_setHeader3</code> node to open its
properties in the <code class="literal">Properties</code> view.</li><li class="listitem"><p class="simpara">In the <code class="literal">Properties</code> view:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Select <code class="literal">constant</code> from the
Language drop-down menu.</li><li class="listitem">Enter <code class="literal">UK</code> in the
<code class="literal">Expression</code> field.</li><li class="listitem">Leave <code class="literal">Trim</code> as is.</li><li class="listitem">Enter <code class="literal">Destination</code> in the <code class="literal">Header
Name</code> field.</li><li class="listitem">Enter<code class="literal">_setHead_uk</code> in the
<code class="literal">Id</code> field.</li></ul></div></li><li class="listitem"><p class="simpara">In the <code class="literal">Palette</code>, open the <code class="literal">Components</code> drawer and drag
a <code class="literal">Log</code> pattern (
<span class="inlinemediaobject"><img src="images/log.png" alt="Log icon"></span>) to the canvas and drop it in the
<code class="literal">When_when/gb</code> container.</p><p class="simpara">The <code class="literal">When_when/gb</code> container expands to accommodate the
<code class="literal">Log_log3</code> node.</p></li><li class="listitem"><p class="simpara">On the canvas, select the <code class="literal">SetHeader_setHead_uk</code> node and drag its
connector arrow over the <code class="literal">Log_log3</code> node, and then release
it:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2LogUKAdd.png" alt="tutCBRrte2LogUKAdd"></div></div></li><li class="listitem">On the canvas, select the <code class="literal">Log_log3</code> node to open its
properties in the <code class="literal">Properties</code> view.</li><li class="listitem"><p class="simpara">In the <code class="literal">Properties</code> view:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Enter <code class="literal">Valid order - ship animals to UK
customer</code> in the <code class="literal">Message</code>
field.</li><li class="listitem">Enter <code class="literal">_uk</code> in the <code class="literal">Id</code>
field.</li><li class="listitem">Leave the <code class="literal">Logging Level</code> as is.</li></ul></div></li><li class="listitem"><p class="simpara">From the <code class="literal">Components</code> drawer, drag a
<code class="literal">File</code> pattern (
<span class="inlinemediaobject"><img src="images/file.png" alt="File icon"></span>) to the canvas and drop it in the
<code class="literal">When_when/gb</code> container.</p><p class="simpara">The <code class="literal">When_when/gb</code> container expands to accommodate the
<code class="literal">To_to1</code> node.</p></li><li class="listitem"><p class="simpara">On the canvas, select the <code class="literal">Log_uk</code> node and drag its connector arrow over
the <code class="literal">To_to1</code> node, and then release it:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2UKtermFile.png" alt="tutCBRrte2UKtermFile"></div></div></li><li class="listitem">On the canvas, select the <code class="literal">To_to1</code> node to open its properties in the
<code class="literal">Properties</code> view.</li><li class="listitem"><p class="simpara">In the <code class="literal">Properties</code> view:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Replace <span class="emphasis"><em>directoryName</em></span> with
<code class="literal">target/messages/GreatBritain</code> in the
<code class="literal">Uri</code> field.</li><li class="listitem">Enter <code class="literal">_UK</code> in the <code class="literal">Id</code>
field.</li></ul></div></li><li class="listitem"><p class="simpara">On the menu bar, click <span class="guimenu">File</span> &gt; <span class="guisubmenu"></span> &gt; <span class="guisubmenu"></span> &gt; <span class="guisubmenu"><code class="literal">Save</code></span> &gt; <span class="guimenuitem"></span> to save the routing context file.</p><p class="simpara">The Great Britain branch of <code class="literal">Route_route2</code> should look
like this:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutUKbranchRte2.png" alt="tutUKbranchRte2"></div></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_building_and_configuring_the_germany_branch_of_the_second_route"></a>Building and configuring the Germany branch of the second route</h2></div></div></div><p>With <code class="literal">Route_route2</code> displayed on the canvas:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">In the <code class="literal">Palette</code>, open the <code class="literal">Routing</code>
drawer and drag a <code class="literal">When</code> pattern (
<span class="inlinemediaobject"><img src="images/endpointdef.png" alt="When icon"></span>) to the canvas and drop it in the
<code class="literal">Choice_choice2</code> container:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2WhenGERAdd.png" alt="tutCBRrte2WhenGERAdd"></div></div><p class="simpara">The <code class="literal">Choice_choice2</code> container expands to accommodate the
<code class="literal">When_when2</code> node.</p></li><li class="listitem">On the canvas, select the <code class="literal">When_when2</code> node to open its properties in the
<code class="literal">Properties</code> view.</li><li class="listitem"><p class="simpara">In the <code class="literal">Properties</code> view:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Select <code class="literal">xpath</code> from the
<code class="literal">Language</code> drop-down menu.</li><li class="listitem">Enter <code class="literal">/order/customer/country = 'Germany'</code>
in the <code class="literal">Expression</code> field.</li><li class="listitem">Leave <code class="literal">Trim</code> enabled.</li><li class="listitem">Enter <code class="literal">_when/ger</code> in the
<code class="literal">Id</code> field.</li></ul></div></li><li class="listitem"><p class="simpara">In the <code class="literal">Palette</code>, open the
<code class="literal">Transformation</code> drawer and drag a <code class="literal">Set
Header</code> pattern (
<span class="inlinemediaobject"><img src="images/setHeader.png" alt="Set Header icon"></span>) to the canvas and drop it on the
<code class="literal">When_when/ger</code> node:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2SetHeadGERAdd.png" alt="tutCBRrte2SetHeadGERAdd"></div></div><p class="simpara">The <code class="literal">When_when/ger</code> container expands to accommodate the
<code class="literal">SetHeader_setHeader3</code> node.</p></li><li class="listitem">On the canvas, select the <code class="literal">SetHeader_setHeader3</code> node to open its
properties in the <code class="literal">Properties</code> view.</li><li class="listitem"><p class="simpara">In the <code class="literal">Properties</code> view:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Select <code class="literal">constant</code> from the
Language drop-down menu.</li><li class="listitem">Enter <code class="literal">Germany</code> in the
<code class="literal">Expression</code> field.</li><li class="listitem">Leave <code class="literal">Trim</code> as is.</li><li class="listitem">Enter <code class="literal">Destination</code> in the <code class="literal">Header
Name</code> field.</li><li class="listitem">Enter<code class="literal">_setHead_ger</code> in the
<code class="literal">Id</code> field.</li></ul></div></li><li class="listitem"><p class="simpara">In the <code class="literal">Palette</code>, open the <code class="literal">Components</code> drawer and drag
a <code class="literal">Log</code> pattern (
<span class="inlinemediaobject"><img src="images/log.png" alt="Log icon"></span>) to the canvas and drop it in the
<code class="literal">When_when/ger</code> container.</p><p class="simpara">The <code class="literal">When_when/ger</code> container expands to accommodate the
<code class="literal">Log_log3</code> node.</p></li><li class="listitem"><p class="simpara">On the canvas, select the <code class="literal">SetHeader_setHead_ger</code> node and drag its
connector arrow over the <code class="literal">Log_log3</code> node, and then release
it:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2LogGERAdd.png" alt="tutCBRrte2LogGERAdd"></div></div></li><li class="listitem">On the canvas, select the <code class="literal">Log_log3</code> node to open its
properties in the <code class="literal">Properties</code> view.</li><li class="listitem"><p class="simpara">In the <code class="literal">Properties</code> view:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Enter <code class="literal">Valid order - ship animals to Germany
customer</code> in the <code class="literal">Message</code>
field.</li><li class="listitem">Enter <code class="literal">_ger</code> in the <code class="literal">Id</code>
field.</li><li class="listitem">Leave the <code class="literal">Logging Level</code> as is.</li></ul></div></li><li class="listitem"><p class="simpara">From the <code class="literal">Components</code> drawer, drag a
<code class="literal">File</code> pattern (
<span class="inlinemediaobject"><img src="images/file.png" alt="File icon"></span>) to the canvas and drop it in the
<code class="literal">When_when/ger</code> container.</p><p class="simpara">The <code class="literal">When_when/ger</code> container expands to accommodate the
<code class="literal">To_to1</code> node.</p></li><li class="listitem"><p class="simpara">On the canvas, select the <code class="literal">Log_ger</code> node and drag its connector arrow over
the <code class="literal">To_to1</code> node, and then release it:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2GERtermFile.png" alt="tutCBRrte2GERtermFile"></div></div></li><li class="listitem">On the canvas, select the <code class="literal">To_to1</code> node to open its properties in the
<code class="literal">Properties</code> view.</li><li class="listitem"><p class="simpara">In the <code class="literal">Properties</code> view:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Replace <span class="emphasis"><em>directoryName</em></span> with
<code class="literal">target/messages/Germany</code> in the
<code class="literal">Uri</code> field.</li><li class="listitem">Enter <code class="literal">_GER</code> in the <code class="literal">Id</code>
field.</li></ul></div></li><li class="listitem"><p class="simpara">On the menu bar, click <span class="guimenu">File</span> &gt; <span class="guisubmenu"></span> &gt; <span class="guisubmenu"></span> &gt; <span class="guisubmenu"><code class="literal">Save</code></span> &gt; <span class="guimenuitem"></span> to save the routing context file.</p><p class="simpara">The Germany branch of <code class="literal">Route_route2</code> should look like
this:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutGERbranchRte2.png" alt="tutGERbranchRte2"></div></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_building_and_configuring_the_france_branch_of_the_second_route"></a>Building and configuring the France branch of the second route</h2></div></div></div><p>With <code class="literal">Route_route2</code> displayed on the canvas:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">In the <code class="literal">Palette</code>, open the <code class="literal">Routing</code>
drawer and drag an <code class="literal">Otherwise</code> pattern (
<span class="inlinemediaobject"><img src="images/endpointdef.png" alt="Otherwise icon"></span>) to the canvas and drop it in the
<code class="literal">Choice_choice2</code> container:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2OtherFRAdd.png" alt="tutCBRrte2OtherFRAdd"></div></div><p class="simpara">The <code class="literal">Choice_choice2</code> container expands to accommodate the
<code class="literal">Otherwise_otherwise1</code> node.</p></li><li class="listitem">On the canvas, select the <code class="literal">Otherwise_otherwise1</code> node to open its
properties in the <code class="literal">Properties</code> view.</li><li class="listitem">In the <code class="literal">Properties</code> view, enter
<code class="literal">_else/fr</code> in the <code class="literal">Id</code> field.</li><li class="listitem"><p class="simpara">In the <code class="literal">Palette</code>, open the
<code class="literal">Transformation</code> drawer and drag a <code class="literal">Set
Header</code> pattern (
<span class="inlinemediaobject"><img src="images/setHeader.png" alt="Set Header icon"></span>) to the canvas and drop it on the
<code class="literal">Otherwise_else/fr</code> node:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2SetHeadFRAdd.png" alt="tutCBRrte2SetHeadFRAdd"></div></div><p class="simpara">The <code class="literal">Otherwise_else/fr</code> container expands to accommodate
the <code class="literal">SetHeader_setHeader3</code> node.</p></li><li class="listitem">On the canvas, select the <code class="literal">SetHeader_setHeader3</code> node to open its
properties in the <code class="literal">Properties</code> view.</li><li class="listitem"><p class="simpara">In the <code class="literal">Properties</code> view:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Select <code class="literal">constant</code> from the
Language drop-down menu.</li><li class="listitem">Enter <code class="literal">France</code> in the
<code class="literal">Expression</code> field.</li><li class="listitem">Leave <code class="literal">Trim</code> as is.</li><li class="listitem">Enter <code class="literal">Destination</code> in the <code class="literal">Header
Name</code> field.</li><li class="listitem">Enter<code class="literal">_setHead_fr</code> in the
<code class="literal">Id</code> field.</li></ul></div></li><li class="listitem"><p class="simpara">In the <code class="literal">Palette</code>, open the <code class="literal">Components</code> drawer and drag
a <code class="literal">Log</code> pattern (
<span class="inlinemediaobject"><img src="images/log.png" alt="Log icon"></span>) to the canvas and drop it in the
<code class="literal">Otherwise_else/fr</code> container.</p><p class="simpara">The <code class="literal">Otherwise_else/fr</code> container expands to accommodate
the <code class="literal">Log_log3</code> node.</p></li><li class="listitem"><p class="simpara">On the canvas, select the <code class="literal">SetHeader_setHead_fr</code> node and drag its
connector arrow over the <code class="literal">Log_log3</code> node, and then release
it:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2LogFRAdd.png" alt="tutCBRrte2LogFRAdd"></div></div></li><li class="listitem">On the canvas, select the <code class="literal">Log_log3</code> node to open its
properties in the <code class="literal">Properties</code> view.</li><li class="listitem"><p class="simpara">In the <code class="literal">Properties</code> view:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Enter <code class="literal">Valid order - ship animals to France
customer</code> in the <code class="literal">Message</code>
field.</li><li class="listitem">Enter <code class="literal">_fr</code> in the <code class="literal">Id</code>
field.</li><li class="listitem">Leave the <code class="literal">Logging Level</code> as is.</li></ul></div></li><li class="listitem"><p class="simpara">From the <code class="literal">Components</code> drawer, drag a
<code class="literal">File</code> pattern (
<span class="inlinemediaobject"><img src="images/file.png" alt="File icon"></span>) to the canvas and drop it in the
<code class="literal">Otherwise_else/fr</code> container.</p><p class="simpara">The <code class="literal">Otherwise_else/fr</code> container expands to accommodate
the <code class="literal">To_to1</code> node.</p></li><li class="listitem"><p class="simpara">On the canvas, select the <code class="literal">Log_fr</code> node and drag its connector arrow over
the <code class="literal">To_to1</code> node, and then release it:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2FRtermFile.png" alt="tutCBRrte2FRtermFile"></div></div></li><li class="listitem">On the canvas, select the <code class="literal">To_to1</code> node to open its properties in the
<code class="literal">Properties</code> view.</li><li class="listitem"><p class="simpara">In the <code class="literal">Properties</code> view:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Replace <span class="emphasis"><em>directoryName</em></span> with
<code class="literal">target/messages/France</code> in the
<code class="literal">Uri</code> field.</li><li class="listitem">Enter <code class="literal">_FR</code> in the <code class="literal">Id</code>
field.</li></ul></div></li><li class="listitem"><p class="simpara">On the menu bar, click <span class="guimenu">File</span> &gt; <span class="guisubmenu"></span> &gt; <span class="guisubmenu"></span> &gt; <span class="guisubmenu"><code class="literal">Save</code></span> &gt; <span class="guimenuitem"></span> to save the routing context file.</p><p class="simpara">The France branch of <code class="literal">Route_route2</code> should look like
this:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutFRbranchRte2.png" alt="tutFRbranchRte2"></div></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_finishing_up"></a>Finishing up</h2></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">If needed, on the menu bar, select <span class="guimenu">File</span> &gt; <span class="guisubmenu"></span> &gt; <span class="guisubmenu"></span> &gt; <span class="guisubmenu"><code class="literal">Save</code></span> &gt; <span class="guimenuitem"></span> to save the routing context.</p><p class="simpara">The routes on the canvas should look like this:</p><p><b>Completed route1.&nbsp;</b>image::./images/tutCBRRte1Completed.png[Completed first route in the CBRroute
                                    routing context]</p><p><b>Completed route2.&nbsp;</b>image::./images/tutCBRRte2Completed.png[Completed second route in the CBRroute
                                    routing context]</p></li><li class="listitem"><p class="simpara">Click the <code class="literal">Source</code> tab at the bottom,
left of the canvas to display the XML for the route.</p><p class="simpara">The camelContext element should look like that
shown in <a class="xref" href="RiderTutorialAddRoute.html#CBREx011" title="Example&nbsp;4.&nbsp;XML for dual-route content-based router">Example&nbsp;4, &#8220;XML for dual-route content-based router&#8221;</a>:</p><div class="example"><a name="CBREx011"></a><p class="title"><b>Example&nbsp;4.&nbsp;XML for dual-route content-based router</b></p><div class="example-contents"><pre class="screen">&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.osgi.org/xmlns/blueprint/v1.0.0
    https://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
    http://camel.apache.org/schema/blueprint
    http://camel.apache.org/schema/blueprint/camel-blueprint.xsd"&gt;

  &lt;camelContext id="_context1" xmlns="http://camel.apache.org/schema/blueprint"&gt;
      &lt;route id="_route1" shutdownRoute="Default"&gt;
          &lt;from id="_from1" uri="file:src/data?noop=true"/&gt;
          &lt;choice id="_choice1"&gt;
              &lt;when id="_when1"&gt;
                  &lt;xpath&gt;/order/orderline/quantity/text() &gt; /order/orderline/maxAllowed/text()&lt;/xpath&gt;
                  &lt;log id="_log1" message="quantity exceeds the maximum allowed - contact customer"/&gt;
                  &lt;setHeader headerName="Destination" id="_setHeader1"&gt;
                      &lt;constant&gt;InvalidOrders&lt;/constant&gt;
                  &lt;/setHeader&gt;
                  &lt;to id="_Invalid" uri="file:target/messages/invalidOrders"/&gt;
              &lt;/when&gt;
              &lt;otherwise id="_else2"&gt;
                  &lt;log id="_log2" message="valid order - process"/&gt;
                  &lt;setHeader headerName="Destination" id="_setHeader2"&gt;
                      &lt;constant&gt;Dispatcher&lt;/constant&gt;
                  &lt;/setHeader&gt;
                  &lt;to id="_Fulfill" uri="direct:OrderFulfillment"/&gt;
              &lt;/otherwise&gt;
          &lt;/choice&gt;
      &lt;/route&gt;
      &lt;route id="_route2"&gt;
          &lt;from id="_direct:OrderFulfillment" uri="direct:OrderFulfillment"/&gt;
          &lt;choice id="_choice2"&gt;
              &lt;when id="_when/usa"&gt;
                  &lt;xpath&gt;/order/customer/country = 'USA'&lt;/xpath&gt;
                  &lt;setHeader headerName="Destination" id="_setHead_usa"&gt;
                      &lt;constant&gt;USA&lt;/constant&gt;
                  &lt;/setHeader&gt;
                  &lt;log id="_usa" message="Valid order - ship to USA customer"/&gt;
                  &lt;to id="_US" uri="file:target/messages/USA"/&gt;
              &lt;/when&gt;
              &lt;when id="_when/gb"&gt;
                  &lt;xpath&gt;/order/customer/country = 'Great Britain'&lt;/xpath&gt;
                  &lt;setHeader headerName="Destination" id="_setHead_uk"&gt;
                      &lt;constant&gt;UK&lt;/constant&gt;
                  &lt;/setHeader&gt;
                  &lt;log id="_uk" message="Valid order - ship animals to UK customer"/&gt;
                  &lt;to id="_UK" uri="file:target/messages/GreatBritain"/&gt;
              &lt;/when&gt;
              &lt;when id="_when/ger"&gt;
                  &lt;xpath&gt;/order/customer/country = 'Germany'&lt;/xpath&gt;
                  &lt;setHeader headerName="Destination" id="_setHead_ger"&gt;
                      &lt;constant&gt;Germany&lt;/constant&gt;
                  &lt;/setHeader&gt;
                  &lt;log id="_ger" message="Valid order - ship to Germany customer"/&gt;
                  &lt;to id="_GER" uri="file:target/messages/Germany"/&gt;
              &lt;/when&gt;
              &lt;otherwise id="_else/fr"&gt;
                  &lt;setHeader headerName="Destination" id="_setHead_fr"&gt;
                      &lt;constant&gt;France&lt;/constant&gt;
                  &lt;/setHeader&gt;
                  &lt;log id="_fr" message="Valid order - ship animals to France customer"/&gt;
                  &lt;to id="_FR" uri="file:target/messages/France"/&gt;
              &lt;/otherwise&gt;
          &lt;/choice&gt;
      &lt;/route&gt;
  &lt;/camelContext&gt;
&lt;/blueprint&gt;</pre></div></div><br class="example-break"></li></ol></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="imagesdb/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>If the tooling added the attribute <code class="literal">shutdownRoute=" "</code> to the second route
element (<code class="literal">&lt;route id="route2"&gt;</code>), delete that attribute.
Otherwise, the <code class="literal">CBRroute</code> project might fail to run.</p></td></tr></table></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_next_steps_3"></a>Next steps</h2></div></div></div><p>You can run the new route as described in <a class="xref" href="RiderTutorialRun.html#RiderRunRun" title="Running the route">Running the route</a>.</p><p>Check the end of the Console&#8217;s output. You should see these
lines:</p><div class="informalfigure"><div class="mediaobject"><img src="./images/tutCBRrte2Console.png" alt="tutCBRrte2Console"></div></div><p>Check the target destinations in <code class="literal">Project
Explorer</code> to verify that the routes executed
properly:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Select <code class="literal">CBRroute</code>.</li><li class="listitem">Right-click it to open the context menu, then select
<code class="literal">Refresh</code>.</li><li class="listitem"><p class="simpara">Expand the folder <code class="literal">target/messages/</code> as
shown in <a class="xref" href="RiderTutorialAddRoute.html#tutDualCBRTarget" title="Figure&nbsp;2.&nbsp;Target message destinations in Project Explorer">Figure&nbsp;2, &#8220;Target message destinations in Project Explorer&#8221;</a>. The
<code class="literal">message*.xml</code> files should be
dispersed in your target destinations like this:</p><div class="figure"><a name="tutDualCBRTarget"></a><p class="title"><b>Figure&nbsp;2.&nbsp;Target message destinations in Project Explorer</b></p><div class="figure-contents"><div class="mediaobject"><img src="./images/tutDualCBRrteVerify.png" alt="message destinations"></div></div></div><br class="figure-break"><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>To view message content, double-click a message to open it in the route view&#8217;s XML
editor.</p></td></tr></table></div></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_further_reading_4"></a>Further reading</h2></div></div></div><p>To learn more about the <code class="literal">direct</code> component
see the <span class="emphasis"><em><span class="citetitle">Red Hat JBoss Fuse:
Apache Camel Component Reference</span></em></span> at <a class="link" href="https://access.redhat.com/documentation/en-US/Red_Hat_JBoss_Fuse/6.3/html/Apache_Camel_Component_Reference/IDU-Direct.html" target="_top">Red Hat JBoss Fuse 6.3 documentation</a></p></div></div></body></html>