<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>To Add a Content-Based Router</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><meta name="description" content="This tutorial walks you through adding a content-based router with logging to a route."><meta name="keywords" content="Apache Camel, Open Source, open source, Fuse, Red Hat, EIP, Enterprise Integration Patterns"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="RiderTutorials.html" title="Tutorials"><link rel="prev" href="RiderTutorialRun.html" title="To Run a Route"><link rel="next" href="RiderTutorialTrace.html" title="To Trace a Message Through a Route"><link rel="copyright" href="tmdisclaim.html" title="Trademark Disclaimer"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="RiderTutorialCBR"></a>To Add a Content-Based Router</h1></div><div><div class="abstract"><p>This tutorial walks you through adding a content-based router
                with logging to a route.</p></div></div></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e12715"></a>Goals</h2></div></div></div><p>In this tutorial you will:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>add a content based-router to a route</p></li><li class="listitem"><p>configure the content-based router</p></li><li class="listitem"><p>add a log endpoint to each output branch of the
                    content-based router</p></li><li class="listitem"><p>rewire the route to use the content-based router and log
                    its output</p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e12733"></a>Prerequisites</h2></div></div></div><p>To complete this tutorial you will need the <span class="bold"><strong>simple-route</strong></span> project you created in <a class="xref" href="RiderTutorialCreate.html" title="To Create a New Route"><i>To Create a New Route</i></a>.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e12743"></a>Procedure</h2></div></div></div><p>To add a content-based router with logging to your route:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>In <span class="guilabel">Project Explorer</span>, double-click
                        <code class="filename">simple-route/src/main/resources/META-INF/spring/camelContext.xml</code>
                    to open your <span class="guilabel">simple-route</span>
                    project.</p></li><li class="step"><p>Select the connector joining the two endpoint nodes
                        <code class="code">file:src/data?noop=true</code> and
                        <code class="code">file:target/messages/others</code>.</p></li><li class="step"><p>Right-click it to open the context menu, and select <span class="guimenu">Edit</span> &gt; <span class="guimenuitem">Remove</span> to delete the connector.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Alternatively, you can delete the connector by
                        selecting it, then selecting
                            <span class="guimenuitem">Delete</span> from the toolbar's
                            <span class="guimenu">Edit</span> menu.</p></td></tr></table></div></li><li class="step"><p>On the canvas, select the terminal endpoint node,
                        <code class="code">file:target/messages/others</code>, and drag it
                    out of the way.</p></li><li class="step"><p>On the canvas, select the starting endpoint node,
                        <code class="code">file:src/data?noop=true</code>, and right-click it
                    to open the context menu.</p></li><li class="step"><p>Select <span class="guimenu">Add</span> &gt; <span class="guisubmenu">Routing</span> &gt; <span class="guimenuitem">Choice</span>.</p><p>A <span class="guilabel">choice</span> node (<span class="inlinemediaobject"><img src="images/ChoiceElement.jpg" width="36.89999999999999" alt="choice icon"></span>) appears on the canvas connected to the
                    starting endpoint node.</p></li><li class="step"><p>On the canvas, select the <span class="guilabel">choice</span>
                    node, then right-click it to open the context menu.</p></li><li class="step"><p>Select
                            <span class="guimenu">Add</span> &gt; <span class="guisubmenu">Routing</span> &gt; <span class="guimenuitem">When</span>.</p><p>A <span class="guilabel">when</span> node (<span class="inlinemediaobject"><img src="images/endpoint.png" width="21" alt="when icon"></span>) appears on the canvas connected to the
                        <span class="guilabel">choice</span> node. The
                        <span class="guilabel">Properties</span> editor opens, displaying
                    the <span class="guilabel">when</span> node's property fields for you
                    to edit, as shown in <a class="xref" href="RiderTutorialCBR.html#RiderTutorialEnrichCBR010" title="Figure&nbsp;9.&nbsp;When property editor">Figure&nbsp;9</a>.</p><div class="figure"><a name="RiderTutorialEnrichCBR010"></a><p class="title"><b>Figure&nbsp;9.&nbsp;When property editor</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/tutWhen1propEd.jpg" align="middle" width="520" alt="when node property editor"></div></div></div><br class="figure-break"></li><li class="step"><p>In the <span class="guilabel">Expression</span> field, enter
                        <strong class="userinput"><code>/person/city='London'</code></strong> .</p><p>This XPath expression determines which messages will
                    transit this path in the route.</p></li><li class="step"><p>From the <span class="guilabel">Language</span> drop-down menu,
                    select <span class="guilabel">xpath</span>.</p></li><li class="step"><p>In the <span class="guilabel">Id</span> field, enter
                        <span class="guilabel">when1</span>.</p></li><li class="step"><p>On the canvas, reselect the <span class="bold"><strong>Choice</strong></span> node, then right-click it to open the
                    context menu.</p></li><li class="step"><p>Select <span class="guimenu">Add</span> &gt; <span class="guisubmenu">Routing</span> &gt; <span class="guimenuitem">Otherwise</span>.</p><p>An <span class="bold"><strong>otherwise</strong></span> node (<span class="inlinemediaobject"><img src="images/endpoint.png" width="21" alt="otherwise icon"></span>) appears on the canvas, connected to
                    the <span class="bold"><strong>choice</strong></span> node.</p><p>The <span class="bold"><strong>otherwise</strong></span> node will
                    eventually route to the terminal endpoint
                        (<code class="code">file:target/messages/others</code>) any message
                    that does not match the XPath expression set for the
                        <span class="bold"><strong>when1</strong></span> node.</p></li><li class="step"><p>On the canvas, select the <span class="guilabel">when1</span> node,
                    and then right-click it to open the context menu.</p></li><li class="step"><p>Select
                            <span class="guimenu">Add</span> &gt; <span class="guisubmenu">Endpoints</span> &gt; <span class="guimenuitem">Log</span></p><p>A <span class="bold"><strong>log</strong></span> node (<span class="inlinemediaobject"><img src="images/endpoint.png" width="21" alt="log icon"></span>) appears on the canvas, connected to
                    the <span class="bold"><strong>when1</strong></span> node. The
                        <span class="guilabel">Properties</span> editor opens, displaying
                    the <span class="guilabel">log</span> node's property fields for you
                    to edit.</p></li><li class="step"><p>In the <span class="guilabel">Message</span> field, enter
                        <strong class="userinput"><code>uk messages</code></strong>, and in the
                        <span class="guilabel">Log Name</span> field, enter
                        <strong class="userinput"><code>1</code></strong>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>In <span class="guilabel">Fuse Integration</span> perspective's
                            <span class="guilabel">Messages View</span>, the tooling
                        inserts the contents of the log node's
                            <span class="guilabel">Id</span> field in the <code class="code">Trace
                            Node Id</code> column for message instances, when
                        tracing is enabled on the route (see <a class="xref" href="RiderTutorialTrace.html#TutMessageTrace" title="Figure&nbsp;14.&nbsp;Fuse Integration perspective's message tracing components">Figure&nbsp;14</a>). In the <span class="guilabel">Console</span>, it adds the
                        contents of the log node's <span class="guilabel">Message</span>
                        field to the log data whenever the route runs.</p></td></tr></table></div></li><li class="step"><p>On the canvas, select the <span class="guilabel">otherwise</span>
                    node, and then right-click it to open the context
                    menu.</p></li><li class="step"><p>Select <span class="guimenu">Add</span> &gt; <span class="guisubmenu">Endpoints</span> &gt; <span class="guimenuitem">Log</span></p><p>A <span class="bold"><strong>log</strong></span> node (<span class="inlinemediaobject"><img src="images/endpoint.png" width="21" alt="log icon"></span>) appears on the canvas, connected to
                    the <span class="bold"><strong>otherwise</strong></span> node. The
                        <span class="guilabel">Properties</span> editor opens, displaying
                    the <span class="guilabel">log</span> node's property fields for you
                    to edit.</p></li><li class="step"><p>In the <span class="guilabel">Message</span> field, enter
                        <strong class="userinput"><code>other messages</code></strong>, and in the
                        <span class="guilabel">Log Name</span> field, enter
                        <strong class="userinput"><code>2</code></strong>.</p></li><li class="step"><p>On the canvas, select the <span class="guilabel">log 1</span> node,
                    and then right-click it to open the context menu.</p></li><li class="step"><p>Select
                            <span class="guimenu">Add</span> &gt; <span class="guisubmenu">Endpoints</span> &gt; <span class="guimenuitem">Endpoint</span></p><p>An <span class="bold"><strong>Endpoint</strong></span> node (<span class="inlinemediaobject"><img src="images/endpoint.png" width="21" alt="endpoint icon"></span>) appears on the canvas, connected to
                    the <span class="bold"><strong>log 1</strong></span> node. The
                        <span class="guilabel">Properties</span> editor opens, displaying
                    the <span class="guilabel">Endpoint</span> node's property fields for
                    you to edit.</p></li><li class="step"><p>In the <span class="guilabel">Uri</span> field, enter
                        <strong class="userinput"><code>file:target/messages/uk</code></strong>, and
                    leave the other property fields blank.</p></li><li class="step"><p>On the canvas, select the <span class="bold"><strong>log
                        2</strong></span> node, and then drag its connector arrow (<span class="inlinemediaobject"><img src="images/ConnectorArrow.jpg" width="16.799999999999997" alt="connector arrow icon"></span>) to the terminal endpoint node,
                        <code class="code">file:target/messages/others</code>, and release
                    it.</p></li><li class="step"><p>To quickly realign all of the nodes on the canvas,
                    right-click the canvas to open the context menu, and then
                    select <span class="guimenuitem">Layout Diagram</span>.</p><p>The route on the canvas should resemble <a class="xref" href="RiderTutorialCBR.html#RiderTutorialCBRImg020" title="Figure&nbsp;10.&nbsp;Completed content-based router with logs">Figure&nbsp;10</a>.</p><div class="figure"><a name="RiderTutorialCBRImg020"></a><p class="title"><b>Figure&nbsp;10.&nbsp;Completed content-based router with logs</b></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/tutCBRwLogs.jpg" align="middle" width="471.25" alt="content-based route with logging"></div></div></div><br class="figure-break"></li><li class="step"><p>On the toolbar, select <span class="guimenu">File</span> &gt; <span class="guimenuitem">Save</span> to save the completed route.</p></li><li class="step"><p>Click the <span class="guilabel">Source</span> tab at the bottom,
                    left of the canvas to display the XML for the route.</p><p>The <code class="sgmltag-element">camelContext</code> element will
                    look like that shown in <a class="xref" href="RiderTutorialCBR.html#CBREx010" title="Example&nbsp;3.&nbsp;XML for content-based router">Example&nbsp;3</a>.</p><div class="example"><a name="CBREx010"></a><p class="title"><b>Example&nbsp;3.&nbsp;XML for content-based router</b></p><div class="example-contents"><pre class="programlisting"><span xmlns="http://www.w3.org/1999/xhtml" class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;beans</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://www.springframework.org/schema/beans"</span>
       <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns:camel</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://camel.apache.org/schema/spring"</span>
       <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns:xsi</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://www.springframework.org/schema/beans 
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://camel.apache.org/schema/spring 
        http://camel.apache.org/schema/spring/camel-spring.xsd"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>

  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">trace</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"false"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://camel.apache.org/schema/spring"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;from</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"file:src/data?noop=true"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;choice&gt;</strong>
            <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;when</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"when1"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
                <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;xpath&gt;</strong>/person/city='London'<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/xpath&gt;</strong>
                <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;log</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">logName</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"1"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">message</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"uk messages"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
                <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"file:target/messages/uk"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
            <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/when&gt;</strong>
            <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;otherwise&gt;</strong>
                <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;log</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">logName</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"2"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">message</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"other messages"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
                <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"file:target/messages/others"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
            <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/otherwise&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/choice&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camelContext&gt;</strong>

<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/beans&gt;</strong></pre></div></div><br class="example-break"></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e13180"></a>Next steps</h2></div></div></div><p>You can run the new route as described in <a class="xref" href="RiderTutorialRun.html#RiderRunRun" title="Running the route">Running the route</a>.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e13187"></a>Further reading</h2></div></div></div><p>To learn more about message enrichment see:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>the <code class="code">when</code> EIP in <em class="citetitle">Red
                        Hat JBoss Fuse: Enterprise Implementing Integration
                        Patterns</em>
                </p></li><li class="listitem"><p>the <a class="link" href="https://access.redhat.com/site/documentation/JBoss_Fuse/" target="_top">Red
                        Hat JBoss Fuse 6.x documentation</a>
                </p></li></ul></div></div></div></body></html>